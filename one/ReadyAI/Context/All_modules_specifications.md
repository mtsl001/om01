# Configuration Management Module - Technical Specification

## **1. Module Overview**

**Purpose:** The Configuration Management Module serves as the centralized configuration management system for the entire ReadyAI application, handling environment variable validation, configuration schema management, settings persistence, and configuration hot reloading. This module ensures consistent and reliable configuration across all ReadyAI components while maintaining the local-first architecture principles defined in the HLSD.

**Dependencies:** This module implements the foundational environment variable management patterns defined in the Core Contracts document (`.env.template`) and provides the core configuration services that support the local-first architecture. It integrates directly with the `config` object structure defined in the Project Scaffolding and implements the Zod-based validation patterns for environment variables. The module serves as a critical dependency for all other P0 modules including Database Management, Vector Database Service, Claude Integration Service, and API Gateway Module.

## **2. Module-Specific Type Additions (`types.configuration.ts`)**

```typescript
/**
 * Configuration Management Module Types
 * Extends foundational types with configuration-specific interfaces
 */

/** Configuration change event types */
export type ConfigChangeEventType = 'updated' | 'reloaded' | 'validated' | 'error';

/** Configuration validation severity levels */
export type ValidationSeverity = 'error' | 'warning' | 'info';

/** Configuration source types */
export type ConfigSourceType = 'environment' | 'file' | 'database' | 'default';

/** Configuration scope levels */
export type ConfigScope = 'global' | 'project' | 'user' | 'session';

/** Configuration change event */
export interface ConfigChangeEvent {
  /** Unique event identifier */
  id: UUID;
  /** Type of configuration change */
  eventType: ConfigChangeEventType;
  /** Configuration key that changed */
  configKey: string;
  /** Previous value (if applicable) */
  previousValue?: any;
  /** New value */
  newValue?: any;
  /** Source of the change */
  source: ConfigSourceType;
  /** Timestamp of the change */
  timestamp: string; // ISO 8601 format
  /** Optional metadata */
  metadata?: Record<string, any>;
}

/** Configuration validation result */
export interface ConfigValidationResult {
  /** Validation identifier */
  id: UUID;
  /** Configuration key being validated */
  configKey: string;
  /** Whether validation passed */
  isValid: boolean;
  /** Validation severity */
  severity: ValidationSeverity;
  /** Error or warning message */
  message?: string;
  /** Expected value type or format */
  expectedFormat?: string;
  /** Actual value that failed validation */
  actualValue?: any;
  /** Validation timestamp */
  validatedAt: string; // ISO 8601 format
}

/** Configuration schema definition */
export interface ConfigSchemaDefinition {
  /** Configuration key */
  key: string;
  /** Human-readable description */
  description: string;
  /** Value type */
  type: 'string' | 'number' | 'boolean' | 'object' | 'array';
  /** Whether the configuration is required */
  required: boolean;
  /** Default value if not provided */
  defaultValue?: any;
  /** Validation pattern (for string types) */
  pattern?: string;
  /** Minimum value (for number types) */
  minimum?: number;
  /** Maximum value (for number types) */
  maximum?: number;
  /** Allowed values (enum) */
  allowedValues?: any[];
  /** Configuration scope */
  scope: ConfigScope;
  /** Whether this config supports hot reloading */
  hotReloadable: boolean;
  /** Dependencies on other config keys */
  dependencies?: string[];
}

/** Configuration watcher callback */
export interface ConfigWatcher {
  /** Unique watcher identifier */
  id: UUID;
  /** Configuration keys to watch */
  watchKeys: string[];
  /** Callback function to execute on change */
  callback: (event: ConfigChangeEvent) => void | Promise<void>;
  /** Whether watcher is currently active */
  active: boolean;
  /** Watcher creation timestamp */
  createdAt: string; // ISO 8601 format
}

/** Configuration backup */
export interface ConfigBackup {
  /** Backup identifier */
  id: UUID;
  /** Backup name/label */
  name: string;
  /** Configuration snapshot */
  configSnapshot: Record<string, any>;
  /** Backup creation timestamp */
  createdAt: string; // ISO 8601 format
  /** Backup description */
  description?: string;
  /** Whether this is an automatic backup */
  isAutomatic: boolean;
}

/** Configuration health status */
export interface ConfigHealth {
  /** Overall health status */
  status: 'healthy' | 'warning' | 'error';
  /** Total number of configurations */
  totalConfigs: number;
  /** Number of valid configurations */
  validConfigs: number;
  /** Number of configurations with warnings */
  warningConfigs: number;
  /** Number of invalid configurations */
  errorConfigs: number;
  /** Recent validation results */
  recentValidations: ConfigValidationResult[];
  /** Last health check timestamp */
  lastCheckedAt: string; // ISO 8601 format
}
```

## **3. API Endpoint Specification (OpenAPI `paths` block)**

```yaml
paths:
  /api/v1/config:
    get:
      tags:
        - Configuration
      summary: Get all configuration values
      description: Retrieves all configuration values with optional filtering by scope or keys
      security:
        - localAuth: []
      parameters:
        - name: scope
          in: query
          description: Filter configurations by scope
          required: false
          schema:
            type: string
            enum: [global, project, user, session]
        - name: keys
          in: query
          description: Comma-separated list of specific configuration keys to retrieve
          required: false
          schema:
            type: string
      responses:
        '200':
          description: Configuration values retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          configurations:
                            type: object
                            additionalProperties: true
                          totalCount:
                            type: integer
                          scope:
                            type: string
        '400':
          description: Invalid request parameters
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

    put:
      tags:
        - Configuration
      summary: Update configuration values
      description: Updates one or more configuration values with validation
      security:
        - localAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                configurations:
                  type: object
                  additionalProperties: true
                validateOnly:
                  type: boolean
                  default: false
                backup:
                  type: boolean
                  default: true
              required:
                - configurations
      responses:
        '200':
          description: Configuration values updated successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          updatedKeys:
                            type: array
                            items:
                              type: string
                          validationResults:
                            type: array
                            items:
                              $ref: '#/components/schemas/ConfigValidationResult'
                          backupId:
                            $ref: '#/components/schemas/UUID'
        '400':
          description: Validation errors or invalid configuration values
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiErrorResponse'
                  - type: object
                    properties:
                      error:
                        type: object
                        properties:
                          validationErrors:
                            type: array
                            items:
                              $ref: '#/components/schemas/ConfigValidationResult'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

  /api/v1/config/validate:
    post:
      tags:
        - Configuration
      summary: Validate configuration values
      description: Validates configuration values without applying changes
      security:
        - localAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                configurations:
                  type: object
                  additionalProperties: true
                strictMode:
                  type: boolean
                  default: false
              required:
                - configurations
      responses:
        '200':
          description: Validation completed
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          validationResults:
                            type: array
                            items:
                              $ref: '#/components/schemas/ConfigValidationResult'
                          overallStatus:
                            type: string
                            enum: [valid, warning, error]
        '400':
          description: Invalid request format
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

  /api/v1/config/schema:
    get:
      tags:
        - Configuration
      summary: Get configuration schema
      description: Retrieves the complete configuration schema definitions
      security:
        - localAuth: []
      responses:
        '200':
          description: Configuration schema retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          schemas:
                            type: array
                            items:
                              $ref: '#/components/schemas/ConfigSchemaDefinition'
                          version:
                            type: string

  /api/v1/config/reload:
    post:
      tags:
        - Configuration
      summary: Reload configuration from sources
      description: Triggers a reload of configuration from all sources (environment, files, etc.)
      security:
        - localAuth: []
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              properties:
                sources:
                  type: array
                  items:
                    type: string
                    enum: [environment, file, database, default]
                validateAfterReload:
                  type: boolean
                  default: true
      responses:
        '200':
          description: Configuration reloaded successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          reloadedKeys:
                            type: array
                            items:
                              type: string
                          validationResults:
                            type: array
                            items:
                              $ref: '#/components/schemas/ConfigValidationResult'
                          reloadedAt:
                            type: string
                            format: date-time

  /api/v1/config/backup:
    get:
      tags:
        - Configuration
      summary: List configuration backups
      description: Retrieves list of available configuration backups
      security:
        - localAuth: []
      parameters:
        - name: limit
          in: query
          description: Maximum number of backups to return
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
        - name: automaticOnly
          in: query
          description: Filter to automatic backups only
          required: false
          schema:
            type: boolean
      responses:
        '200':
          description: Backup list retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          backups:
                            type: array
                            items:
                              $ref: '#/components/schemas/ConfigBackup'
                          totalCount:
                            type: integer

    post:
      tags:
        - Configuration
      summary: Create configuration backup
      description: Creates a new backup of current configuration
      security:
        - localAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  minLength: 1
                  maxLength: 100
                description:
                  type: string
                  maxLength: 500
                includeSecrets:
                  type: boolean
                  default: false
              required:
                - name
      responses:
        '201':
          description: Backup created successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/ConfigBackup'

  /api/v1/config/backup/{backupId}:
    get:
      tags:
        - Configuration
      summary: Get specific backup details
      description: Retrieves details of a specific configuration backup
      security:
        - localAuth: []
      parameters:
        - name: backupId
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '200':
          description: Backup details retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/ConfigBackup'
        '404':
          description: Backup not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

    delete:
      tags:
        - Configuration
      summary: Delete configuration backup
      description: Deletes a specific configuration backup
      security:
        - localAuth: []
      parameters:
        - name: backupId
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '200':
          description: Backup deleted successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '404':
          description: Backup not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

  /api/v1/config/restore/{backupId}:
    post:
      tags:
        - Configuration
      summary: Restore from backup
      description: Restores configuration from a specific backup
      security:
        - localAuth: []
      parameters:
        - name: backupId
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              properties:
                selectedKeys:
                  type: array
                  items:
                    type: string
                validateBeforeRestore:
                  type: boolean
                  default: true
                createBackupBeforeRestore:
                  type: boolean
                  default: true
      responses:
        '200':
          description: Configuration restored successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          restoredKeys:
                            type: array
                            items:
                              type: string
                          preRestoreBackupId:
                            $ref: '#/components/schemas/UUID'
                          restoredAt:
                            type: string
                            format: date-time

  /api/v1/config/health:
    get:
      tags:
        - Configuration
      summary: Get configuration health status
      description: Retrieves the current health status of the configuration system
      security:
        - localAuth: []
      responses:
        '200':
          description: Configuration health status retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/ConfigHealth'

  /api/v1/config/watchers:
    get:
      tags:
        - Configuration
      summary: List configuration watchers
      description: Retrieves list of active configuration watchers
      security:
        - localAuth: []
      responses:
        '200':
          description: Watchers list retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          watchers:
                            type: array
                            items:
                              $ref: '#/components/schemas/ConfigWatcher'
                          activeCount:
                            type: integer

components:
  schemas:
    ConfigValidationResult:
      type: object
      required:
        - id
        - configKey
        - isValid
        - severity
        - validatedAt
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        configKey:
          type: string
        isValid:
          type: boolean
        severity:
          type: string
          enum: [error, warning, info]
        message:
          type: string
        expectedFormat:
          type: string
        actualValue:
          oneOf:
            - type: string
            - type: number
            - type: boolean
            - type: object
        validatedAt:
          type: string
          format: date-time

    ConfigSchemaDefinition:
      type: object
      required:
        - key
        - description
        - type
        - required
        - scope
        - hotReloadable
      properties:
        key:
          type: string
        description:
          type: string
        type:
          type: string
          enum: [string, number, boolean, object, array]
        required:
          type: boolean
        defaultValue:
          oneOf:
            - type: string
            - type: number
            - type: boolean
            - type: object
        pattern:
          type: string
        minimum:
          type: number
        maximum:
          type: number
        allowedValues:
          type: array
          items: {}
        scope:
          type: string
          enum: [global, project, user, session]
        hotReloadable:
          type: boolean
        dependencies:
          type: array
          items:
            type: string

    ConfigWatcher:
      type: object
      required:
        - id
        - watchKeys
        - active
        - createdAt
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        watchKeys:
          type: array
          items:
            type: string
        active:
          type: boolean
        createdAt:
          type: string
          format: date-time

    ConfigBackup:
      type: object
      required:
        - id
        - name
        - configSnapshot
        - createdAt
        - isAutomatic
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        name:
          type: string
        configSnapshot:
          type: object
          additionalProperties: true
        createdAt:
          type: string
          format: date-time
        description:
          type: string
        isAutomatic:
          type: boolean

    ConfigHealth:
      type: object
      required:
        - status
        - totalConfigs
        - validConfigs
        - warningConfigs
        - errorConfigs
        - recentValidations
        - lastCheckedAt
      properties:
        status:
          type: string
          enum: [healthy, warning, error]
        totalConfigs:
          type: integer
        validConfigs:
          type: integer
        warningConfigs:
          type: integer
        errorConfigs:
          type: integer
        recentValidations:
          type: array
          items:
            $ref: '#/components/schemas/ConfigValidationResult'
        lastCheckedAt:
          type: string
          format: date-time
```

## **4. Detailed Business Logic & Validation Rules**

| Rule ID | Rule Description | Implementation Location(s) & Notes |
|---------|------------------|-----------------------------------|
| **CFG-01** | All required environment variables must be present and valid before the application can start. | **Backend (Authoritative):** Environment validation in `config/environment.ts` using Zod schema validation. Application startup must fail if critical configurations are missing. |
| **CFG-02** | Configuration changes must be validated against the schema before being applied to prevent system instability. | **Backend (Authoritative):** Validation service layer that runs Zod validation on all configuration updates. Frontend provides immediate feedback but backend is authoritative. |
| **CFG-03** | Sensitive configuration values (API keys, secrets) must never be logged or exposed in plain text through APIs. | **Backend (Authoritative):** Logging service must mask sensitive values. API responses must redact secrets. Use environment variable patterns to identify sensitive keys. |
| **CFG-04** | Configuration backups must be created automatically before any configuration changes are applied. | **Backend (Authoritative):** Backup service automatically creates snapshots before applying changes. Configurable retention policy (default 30 days per Core Contracts). |
| **CFG-05** | Hot reloading must only affect configurations marked as `hotReloadable: true` in the schema to prevent system disruption. | **Backend (Authoritative):** Configuration schema validation ensures only safe configurations can be hot-reloaded. Critical system configs require restart. |
| **CFG-06** | Configuration watchers must be automatically cleaned up when their associated components are destroyed to prevent memory leaks. | **Backend (Authoritative):** Watcher registry with automatic cleanup on component disposal. Frontend components must properly unregister watchers on unmount. |
| **CFG-07** | Database and vector database connection configurations must be validated by attempting actual connections during validation. | **Backend (Authoritative):** Connection validation service that performs health checks against configured database endpoints as part of validation process. |
| **CFG-08** | OpenRouter API key must be validated by making a test API call during configuration validation. | **Backend (Authoritative):** API key validation service that performs authentication check with OpenRouter during config validation. |
| **CFG-09** | Configuration restore operations must validate restored configurations before applying them to prevent invalid state. | **Backend (Authoritative):** Restore service must run full validation pipeline on backup data before applying any changes. |
| **CFG-10** | Milvus vector database configuration must validate host/port connectivity and verify the embedding model is accessible. | **Backend (Authoritative):** Vector database validation service that checks Milvus connectivity and sentence-transformer model availability. |

## **5. Developer Task Checklist**

### **Backend Tasks:**
- [ ] Create database migration script for configuration tables (`config_definitions`, `config_backups`, `config_watchers`, `config_audit_log`)
- [ ] Implement the `ConfigurationService` class with environment validation, schema management, and hot reloading capabilities
- [ ] Implement the `GET /api/v1/config` endpoint with scope filtering and key selection functionality
- [ ] Implement the `PUT /api/v1/config` endpoint with comprehensive validation and backup creation
- [ ] Implement the `POST /api/v1/config/validate` endpoint for configuration validation without applying changes
- [ ] Implement the `GET /api/v1/config/schema` endpoint to serve configuration schema definitions
- [ ] Implement the `POST /api/v1/config/reload` endpoint for hot configuration reloading
- [ ] Implement configuration backup management endpoints (`GET`, `POST /api/v1/config/backup`, `DELETE /api/v1/config/backup/{id}`)
- [ ] Implement configuration restore endpoint (`POST /api/v1/config/restore/{backupId}`)
- [ ] Implement the `GET /api/v1/config/health` endpoint for configuration system health monitoring
- [ ] Implement configuration watcher management (`GET /api/v1/config/watchers`)
- [ ] Create `ConfigurationRepository` class for database operations with proper error handling
- [ ] Implement `ConfigValidationService` with Zod schema integration and custom validation rules
- [ ] Implement `ConfigBackupService` with automatic backup creation and retention management
- [ ] Implement `ConfigWatcherService` for managing configuration change notifications
- [ ] Create comprehensive unit tests for all service classes with edge case coverage
- [ ] Create integration tests for all API endpoints including error scenarios
- [ ] Implement configuration audit logging for compliance and debugging
- [ ] Add configuration health checks to system monitoring

### **Frontend Tasks:**
- [ ] Create `ConfigurationProvider` React context for global configuration state management
- [ ] Implement `useConfiguration` hook for accessing and updating configuration values
- [ ] Create `ConfigurationPanel` component for the settings page with tabbed interface
- [ ] Implement `ConfigurationEditor` component for editing individual configuration values with validation
- [ ] Create `ConfigurationValidation` component to display validation results and errors
- [ ] Implement `ConfigurationBackup` component for managing configuration backups and restoration
- [ ] Create `ConfigurationHealth` component to display system configuration health status
- [ ] Implement configuration service functions in the API client (`configService.ts`)
- [ ] Integrate configuration management into the main application settings interface
- [ ] Implement real-time configuration updates using the watcher system
- [ ] Create configuration import/export functionality for advanced users
- [ ] Add configuration search and filtering capabilities in the UI
- [ ] Implement configuration validation feedback with inline error messages
- [ ] Create configuration backup scheduling interface
- [ ] Add configuration change history and diff viewing capabilities
- [ ] Implement configuration templates and presets for common setups

========================================================================================


# Logging & Monitoring Service - Technical Specification

## **1. Module Overview**

**Purpose:** The Logging & Monitoring Service serves as the centralized logging, error tracking, and system monitoring infrastructure for the entire ReadyAI application. This module provides structured logging capabilities, performance monitoring, error tracking with detailed context, and usage analytics to support the local-first architecture while ensuring comprehensive observability across all ReadyAI components including the VS Code extension, backend services, and AI integration workflows.

**Dependencies & Interactions:** This module depends on the Configuration Management Module to obtain logging configuration settings, log levels, retention policies, and monitoring thresholds. It interacts with all other ReadyAI modules by receiving log events, error reports, and performance metrics. The module integrates with the Multi-Phase Development Orchestrator to track phase progression metrics, with the Claude Integration Service to monitor AI generation performance and token usage, and with the Context Management Engine to track context retrieval performance against the <3 second KPI requirement. It also provides logging infrastructure that other modules use for audit trails and debugging.

## **2. Module-Specific Type Additions (`types.logging.ts`)**

```typescript
/**
 * Logging & Monitoring Service Module Types
 * Extends foundational types with logging and monitoring interfaces
 */

/** Log severity levels */
export type LogLevel = 'debug' | 'info' | 'warn' | 'error' | 'fatal';

/** Log categories for organizing log entries */
export type LogCategory = 
  | 'system'
  | 'api'
  | 'ai_generation'
  | 'context_management'
  | 'user_action'
  | 'performance'
  | 'security'
  | 'database'
  | 'file_system'
  | 'configuration'
  | 'phase_progression';

/** Performance metric types */
export type MetricType = 
  | 'counter'
  | 'gauge'
  | 'histogram'
  | 'timer'
  | 'memory_usage'
  | 'api_response_time'
  | 'context_retrieval_time'
  | 'ai_generation_time';

/** Error classification levels */
export type ErrorSeverity = 'low' | 'medium' | 'high' | 'critical';

/** Log entry structure */
export interface LogEntry {
  /** Unique log entry identifier */
  id: UUID;
  /** Log severity level */
  level: LogLevel;
  /** Log category */
  category: LogCategory;
  /** Log message */
  message: string;
  /** Timestamp when log was created */
  timestamp: string; // ISO 8601 format
  /** Source component or module */
  source: string;
  /** Optional project context */
  projectId?: UUID;
  /** Optional user session context */
  sessionId?: string;
  /** Optional request correlation ID */
  correlationId?: string;
  /** Additional structured data */
  metadata?: Record<string, any>;
  /** Stack trace for errors */
  stackTrace?: string;
  /** Request/response context for API logs */
  requestContext?: {
    method: string;
    url: string;
    userAgent?: string;
    ip?: string;
    responseTime?: number;
    statusCode?: number;
  };
}

/** Performance metric entry */
export interface PerformanceMetric {
  /** Unique metric identifier */
  id: UUID;
  /** Metric name/identifier */
  name: string;
  /** Type of metric */
  type: MetricType;
  /** Metric value */
  value: number;
  /** Metric unit (ms, bytes, count, etc.) */
  unit: string;
  /** Timestamp when metric was recorded */
  timestamp: string; // ISO 8601 format
  /** Source component */
  source: string;
  /** Optional project context */
  projectId?: UUID;
  /** Optional additional tags */
  tags?: Record<string, string>;
  /** Optional metadata */
  metadata?: Record<string, any>;
}

/** Error tracking entry */
export interface ErrorEntry {
  /** Unique error identifier */
  id: UUID;
  /** Error message */
  message: string;
  /** Error type/name */
  errorType: string;
  /** Error severity classification */
  severity: ErrorSeverity;
  /** Stack trace */
  stackTrace?: string;
  /** Source component where error occurred */
  source: string;
  /** Timestamp when error occurred */
  timestamp: string; // ISO 8601 format
  /** Optional project context */
  projectId?: UUID;
  /** Optional user session context */
  sessionId?: string;
  /** Request correlation ID */
  correlationId?: string;
  /** Additional error context */
  context?: Record<string, any>;
  /** Whether error was handled or unhandled */
  handled: boolean;
  /** Error resolution status */
  resolved: boolean;
  /** Number of times this error has occurred */
  occurrenceCount: number;
  /** First occurrence timestamp */
  firstOccurrence: string; // ISO 8601 format
  /** Last occurrence timestamp */
  lastOccurrence: string; // ISO 8601 format
}

/** System health status */
export interface SystemHealth {
  /** Overall system health */
  status: 'healthy' | 'degraded' | 'unhealthy';
  /** Health check timestamp */
  timestamp: string; // ISO 8601 format
  /** Individual component health */
  components: {
    database: ComponentHealth;
    vectorDatabase: ComponentHealth;
    aiProvider: ComponentHealth;
    fileSystem: ComponentHealth;
    configuration: ComponentHealth;
  };
  /** Recent performance metrics summary */
  performance: {
    avgContextRetrievalTime: number;
    avgAiGenerationTime: number;
    avgApiResponseTime: number;
    errorRate: number;
    memoryUsage: number;
    diskUsage: number;
  };
  /** Recent errors summary */
  recentErrors: {
    criticalCount: number;
    highCount: number;
    mediumCount: number;
    lowCount: number;
  };
}

/** Individual component health status */
export interface ComponentHealth {
  /** Component status */
  status: 'healthy' | 'degraded' | 'unhealthy';
  /** Last health check timestamp */
  lastChecked: string; // ISO 8601 format
  /** Response time in milliseconds */
  responseTime?: number;
  /** Additional status details */
  details?: string;
  /** Error information if unhealthy */
  error?: string;
}

/** Usage analytics summary */
export interface UsageAnalytics {
  /** Analytics period identifier */
  id: UUID;
  /** Start of analytics period */
  periodStart: string; // ISO 8601 format
  /** End of analytics period */
  periodEnd: string; // ISO 8601 format
  /** Total number of projects */
  totalProjects: number;
  /** Total AI generations */
  totalGenerations: number;
  /** Total context retrievals */
  totalContextRetrievals: number;
  /** Average context retrieval time */
  avgContextRetrievalTime: number;
  /** Average AI generation time */
  avgAiGenerationTime: number;
  /** Total API requests */
  totalApiRequests: number;
  /** Average API response time */
  avgApiResponseTime: number;
  /** Error statistics */
  errorStats: {
    totalErrors: number;
    errorsByLevel: Record<LogLevel, number>;
    errorsBySeverity: Record<ErrorSeverity, number>;
  };
  /** Most active phases */
  phaseActivity: Record<PhaseType, number>;
  /** Token usage statistics */
  tokenUsage: {
    totalTokens: number;
    inputTokens: number;
    outputTokens: number;
    avgTokensPerGeneration: number;
  };
}

/** Log query parameters */
export interface LogQuery {
  /** Log levels to include */
  levels?: LogLevel[];
  /** Categories to filter by */
  categories?: LogCategory[];
  /** Source components to filter by */
  sources?: string[];
  /** Project ID filter */
  projectId?: UUID;
  /** Session ID filter */
  sessionId?: string;
  /** Start time for log range */
  startTime?: string; // ISO 8601 format
  /** End time for log range */
  endTime?: string; // ISO 8601 format
  /** Search text in log messages */
  searchText?: string;
  /** Correlation ID filter */
  correlationId?: string;
  /** Maximum number of results */
  limit?: number;
  /** Offset for pagination */
  offset?: number;
}

/** Monitoring alert configuration */
export interface AlertConfig {
  /** Alert identifier */
  id: UUID;
  /** Alert name */
  name: string;
  /** Alert description */
  description?: string;
  /** Whether alert is enabled */
  enabled: boolean;
  /** Metric or condition to monitor */
  condition: {
    metric: string;
    operator: 'gt' | 'lt' | 'eq' | 'gte' | 'lte';
    threshold: number;
    timeWindow: number; // seconds
  };
  /** Alert severity */
  severity: 'info' | 'warning' | 'critical';
  /** Alert actions */
  actions: {
    logAlert: boolean;
    emailNotification?: boolean;
    webhookUrl?: string;
  };
  /** Alert creation timestamp */
  createdAt: string; // ISO 8601 format
  /** Last triggered timestamp */
  lastTriggered?: string; // ISO 8601 format
}
```

## **3. API Endpoint Specification (OpenAPI `paths` block)**

```yaml
paths:
  /api/v1/logging/logs:
    get:
      tags:
        - Logging
      summary: Query log entries
      description: Retrieves log entries with filtering, searching, and pagination capabilities
      security:
        - localAuth: []
      parameters:
        - name: levels
          in: query
          description: Comma-separated log levels to filter by
          required: false
          schema:
            type: string
            example: "info,warn,error"
        - name: categories
          in: query
          description: Comma-separated categories to filter by
          required: false
          schema:
            type: string
            example: "api,ai_generation"
        - name: sources
          in: query
          description: Comma-separated source components to filter by
          required: false
          schema:
            type: string
        - name: projectId
          in: query
          description: Filter logs by project ID
          required: false
          schema:
            $ref: '#/components/schemas/UUID'
        - name: sessionId
          in: query
          description: Filter logs by session ID
          required: false
          schema:
            type: string
        - name: startTime
          in: query
          description: Start time for log range (ISO 8601)
          required: false
          schema:
            type: string
            format: date-time
        - name: endTime
          in: query
          description: End time for log range (ISO 8601)
          required: false
          schema:
            type: string
            format: date-time
        - name: searchText
          in: query
          description: Search text in log messages
          required: false
          schema:
            type: string
        - name: correlationId
          in: query
          description: Filter by correlation ID
          required: false
          schema:
            type: string
        - name: limit
          in: query
          description: Maximum number of results
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 1000
            default: 100
        - name: offset
          in: query
          description: Offset for pagination
          required: false
          schema:
            type: integer
            minimum: 0
            default: 0
      responses:
        '200':
          description: Log entries retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          logs:
                            type: array
                            items:
                              $ref: '#/components/schemas/LogEntry'
                          totalCount:
                            type: integer
                          hasMore:
                            type: boolean
        '400':
          description: Invalid query parameters
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

    post:
      tags:
        - Logging
      summary: Create log entry
      description: Creates a new log entry (typically used by other system components)
      security:
        - localAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                level:
                  type: string
                  enum: [debug, info, warn, error, fatal]
                category:
                  type: string
                  enum: [system, api, ai_generation, context_management, user_action, performance, security, database, file_system, configuration, phase_progression]
                message:
                  type: string
                  minLength: 1
                source:
                  type: string
                  minLength: 1
                projectId:
                  $ref: '#/components/schemas/UUID'
                sessionId:
                  type: string
                correlationId:
                  type: string
                metadata:
                  type: object
                stackTrace:
                  type: string
                requestContext:
                  type: object
                  properties:
                    method:
                      type: string
                    url:
                      type: string
                    userAgent:
                      type: string
                    ip:
                      type: string
                    responseTime:
                      type: number
                    statusCode:
                      type: integer
              required:
                - level
                - category
                - message
                - source
      responses:
        '201':
          description: Log entry created successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/LogEntry'
        '400':
          description: Invalid log entry data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

  /api/v1/logging/metrics:
    get:
      tags:
        - Monitoring
      summary: Query performance metrics
      description: Retrieves performance metrics with filtering and aggregation options
      security:
        - localAuth: []
      parameters:
        - name: type
          in: query
          description: Metric type filter
          required: false
          schema:
            type: string
            enum: [counter, gauge, histogram, timer, memory_usage, api_response_time, context_retrieval_time, ai_generation_time]
        - name: source
          in: query
          description: Source component filter
          required: false
          schema:
            type: string
        - name: projectId
          in: query
          description: Project ID filter
          required: false
          schema:
            $ref: '#/components/schemas/UUID'
        - name: startTime
          in: query
          description: Start time for metric range
          required: false
          schema:
            type: string
            format: date-time
        - name: endTime
          in: query
          description: End time for metric range
          required: false
          schema:
            type: string
            format: date-time
        - name: aggregation
          in: query
          description: Aggregation method
          required: false
          schema:
            type: string
            enum: [avg, sum, min, max, count]
            default: avg
        - name: interval
          in: query
          description: Aggregation interval in seconds
          required: false
          schema:
            type: integer
            minimum: 60
            default: 300
      responses:
        '200':
          description: Performance metrics retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          metrics:
                            type: array
                            items:
                              $ref: '#/components/schemas/PerformanceMetric'
                          aggregatedMetrics:
                            type: array
                            items:
                              type: object
                              properties:
                                timestamp:
                                  type: string
                                  format: date-time
                                value:
                                  type: number
                                count:
                                  type: integer

    post:
      tags:
        - Monitoring
      summary: Record performance metric
      description: Records a new performance metric (typically used by other system components)
      security:
        - localAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  minLength: 1
                type:
                  type: string
                  enum: [counter, gauge, histogram, timer, memory_usage, api_response_time, context_retrieval_time, ai_generation_time]
                value:
                  type: number
                unit:
                  type: string
                  minLength: 1
                source:
                  type: string
                  minLength: 1
                projectId:
                  $ref: '#/components/schemas/UUID'
                tags:
                  type: object
                  additionalProperties:
                    type: string
                metadata:
                  type: object
              required:
                - name
                - type
                - value
                - unit
                - source
      responses:
        '201':
          description: Performance metric recorded successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/PerformanceMetric'

  /api/v1/logging/errors:
    get:
      tags:
        - Logging
      summary: Query error entries
      description: Retrieves error entries with filtering and grouping options
      security:
        - localAuth: []
      parameters:
        - name: severity
          in: query
          description: Error severity filter
          required: false
          schema:
            type: string
            enum: [low, medium, high, critical]
        - name: source
          in: query
          description: Source component filter
          required: false
          schema:
            type: string
        - name: projectId
          in: query
          description: Project ID filter
          required: false
          schema:
            $ref: '#/components/schemas/UUID'
        - name: resolved
          in: query
          description: Filter by resolution status
          required: false
          schema:
            type: boolean
        - name: startTime
          in: query
          description: Start time for error range
          required: false
          schema:
            type: string
            format: date-time
        - name: endTime
          in: query
          description: End time for error range
          required: false
          schema:
            type: string
            format: date-time
        - name: groupBy
          in: query
          description: Group errors by field
          required: false
          schema:
            type: string
            enum: [errorType, source, severity]
      responses:
        '200':
          description: Error entries retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          errors:
                            type: array
                            items:
                              $ref: '#/components/schemas/ErrorEntry'
                          groupedErrors:
                            type: object
                            additionalProperties:
                              type: array
                              items:
                                $ref: '#/components/schemas/ErrorEntry'

    post:
      tags:
        - Logging
      summary: Report error
      description: Reports a new error occurrence
      security:
        - localAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                message:
                  type: string
                  minLength: 1
                errorType:
                  type: string
                  minLength: 1
                severity:
                  type: string
                  enum: [low, medium, high, critical]
                stackTrace:
                  type: string
                source:
                  type: string
                  minLength: 1
                projectId:
                  $ref: '#/components/schemas/UUID'
                sessionId:
                  type: string
                correlationId:
                  type: string
                context:
                  type: object
                handled:
                  type: boolean
                  default: true
              required:
                - message
                - errorType
                - severity
                - source
      responses:
        '201':
          description: Error reported successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/ErrorEntry'

  /api/v1/logging/errors/{errorId}/resolve:
    patch:
      tags:
        - Logging
      summary: Mark error as resolved
      description: Marks a specific error as resolved
      security:
        - localAuth: []
      parameters:
        - name: errorId
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '200':
          description: Error marked as resolved
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/ErrorEntry'
        '404':
          description: Error not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

  /api/v1/monitoring/health:
    get:
      tags:
        - Monitoring
      summary: Get system health status
      description: Retrieves comprehensive system health information including component status and performance metrics
      security:
        - localAuth: []
      responses:
        '200':
          description: System health retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/SystemHealth'

  /api/v1/monitoring/analytics:
    get:
      tags:
        - Monitoring
      summary: Get usage analytics
      description: Retrieves usage analytics for specified time periods
      security:
        - localAuth: []
      parameters:
        - name: period
          in: query
          description: Analytics period
          required: false
          schema:
            type: string
            enum: [hour, day, week, month]
            default: day
        - name: startDate
          in: query
          description: Start date for analytics period
          required: false
          schema:
            type: string
            format: date
        - name: endDate
          in: query
          description: End date for analytics period
          required: false
          schema:
            type: string
            format: date
      responses:
        '200':
          description: Usage analytics retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/UsageAnalytics'

  /api/v1/monitoring/alerts:
    get:
      tags:
        - Monitoring
      summary: List monitoring alerts
      description: Retrieves configured monitoring alerts
      security:
        - localAuth: []
      responses:
        '200':
          description: Monitoring alerts retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          alerts:
                            type: array
                            items:
                              $ref: '#/components/schemas/AlertConfig'

    post:
      tags:
        - Monitoring
      summary: Create monitoring alert
      description: Creates a new monitoring alert configuration
      security:
        - localAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  minLength: 1
                  maxLength: 100
                description:
                  type: string
                  maxLength: 500
                enabled:
                  type: boolean
                  default: true
                condition:
                  type: object
                  properties:
                    metric:
                      type: string
                    operator:
                      type: string
                      enum: [gt, lt, eq, gte, lte]
                    threshold:
                      type: number
                    timeWindow:
                      type: integer
                      minimum: 60
                  required:
                    - metric
                    - operator
                    - threshold
                    - timeWindow
                severity:
                  type: string
                  enum: [info, warning, critical]
                actions:
                  type: object
                  properties:
                    logAlert:
                      type: boolean
                      default: true
                    emailNotification:
                      type: boolean
                    webhookUrl:
                      type: string
                      format: uri
                  required:
                    - logAlert
              required:
                - name
                - condition
                - severity
                - actions
      responses:
        '201':
          description: Monitoring alert created successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/AlertConfig'

components:
  schemas:
    LogEntry:
      type: object
      required:
        - id
        - level
        - category
        - message
        - timestamp
        - source
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        level:
          type: string
          enum: [debug, info, warn, error, fatal]
        category:
          type: string
          enum: [system, api, ai_generation, context_management, user_action, performance, security, database, file_system, configuration, phase_progression]
        message:
          type: string
        timestamp:
          type: string
          format: date-time
        source:
          type: string
        projectId:
          $ref: '#/components/schemas/UUID'
        sessionId:
          type: string
        correlationId:
          type: string
        metadata:
          type: object
        stackTrace:
          type: string
        requestContext:
          type: object
          properties:
            method:
              type: string
            url:
              type: string
            userAgent:
              type: string
            ip:
              type: string
            responseTime:
              type: number
            statusCode:
              type: integer

    PerformanceMetric:
      type: object
      required:
        - id
        - name
        - type
        - value
        - unit
        - timestamp
        - source
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        name:
          type: string
        type:
          type: string
          enum: [counter, gauge, histogram, timer, memory_usage, api_response_time, context_retrieval_time, ai_generation_time]
        value:
          type: number
        unit:
          type: string
        timestamp:
          type: string
          format: date-time
        source:
          type: string
        projectId:
          $ref: '#/components/schemas/UUID'
        tags:
          type: object
          additionalProperties:
            type: string
        metadata:
          type: object

    ErrorEntry:
      type: object
      required:
        - id
        - message
        - errorType
        - severity
        - source
        - timestamp
        - handled
        - resolved
        - occurrenceCount
        - firstOccurrence
        - lastOccurrence
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        message:
          type: string
        errorType:
          type: string
        severity:
          type: string
          enum: [low, medium, high, critical]
        stackTrace:
          type: string
        source:
          type: string
        timestamp:
          type: string
          format: date-time
        projectId:
          $ref: '#/components/schemas/UUID'
        sessionId:
          type: string
        correlationId:
          type: string
        context:
          type: object
        handled:
          type: boolean
        resolved:
          type: boolean
        occurrenceCount:
          type: integer
        firstOccurrence:
          type: string
          format: date-time
        lastOccurrence:
          type: string
          format: date-time

    SystemHealth:
      type: object
      required:
        - status
        - timestamp
        - components
        - performance
        - recentErrors
      properties:
        status:
          type: string
          enum: [healthy, degraded, unhealthy]
        timestamp:
          type: string
          format: date-time
        components:
          type: object
          properties:
            database:
              $ref: '#/components/schemas/ComponentHealth'
            vectorDatabase:
              $ref: '#/components/schemas/ComponentHealth'
            aiProvider:
              $ref: '#/components/schemas/ComponentHealth'
            fileSystem:
              $ref: '#/components/schemas/ComponentHealth'
            configuration:
              $ref: '#/components/schemas/ComponentHealth'
        performance:
          type: object
          properties:
            avgContextRetrievalTime:
              type: number
            avgAiGenerationTime:
              type: number
            avgApiResponseTime:
              type: number
            errorRate:
              type: number
            memoryUsage:
              type: number
            diskUsage:
              type: number
        recentErrors:
          type: object
          properties:
            criticalCount:
              type: integer
            highCount:
              type: integer
            mediumCount:
              type: integer
            lowCount:
              type: integer

    ComponentHealth:
      type: object
      required:
        - status
        - lastChecked
      properties:
        status:
          type: string
          enum: [healthy, degraded, unhealthy]
        lastChecked:
          type: string
          format: date-time
        responseTime:
          type: number
        details:
          type: string
        error:
          type: string

    UsageAnalytics:
      type: object
      required:
        - id
        - periodStart
        - periodEnd
        - totalProjects
        - totalGenerations
        - totalContextRetrievals
        - avgContextRetrievalTime
        - avgAiGenerationTime
        - totalApiRequests
        - avgApiResponseTime
        - errorStats
        - phaseActivity
        - tokenUsage
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        periodStart:
          type: string
          format: date-time
        periodEnd:
          type: string
          format: date-time
        totalProjects:
          type: integer
        totalGenerations:
          type: integer
        totalContextRetrievals:
          type: integer
        avgContextRetrievalTime:
          type: number
        avgAiGenerationTime:
          type: number
        totalApiRequests:
          type: integer
        avgApiResponseTime:
          type: number
        errorStats:
          type: object
          properties:
            totalErrors:
              type: integer
            errorsByLevel:
              type: object
              additionalProperties:
                type: integer
            errorsBySeverity:
              type: object
              additionalProperties:
                type: integer
        phaseActivity:
          type: object
          additionalProperties:
            type: integer
        tokenUsage:
          type: object
          properties:
            totalTokens:
              type: integer
            inputTokens:
              type: integer
            outputTokens:
              type: integer
            avgTokensPerGeneration:
              type: number

    AlertConfig:
      type: object
      required:
        - id
        - name
        - enabled
        - condition
        - severity
        - actions
        - createdAt
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        name:
          type: string
        description:
          type: string
        enabled:
          type: boolean
        condition:
          type: object
          properties:
            metric:
              type: string
            operator:
              type: string
              enum: [gt, lt, eq, gte, lte]
            threshold:
              type: number
            timeWindow:
              type: integer
        severity:
          type: string
          enum: [info, warning, critical]
        actions:
          type: object
          properties:
            logAlert:
              type: boolean
            emailNotification:
              type: boolean
            webhookUrl:
              type: string
        createdAt:
          type: string
          format: date-time
        lastTriggered:
          type: string
          format: date-time
```

## **4. Detailed Business Logic & Validation Rules**

| Rule ID | Rule Description | Implementation Location(s) & Notes |
|---------|------------------|-----------------------------------|
| **LOG-01** | Log entries must be persisted immediately and never lost, even during system failures or high load conditions. | **Backend (Authoritative):** Logging service must use asynchronous queuing with persistent storage. Implement circuit breaker pattern to prevent logging failures from affecting core functionality. |
| **LOG-02** | Performance metrics for context retrieval must automatically trigger alerts if they exceed the 3-second KPI threshold defined in the charter. | **Backend (Authoritative):** Monitoring service must automatically create alerts when context_retrieval_time metrics exceed 3000ms threshold. Integrates with Configuration Management Module for alert thresholds. |
| **LOG-03** | Sensitive data (API keys, tokens, passwords) must never be logged in plain text or included in error stack traces. | **Backend (Authoritative):** Logging service must implement data sanitization filters that detect and mask sensitive patterns before persisting logs. Use configuration patterns from Configuration Management Module. |
| **LOG-04** | Error occurrences of the same type from the same source must be grouped and counted rather than creating duplicate entries. | **Backend (Authoritative):** Error tracking service must implement deduplication logic based on errorType + source + message hash. Update occurrence count and timestamps for existing errors. |
| **LOG-05** | System health status must automatically degrade to 'unhealthy' if any P0 component (Database, Vector Database, AI Provider) fails health checks. | **Backend (Authoritative):** Health monitoring service must aggregate component health and apply business rules. P0 component failures override overall status regardless of other component states. |
| **LOG-06** | Log retention must follow the backup retention policy from Configuration Management Module (default 30 days for logs, 90 days for metrics). | **Backend (Authoritative):** Log cleanup service must query Configuration Management Module for retention policies and implement automated cleanup based on configured retention periods. |
| **LOG-07** | Performance metrics that impact ReadyAI KPIs (development velocity, code quality consistency) must be tagged with project context for analytics. | **Backend (Authoritative):** Metrics collection must automatically tag AI generation time, context retrieval time, and phase progression metrics with projectId and phaseType for KPI analytics. |
| **LOG-08** | Critical errors (severity 'critical') must automatically create system health incidents and persist until manually resolved. | **Backend (Authoritative):** Error tracking service must create persistent incident records for critical errors and prevent system health from returning to 'healthy' until incidents are resolved. |
| **LOG-09** | Usage analytics must aggregate data without exposing individual user sessions or project details to maintain privacy in the local-first architecture. | **Backend (Authoritative):** Analytics service must implement aggregation functions that summarize usage patterns while anonymizing individual session or project identifiers. |
| **LOG-10** | Monitoring alerts must respect the Configuration Management Module's settings for notification preferences and alert thresholds. | **Backend (Authoritative):** Alert service must query Configuration Management Module for user notification preferences and use configured thresholds instead of hardcoded values. |

## **5. Developer Task Checklist**

### **Backend Tasks:**
- [ ] Create database migration script for logging tables (`log_entries`, `performance_metrics`, `error_entries`, `system_health_checks`, `usage_analytics`, `alert_configs`)
- [ ] Implement the `LoggingService` class with structured logging, log levels, and asynchronous persistence capabilities
- [ ] Implement the `PerformanceMonitoringService` class for collecting and aggregating performance metrics across all ReadyAI components
- [ ] Implement the `ErrorTrackingService` class with error deduplication, occurrence counting, and severity classification
- [ ] Implement the `SystemHealthService` class for component health monitoring and overall system status aggregation
- [ ] Implement the `UsageAnalyticsService` class for privacy-aware analytics aggregation and KPI tracking
- [ ] Implement the `AlertingService` class for threshold monitoring and notification management
- [ ] Implement all logging API endpoints (`GET`, `POST /api/v1/logging/logs`) with advanced querying and filtering capabilities
- [ ] Implement metrics API endpoints (`GET`, `POST /api/v1/logging/metrics`) with aggregation and time-series support
- [ ] Implement error tracking endpoints (`GET`, `POST /api/v1/logging/errors`, `PATCH /api/v1/logging/errors/{id}/resolve`)
- [ ] Implement system monitoring endpoints (`GET /api/v1/monitoring/health`, `GET /api/v1/monitoring/analytics`)
- [ ] Implement alert management endpoints (`GET`, `POST /api/v1/monitoring/alerts`)
- [ ] Create `LoggingRepository` class for efficient log storage and retrieval with indexing on timestamp, level, category, and source
- [ ] Create `MetricsRepository` class for time-series metrics storage with aggregation capabilities
- [ ] Create `ErrorRepository` class for error deduplication and occurrence tracking
- [ ] Implement log data sanitization filters to prevent sensitive data exposure
- [ ] Implement automated log retention and cleanup based on Configuration Management Module policies
- [ ] Create middleware for automatic request/response logging with correlation ID generation
- [ ] Implement performance monitoring interceptors for AI generation and context retrieval operations
- [ ] Create health check probes for Database, Vector Database, AI Provider, File System, and Configuration components
- [ ] Implement comprehensive unit tests for all service classes with mock dependencies
- [ ] Create integration tests for logging endpoints with real database interactions
- [ ] Implement performance tests for logging throughput under high load conditions
- [ ] Add logging instrumentation to existing ReadyAI modules (Project Management, Phase Management, Context Management)

### **Frontend Tasks:**
- [ ] Create `LoggingProvider` React context for accessing logging and monitoring functionality
- [ ] Implement `useLogging` hook for frontend logging capabilities with automatic error boundary integration
- [ ] Create `LogViewer` component for displaying log entries with filtering, searching, and real-time updates
- [ ] Implement `MetricsDashboard` component for visualizing performance metrics and system health
- [ ] Create `ErrorTracker` component for displaying error summaries, groupings, and resolution status
- [ ] Implement `SystemHealthMonitor` component for real-time system status display
- [ ] Create `UsageAnalytics` component for displaying usage statistics and KPI metrics
- [ ] Implement `AlertConfiguration` component for managing monitoring alerts and thresholds
- [ ] Create logging service functions in the API client (`loggingService.ts`) for all logging endpoints
- [ ] Implement automatic error logging for uncaught exceptions and API errors
- [ ] Create performance monitoring hooks for tracking frontend component render times
- [ ] Implement log export functionality for downloading logs and metrics
- [ ] Add real-time log streaming capabilities using WebSockets or Server-Sent Events
- [ ] Create log search and filtering interface with advanced query capabilities
- [ ] Implement metrics visualization using charts and graphs for performance trends
- [ ] Add error reporting integration to React error boundaries with automatic context collection
- [ ] Create system health status indicators in the main application header
- [ ] Implement alert notification display system for critical system alerts
- [ ] Add logging configuration interface integrated with Configuration Management Module settings
- [ ] Create debugging tools for developers including correlation ID tracking and distributed tracing visualization


========================================================================================


# File System Management Module - Technical Specification

## **1. Module Overview**

**Purpose:** The File System Management Module serves as the centralized file system interface for the entire ReadyAI application, handling all file operations, workspace management, and file system integration. This module provides secure and efficient file CRUD operations, directory management, file watching capabilities, workspace isolation, and backup management while maintaining the local-first architecture principles. It acts as the foundational layer that enables the VS Code extension, AI code generation, and project management features to interact safely with the local file system.

**Dependencies & Interactions:** This module depends on the Configuration Management Module to obtain file system configuration settings, workspace paths, backup retention policies, and security configurations. It interacts with the Logging & Monitoring Service to track file operations, performance metrics, and error reporting. The module provides file system services that are consumed by the Project Management Module for project file operations, the Context Management Engine for reading source files and extracting context, the AI Code Generation Engine for writing generated files, and the VS Code Extension Host for workspace integration. It also supports the Multi-Phase Development Orchestrator by managing phase artifacts and project scaffolding files.

## **2. Module-Specific Type Additions (`types.filesystem.ts`)**

```typescript
/**
 * File System Management Module Types
 * Extends foundational types with file system-specific interfaces
 */

/** File operation types */
export type FileOperationType = 'create' | 'read' | 'update' | 'delete' | 'copy' | 'move' | 'watch';

/** File system entry types */
export type FileSystemEntryType = 'file' | 'directory' | 'symlink';

/** File watching event types */
export type FileWatchEventType = 'created' | 'modified' | 'deleted' | 'renamed' | 'moved';

/** Workspace isolation levels */
export type WorkspaceIsolationLevel = 'strict' | 'moderate' | 'permissive';

/** Backup operation types */
export type BackupOperationType = 'full' | 'incremental' | 'differential';

/** File system entry information */
export interface FileSystemEntry {
  /** Entry path relative to workspace root */
  path: string;
  /** Absolute file system path */
  absolutePath: string;
  /** Entry type */
  type: FileSystemEntryType;
  /** File size in bytes */
  size: number;
  /** Created timestamp */
  createdAt: string; // ISO 8601 format
  /** Modified timestamp */
  modifiedAt: string; // ISO 8601 format
  /** Accessed timestamp */
  accessedAt: string; // ISO 8601 format
  /** File permissions (Unix-style octal) */
  permissions: string;
  /** Whether entry is readable */
  readable: boolean;
  /** Whether entry is writable */
  writable: boolean;
  /** Whether entry is executable */
  executable: boolean;
  /** File MIME type (for files) */
  mimeType?: string;
  /** File extension (for files) */
  extension?: string;
  /** Directory contents (for directories) */
  children?: FileSystemEntry[];
  /** File content hash for change detection */
  contentHash?: string;
}

/** File operation request */
export interface FileOperationRequest {
  /** Unique operation identifier */
  id: UUID;
  /** Type of file operation */
  operation: FileOperationType;
  /** Source path */
  sourcePath: string;
  /** Destination path (for copy/move operations) */
  destinationPath?: string;
  /** File content (for create/update operations) */
  content?: string;
  /** Content encoding */
  encoding?: 'utf8' | 'base64' | 'binary';
  /** Operation options */
  options?: {
    /** Create parent directories if they don't exist */
    createDirectories?: boolean;
    /** Overwrite existing files */
    overwrite?: boolean;
    /** Preserve timestamps */
    preserveTimestamps?: boolean;
    /** Follow symlinks */
    followSymlinks?: boolean;
  };
  /** Project context */
  projectId?: UUID;
  /** User session context */
  sessionId?: string;
  /** Request timestamp */
  createdAt: string; // ISO 8601 format
}

/** File operation result */
export interface FileOperationResult {
  /** Operation request identifier */
  requestId: UUID;
  /** Operation success status */
  success: boolean;
  /** Operation result data */
  result?: {
    /** File system entry information */
    entry?: FileSystemEntry;
    /** File content (for read operations) */
    content?: string;
    /** Content encoding */
    encoding?: string;
    /** Operation metadata */
    metadata?: Record<string, any>;
  };
  /** Error information (if operation failed) */
  error?: {
    /** Error code */
    code: string;
    /** Error message */
    message: string;
    /** Additional error details */
    details?: Record<string, any>;
  };
  /** Operation execution time in milliseconds */
  executionTime: number;
  /** Operation completion timestamp */
  completedAt: string; // ISO 8601 format
}

/** File watcher configuration */
export interface FileWatcher {
  /** Unique watcher identifier */
  id: UUID;
  /** Watch path pattern */
  pattern: string;
  /** Events to watch for */
  events: FileWatchEventType[];
  /** Whether watcher is recursive */
  recursive: boolean;
  /** Whether watcher is currently active */
  active: boolean;
  /** Callback URL for notifications */
  callbackUrl?: string;
  /** Project context */
  projectId?: UUID;
  /** Watcher creation timestamp */
  createdAt: string; // ISO 8601 format
  /** Last activity timestamp */
  lastActivity?: string; // ISO 8601 format
}

/** File watch event */
export interface FileWatchEvent {
  /** Unique event identifier */
  id: UUID;
  /** Watcher that detected this event */
  watcherId: UUID;
  /** Event type */
  eventType: FileWatchEventType;
  /** File path that changed */
  path: string;
  /** Old path (for rename/move events) */
  oldPath?: string;
  /** New path (for rename/move events) */
  newPath?: string;
  /** Event timestamp */
  timestamp: string; // ISO 8601 format
  /** Additional event metadata */
  metadata?: Record<string, any>;
}

/** Workspace configuration */
export interface WorkspaceConfig {
  /** Workspace identifier */
  id: UUID;
  /** Workspace name */
  name: string;
  /** Root path */
  rootPath: string;
  /** Workspace isolation level */
  isolationLevel: WorkspaceIsolationLevel;
  /** Allowed file extensions */
  allowedExtensions?: string[];
  /** Blocked file extensions */
  blockedExtensions?: string[];
  /** Allowed directories (relative to root) */
  allowedDirectories?: string[];
  /** Blocked directories (relative to root) */
  blockedDirectories?: string[];
  /** Maximum file size in bytes */
  maxFileSize?: number;
  /** Maximum total workspace size in bytes */
  maxWorkspaceSize?: number;
  /** Whether workspace is read-only */
  readOnly: boolean;
  /** Workspace creation timestamp */
  createdAt: string; // ISO 8601 format
  /** Last access timestamp */
  lastAccessed: string; // ISO 8601 format
}

/** Backup configuration */
export interface BackupConfig {
  /** Backup identifier */
  id: UUID;
  /** Backup name/label */
  name: string;
  /** Backup type */
  type: BackupOperationType;
  /** Source path to backup */
  sourcePath: string;
  /** Backup destination path */
  destinationPath: string;
  /** Whether backup is enabled */
  enabled: boolean;
  /** Backup schedule (cron expression) */
  schedule?: string;
  /** Retention policy in days */
  retentionDays: number;
  /** Compression enabled */
  compressed: boolean;
  /** Include patterns */
  includePatterns?: string[];
  /** Exclude patterns */
  excludePatterns?: string[];
  /** Project context */
  projectId?: UUID;
  /** Backup creation timestamp */
  createdAt: string; // ISO 8601 format
}

/** Backup execution record */
export interface BackupExecution {
  /** Execution identifier */
  id: UUID;
  /** Backup configuration used */
  backupConfigId: UUID;
  /** Execution status */
  status: 'pending' | 'running' | 'completed' | 'failed';
  /** Backup start timestamp */
  startedAt: string; // ISO 8601 format
  /** Backup completion timestamp */
  completedAt?: string; // ISO 8601 format
  /** Number of files backed up */
  filesBackedUp?: number;
  /** Total backup size in bytes */
  backupSize?: number;
  /** Execution duration in milliseconds */
  duration?: number;
  /** Error information (if backup failed) */
  error?: {
    /** Error code */
    code: string;
    /** Error message */
    message: string;
    /** Stack trace */
    stackTrace?: string;
  };
  /** Backup file path */
  backupPath?: string;
}

/** File system statistics */
export interface FileSystemStats {
  /** Workspace identifier */
  workspaceId: UUID;
  /** Statistics timestamp */
  timestamp: string; // ISO 8601 format
  /** Total number of files */
  totalFiles: number;
  /** Total number of directories */
  totalDirectories: number;
  /** Total workspace size in bytes */
  totalSize: number;
  /** Available space in bytes */
  availableSpace: number;
  /** Used space percentage */
  usedSpacePercentage: number;
  /** File type breakdown */
  fileTypes: Record<string, number>;
  /** Largest files */
  largestFiles: Array<{
    path: string;
    size: number;
  }>;
  /** Recently modified files */
  recentlyModified: Array<{
    path: string;
    modifiedAt: string;
  }>;
}
```

## **3. API Endpoint Specification (OpenAPI `paths` block)**

```yaml
paths:
  /api/v1/filesystem/entries:
    get:
      tags:
        - FileSystem
      summary: List directory contents
      description: Retrieves the contents of a directory with filtering and metadata options
      security:
        - localAuth: []
      parameters:
        - name: path
          in: query
          description: Directory path to list (relative to workspace root)
          required: true
          schema:
            type: string
        - name: recursive
          in: query
          description: Whether to list contents recursively
          required: false
          schema:
            type: boolean
            default: false
        - name: includeMetadata
          in: query
          description: Whether to include detailed metadata for each entry
          required: false
          schema:
            type: boolean
            default: true
        - name: fileTypes
          in: query
          description: Filter by file types (extensions)
          required: false
          schema:
            type: string
            example: "js,ts,json"
        - name: workspaceId
          in: query
          description: Workspace context for path resolution
          required: false
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '200':
          description: Directory contents retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          entries:
                            type: array
                            items:
                              $ref: '#/components/schemas/FileSystemEntry'
                          totalCount:
                            type: integer
                          path:
                            type: string
        '400':
          description: Invalid path or request parameters
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'
        '403':
          description: Access denied to specified path
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'
        '404':
          description: Directory not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

  /api/v1/filesystem/files:
    get:
      tags:
        - FileSystem
      summary: Read file contents
      description: Retrieves the contents of a specific file
      security:
        - localAuth: []
      parameters:
        - name: path
          in: query
          description: File path to read (relative to workspace root)
          required: true
          schema:
            type: string
        - name: encoding
          in: query
          description: Content encoding format
          required: false
          schema:
            type: string
            enum: [utf8, base64, binary]
            default: utf8
        - name: workspaceId
          in: query
          description: Workspace context for path resolution
          required: false
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '200':
          description: File contents retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          content:
                            type: string
                          encoding:
                            type: string
                          metadata:
                            $ref: '#/components/schemas/FileSystemEntry'
        '400':
          description: Invalid file path or encoding
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'
        '403':
          description: Access denied to file
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'
        '404':
          description: File not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

    post:
      tags:
        - FileSystem
      summary: Create or update file
      description: Creates a new file or updates an existing file with the provided content
      security:
        - localAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                path:
                  type: string
                  description: File path (relative to workspace root)
                content:
                  type: string
                  description: File content
                encoding:
                  type: string
                  enum: [utf8, base64, binary]
                  default: utf8
                  description: Content encoding
                options:
                  type: object
                  properties:
                    createDirectories:
                      type: boolean
                      default: true
                      description: Create parent directories if they don't exist
                    overwrite:
                      type: boolean
                      default: false
                      description: Overwrite existing file
                    preserveTimestamps:
                      type: boolean
                      default: false
                      description: Preserve existing timestamps
                workspaceId:
                  $ref: '#/components/schemas/UUID'
                  description: Workspace context
                projectId:
                  $ref: '#/components/schemas/UUID'
                  description: Project context for logging
              required:
                - path
                - content
      responses:
        '201':
          description: File created successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/FileOperationResult'
        '200':
          description: File updated successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/FileOperationResult'
        '400':
          description: Invalid file path, content, or options
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'
        '403':
          description: Access denied or workspace is read-only
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'
        '409':
          description: File exists and overwrite is disabled
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

    delete:
      tags:
        - FileSystem
      summary: Delete file or directory
      description: Removes a file or directory from the file system
      security:
        - localAuth: []
      parameters:
        - name: path
          in: query
          description: Path to delete (relative to workspace root)
          required: true
          schema:
            type: string
        - name: recursive
          in: query
          description: Delete directories recursively
          required: false
          schema:
            type: boolean
            default: false
        - name: workspaceId
          in: query
          description: Workspace context
          required: false
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '200':
          description: File or directory deleted successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/FileOperationResult'
        '400':
          description: Invalid path or recursive option
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'
        '403':
          description: Access denied or workspace is read-only
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'
        '404':
          description: File or directory not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

  /api/v1/filesystem/operations:
    post:
      tags:
        - FileSystem
      summary: Execute file system operation
      description: Executes complex file system operations like copy, move, or batch operations
      security:
        - localAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                operation:
                  type: string
                  enum: [copy, move]
                sourcePath:
                  type: string
                  description: Source path
                destinationPath:
                  type: string
                  description: Destination path
                options:
                  type: object
                  properties:
                    createDirectories:
                      type: boolean
                      default: true
                    overwrite:
                      type: boolean
                      default: false
                    preserveTimestamps:
                      type: boolean
                      default: true
                    followSymlinks:
                      type: boolean
                      default: true
                workspaceId:
                  $ref: '#/components/schemas/UUID'
                projectId:
                  $ref: '#/components/schemas/UUID'
              required:
                - operation
                - sourcePath
                - destinationPath
      responses:
        '200':
          description: Operation completed successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/FileOperationResult'
        '400':
          description: Invalid operation parameters
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'
        '403':
          description: Access denied
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'
        '404':
          description: Source path not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

  /api/v1/filesystem/watchers:
    get:
      tags:
        - FileSystem
      summary: List file watchers
      description: Retrieves list of active file watchers
      security:
        - localAuth: []
      parameters:
        - name: projectId
          in: query
          description: Filter watchers by project
          required: false
          schema:
            $ref: '#/components/schemas/UUID'
        - name: active
          in: query
          description: Filter by active status
          required: false
          schema:
            type: boolean
      responses:
        '200':
          description: File watchers retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          watchers:
                            type: array
                            items:
                              $ref: '#/components/schemas/FileWatcher'
                          totalCount:
                            type: integer

    post:
      tags:
        - FileSystem
      summary: Create file watcher
      description: Creates a new file system watcher to monitor changes
      security:
        - localAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                pattern:
                  type: string
                  description: File path pattern to watch
                events:
                  type: array
                  items:
                    type: string
                    enum: [created, modified, deleted, renamed, moved]
                  description: Events to watch for
                recursive:
                  type: boolean
                  default: true
                  description: Watch subdirectories recursively
                callbackUrl:
                  type: string
                  format: uri
                  description: URL to notify on events
                projectId:
                  $ref: '#/components/schemas/UUID'
              required:
                - pattern
                - events
      responses:
        '201':
          description: File watcher created successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/FileWatcher'
        '400':
          description: Invalid watcher configuration
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

  /api/v1/filesystem/watchers/{watcherId}:
    delete:
      tags:
        - FileSystem
      summary: Remove file watcher
      description: Removes an existing file system watcher
      security:
        - localAuth: []
      parameters:
        - name: watcherId
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '200':
          description: File watcher removed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '404':
          description: File watcher not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

  /api/v1/filesystem/workspaces:
    get:
      tags:
        - FileSystem
      summary: List workspaces
      description: Retrieves list of configured workspaces
      security:
        - localAuth: []
      responses:
        '200':
          description: Workspaces retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          workspaces:
                            type: array
                            items:
                              $ref: '#/components/schemas/WorkspaceConfig'

    post:
      tags:
        - FileSystem
      summary: Create workspace
      description: Creates a new workspace configuration
      security:
        - localAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  minLength: 1
                  maxLength: 100
                rootPath:
                  type: string
                  description: Absolute path to workspace root
                isolationLevel:
                  type: string
                  enum: [strict, moderate, permissive]
                  default: moderate
                allowedExtensions:
                  type: array
                  items:
                    type: string
                blockedExtensions:
                  type: array
                  items:
                    type: string
                maxFileSize:
                  type: integer
                  minimum: 1
                  description: Maximum file size in bytes
                readOnly:
                  type: boolean
                  default: false
              required:
                - name
                - rootPath
      responses:
        '201':
          description: Workspace created successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/WorkspaceConfig'
        '400':
          description: Invalid workspace configuration
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'
        '409':
          description: Workspace with same name or path already exists
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

  /api/v1/filesystem/backups:
    get:
      tags:
        - FileSystem
      summary: List backup configurations
      description: Retrieves list of backup configurations and recent executions
      security:
        - localAuth: []
      parameters:
        - name: projectId
          in: query
          description: Filter backups by project
          required: false
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '200':
          description: Backup configurations retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          backups:
                            type: array
                            items:
                              $ref: '#/components/schemas/BackupConfig'
                          recentExecutions:
                            type: array
                            items:
                              $ref: '#/components/schemas/BackupExecution'

    post:
      tags:
        - FileSystem
      summary: Create backup configuration
      description: Creates a new backup configuration
      security:
        - localAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  minLength: 1
                  maxLength: 100
                type:
                  type: string
                  enum: [full, incremental, differential]
                  default: full
                sourcePath:
                  type: string
                  description: Path to backup
                destinationPath:
                  type: string
                  description: Backup destination
                schedule:
                  type: string
                  description: Cron expression for scheduling
                retentionDays:
                  type: integer
                  minimum: 1
                  default: 30
                compressed:
                  type: boolean
                  default: true
                includePatterns:
                  type: array
                  items:
                    type: string
                excludePatterns:
                  type: array
                  items:
                    type: string
                projectId:
                  $ref: '#/components/schemas/UUID'
              required:
                - name
                - sourcePath
                - destinationPath
      responses:
        '201':
          description: Backup configuration created successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/BackupConfig'

  /api/v1/filesystem/backups/{backupId}/execute:
    post:
      tags:
        - FileSystem
      summary: Execute backup
      description: Manually triggers execution of a backup configuration
      security:
        - localAuth: []
      parameters:
        - name: backupId
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '202':
          description: Backup execution started
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/BackupExecution'
        '404':
          description: Backup configuration not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

  /api/v1/filesystem/stats:
    get:
      tags:
        - FileSystem
      summary: Get file system statistics
      description: Retrieves file system usage statistics for workspace
      security:
        - localAuth: []
      parameters:
        - name: workspaceId
          in: query
          description: Workspace to analyze
          required: false
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '200':
          description: File system statistics retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/FileSystemStats'

components:
  schemas:
    FileSystemEntry:
      type: object
      required:
        - path
        - absolutePath
        - type
        - size
        - createdAt
        - modifiedAt
        - accessedAt
        - permissions
        - readable
        - writable
        - executable
      properties:
        path:
          type: string
        absolutePath:
          type: string
        type:
          type: string
          enum: [file, directory, symlink]
        size:
          type: integer
        createdAt:
          type: string
          format: date-time
        modifiedAt:
          type: string
          format: date-time
        accessedAt:
          type: string
          format: date-time
        permissions:
          type: string
        readable:
          type: boolean
        writable:
          type: boolean
        executable:
          type: boolean
        mimeType:
          type: string
        extension:
          type: string
        children:
          type: array
          items:
            $ref: '#/components/schemas/FileSystemEntry'
        contentHash:
          type: string

    FileOperationResult:
      type: object
      required:
        - requestId
        - success
        - executionTime
        - completedAt
      properties:
        requestId:
          $ref: '#/components/schemas/UUID'
        success:
          type: boolean
        result:
          type: object
          properties:
            entry:
              $ref: '#/components/schemas/FileSystemEntry'
            content:
              type: string
            encoding:
              type: string
            metadata:
              type: object
        error:
          type: object
          properties:
            code:
              type: string
            message:
              type: string
            details:
              type: object
        executionTime:
          type: number
        completedAt:
          type: string
          format: date-time

    FileWatcher:
      type: object
      required:
        - id
        - pattern
        - events
        - recursive
        - active
        - createdAt
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        pattern:
          type: string
        events:
          type: array
          items:
            type: string
            enum: [created, modified, deleted, renamed, moved]
        recursive:
          type: boolean
        active:
          type: boolean
        callbackUrl:
          type: string
        projectId:
          $ref: '#/components/schemas/UUID'
        createdAt:
          type: string
          format: date-time
        lastActivity:
          type: string
          format: date-time

    WorkspaceConfig:
      type: object
      required:
        - id
        - name
        - rootPath
        - isolationLevel
        - readOnly
        - createdAt
        - lastAccessed
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        name:
          type: string
        rootPath:
          type: string
        isolationLevel:
          type: string
          enum: [strict, moderate, permissive]
        allowedExtensions:
          type: array
          items:
            type: string
        blockedExtensions:
          type: array
          items:
            type: string
        allowedDirectories:
          type: array
          items:
            type: string
        blockedDirectories:
          type: array
          items:
            type: string
        maxFileSize:
          type: integer
        maxWorkspaceSize:
          type: integer
        readOnly:
          type: boolean
        createdAt:
          type: string
          format: date-time
        lastAccessed:
          type: string
          format: date-time

    BackupConfig:
      type: object
      required:
        - id
        - name
        - type
        - sourcePath
        - destinationPath
        - enabled
        - retentionDays
        - compressed
        - createdAt
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        name:
          type: string
        type:
          type: string
          enum: [full, incremental, differential]
        sourcePath:
          type: string
        destinationPath:
          type: string
        enabled:
          type: boolean
        schedule:
          type: string
        retentionDays:
          type: integer
        compressed:
          type: boolean
        includePatterns:
          type: array
          items:
            type: string
        excludePatterns:
          type: array
          items:
            type: string
        projectId:
          $ref: '#/components/schemas/UUID'
        createdAt:
          type: string
          format: date-time

    BackupExecution:
      type: object
      required:
        - id
        - backupConfigId
        - status
        - startedAt
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        backupConfigId:
          $ref: '#/components/schemas/UUID'
        status:
          type: string
          enum: [pending, running, completed, failed]
        startedAt:
          type: string
          format: date-time
        completedAt:
          type: string
          format: date-time
        filesBackedUp:
          type: integer
        backupSize:
          type: integer
        duration:
          type: integer
        error:
          type: object
          properties:
            code:
              type: string
            message:
              type: string
            stackTrace:
              type: string
        backupPath:
          type: string

    FileSystemStats:
      type: object
      required:
        - workspaceId
        - timestamp
        - totalFiles
        - totalDirectories
        - totalSize
        - availableSpace
        - usedSpacePercentage
        - fileTypes
        - largestFiles
        - recentlyModified
      properties:
        workspaceId:
          $ref: '#/components/schemas/UUID'
        timestamp:
          type: string
          format: date-time
        totalFiles:
          type: integer
        totalDirectories:
          type: integer
        totalSize:
          type: integer
        availableSpace:
          type: integer
        usedSpacePercentage:
          type: number
        fileTypes:
          type: object
          additionalProperties:
            type: integer
        largestFiles:
          type: array
          items:
            type: object
            properties:
              path:
                type: string
              size:
                type: integer
        recentlyModified:
          type: array
          items:
            type: object
            properties:
              path:
                type: string
              modifiedAt:
                type: string
                format: date-time
```

## **4. Detailed Business Logic & Validation Rules**

| Rule ID | Rule Description | Implementation Location(s) & Notes |
|---------|------------------|-----------------------------------|
| **FS-01** | All file operations must be validated against workspace isolation rules before execution, ensuring operations are only allowed within permitted directories and on allowed file types. | **Backend (Authoritative):** File service must query Configuration Management Module for workspace configuration and validate all paths against isolation rules before performing any file system operations. |
| **FS-02** | File watchers must automatically clean up and deactivate when their associated project is deleted or becomes inactive to prevent resource leaks. | **Backend (Authoritative):** Watcher service must integrate with Project Management Module to receive project lifecycle events and automatically remove watchers for deleted/inactive projects. |
| **FS-03** | Backup operations must respect the retention policy from Configuration Management Module and automatically clean up old backups to prevent disk space exhaustion. | **Backend (Authoritative):** Backup service must query Configuration Management Module for retention policies and implement automated cleanup based on configured retention periods (default 30 days per Core Contracts). |
| **FS-04** | All file operations must be logged to the Logging & Monitoring Service with appropriate detail level and performance metrics for audit trails and KPI tracking. | **Backend (Authoritative):** File operations service must send structured log entries to Logging & Monitoring Service including operation type, file paths, execution time, and success/failure status. |
| **FS-05** | File content must be validated for maximum size limits defined in workspace configuration before write operations to prevent disk space issues. | **Backend (Authoritative):** File write operations must check content size against workspace configuration limits from Configuration Management Module and reject operations exceeding limits. |
| **FS-06** | Concurrent file operations on the same path must be serialized to prevent race conditions and ensure data consistency. | **Backend (Authoritative):** File operations service must implement file-level locking mechanism using path-based mutexes to serialize operations on identical file paths. |
| **FS-07** | File watchers must debounce rapid file changes to prevent excessive callback notifications and system overload. | **Backend (Authoritative):** Watcher service must implement debouncing logic with configurable delay (default 500ms) to batch rapid sequential changes to the same file into single notifications. |
| **FS-08** | Backup configurations must validate source and destination paths for accessibility and permissions before allowing backup creation. | **Backend (Authoritative):** Backup service must perform pre-flight checks on source/destination paths, verifying read access to source and write access to destination during configuration creation. |
| **FS-09** | File operations involving symbolic links must respect the followSymlinks option and prevent infinite loops from circular symbolic links. | **Backend (Authoritative):** File operations service must implement symlink resolution with loop detection (max depth 10) and respect followSymlinks configuration to prevent infinite recursion. |
| **FS-10** | All sensitive file paths containing configuration data, credentials, or private keys must be excluded from backup operations by default. | **Backend (Authoritative):** Backup service must implement default exclusion patterns for sensitive files (.env, *.key, *.pem, credentials/*) and allow custom patterns from Configuration Management Module. |

## **5. Developer Task Checklist**

### **Backend Tasks:**
- [ ] Create database migration script for file system tables (`file_operations`, `file_watchers`, `workspace_configs`, `backup_configs`, `backup_executions`, `file_system_stats`)
- [ ] Implement the `FileSystemService` class with secure file CRUD operations, path validation, and workspace isolation enforcement
- [ ] Implement the `WorkspaceManager` class for workspace configuration management, isolation rules, and access control validation
- [ ] Implement the `FileWatcherService` class with native file system watching, event debouncing, and callback notification management
- [ ] Implement the `BackupService` class with scheduled backup execution, compression, retention management, and progress tracking
- [ ] Implement all file system API endpoints (`GET`, `POST`, `DELETE /api/v1/filesystem/files`) with comprehensive error handling and logging
- [ ] Implement directory listing endpoints (`GET /api/v1/filesystem/entries`) with recursive traversal, filtering, and metadata collection
- [ ] Implement file operation endpoints (`POST /api/v1/filesystem/operations`) for copy, move, and batch operations
- [ ] Implement watcher management endpoints (`GET`, `POST /api/v1/filesystem/watchers`, `DELETE /api/v1/filesystem/watchers/{id}`)
- [ ] Implement workspace management endpoints (`GET`, `POST /api/v1/filesystem/workspaces`) with configuration validation
- [ ] Implement backup management endpoints (`GET`, `POST /api/v1/filesystem/backups`, `POST /api/v1/filesystem/backups/{id}/execute`)
- [ ] Implement file system statistics endpoint (`GET /api/v1/filesystem/stats`) with usage analysis and reporting
- [ ] Create `FileSystemRepository` class for file operation logging, metadata storage, and audit trail persistence
- [ ] Create `PathValidator` utility class for workspace isolation validation, path sanitization, and security checks
- [ ] Create `FileContentAnalyzer` utility class for MIME type detection, content validation, and encoding handling
- [ ] Implement file locking mechanism to prevent concurrent operation conflicts on same files
- [ ] Implement symlink resolution with circular link detection and configurable maximum depth
- [ ] Create backup compression and decompression utilities with progress reporting
- [ ] Integrate with Configuration Management Module for workspace settings, backup policies, and security configurations
- [ ] Integrate with Logging & Monitoring Service for operation logging, performance metrics, and error tracking
- [ ] Implement comprehensive unit tests for all service classes with mock file system operations
- [ ] Create integration tests for file operations with real file system interactions and temporary directories
- [ ] Implement performance tests for file watching, backup operations, and large file handling
- [ ] Add file system health checks for disk space monitoring, permission validation, and backup status verification

### **Frontend Tasks:**
- [ ] Create `FileSystemProvider` React context for accessing file system operations and state management
- [ ] Implement `useFileSystem` hook for file CRUD operations, directory navigation, and file watching capabilities
- [ ] Create `FileExplorer` component for browsing directory structures with tree view, search, and filtering
- [ ] Implement `FileEditor` component for viewing and editing file contents with syntax highlighting and save functionality
- [ ] Create `FileUploader` component for drag-and-drop file uploads with progress tracking and validation
- [ ] Implement `WorkspaceManager` component for workspace configuration, isolation settings, and access control management
- [ ] Create `BackupManager` component for backup configuration, scheduling, execution monitoring, and restore functionality
- [ ] Implement `FileWatcher` component for configuring file watching patterns, event monitoring, and notification display
- [ ] Create `FileSystemStats` component for displaying workspace usage statistics, file type breakdowns, and disk usage charts
- [ ] Implement file system service functions in the API client (`fileSystemService.ts`) for all file system endpoints
- [ ] Create file operation progress tracking with cancellation support for long-running operations
- [ ] Implement file preview functionality for common file types (text, images, JSON, markdown)
- [ ] Add file system error handling with user-friendly error messages and retry mechanisms
- [ ] Create file and directory context menus with copy, move, rename, and delete operations
- [ ] Implement file search functionality with content search, file name filtering, and advanced search options
- [ ] Add keyboard shortcuts for common file operations (Ctrl+S for save, F2 for rename, Delete for delete)
- [ ] Create file history and version tracking interface for backup and restore operations
- [ ] Implement real-time file system updates using file watcher events and WebSocket connections
- [ ] Add file system security warnings for operations outside workspace boundaries or on sensitive files
- [ ] Create batch operation interfaces for multiple file selection and bulk operations (delete, move, copy)


========================================================================================


# Database Management Module - Technical Specification

## **1. Module Overview**

**Purpose:** The Database Management Module serves as the core data persistence layer for the ReadyAI application, providing SQLite database operations, migration management, transaction handling, and backup/recovery capabilities. This module manages all project state, phases, metadata, and system data while maintaining ACID compliance and supporting the local-first architecture principles defined in the HLSD.

**Dependencies & Interactions:** This module depends on the Configuration Management Module to obtain database connection strings, backup retention policies, and database-specific configuration settings from the validated environment variables. It integrates with the Logging & Monitoring Service to provide comprehensive database operation logging, performance metrics tracking, and error reporting. The module serves as the foundational data layer for all other ReadyAI modules including Project Management, Phase Management, Context Management, and AI Generation tracking, providing them with reliable CRUD operations, transaction management, and data integrity guarantees.

## **2. Module-Specific Type Additions (`types.database.ts`)**

```typescript
/**
 * Database Management Module Types
 * Extends foundational types with database-specific interfaces
 */

/** Database connection status */
export type DatabaseConnectionStatus = 'connected' | 'disconnected' | 'connecting' | 'error';

/** Database migration status */
export type MigrationStatus = 'pending' | 'running' | 'completed' | 'failed' | 'rolled_back';

/** Database backup types */
export type BackupType = 'full' | 'incremental' | 'schema_only';

/** Database transaction isolation levels */
export type IsolationLevel = 'read_uncommitted' | 'read_committed' | 'repeatable_read' | 'serializable';

/** Database migration entry */
export interface DatabaseMigration {
  /** Migration identifier */
  id: UUID;
  /** Migration version number */
  version: string;
  /** Migration name/description */
  name: string;
  /** Migration status */
  status: MigrationStatus;
  /** SQL migration script content */
  script: string;
  /** Migration execution timestamp */
  executedAt?: string; // ISO 8601 format
  /** Execution duration in milliseconds */
  executionTime?: number;
  /** Error message if migration failed */
  error?: string;
  /** Checksum of migration script */
  checksum: string;
}

/** Database connection configuration */
export interface DatabaseConnection {
  /** Connection identifier */
  id: UUID;
  /** Database file path */
  path: string;
  /** Connection status */
  status: DatabaseConnectionStatus;
  /** Connection established timestamp */
  connectedAt?: string; // ISO 8601 format
  /** Last activity timestamp */
  lastActivity: string; // ISO 8601 format
  /** Connection pool size */
  poolSize: number;
  /** Active connections count */
  activeConnections: number;
  /** Connection timeout in milliseconds */
  timeout: number;
}

/** Database backup entry */
export interface DatabaseBackup {
  /** Backup identifier */
  id: UUID;
  /** Backup filename */
  filename: string;
  /** Backup file path */
  path: string;
  /** Backup type */
  type: BackupType;
  /** Backup size in bytes */
  size: number;
  /** Backup creation timestamp */
  createdAt: string; // ISO 8601 format
  /** Backup completion timestamp */
  completedAt?: string; // ISO 8601 format
  /** Backup duration in milliseconds */
  duration?: number;
  /** Whether backup is compressed */
  compressed: boolean;
  /** Backup description */
  description?: string;
  /** Backup checksum for integrity verification */
  checksum: string;
  /** Whether this is an automatic backup */
  automatic: boolean;
}

/** Database transaction context */
export interface DatabaseTransaction {
  /** Transaction identifier */
  id: UUID;
  /** Transaction isolation level */
  isolationLevel: IsolationLevel;
  /** Transaction start timestamp */
  startedAt: string; // ISO 8601 format
  /** Transaction status */
  status: 'active' | 'committed' | 'rolled_back' | 'failed';
  /** Operations performed in this transaction */
  operations: DatabaseOperation[];
  /** Transaction completion timestamp */
  completedAt?: string; // ISO 8601 format
  /** Transaction duration in milliseconds */
  duration?: number;
}

/** Database operation record */
export interface DatabaseOperation {
  /** Operation identifier */
  id: UUID;
  /** Operation type */
  type: 'select' | 'insert' | 'update' | 'delete' | 'create' | 'drop' | 'alter';
  /** Table name affected */
  tableName: string;
  /** SQL query executed */
  query: string;
  /** Query parameters */
  parameters?: Record<string, any>;
  /** Operation execution timestamp */
  executedAt: string; // ISO 8601 format
  /** Execution duration in milliseconds */
  executionTime: number;
  /** Number of rows affected */
  rowsAffected?: number;
  /** Operation success status */
  success: boolean;
  /** Error message if operation failed */
  error?: string;
}

/** Database health status */
export interface DatabaseHealth {
  /** Overall database health */
  status: 'healthy' | 'degraded' | 'unhealthy';
  /** Database connection status */
  connection: DatabaseConnectionStatus;
  /** Database file size in bytes */
  fileSize: number;
  /** Available disk space in bytes */
  availableSpace: number;
  /** Last successful backup timestamp */
  lastBackup?: string; // ISO 8601 format
  /** Pending migrations count */
  pendingMigrations: number;
  /** Database uptime in milliseconds */
  uptime: number;
  /** Recent performance metrics */
  performance: {
    avgQueryTime: number;
    slowQueries: number;
    totalQueries: number;
    cacheHitRatio: number;
  };
  /** Health check timestamp */
  lastChecked: string; // ISO 8601 format
}

/** Database schema information */
export interface DatabaseSchema {
  /** Schema version */
  version: string;
  /** All tables in the database */
  tables: DatabaseTable[];
  /** Database indexes */
  indexes: DatabaseIndex[];
  /** Foreign key constraints */
  foreignKeys: DatabaseForeignKey[];
  /** Schema last updated timestamp */
  lastUpdated: string; // ISO 8601 format
}

/** Database table information */
export interface DatabaseTable {
  /** Table name */
  name: string;
  /** Table columns */
  columns: DatabaseColumn[];
  /** Row count */
  rowCount: number;
  /** Table size in bytes */
  size: number;
  /** Table creation timestamp */
  createdAt: string; // ISO 8601 format
  /** Table last modified timestamp */
  lastModified: string; // ISO 8601 format
}

/** Database column information */
export interface DatabaseColumn {
  /** Column name */
  name: string;
  /** Column data type */
  type: string;
  /** Whether column allows null values */
  nullable: boolean;
  /** Default value */
  defaultValue?: any;
  /** Whether column is primary key */
  primaryKey: boolean;
  /** Whether column is unique */
  unique: boolean;
  /** Whether column is auto-increment */
  autoIncrement: boolean;
}

/** Database index information */
export interface DatabaseIndex {
  /** Index name */
  name: string;
  /** Table name */
  tableName: string;
  /** Indexed columns */
  columns: string[];
  /** Whether index is unique */
  unique: boolean;
  /** Index type */
  type: 'btree' | 'hash' | 'partial';
}

/** Database foreign key constraint */
export interface DatabaseForeignKey {
  /** Constraint name */
  name: string;
  /** Source table */
  fromTable: string;
  /** Source column */
  fromColumn: string;
  /** Referenced table */
  toTable: string;
  /** Referenced column */
  toColumn: string;
  /** On delete action */
  onDelete: 'cascade' | 'set_null' | 'restrict' | 'no_action';
  /** On update action */
  onUpdate: 'cascade' | 'set_null' | 'restrict' | 'no_action';
}

/** Database query result */
export interface DatabaseQueryResult<T = any> {
  /** Query result data */
  data: T[];
  /** Number of rows returned */
  rowCount: number;
  /** Query execution time in milliseconds */
  executionTime: number;
  /** Whether query used cache */
  fromCache: boolean;
  /** Query metadata */
  metadata?: {
    sql: string;
    parameters?: Record<string, any>;
  };
}

/** Database statistics */
export interface DatabaseStatistics {
  /** Database file size in bytes */
  fileSize: number;
  /** Number of tables */
  tableCount: number;
  /** Total row count across all tables */
  totalRows: number;
  /** Number of indexes */
  indexCount: number;
  /** Cache statistics */
  cache: {
    hitRatio: number;
    totalHits: number;
    totalMisses: number;
    size: number;
  };
  /** Query statistics */
  queries: {
    total: number;
    successful: number;
    failed: number;
    avgExecutionTime: number;
    slowQueries: number;
  };
  /** Statistics timestamp */
  timestamp: string; // ISO 8601 format
}
```

## **3. API Endpoint Specification (OpenAPI `paths` block)**

```yaml
paths:
  /api/v1/database/health:
    get:
      tags:
        - Database
      summary: Get database health status
      description: Retrieves comprehensive database health information including connection status, performance metrics, and system statistics
      security:
        - localAuth: []
      responses:
        '200':
          description: Database health status retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/DatabaseHealth'
        '500':
          description: Database health check failed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

  /api/v1/database/connection:
    get:
      tags:
        - Database
      summary: Get database connection status
      description: Retrieves current database connection information and statistics
      security:
        - localAuth: []
      responses:
        '200':
          description: Database connection status retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/DatabaseConnection'

    post:
      tags:
        - Database
      summary: Test database connection
      description: Tests database connectivity and returns connection diagnostics
      security:
        - localAuth: []
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              properties:
                timeout:
                  type: integer
                  minimum: 1000
                  maximum: 30000
                  default: 5000
                  description: Connection timeout in milliseconds
      responses:
        '200':
          description: Database connection test completed
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          connected:
                            type: boolean
                          responseTime:
                            type: number
                          error:
                            type: string
                          timestamp:
                            type: string
                            format: date-time

  /api/v1/database/migrations:
    get:
      tags:
        - Database
      summary: List database migrations
      description: Retrieves list of all database migrations with their status and execution history
      security:
        - localAuth: []
      parameters:
        - name: status
          in: query
          description: Filter migrations by status
          required: false
          schema:
            type: string
            enum: [pending, running, completed, failed, rolled_back]
        - name: limit
          in: query
          description: Maximum number of migrations to return
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 50
      responses:
        '200':
          description: Database migrations retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          migrations:
                            type: array
                            items:
                              $ref: '#/components/schemas/DatabaseMigration'
                          totalCount:
                            type: integer
                          pendingCount:
                            type: integer

    post:
      tags:
        - Database
      summary: Execute pending migrations
      description: Runs all pending database migrations in sequence and reports results
      security:
        - localAuth: []
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              properties:
                dryRun:
                  type: boolean
                  default: false
                  description: If true, validates migrations without executing them
                targetVersion:
                  type: string
                  description: Specific version to migrate to (optional)
      responses:
        '200':
          description: Migrations executed successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          executedMigrations:
                            type: array
                            items:
                              $ref: '#/components/schemas/DatabaseMigration'
                          totalExecuted:
                            type: integer
                          totalDuration:
                            type: number
                          success:
                            type: boolean
        '400':
          description: Migration execution failed
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiErrorResponse'
                  - type: object
                    properties:
                      error:
                        type: object
                        properties:
                          failedMigrations:
                            type: array
                            items:
                              $ref: '#/components/schemas/DatabaseMigration'

  /api/v1/database/migrations/{migrationId}/rollback:
    post:
      tags:
        - Database
      summary: Rollback specific migration
      description: Rolls back a specific database migration if rollback script is available
      security:
        - localAuth: []
      parameters:
        - name: migrationId
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '200':
          description: Migration rolled back successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/DatabaseMigration'
        '400':
          description: Migration rollback failed or not supported
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'
        '404':
          description: Migration not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

  /api/v1/database/backup:
    get:
      tags:
        - Database
      summary: List database backups
      description: Retrieves list of available database backups with metadata
      security:
        - localAuth: []
      parameters:
        - name: type
          in: query
          description: Filter backups by type
          required: false
          schema:
            type: string
            enum: [full, incremental, schema_only]
        - name: automatic
          in: query
          description: Filter automatic vs manual backups
          required: false
          schema:
            type: boolean
        - name: limit
          in: query
          description: Maximum number of backups to return
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
      responses:
        '200':
          description: Database backups retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          backups:
                            type: array
                            items:
                              $ref: '#/components/schemas/DatabaseBackup'
                          totalCount:
                            type: integer
                          totalSize:
                            type: number

    post:
      tags:
        - Database
      summary: Create database backup
      description: Creates a new database backup with specified options
      security:
        - localAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                type:
                  type: string
                  enum: [full, incremental, schema_only]
                  default: full
                description:
                  type: string
                  maxLength: 500
                compress:
                  type: boolean
                  default: true
                filename:
                  type: string
                  maxLength: 255
                  description: Custom filename (optional, auto-generated if not provided)
              required:
                - type
      responses:
        '201':
          description: Database backup created successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/DatabaseBackup'
        '400':
          description: Backup creation failed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

  /api/v1/database/backup/{backupId}:
    get:
      tags:
        - Database
      summary: Get backup details
      description: Retrieves detailed information about a specific database backup
      security:
        - localAuth: []
      parameters:
        - name: backupId
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '200':
          description: Backup details retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/DatabaseBackup'
        '404':
          description: Backup not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

    delete:
      tags:
        - Database
      summary: Delete database backup
      description: Deletes a specific database backup file and its metadata
      security:
        - localAuth: []
      parameters:
        - name: backupId
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '200':
          description: Backup deleted successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '404':
          description: Backup not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

  /api/v1/database/restore/{backupId}:
    post:
      tags:
        - Database
      summary: Restore from backup
      description: Restores database from a specific backup file
      security:
        - localAuth: []
      parameters:
        - name: backupId
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              properties:
                createBackupBeforeRestore:
                  type: boolean
                  default: true
                  description: Create backup of current state before restoring
                validateBackup:
                  type: boolean
                  default: true
                  description: Validate backup integrity before restoring
      responses:
        '200':
          description: Database restored successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          restoredBackup:
                            $ref: '#/components/schemas/DatabaseBackup'
                          preRestoreBackupId:
                            $ref: '#/components/schemas/UUID'
                          restoredAt:
                            type: string
                            format: date-time
                          duration:
                            type: number
        '400':
          description: Database restore failed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'
        '404':
          description: Backup not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

  /api/v1/database/schema:
    get:
      tags:
        - Database
      summary: Get database schema
      description: Retrieves current database schema including tables, indexes, and constraints
      security:
        - localAuth: []
      responses:
        '200':
          description: Database schema retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/DatabaseSchema'

  /api/v1/database/statistics:
    get:
      tags:
        - Database
      summary: Get database statistics
      description: Retrieves detailed database performance and usage statistics
      security:
        - localAuth: []
      parameters:
        - name: includeTableStats
          in: query
          description: Include per-table statistics
          required: false
          schema:
            type: boolean
            default: false
      responses:
        '200':
          description: Database statistics retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/DatabaseStatistics'

  /api/v1/database/vacuum:
    post:
      tags:
        - Database
      summary: Vacuum database
      description: Performs SQLite VACUUM operation to optimize database file size and performance
      security:
        - localAuth: []
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              properties:
                analyze:
                  type: boolean
                  default: true
                  description: Run ANALYZE after VACUUM to update statistics
      responses:
        '200':
          description: Database vacuum completed successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          sizeBefore:
                            type: number
                          sizeAfter:
                            type: number
                          spaceRecovered:
                            type: number
                          duration:
                            type: number
                          timestamp:
                            type: string
                            format: date-time

components:
  schemas:
    DatabaseMigration:
      type: object
      required:
        - id
        - version
        - name
        - status
        - script
        - checksum
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        version:
          type: string
        name:
          type: string
        status:
          type: string
          enum: [pending, running, completed, failed, rolled_back]
        script:
          type: string
        executedAt:
          type: string
          format: date-time
        executionTime:
          type: number
        error:
          type: string
        checksum:
          type: string

    DatabaseConnection:
      type: object
      required:
        - id
        - path
        - status
        - lastActivity
        - poolSize
        - activeConnections
        - timeout
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        path:
          type: string
        status:
          type: string
          enum: [connected, disconnected, connecting, error]
        connectedAt:
          type: string
          format: date-time
        lastActivity:
          type: string
          format: date-time
        poolSize:
          type: integer
        activeConnections:
          type: integer
        timeout:
          type: integer

    DatabaseBackup:
      type: object
      required:
        - id
        - filename
        - path
        - type
        - size
        - createdAt
        - compressed
        - checksum
        - automatic
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        filename:
          type: string
        path:
          type: string
        type:
          type: string
          enum: [full, incremental, schema_only]
        size:
          type: number
        createdAt:
          type: string
          format: date-time
        completedAt:
          type: string
          format: date-time
        duration:
          type: number
        compressed:
          type: boolean
        description:
          type: string
        checksum:
          type: string
        automatic:
          type: boolean

    DatabaseHealth:
      type: object
      required:
        - status
        - connection
        - fileSize
        - availableSpace
        - pendingMigrations
        - uptime
        - performance
        - lastChecked
      properties:
        status:
          type: string
          enum: [healthy, degraded, unhealthy]
        connection:
          type: string
          enum: [connected, disconnected, connecting, error]
        fileSize:
          type: number
        availableSpace:
          type: number
        lastBackup:
          type: string
          format: date-time
        pendingMigrations:
          type: integer
        uptime:
          type: number
        performance:
          type: object
          properties:
            avgQueryTime:
              type: number
            slowQueries:
              type: integer
            totalQueries:
              type: integer
            cacheHitRatio:
              type: number
        lastChecked:
          type: string
          format: date-time

    DatabaseSchema:
      type: object
      required:
        - version
        - tables
        - indexes
        - foreignKeys
        - lastUpdated
      properties:
        version:
          type: string
        tables:
          type: array
          items:
            $ref: '#/components/schemas/DatabaseTable'
        indexes:
          type: array
          items:
            $ref: '#/components/schemas/DatabaseIndex'
        foreignKeys:
          type: array
          items:
            $ref: '#/components/schemas/DatabaseForeignKey'
        lastUpdated:
          type: string
          format: date-time

    DatabaseTable:
      type: object
      required:
        - name
        - columns
        - rowCount
        - size
        - createdAt
        - lastModified
      properties:
        name:
          type: string
        columns:
          type: array
          items:
            $ref: '#/components/schemas/DatabaseColumn'
        rowCount:
          type: integer
        size:
          type: number
        createdAt:
          type: string
          format: date-time
        lastModified:
          type: string
          format: date-time

    DatabaseColumn:
      type: object
      required:
        - name
        - type
        - nullable
        - primaryKey
        - unique
        - autoIncrement
      properties:
        name:
          type: string
        type:
          type: string
        nullable:
          type: boolean
        defaultValue:
          oneOf:
            - type: string
            - type: number
            - type: boolean
        primaryKey:
          type: boolean
        unique:
          type: boolean
        autoIncrement:
          type: boolean

    DatabaseIndex:
      type: object
      required:
        - name
        - tableName
        - columns
        - unique
        - type
      properties:
        name:
          type: string
        tableName:
          type: string
        columns:
          type: array
          items:
            type: string
        unique:
          type: boolean
        type:
          type: string
          enum: [btree, hash, partial]

    DatabaseForeignKey:
      type: object
      required:
        - name
        - fromTable
        - fromColumn
        - toTable
        - toColumn
        - onDelete
        - onUpdate
      properties:
        name:
          type: string
        fromTable:
          type: string
        fromColumn:
          type: string
        toTable:
          type: string
        toColumn:
          type: string
        onDelete:
          type: string
          enum: [cascade, set_null, restrict, no_action]
        onUpdate:
          type: string
          enum: [cascade, set_null, restrict, no_action]

    DatabaseStatistics:
      type: object
      required:
        - fileSize
        - tableCount
        - totalRows
        - indexCount
        - cache
        - queries
        - timestamp
      properties:
        fileSize:
          type: number
        tableCount:
          type: integer
        totalRows:
          type: integer
        indexCount:
          type: integer
        cache:
          type: object
          properties:
            hitRatio:
              type: number
            totalHits:
              type: integer
            totalMisses:
              type: integer
            size:
              type: number
        queries:
          type: object
          properties:
            total:
              type: integer
            successful:
              type: integer
            failed:
              type: integer
            avgExecutionTime:
              type: number
            slowQueries:
              type: integer
        timestamp:
          type: string
          format: date-time
```

## **4. Detailed Business Logic & Validation Rules**

| Rule ID | Rule Description | Implementation Location(s) & Notes |
|---------|------------------|-----------------------------------|
| **DB-01** | Database connections must be established using configuration values from the Configuration Management Module and all connection failures must be logged through the Logging Service. | **Backend (Authoritative):** Database service must query Configuration Management Module for DATABASE_URL and connection parameters. All connection events logged via Logging Service with appropriate severity levels. |
| **DB-02** | All database migrations must be executed in sequence based on version numbers, and migration failures must rollback the transaction and prevent further migrations. | **Backend (Authoritative):** Migration service must sort migrations by version, execute within transactions, and halt on first failure. Each migration result logged to Logging Service for audit trail. |
| **DB-03** | Database backups must be created automatically before executing migrations and the backup retention policy from Configuration Management Module must be enforced. | **Backend (Authoritative):** Migration service must create automatic backup before running migrations. Backup cleanup service must query Configuration Management for BACKUP_RETENTION_DAYS policy. |
| **DB-04** | All database operations must be wrapped in transactions with appropriate isolation levels and failed transactions must be automatically rolled back. | **Backend (Authoritative):** Database service must provide transaction management with configurable isolation levels. Failed transactions logged as errors via Logging Service. |
| **DB-05** | Database health checks must be performed regularly and health status must be reported to the Logging & Monitoring Service for system-wide health tracking. | **Backend (Authoritative):** Health service must periodically check connection status, file size, available space, and performance metrics. Results sent to Logging Service for monitoring dashboard integration. |
| **DB-06** | Database file size and available disk space must be monitored, and alerts must be triggered through the Logging Service when approaching storage limits. | **Backend (Authoritative):** Monitoring service must check disk usage against configurable thresholds and send alerts via Logging Service when thresholds exceeded (e.g., 80% disk usage). |
| **DB-07** | Database schema changes must be tracked and validated against existing data to prevent data corruption during migrations. | **Backend (Authoritative):** Migration service must validate schema changes against existing data before execution and log validation results. Failed validations prevent migration execution. |
| **DB-08** | Database backup integrity must be verified using checksums and corrupted backups must be automatically flagged and reported through the Logging Service. | **Backend (Authoritative):** Backup service must calculate and store checksums for all backups. Restore operations must verify checksums before proceeding. Integrity failures logged as critical errors. |
| **DB-09** | Performance metrics (query times, slow queries, cache hit ratios) must be collected and reported to the Logging & Monitoring Service for performance monitoring. | **Backend (Authoritative):** Database service must track query performance metrics and send them to Logging Service as performance metrics. Slow queries logged as warnings with query details. |
| **DB-10** | Database connections must implement proper connection pooling and timeout handling to prevent resource exhaustion and maintain the <3 second response time KPI. | **Backend (Authoritative):** Connection service must implement connection pooling with configurable pool size and timeout values from Configuration Management. Connection timeouts logged as warnings. |

## **5. Developer Task Checklist**

### **Backend Tasks:**
- [ ] Create database migration script for database management tables (`migrations`, `backups`, `connections`, `operations_log`)
- [ ] Implement the `DatabaseConnectionService` class with SQLite connection management, pooling, and timeout handling
- [ ] Implement the `MigrationService` class for executing, tracking, and rolling back database migrations using Alembic-style versioning
- [ ] Implement the `BackupService` class for creating, managing, and restoring database backups with compression and integrity verification
- [ ] Implement the `TransactionService` class for managing database transactions with configurable isolation levels
- [ ] Implement the `DatabaseHealthService` class for monitoring connection status, performance metrics, and system health
- [ ] Implement all database health endpoints (`GET /api/v1/database/health`, `GET /api/v1/database/connection`, `POST /api/v1/database/connection`)
- [ ] Implement migration management endpoints (`GET /api/v1/database/migrations`, `POST /api/v1/database/migrations`, `POST /api/v1/database/migrations/{id}/rollback`)
- [ ] Implement backup management endpoints (`GET /api/v1/database/backup`, `POST /api/v1/database/backup`, `DELETE /api/v1/database/backup/{id}`)
- [ ] Implement database restore endpoint (`POST /api/v1/database/restore/{backupId}`) with pre-restore backup creation
- [ ] Implement schema information endpoints (`GET /api/v1/database/schema`, `GET /api/v1/database/statistics`)
- [ ] Implement database optimization endpoint (`POST /api/v1/database/vacuum`) for SQLite VACUUM operations
- [ ] Create `DatabaseRepository` base class providing common CRUD operations with transaction support
- [ ] Implement database performance monitoring with automatic slow query detection and logging
- [ ] Implement automated backup scheduling based on Configuration Management Module settings
- [ ] Create database connection health monitoring with automatic reconnection on connection loss
- [ ] Implement database schema validation and migration conflict detection
- [ ] Create comprehensive unit tests for all service classes with mock dependencies on Configuration and Logging modules
- [ ] Create integration tests for database operations including migration execution, backup/restore cycles, and error scenarios
- [ ] Implement database connection pooling with configurable pool size and connection timeout settings
- [ ] Add database operation logging integration with the Logging & Monitoring Service for audit trails and performance tracking

### **Frontend Tasks:**
- [ ] Create `DatabaseProvider` React context for database management state and operations
- [ ] Implement `useDatabase` hook for accessing database health, migrations, and backup functionality
- [ ] Create `DatabaseHealthMonitor` component for displaying real-time database status and performance metrics
- [ ] Implement `MigrationManager` component for viewing migration history and executing pending migrations
- [ ] Create `BackupManager` component for creating, listing, and restoring database backups
- [ ] Implement `DatabaseStatistics` component for displaying database performance metrics and usage statistics
- [ ] Create `SchemaViewer` component for exploring database tables, columns, and relationships
- [ ] Implement database service functions in the API client (`databaseService.ts`) for all database management endpoints
- [ ] Integrate database health status into the main application health dashboard
- [ ] Implement automated migration execution workflow with progress tracking and error handling
- [ ] Create backup scheduling interface integrated with Configuration Management Module settings
- [ ] Add database performance visualization using charts for query times, cache hit ratios, and storage usage
- [ ] Implement database backup restore workflow with confirmation dialogs and progress indicators
- [ ] Create database optimization interface for running VACUUM operations and viewing results
- [ ] Add database alert notifications for critical issues like low disk space or migration failures
- [ ] Implement database connection status indicator in the application header with real-time updates
- [ ] Create database troubleshooting guide component for common database issues and solutions
- [ ] Add database export functionality for schema and data export in various formats
- [ ] Implement database search functionality for finding specific tables, columns, or data patterns
- [ ] Create database backup verification interface for checking backup integrity and metadata



========================================================================================

# Vector Database Service - Technical Specification

## **1. Module Overview**

**Purpose:** The Vector Database Service serves as the centralized vector storage and semantic search infrastructure for the entire ReadyAI application. This module provides high-performance vector storage operations, semantic similarity search capabilities, collection management, embedding operations, and performance optimization for the Advanced Context Management System. It integrates with Milvus vector database to enable intelligent context retrieval, dependency tracking, and hierarchical context organization that supports the <3 second context retrieval KPI while handling projects with 500+ files.

**Dependencies & Interactions:** This module depends on the Configuration Management Module to obtain Milvus connection settings (MILVUS_HOST, MILVUS_PORT, VECTOR_EMBEDDING_MODEL), vector database configuration parameters, and performance optimization settings. It integrates with the Logging & Monitoring Service to track vector operations, performance metrics, search latencies, and error reporting. The module provides vector storage and retrieval services that are consumed by the Advanced Context Management Engine for storing and querying context embeddings, the Multi-Phase Development Orchestrator for phase artifact similarity analysis, and the Cross-Project Learning System for pattern recognition across projects. It supports the core KPI of maintaining <3 second context retrieval times for large projects.

## **2. Module-Specific Type Additions (`types.vectordb.ts`)**

```typescript
/**
 * Vector Database Service Module Types
 * Extends foundational types with vector database-specific interfaces
 */

/** Vector collection types */
export type VectorCollectionType = 'context' | 'artifacts' | 'patterns' | 'dependencies' | 'embeddings';

/** Vector similarity metrics */
export type VectorSimilarityMetric = 'cosine' | 'euclidean' | 'manhattan' | 'dot_product';

/** Vector index types */
export type VectorIndexType = 'ivf_flat' | 'ivf_sq8' | 'hnsw' | 'annoy' | 'autoindex';

/** Vector search result entry */
export interface VectorSearchResult {
  /** Unique vector identifier */
  id: string;
  /** Similarity score (0.0 to 1.0) */
  score: number;
  /** Vector metadata */
  metadata?: Record<string, any>;
  /** Associated context node ID */
  contextId?: UUID;
  /** Project context */
  projectId?: UUID;
  /** Distance from query vector */
  distance: number;
}

/** Vector collection configuration */
export interface VectorCollection {
  /** Collection name */
  name: string;
  /** Collection description */
  description?: string;
  /** Collection type */
  type: VectorCollectionType;
  /** Vector dimension */
  dimension: number;
  /** Similarity metric */
  metric: VectorSimilarityMetric;
  /** Index type */
  indexType: VectorIndexType;
  /** Index parameters */
  indexParams?: Record<string, any>;
  /** Collection creation timestamp */
  createdAt: string; // ISO 8601 format
  /** Last modification timestamp */
  lastModified: string; // ISO 8601 format
  /** Vector count */
  vectorCount: number;
  /** Collection status */
  status: 'creating' | 'ready' | 'loading' | 'error';
  /** Associated project */
  projectId?: UUID;
}

/** Vector entry for storage */
export interface VectorEntry {
  /** Unique vector identifier */
  id: string;
  /** Vector values */
  vector: number[];
  /** Vector metadata */
  metadata?: Record<string, any>;
  /** Associated context node */
  contextId?: UUID;
  /** Project context */
  projectId?: UUID;
  /** Insertion timestamp */
  insertedAt: string; // ISO 8601 format
}

/** Vector search parameters */
export interface VectorSearchParams {
  /** Query vector */
  queryVector: number[];
  /** Collection name to search */
  collectionName: string;
  /** Number of results to return */
  limit: number;
  /** Minimum similarity threshold */
  threshold?: number;
  /** Search parameters */
  searchParams?: Record<string, any>;
  /** Metadata filters */
  filters?: Record<string, any>;
  /** Project context filter */
  projectId?: UUID;
  /** Include vector data in results */
  includeVectors?: boolean;
  /** Include metadata in results */
  includeMetadata?: boolean;
}

/** Vector upsert operation */
export interface VectorUpsertOperation {
  /** Operation identifier */
  id: UUID;
  /** Collection name */
  collectionName: string;
  /** Vectors to upsert */
  vectors: VectorEntry[];
  /** Batch size for operation */
  batchSize?: number;
  /** Operation options */
  options?: {
    /** Skip duplicate check */
    skipDuplicates?: boolean;
    /** Update metadata only */
    metadataOnly?: boolean;
  };
  /** Operation timestamp */
  createdAt: string; // ISO 8601 format
}

/** Vector delete operation */
export interface VectorDeleteOperation {
  /** Operation identifier */
  id: UUID;
  /** Collection name */
  collectionName: string;
  /** Vector IDs to delete */
  vectorIds?: string[];
  /** Delete filters */
  filters?: Record<string, any>;
  /** Project context filter */
  projectId?: UUID;
  /** Operation timestamp */
  createdAt: string; // ISO 8601 format
}

/** Collection statistics */
export interface CollectionStatistics {
  /** Collection name */
  collectionName: string;
  /** Total vector count */
  totalVectors: number;
  /** Index status */
  indexStatus: 'built' | 'building' | 'not_built';
  /** Memory usage in bytes */
  memoryUsage: number;
  /** Disk usage in bytes */
  diskUsage: number;
  /** Last insert timestamp */
  lastInsert?: string; // ISO 8601 format
  /** Search performance metrics */
  searchMetrics: {
    /** Average search latency in milliseconds */
    avgSearchLatency: number;
    /** Total searches performed */
    totalSearches: number;
    /** Search success rate */
    successRate: number;
  };
  /** Statistics timestamp */
  timestamp: string; // ISO 8601 format
}

/** Vector database health status */
export interface VectorDatabaseHealth {
  /** Database connection status */
  connectionStatus: 'connected' | 'disconnected' | 'error';
  /** Milvus server version */
  serverVersion?: string;
  /** Total collections */
  totalCollections: number;
  /** Active collections */
  activeCollections: number;
  /** Total vectors across all collections */
  totalVectors: number;
  /** Memory usage in bytes */
  memoryUsage: number;
  /** CPU usage percentage */
  cpuUsage: number;
  /** Disk usage percentage */
  diskUsage: number;
  /** Recent operations */
  recentOperations: {
    /** Search operations per minute */
    searchOpsPerMinute: number;
    /** Insert operations per minute */
    insertOpsPerMinute: number;
    /** Delete operations per minute */
    deleteOpsPerMinute: number;
  };
  /** Health check timestamp */
  timestamp: string; // ISO 8601 format
}

/** Embedding generation request */
export interface EmbeddingRequest {
  /** Request identifier */
  id: UUID;
  /** Text content to embed */
  content: string;
  /** Content type */
  contentType: 'code' | 'documentation' | 'comment' | 'text';
  /** Model to use for embedding */
  model?: string;
  /** Project context */
  projectId?: UUID;
  /** Request timestamp */
  createdAt: string; // ISO 8601 format
}

/** Embedding generation result */
export interface EmbeddingResult {
  /** Request identifier */
  requestId: UUID;
  /** Generated embedding vector */
  embedding: number[];
  /** Embedding dimension */
  dimension: number;
  /** Model used */
  model: string;
  /** Generation timestamp */
  generatedAt: string; // ISO 8601 format
  /** Generation time in milliseconds */
  generationTime: number;
}

/** Vector operation batch result */
export interface VectorBatchResult {
  /** Operation identifier */
  operationId: UUID;
  /** Total operations in batch */
  totalOperations: number;
  /** Successfully processed operations */
  successfulOperations: number;
  /** Failed operations */
  failedOperations: number;
  /** Batch processing time in milliseconds */
  processingTime: number;
  /** Error details for failed operations */
  errors?: Array<{
    vectorId: string;
    error: string;
  }>;
  /** Batch completion timestamp */
  completedAt: string; // ISO 8601 format
}
```

## **3. API Endpoint Specification (OpenAPI `paths` block)**

```yaml
paths:
  /api/v1/vectordb/health:
    get:
      tags:
        - VectorDatabase
      summary: Get vector database health status
      description: Retrieves comprehensive health information for the Milvus vector database including connection status, performance metrics, and resource usage
      security:
        - localAuth: []
      responses:
        '200':
          description: Vector database health retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/VectorDatabaseHealth'
        '500':
          description: Unable to retrieve vector database health
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

  /api/v1/vectordb/collections:
    get:
      tags:
        - VectorDatabase
      summary: List vector collections
      description: Retrieves all vector collections with their configurations and statistics
      security:
        - localAuth: []
      parameters:
        - name: type
          in: query
          description: Filter collections by type
          required: false
          schema:
            type: string
            enum: [context, artifacts, patterns, dependencies, embeddings]
        - name: projectId
          in: query
          description: Filter collections by project
          required: false
          schema:
            $ref: '#/components/schemas/UUID'
        - name: status
          in: query
          description: Filter collections by status
          required: false
          schema:
            type: string
            enum: [creating, ready, loading, error]
      responses:
        '200':
          description: Collections retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          collections:
                            type: array
                            items:
                              $ref: '#/components/schemas/VectorCollection'
                          totalCount:
                            type: integer

    post:
      tags:
        - VectorDatabase
      summary: Create vector collection
      description: Creates a new vector collection with specified configuration
      security:
        - localAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  minLength: 1
                  maxLength: 64
                  pattern: '^[a-zA-Z][a-zA-Z0-9_]*$'
                description:
                  type: string
                  maxLength: 500
                type:
                  type: string
                  enum: [context, artifacts, patterns, dependencies, embeddings]
                dimension:
                  type: integer
                  minimum: 1
                  maximum: 32768
                metric:
                  type: string
                  enum: [cosine, euclidean, manhattan, dot_product]
                  default: cosine
                indexType:
                  type: string
                  enum: [ivf_flat, ivf_sq8, hnsw, annoy, autoindex]
                  default: autoindex
                indexParams:
                  type: object
                projectId:
                  $ref: '#/components/schemas/UUID'
              required:
                - name
                - type
                - dimension
      responses:
        '201':
          description: Collection created successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/VectorCollection'
        '400':
          description: Invalid collection configuration
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'
        '409':
          description: Collection already exists
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

  /api/v1/vectordb/collections/{collectionName}:
    get:
      tags:
        - VectorDatabase
      summary: Get collection information
      description: Retrieves detailed information about a specific vector collection
      security:
        - localAuth: []
      parameters:
        - name: collectionName
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Collection information retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/VectorCollection'
        '404':
          description: Collection not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

    delete:
      tags:
        - VectorDatabase
      summary: Delete vector collection
      description: Deletes a vector collection and all its data
      security:
        - localAuth: []
      parameters:
        - name: collectionName
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Collection deleted successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '404':
          description: Collection not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

  /api/v1/vectordb/collections/{collectionName}/statistics:
    get:
      tags:
        - VectorDatabase
      summary: Get collection statistics
      description: Retrieves detailed statistics and performance metrics for a collection
      security:
        - localAuth: []
      parameters:
        - name: collectionName
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Collection statistics retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/CollectionStatistics'

  /api/v1/vectordb/vectors:
    post:
      tags:
        - VectorDatabase
      summary: Insert or update vectors
      description: Inserts new vectors or updates existing ones in a collection
      security:
        - localAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                collectionName:
                  type: string
                vectors:
                  type: array
                  items:
                    $ref: '#/components/schemas/VectorEntry'
                  minItems: 1
                  maxItems: 1000
                batchSize:
                  type: integer
                  minimum: 1
                  maximum: 1000
                  default: 100
                options:
                  type: object
                  properties:
                    skipDuplicates:
                      type: boolean
                      default: false
                    metadataOnly:
                      type: boolean
                      default: false
              required:
                - collectionName
                - vectors
      responses:
        '201':
          description: Vectors inserted successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/VectorBatchResult'
        '400':
          description: Invalid vector data or collection
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

    delete:
      tags:
        - VectorDatabase
      summary: Delete vectors
      description: Deletes vectors from a collection by IDs or filters
      security:
        - localAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                collectionName:
                  type: string
                vectorIds:
                  type: array
                  items:
                    type: string
                filters:
                  type: object
                projectId:
                  $ref: '#/components/schemas/UUID'
              required:
                - collectionName
              oneOf:
                - required: [vectorIds]
                - required: [filters]
      responses:
        '200':
          description: Vectors deleted successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          deletedCount:
                            type: integer
                          operationId:
                            $ref: '#/components/schemas/UUID'

  /api/v1/vectordb/search:
    post:
      tags:
        - VectorDatabase
      summary: Search vectors by similarity
      description: Performs semantic similarity search in a vector collection
      security:
        - localAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                queryVector:
                  type: array
                  items:
                    type: number
                  minItems: 1
                collectionName:
                  type: string
                limit:
                  type: integer
                  minimum: 1
                  maximum: 1000
                  default: 10
                threshold:
                  type: number
                  minimum: 0
                  maximum: 1
                searchParams:
                  type: object
                filters:
                  type: object
                projectId:
                  $ref: '#/components/schemas/UUID'
                includeVectors:
                  type: boolean
                  default: false
                includeMetadata:
                  type: boolean
                  default: true
              required:
                - queryVector
                - collectionName
      responses:
        '200':
          description: Search completed successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          results:
                            type: array
                            items:
                              $ref: '#/components/schemas/VectorSearchResult'
                          searchTime:
                            type: number
                            description: Search time in milliseconds
                          totalResults:
                            type: integer
        '400':
          description: Invalid search parameters
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

  /api/v1/vectordb/embeddings:
    post:
      tags:
        - VectorDatabase
      summary: Generate embeddings
      description: Generates vector embeddings for text content using configured model
      security:
        - localAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                content:
                  type: string
                  minLength: 1
                  maxLength: 10000
                contentType:
                  type: string
                  enum: [code, documentation, comment, text]
                  default: text
                model:
                  type: string
                  description: Override default embedding model
                projectId:
                  $ref: '#/components/schemas/UUID'
              required:
                - content
      responses:
        '200':
          description: Embedding generated successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/EmbeddingResult'
        '400':
          description: Invalid content or parameters
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

  /api/v1/vectordb/embeddings/batch:
    post:
      tags:
        - VectorDatabase
      summary: Generate embeddings in batch
      description: Generates vector embeddings for multiple text contents
      security:
        - localAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                requests:
                  type: array
                  items:
                    type: object
                    properties:
                      id:
                        type: string
                      content:
                        type: string
                      contentType:
                        type: string
                        enum: [code, documentation, comment, text]
                        default: text
                    required:
                      - id
                      - content
                  minItems: 1
                  maxItems: 100
                model:
                  type: string
                projectId:
                  $ref: '#/components/schemas/UUID'
              required:
                - requests
      responses:
        '200':
          description: Batch embeddings generated successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          results:
                            type: array
                            items:
                              type: object
                              properties:
                                id:
                                  type: string
                                embedding:
                                  type: array
                                  items:
                                    type: number
                                error:
                                  type: string
                          totalRequests:
                            type: integer
                          successfulRequests:
                            type: integer
                          failedRequests:
                            type: integer
                          totalTime:
                            type: number

components:
  schemas:
    VectorDatabaseHealth:
      type: object
      required:
        - connectionStatus
        - totalCollections
        - activeCollections
        - totalVectors
        - memoryUsage
        - cpuUsage
        - diskUsage
        - recentOperations
        - timestamp
      properties:
        connectionStatus:
          type: string
          enum: [connected, disconnected, error]
        serverVersion:
          type: string
        totalCollections:
          type: integer
        activeCollections:
          type: integer
        totalVectors:
          type: integer
        memoryUsage:
          type: number
        cpuUsage:
          type: number
        diskUsage:
          type: number
        recentOperations:
          type: object
          properties:
            searchOpsPerMinute:
              type: number
            insertOpsPerMinute:
              type: number
            deleteOpsPerMinute:
              type: number
        timestamp:
          type: string
          format: date-time

    VectorCollection:
      type: object
      required:
        - name
        - type
        - dimension
        - metric
        - indexType
        - createdAt
        - lastModified
        - vectorCount
        - status
      properties:
        name:
          type: string
        description:
          type: string
        type:
          type: string
          enum: [context, artifacts, patterns, dependencies, embeddings]
        dimension:
          type: integer
        metric:
          type: string
          enum: [cosine, euclidean, manhattan, dot_product]
        indexType:
          type: string
          enum: [ivf_flat, ivf_sq8, hnsw, annoy, autoindex]
        indexParams:
          type: object
        createdAt:
          type: string
          format: date-time
        lastModified:
          type: string
          format: date-time
        vectorCount:
          type: integer
        status:
          type: string
          enum: [creating, ready, loading, error]
        projectId:
          $ref: '#/components/schemas/UUID'

    VectorEntry:
      type: object
      required:
        - id
        - vector
        - insertedAt
      properties:
        id:
          type: string
        vector:
          type: array
          items:
            type: number
        metadata:
          type: object
        contextId:
          $ref: '#/components/schemas/UUID'
        projectId:
          $ref: '#/components/schemas/UUID'
        insertedAt:
          type: string
          format: date-time

    VectorSearchResult:
      type: object
      required:
        - id
        - score
        - distance
      properties:
        id:
          type: string
        score:
          type: number
        metadata:
          type: object
        contextId:
          $ref: '#/components/schemas/UUID'
        projectId:
          $ref: '#/components/schemas/UUID'
        distance:
          type: number

    CollectionStatistics:
      type: object
      required:
        - collectionName
        - totalVectors
        - indexStatus
        - memoryUsage
        - diskUsage
        - searchMetrics
        - timestamp
      properties:
        collectionName:
          type: string
        totalVectors:
          type: integer
        indexStatus:
          type: string
          enum: [built, building, not_built]
        memoryUsage:
          type: number
        diskUsage:
          type: number
        lastInsert:
          type: string
          format: date-time
        searchMetrics:
          type: object
          properties:
            avgSearchLatency:
              type: number
            totalSearches:
              type: integer
            successRate:
              type: number
        timestamp:
          type: string
          format: date-time

    EmbeddingResult:
      type: object
      required:
        - requestId
        - embedding
        - dimension
        - model
        - generatedAt
        - generationTime
      properties:
        requestId:
          $ref: '#/components/schemas/UUID'
        embedding:
          type: array
          items:
            type: number
        dimension:
          type: integer
        model:
          type: string
        generatedAt:
          type: string
          format: date-time
        generationTime:
          type: number

    VectorBatchResult:
      type: object
      required:
        - operationId
        - totalOperations
        - successfulOperations
        - failedOperations
        - processingTime
        - completedAt
      properties:
        operationId:
          $ref: '#/components/schemas/UUID'
        totalOperations:
          type: integer
        successfulOperations:
          type: integer
        failedOperations:
          type: integer
        processingTime:
          type: number
        errors:
          type: array
          items:
            type: object
            properties:
              vectorId:
                type: string
              error:
                type: string
        completedAt:
          type: string
          format: date-time
```

## **4. Detailed Business Logic & Validation Rules**

| Rule ID | Rule Description | Implementation Location(s) & Notes |
|---------|------------------|-----------------------------------|
| **VDB-01** | Vector database connections must be established using configuration values from the Configuration Management Module and all connection failures must be logged through the Logging Service. | **Backend (Authoritative):** Vector database service must query Configuration Management Module for MILVUS_HOST, MILVUS_PORT, and connection parameters. All connection events logged via Logging Service with appropriate severity levels. |
| **VDB-02** | All vector search operations must complete within 3 seconds to meet the Context Management Efficiency KPI, and search times exceeding this threshold must trigger alerts through the Logging Service. | **Backend (Authoritative):** Search service must implement timeout mechanisms and performance monitoring. Search latency metrics sent to Logging Service, with alerts generated when exceeding 3000ms threshold. |
| **VDB-03** | Vector embeddings must be generated using the model specified in the Configuration Management Module (default: sentence-transformers/all-mpnet-base-v2) to ensure consistency across all vector operations. | **Backend (Authoritative):** Embedding service must query Configuration Management Module for VECTOR_EMBEDDING_MODEL setting. All embedding generation requests must use the configured model unless explicitly overridden. |
| **VDB-04** | Vector collections must be created with appropriate names and configurations, and collection name conflicts must be prevented by validating uniqueness before creation. | **Backend (Authoritative):** Collection service must validate collection names against existing collections and enforce naming conventions (alphanumeric + underscore, starting with letter). |
| **VDB-05** | Vector operations (insert, update, delete, search) must be logged with performance metrics to the Logging & Monitoring Service for performance tracking and debugging. | **Backend (Authoritative):** All vector operations must generate performance metrics including operation type, duration, vector count, and success status. Metrics sent to Logging Service for monitoring dashboard integration. |
| **VDB-06** | Vector database health must be monitored continuously and health status must be reported to the Logging & Monitoring Service for system-wide health tracking and alerting. | **Backend (Authoritative):** Health monitoring service must periodically check Milvus connection, resource usage, and performance metrics. Health status updates sent to Logging Service for integration with system health monitoring. |
| **VDB-07** | Batch vector operations must implement proper error handling and partial failure recovery, ensuring that individual vector failures don't prevent the entire batch from processing. | **Backend (Authoritative):** Batch operations must process vectors individually, collect success/failure results, and return detailed batch results with error information for failed vectors. |
| **VDB-08** | Vector similarity search results must be filtered and sorted by relevance score, and minimum threshold filtering must be applied to ensure only semantically relevant results are returned. | **Backend (Authoritative):** Search service must implement configurable similarity thresholds and relevance scoring. Results below threshold should be filtered out before returning to calling services. |
| **VDB-09** | Vector database storage and memory usage must be monitored, and storage capacity alerts must be triggered through the Logging Service when approaching configured limits. | **Backend (Authoritative):** Resource monitoring service must track disk usage, memory consumption, and vector count per collection. Alerts sent via Logging Service when usage exceeds configurable thresholds. |
| **VDB-10** | Vector embedding dimension consistency must be enforced within collections, and attempts to insert vectors with mismatched dimensions must be rejected with appropriate error messages. | **Backend (Authoritative):** Vector validation service must check embedding dimensions against collection configuration before insertion. Dimension mismatches must result in validation errors with clear error messages. |

## **5. Developer Task Checklist**

### **Backend Tasks:**
- [ ] Create database migration script for vector database management tables (`vector_collections`, `vector_operations`, `embedding_cache`)
- [ ] Implement the `MilvusConnectionService` class with connection pooling, health monitoring, and automatic reconnection capabilities
- [ ] Implement the `VectorCollectionService` class for creating, managing, and configuring Milvus collections with proper indexing
- [ ] Implement the `VectorStorageService` class for inserting, updating, and deleting vectors with batch processing capabilities
- [ ] Implement the `VectorSearchService` class for semantic similarity search with configurable parameters and result filtering
- [ ] Implement the `EmbeddingGenerationService` class for generating embeddings using sentence-transformers with caching and batch processing
- [ ] Implement vector database health endpoints (`GET /api/v1/vectordb/health`) with comprehensive health checks and performance metrics
- [ ] Implement collection management endpoints (`GET`, `POST /api/v1/vectordb/collections`, `GET`, `DELETE /api/v1/vectordb/collections/{name}`)
- [ ] Implement vector operations endpoints (`POST`, `DELETE /api/v1/vectordb/vectors`) with batch processing and error handling
- [ ] Implement vector search endpoint (`POST /api/v1/vectordb/search`) with similarity search, filtering, and performance optimization
- [ ] Implement embedding generation endpoints (`POST /api/v1/vectordb/embeddings`, `POST /api/v1/vectordb/embeddings/batch`)
- [ ] Implement collection statistics endpoint (`GET /api/v1/vectordb/collections/{name}/statistics`) for performance monitoring
- [ ] Create `VectorDatabaseRepository` class for managing vector database metadata and operation logging
- [ ] Implement vector embedding caching mechanism to avoid regenerating embeddings for identical content
- [ ] Implement vector search result caching with TTL-based invalidation for frequently accessed queries
- [ ] Create automated collection optimization service for maintaining search performance as collections grow
- [ ] Implement vector database backup and recovery mechanisms for collection data and configurations
- [ ] Create comprehensive unit tests for all service classes with mock Milvus dependencies
- [ ] Create integration tests for vector operations including end-to-end search and embedding workflows
- [ ] Implement performance benchmarking tools for measuring search latency and throughput under load
- [ ] Add vector database operation logging integration with the Logging & Monitoring Service for audit trails and performance tracking

### **Frontend Tasks:**
- [ ] Create `VectorDatabaseProvider` React context for vector database operations and health monitoring
- [ ] Implement `useVectorDatabase` hook for accessing vector database functionality and health status
- [ ] Create `VectorDatabaseHealth` component for displaying real-time vector database status and performance metrics
- [ ] Implement `CollectionManager` component for viewing, creating, and managing vector collections
- [ ] Create `VectorSearch` component for performing semantic search with result visualization and filtering
- [ ] Implement `EmbeddingGenerator` component for generating and testing embeddings with different models
- [ ] Create `CollectionStatistics` component for displaying collection performance metrics, usage, and health
- [ ] Implement vector database service functions in the API client (`vectorDatabaseService.ts`) for all vector operations
- [ ] Integrate vector database health status into the main application health dashboard
- [ ] Implement collection performance visualization using charts for search latency, vector counts, and memory usage
- [ ] Create vector search interface with semantic similarity visualization and relevance scoring
- [ ] Add vector database configuration interface integrated with Configuration Management Module settings
- [ ] Implement embedding comparison tools for analyzing semantic similarity between different text contents
- [ ] Create collection optimization interface for managing indexes, memory usage, and search performance
- [ ] Add vector database monitoring dashboard with real-time metrics, alerts, and performance trends
- [ ] Implement vector data visualization tools for exploring high-dimensional vector spaces and clusters
- [ ] Create collection backup and restore interface with progress tracking and validation
- [ ] Add vector database troubleshooting guide component for common issues and optimization recommendations
- [ ] Implement vector search result visualization with similarity scores, metadata display, and export functionality
- [ ] Create batch embedding processing interface for bulk content processing with progress indicators and error handling


========================================================================================


# API Gateway Module - Technical Specification

## **1. Module Overview**

**Purpose:** The API Gateway Module serves as the centralized entry point and request orchestrator for the entire ReadyAI application, providing RESTful API routing, local authentication enforcement, request validation, error handling, rate limiting, and API documentation generation. This module acts as the primary interface between the VS Code extension, frontend application, and all backend services, ensuring consistent security, logging, and performance across all API interactions while maintaining the local-first architecture principles.

**Dependencies & Interactions:** This module depends on the Configuration Management Module to obtain API gateway configuration settings including rate limiting thresholds, authentication settings, CORS policies, and API documentation configuration. It integrates with the Logging & Monitoring Service to track all API requests, response times, error rates, and performance metrics for comprehensive system monitoring. The module interacts with all other ReadyAI modules by routing their API requests through centralized middleware pipelines for authentication, validation, and logging. It provides the foundational API infrastructure that enables the Project Management Module, Context Management Engine, Claude Integration Service, and all other modules to expose their functionality through standardized RESTful endpoints.

## **2. Module-Specific Type Additions (`types.apigateway.ts`)**

```typescript
/**
 * API Gateway Module Types
 * Extends foundational types with API gateway-specific interfaces
 */

/** API route definition */
export interface APIRoute {
  /** Route identifier */
  id: UUID;
  /** HTTP method */
  method: 'GET' | 'POST' | 'PUT' | 'PATCH' | 'DELETE' | 'OPTIONS';
  /** Route path pattern */
  path: string;
  /** Target module/service */
  module: string;
  /** Route description */
  description: string;
  /** Whether authentication is required */
  requiresAuth: boolean;
  /** Rate limiting configuration */
  rateLimit?: RateLimitConfig;
  /** Request validation schema */
  validationSchema?: string;
  /** Route creation timestamp */
  createdAt: string; // ISO 8601 format
  /** Whether route is currently active */
  active: boolean;
}

/** Rate limiting configuration */
export interface RateLimitConfig {
  /** Maximum requests per window */
  maxRequests: number;
  /** Time window in seconds */
  windowSeconds: number;
  /** Rate limit identifier/key */
  keyGenerator: 'ip' | 'session' | 'global';
  /** Custom rate limit message */
  message?: string;
  /** Whether to use sliding window */
  slidingWindow: boolean;
}

/** API request metrics */
export interface APIRequestMetrics {
  /** Request identifier */
  id: UUID;
  /** HTTP method */
  method: string;
  /** Request path */
  path: string;
  /** HTTP status code */
  statusCode: number;
  /** Response time in milliseconds */
  responseTime: number;
  /** Request size in bytes */
  requestSize: number;
  /** Response size in bytes */
  responseSize: number;
  /** Client IP address */
  clientIP: string;
  /** User agent */
  userAgent?: string;
  /** Session identifier */
  sessionId?: string;
  /** Project context */
  projectId?: UUID;
  /** Request timestamp */
  timestamp: string; // ISO 8601 format
  /** Request correlation ID */
  correlationId: string;
}

/** Rate limiting status */
export interface RateLimitStatus {
  /** Rate limit identifier */
  key: string;
  /** Current request count */
  currentCount: number;
  /** Maximum allowed requests */
  maxRequests: number;
  /** Time window in seconds */
  windowSeconds: number;
  /** Remaining requests in window */
  remaining: number;
  /** Window reset timestamp */
  resetTime: string; // ISO 8601 format
  /** Whether rate limit is exceeded */
  exceeded: boolean;
}

/** Authentication context */
export interface AuthenticationContext {
  /** Whether request is authenticated */
  isAuthenticated: boolean;
  /** Session identifier */
  sessionId?: string;
  /** Session expiry time */
  expiresAt?: string; // ISO 8601 format
  /** Authentication method used */
  method: 'local-session';
  /** Additional authentication metadata */
  metadata?: Record<string, any>;
}

/** API gateway health status */
export interface APIGatewayHealth {
  /** Overall gateway health */
  status: 'healthy' | 'degraded' | 'unhealthy';
  /** Health check timestamp */
  timestamp: string; // ISO 8601 format
  /** Request routing health */
  routing: {
    /** Total active routes */
    activeRoutes: number;
    /** Failed route count in last window */
    failedRoutes: number;
    /** Average response time */
    avgResponseTime: number;
  };
  /** Rate limiting health */
  rateLimiting: {
    /** Active rate limit rules */
    activeRules: number;
    /** Current rate limit violations */
    violations: number;
    /** Rate limit effectiveness */
    effectiveness: number;
  };
  /** Authentication health */
  authentication: {
    /** Active sessions count */
    activeSessions: number;
    /** Authentication success rate */
    successRate: number;
    /** Expired sessions in last hour */
    expiredSessions: number;
  };
}

/** API documentation configuration */
export interface APIDocumentationConfig {
  /** Documentation title */
  title: string;
  /** Documentation description */
  description: string;
  /** API version */
  version: string;
  /** Server URLs */
  servers: Array<{
    url: string;
    description: string;
  }>;
  /** Contact information */
  contact?: {
    name: string;
    url?: string;
    email?: string;
  };
  /** License information */
  license?: {
    name: string;
    url?: string;
  };
  /** Whether to include example requests */
  includeExamples: boolean;
  /** Tags for organization */
  tags: Array<{
    name: string;
    description: string;
  }>;
}

/** Middleware execution context */
export interface MiddlewareContext {
  /** Request correlation ID */
  correlationId: string;
  /** Request start time */
  startTime: number;
  /** Authentication context */
  auth: AuthenticationContext;
  /** Rate limiting status */
  rateLimit?: RateLimitStatus;
  /** Request metrics */
  metrics: Partial<APIRequestMetrics>;
  /** Additional middleware data */
  data: Record<string, any>;
}

/** API error tracking */
export interface APIError {
  /** Error identifier */
  id: UUID;
  /** Request correlation ID */
  correlationId: string;
  /** HTTP method */
  method: string;
  /** Request path */
  path: string;
  /** HTTP status code */
  statusCode: number;
  /** Error message */
  message: string;
  /** Error stack trace */
  stackTrace?: string;
  /** Request body (sanitized) */
  requestBody?: string;
  /** Response body */
  responseBody?: string;
  /** Client information */
  client: {
    ip: string;
    userAgent?: string;
    sessionId?: string;
  };
  /** Error timestamp */
  timestamp: string; // ISO 8601 format
  /** Whether error was handled */
  handled: boolean;
}
```

## **3. API Endpoint Specification (OpenAPI `paths` block)**

```yaml
paths:
  /api/v1/gateway/health:
    get:
      tags:
        - API Gateway
      summary: Get API gateway health status
      description: Retrieves comprehensive health information about the API gateway including routing, rate limiting, and authentication status
      security:
        - localAuth: []
      responses:
        '200':
          description: API gateway health retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/APIGatewayHealth'

  /api/v1/gateway/routes:
    get:
      tags:
        - API Gateway
      summary: List all registered API routes
      description: Retrieves information about all registered API routes including their configuration and status
      security:
        - localAuth: []
      parameters:
        - name: module
          in: query
          description: Filter routes by module
          required: false
          schema:
            type: string
        - name: method
          in: query
          description: Filter routes by HTTP method
          required: false
          schema:
            type: string
            enum: [GET, POST, PUT, PATCH, DELETE, OPTIONS]
        - name: active
          in: query
          description: Filter by route status
          required: false
          schema:
            type: boolean
      responses:
        '200':
          description: API routes retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          routes:
                            type: array
                            items:
                              $ref: '#/components/schemas/APIRoute'
                          totalCount:
                            type: integer

  /api/v1/gateway/metrics:
    get:
      tags:
        - API Gateway
      summary: Get API gateway metrics
      description: Retrieves request metrics and performance statistics from the API gateway
      security:
        - localAuth: []
      parameters:
        - name: startTime
          in: query
          description: Start time for metrics range
          required: false
          schema:
            type: string
            format: date-time
        - name: endTime
          in: query
          description: End time for metrics range
          required: false
          schema:
            type: string
            format: date-time
        - name: path
          in: query
          description: Filter metrics by request path
          required: false
          schema:
            type: string
        - name: method
          in: query
          description: Filter metrics by HTTP method
          required: false
          schema:
            type: string
        - name: statusCode
          in: query
          description: Filter metrics by status code
          required: false
          schema:
            type: integer
      responses:
        '200':
          description: API metrics retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          metrics:
                            type: array
                            items:
                              $ref: '#/components/schemas/APIRequestMetrics'
                          summary:
                            type: object
                            properties:
                              totalRequests:
                                type: integer
                              avgResponseTime:
                                type: number
                              errorRate:
                                type: number
                              requestsPerSecond:
                                type: number

  /api/v1/gateway/rate-limits:
    get:
      tags:
        - API Gateway
      summary: Get rate limiting status
      description: Retrieves current rate limiting status and configuration
      security:
        - localAuth: []
      responses:
        '200':
          description: Rate limiting status retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          rateLimits:
                            type: array
                            items:
                              $ref: '#/components/schemas/RateLimitStatus'
                          globalStatus:
                            type: object
                            properties:
                              enabled:
                                type: boolean
                              totalViolations:
                                type: integer
                              activeRules:
                                type: integer

    post:
      tags:
        - API Gateway
      summary: Update rate limiting configuration
      description: Updates rate limiting rules and thresholds
      security:
        - localAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                globalEnabled:
                  type: boolean
                  description: Enable/disable global rate limiting
                defaultConfig:
                  $ref: '#/components/schemas/RateLimitConfig'
                  description: Default rate limiting configuration
                routeConfigs:
                  type: array
                  items:
                    type: object
                    properties:
                      path:
                        type: string
                      method:
                        type: string
                      config:
                        $ref: '#/components/schemas/RateLimitConfig'
      responses:
        '200':
          description: Rate limiting configuration updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'

  /api/v1/gateway/auth/status:
    get:
      tags:
        - API Gateway
      summary: Get authentication status
      description: Retrieves current authentication status and session information
      security:
        - localAuth: []
      responses:
        '200':
          description: Authentication status retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/AuthenticationContext'

  /api/v1/gateway/docs:
    get:
      tags:
        - API Gateway
      summary: Get API documentation
      description: Retrieves the complete OpenAPI specification for all registered routes
      responses:
        '200':
          description: API documentation retrieved successfully
          content:
            application/json:
              schema:
                type: object
                description: Complete OpenAPI 3.0 specification
            application/yaml:
              schema:
                type: string
                description: OpenAPI specification in YAML format

  /api/v1/gateway/docs/ui:
    get:
      tags:
        - API Gateway
      summary: Get API documentation UI
      description: Serves the Swagger UI interface for interactive API documentation
      responses:
        '200':
          description: API documentation UI served successfully
          content:
            text/html:
              schema:
                type: string
                description: Swagger UI HTML interface

  /api/v1/gateway/errors:
    get:
      tags:
        - API Gateway
      summary: Get API error logs
      description: Retrieves recent API errors and exceptions with filtering capabilities
      security:
        - localAuth: []
      parameters:
        - name: startTime
          in: query
          description: Start time for error range
          required: false
          schema:
            type: string
            format: date-time
        - name: endTime
          in: query
          description: End time for error range
          required: false
          schema:
            type: string
            format: date-time
        - name: statusCode
          in: query
          description: Filter by HTTP status code
          required: false
          schema:
            type: integer
        - name: path
          in: query
          description: Filter by request path
          required: false
          schema:
            type: string
        - name: handled
          in: query
          description: Filter by error handling status
          required: false
          schema:
            type: boolean
        - name: limit
          in: query
          description: Maximum number of errors to return
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 1000
            default: 100
      responses:
        '200':
          description: API errors retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          errors:
                            type: array
                            items:
                              $ref: '#/components/schemas/APIError'
                          totalCount:
                            type: integer
                          errorRate:
                            type: number

  /api/v1/gateway/config:
    get:
      tags:
        - API Gateway
      summary: Get API gateway configuration
      description: Retrieves current API gateway configuration settings
      security:
        - localAuth: []
      responses:
        '200':
          description: API gateway configuration retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          cors:
                            type: object
                            properties:
                              enabled:
                                type: boolean
                              origins:
                                type: array
                                items:
                                  type: string
                              methods:
                                type: array
                                items:
                                  type: string
                          rateLimit:
                            $ref: '#/components/schemas/RateLimitConfig'
                          authentication:
                            type: object
                            properties:
                              enabled:
                                type: boolean
                              sessionTimeout:
                                type: integer
                          documentation:
                            $ref: '#/components/schemas/APIDocumentationConfig'

    put:
      tags:
        - API Gateway
      summary: Update API gateway configuration
      description: Updates API gateway configuration settings
      security:
        - localAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                cors:
                  type: object
                  properties:
                    enabled:
                      type: boolean
                    origins:
                      type: array
                      items:
                        type: string
                    methods:
                      type: array
                      items:
                        type: string
                rateLimit:
                  $ref: '#/components/schemas/RateLimitConfig'
                authentication:
                  type: object
                  properties:
                    enabled:
                      type: boolean
                    sessionTimeout:
                      type: integer
                      minimum: 300
                      maximum: 86400
                documentation:
                  $ref: '#/components/schemas/APIDocumentationConfig'
      responses:
        '200':
          description: API gateway configuration updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'

components:
  schemas:
    APIRoute:
      type: object
      required:
        - id
        - method
        - path
        - module
        - description
        - requiresAuth
        - createdAt
        - active
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        method:
          type: string
          enum: [GET, POST, PUT, PATCH, DELETE, OPTIONS]
        path:
          type: string
        module:
          type: string
        description:
          type: string
        requiresAuth:
          type: boolean
        rateLimit:
          $ref: '#/components/schemas/RateLimitConfig'
        validationSchema:
          type: string
        createdAt:
          type: string
          format: date-time
        active:
          type: boolean

    RateLimitConfig:
      type: object
      required:
        - maxRequests
        - windowSeconds
        - keyGenerator
        - slidingWindow
      properties:
        maxRequests:
          type: integer
          minimum: 1
        windowSeconds:
          type: integer
          minimum: 1
        keyGenerator:
          type: string
          enum: [ip, session, global]
        message:
          type: string
        slidingWindow:
          type: boolean

    APIRequestMetrics:
      type: object
      required:
        - id
        - method
        - path
        - statusCode
        - responseTime
        - requestSize
        - responseSize
        - clientIP
        - timestamp
        - correlationId
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        method:
          type: string
        path:
          type: string
        statusCode:
          type: integer
        responseTime:
          type: number
        requestSize:
          type: integer
        responseSize:
          type: integer
        clientIP:
          type: string
        userAgent:
          type: string
        sessionId:
          type: string
        projectId:
          $ref: '#/components/schemas/UUID'
        timestamp:
          type: string
          format: date-time
        correlationId:
          type: string

    RateLimitStatus:
      type: object
      required:
        - key
        - currentCount
        - maxRequests
        - windowSeconds
        - remaining
        - resetTime
        - exceeded
      properties:
        key:
          type: string
        currentCount:
          type: integer
        maxRequests:
          type: integer
        windowSeconds:
          type: integer
        remaining:
          type: integer
        resetTime:
          type: string
          format: date-time
        exceeded:
          type: boolean

    AuthenticationContext:
      type: object
      required:
        - isAuthenticated
        - method
      properties:
        isAuthenticated:
          type: boolean
        sessionId:
          type: string
        expiresAt:
          type: string
          format: date-time
        method:
          type: string
          enum: [local-session]
        metadata:
          type: object

    APIGatewayHealth:
      type: object
      required:
        - status
        - timestamp
        - routing
        - rateLimiting
        - authentication
      properties:
        status:
          type: string
          enum: [healthy, degraded, unhealthy]
        timestamp:
          type: string
          format: date-time
        routing:
          type: object
          properties:
            activeRoutes:
              type: integer
            failedRoutes:
              type: integer
            avgResponseTime:
              type: number
        rateLimiting:
          type: object
          properties:
            activeRules:
              type: integer
            violations:
              type: integer
            effectiveness:
              type: number
        authentication:
          type: object
          properties:
            activeSessions:
              type: integer
            successRate:
              type: number
            expiredSessions:
              type: integer

    APIDocumentationConfig:
      type: object
      required:
        - title
        - description
        - version
        - servers
        - includeExamples
        - tags
      properties:
        title:
          type: string
        description:
          type: string
        version:
          type: string
        servers:
          type: array
          items:
            type: object
            properties:
              url:
                type: string
              description:
                type: string
        contact:
          type: object
          properties:
            name:
              type: string
            url:
              type: string
            email:
              type: string
        license:
          type: object
          properties:
            name:
              type: string
            url:
              type: string
        includeExamples:
          type: boolean
        tags:
          type: array
          items:
            type: object
            properties:
              name:
                type: string
              description:
                type: string

    APIError:
      type: object
      required:
        - id
        - correlationId
        - method
        - path
        - statusCode
        - message
        - client
        - timestamp
        - handled
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        correlationId:
          type: string
        method:
          type: string
        path:
          type: string
        statusCode:
          type: integer
        message:
          type: string
        stackTrace:
          type: string
        requestBody:
          type: string
        responseBody:
          type: string
        client:
          type: object
          properties:
            ip:
              type: string
            userAgent:
              type: string
            sessionId:
              type: string
        timestamp:
          type: string
          format: date-time
        handled:
          type: boolean
```

## **4. Detailed Business Logic & Validation Rules**

| Rule ID | Rule Description | Implementation Location(s) & Notes |
|---------|------------------|-----------------------------------|
| **AGW-01** | All API requests must be routed through the authentication middleware, and requests without valid X-Local-Auth headers must be rejected with 401 status for protected endpoints. | **Backend (Authoritative):** Authentication middleware must validate session tokens against local session store. Integrates with Configuration Management Module for authentication settings and logs authentication attempts via Logging Service. |
| **AGW-02** | Rate limiting must be enforced per the configured thresholds, and exceeded clients must receive 429 status with rate limit headers indicating when they can retry. | **Backend (Authoritative):** Rate limiting middleware must track request counts per IP/session and enforce limits from Configuration Management Module. Rate limit violations logged via Logging Service for monitoring. |
| **AGW-03** | All API requests and responses must be logged with correlation IDs, response times, and status codes for monitoring and debugging purposes. | **Backend (Authoritative):** Request logging middleware must generate correlation IDs, measure response times, and send metrics to Logging Service. Critical for meeting <3 second response time KPI. |
| **AGW-04** | CORS headers must be configured based on Configuration Management settings to allow only authorized origins, and preflight requests must be handled appropriately. | **Backend (Authoritative):** CORS middleware must query Configuration Management Module for allowed origins and methods. Invalid CORS requests logged as security events via Logging Service. |
| **AGW-05** | Request validation must be performed based on OpenAPI schemas, and invalid requests must be rejected with detailed validation error messages. | **Backend (Authoritative):** Validation middleware must validate request schemas and return structured validation errors conforming to ApiErrorResponse format. Validation failures logged for debugging. |
| **AGW-06** | API errors must be caught, sanitized to prevent information disclosure, and logged with full context while returning user-friendly error messages. | **Backend (Authoritative):** Global error handler must sanitize sensitive data from error responses and send detailed error context to Logging Service while returning safe error messages to clients. |
| **AGW-07** | Health check endpoints must validate connectivity to all dependent services (Configuration Management, Logging Service) and report degraded status if any dependencies fail. | **Backend (Authoritative):** Health service must periodically check dependencies and report aggregated health status. Health check results sent to Logging Service for system monitoring. |
| **AGW-08** | API documentation must be dynamically generated from registered routes and their schemas, and must be accessible without authentication for development purposes. | **Backend (Authoritative):** Documentation service must introspect registered routes and generate OpenAPI specs. Configuration Management Module controls whether documentation is exposed in production. |
| **AGW-09** | Session management must enforce timeout policies from Configuration Management and automatically clean up expired sessions to prevent memory leaks. | **Backend (Authoritative):** Session service must respect session timeout from Configuration Management and periodically clean expired sessions. Session lifecycle events logged via Logging Service. |
| **AGW-10** | Request routing must support path parameters, query parameters, and request body routing while maintaining consistent error handling across all routes. | **Backend (Authoritative):** Router service must handle dynamic routing patterns and apply consistent middleware pipeline. Route registration and errors logged via Logging Service for debugging. |

## **5. Developer Task Checklist**

### **Backend Tasks:**
- [ ] Create database migration script for API gateway tables (`api_routes`, `rate_limit_rules`, `api_metrics`, `api_errors`, `session_store`)
- [ ] Implement the `APIGatewayService` class as the main orchestrator for request routing, middleware management, and configuration
- [ ] Implement the `AuthenticationMiddleware` class for local session validation with X-Local-Auth header processing
- [ ] Implement the `RateLimitingMiddleware` class with configurable limits, sliding windows, and violation tracking
- [ ] Implement the `RequestLoggingMiddleware` class for comprehensive request/response logging with correlation ID generation
- [ ] Implement the `ValidationMiddleware` class for OpenAPI schema validation with detailed error reporting
- [ ] Implement the `ErrorHandlingMiddleware` class for global error catching, sanitization, and logging
- [ ] Implement the `CORSMiddleware` class with dynamic configuration from Configuration Management Module
- [ ] Implement all API gateway management endpoints (`GET /api/v1/gateway/health`, `GET /api/v1/gateway/routes`, `GET /api/v1/gateway/metrics`)
- [ ] Implement rate limiting management endpoints (`GET /api/v1/gateway/rate-limits`, `POST /api/v1/gateway/rate-limits`)
- [ ] Implement authentication status endpoint (`GET /api/v1/gateway/auth/status`)
- [ ] Implement API documentation endpoints (`GET /api/v1/gateway/docs`, `GET /api/v1/gateway/docs/ui`)
- [ ] Implement error tracking endpoints (`GET /api/v1/gateway/errors`)
- [ ] Implement configuration management endpoints (`GET /api/v1/gateway/config`, `PUT /api/v1/gateway/config`)
- [ ] Create `RouteRegistry` class for dynamic route registration and management with hot-reload capabilities
- [ ] Create `SessionStore` class for local session management with automatic cleanup and persistence
- [ ] Implement `APIDocumentationService` class for dynamic OpenAPI spec generation and Swagger UI serving
- [ ] Create comprehensive unit tests for all middleware components with mock dependencies
- [ ] Create integration tests for complete request/response cycles through all middleware layers
- [ ] Implement performance benchmarks to ensure API gateway meets <3 second response time KPI requirements
- [ ] Add integration with Configuration Management Module for all gateway settings and hot configuration reloading
- [ ] Add comprehensive integration with Logging Service for all request metrics, errors, and performance data

### **Frontend Tasks:**
- [ ] Create `APIGatewayProvider` React context for accessing gateway status, metrics, and configuration
- [ ] Implement `useAPIGateway` hook for frontend access to gateway health, metrics, and configuration management
- [ ] Create `APIGatewayDashboard` component for displaying gateway health, active routes, and performance metrics
- [ ] Implement `APIMetricsViewer` component for visualizing request metrics, response times, and error rates with charts
- [ ] Create `RateLimitManager` component for configuring and monitoring rate limiting rules and violations
- [ ] Implement `APIDocumentationViewer` component for embedded Swagger UI and API exploration
- [ ] Create `APIErrorTracker` component for displaying recent API errors with filtering and search capabilities
- [ ] Implement `GatewayConfigurationEditor` component for modifying CORS, rate limiting, and authentication settings
- [ ] Create API gateway service functions in the API client (`gatewayService.ts`) for all gateway management endpoints
- [ ] Implement real-time gateway status monitoring with automatic refresh and health indicators
- [ ] Add gateway configuration interface integrated with Configuration Management Module settings
- [ ] Create API performance monitoring dashboard with real-time metrics visualization
- [ ] Implement gateway error alerting system with toast notifications for critical gateway issues
- [ ] Add route management interface for viewing and managing registered API routes
- [ ] Create API testing interface for testing endpoints directly from the documentation viewer
- [ ] Implement gateway troubleshooting tools including request tracing and correlation ID tracking
- [ ] Add gateway security monitoring for authentication failures and rate limit violations
- [ ] Create gateway analytics interface for tracking API usage patterns and performance trends
- [ ] Implement gateway configuration backup and restore functionality
- [ ] Add gateway load testing interface for performance validation and capacity planning



========================================================================================


# Authentication Service - Technical Specification

## **1. Module Overview**

**Purpose:** The Authentication Service serves as the local-only authentication system for the ReadyAI Personal AI Development Orchestrator, designed specifically for personal development use. This module provides secure session management, local token storage and validation, session refresh capabilities, and authentication middleware for API endpoints. It implements the local-first authentication model defined in the HLSD, eliminating the complexity of traditional user management while ensuring secure access control for the solo developer persona.

**Dependencies & Interactions:** This module depends on the Configuration Management Module to obtain authentication configuration settings including session timeouts, token expiry policies, and security parameters. It interacts with the Logging & Monitoring Service to track authentication events, session activities, and security-related metrics for audit trails and monitoring. The module integrates with the API Gateway Module by providing authentication middleware that validates sessions for protected API endpoints. It also supports the VS Code Extension Host by providing session validation services and token management for extension-to-backend communication.

## **2. Module-Specific Type Additions (`types.authentication.ts`)**

```typescript
/**
 * Authentication Service Module Types
 * Extends foundational types with authentication-specific interfaces
 */

/** Authentication token types */
export type AuthTokenType = 'session' | 'refresh' | 'api' | 'extension';

/** Session status types */
export type SessionStatus = 'active' | 'expired' | 'revoked' | 'refreshing';

/** Authentication event types */
export type AuthEventType = 'login' | 'logout' | 'refresh' | 'validation' | 'expiry' | 'revocation';

/** Authentication methods */
export type AuthMethod = 'local_session' | 'extension_handshake' | 'api_key';

/** Authentication session */
export interface AuthSession {
  /** Unique session identifier */
  id: UUID;
  /** Session token */
  token: string;
  /** Refresh token for session renewal */
  refreshToken: string;
  /** Session status */
  status: SessionStatus;
  /** Authentication method used */
  authMethod: AuthMethod;
  /** Session creation timestamp */
  createdAt: string; // ISO 8601 format
  /** Session last access timestamp */
  lastAccessedAt: string; // ISO 8601 format
  /** Session expiry timestamp */
  expiresAt: string; // ISO 8601 format
  /** Refresh token expiry timestamp */
  refreshExpiresAt: string; // ISO 8601 format
  /** Client information */
  clientInfo: {
    /** User agent string */
    userAgent?: string;
    /** Client IP address */
    ipAddress?: string;
    /** Client type */
    clientType: 'frontend' | 'extension' | 'api';
    /** Client version */
    clientVersion?: string;
  };
  /** Session metadata */
  metadata?: Record<string, any>;
}

/** Authentication token */
export interface AuthToken {
  /** Token identifier */
  id: UUID;
  /** Token type */
  type: AuthTokenType;
  /** Token value */
  token: string;
  /** Associated session ID */
  sessionId: UUID;
  /** Token creation timestamp */
  createdAt: string; // ISO 8601 format
  /** Token expiry timestamp */
  expiresAt: string; // ISO 8601 format
  /** Token permissions/scopes */
  permissions: string[];
  /** Whether token is revoked */
  revoked: boolean;
  /** Token usage count */
  usageCount: number;
  /** Last used timestamp */
  lastUsedAt?: string; // ISO 8601 format
}

/** Authentication event log */
export interface AuthEvent {
  /** Event identifier */
  id: UUID;
  /** Event type */
  eventType: AuthEventType;
  /** Session ID (if applicable) */
  sessionId?: UUID;
  /** Token ID (if applicable) */
  tokenId?: UUID;
  /** Event timestamp */
  timestamp: string; // ISO 8601 format
  /** Client information */
  clientInfo: {
    userAgent?: string;
    ipAddress?: string;
    clientType: 'frontend' | 'extension' | 'api';
  };
  /** Event success status */
  success: boolean;
  /** Event details */
  details: {
    /** Event message */
    message: string;
    /** Additional context */
    context?: Record<string, any>;
    /** Error information (if failed) */
    error?: string;
  };
}

/** Session validation result */
export interface SessionValidationResult {
  /** Validation identifier */
  id: UUID;
  /** Session ID being validated */
  sessionId: UUID;
  /** Validation result */
  valid: boolean;
  /** Session information (if valid) */
  session?: AuthSession;
  /** Validation failure reason (if invalid) */
  reason?: string;
  /** Whether session can be refreshed */
  refreshable: boolean;
  /** Validation timestamp */
  validatedAt: string; // ISO 8601 format
}

/** Authentication configuration */
export interface AuthConfig {
  /** Session configuration */
  session: {
    /** Session timeout in seconds */
    timeout: number;
    /** Refresh token timeout in seconds */
    refreshTimeout: number;
    /** Maximum concurrent sessions */
    maxConcurrentSessions: number;
    /** Session extension on activity */
    extendOnActivity: boolean;
    /** Activity extension duration in seconds */
    activityExtensionDuration: number;
  };
  /** Token configuration */
  tokens: {
    /** Token length in characters */
    tokenLength: number;
    /** Token encoding algorithm */
    algorithm: 'base64' | 'hex' | 'base32';
    /** Token prefix for identification */
    prefix: string;
  };
  /** Security configuration */
  security: {
    /** Enable IP address validation */
    validateIpAddress: boolean;
    /** Enable user agent validation */
    validateUserAgent: boolean;
    /** Token rotation on refresh */
    rotateTokenOnRefresh: boolean;
    /** Maximum failed attempts before lockout */
    maxFailedAttempts: number;
    /** Lockout duration in seconds */
    lockoutDuration: number;
  };
}

/** Authentication statistics */
export interface AuthStatistics {
  /** Statistics identifier */
  id: UUID;
  /** Statistics period start */
  periodStart: string; // ISO 8601 format
  /** Statistics period end */
  periodEnd: string; // ISO 8601 format
  /** Total authentication attempts */
  totalAttempts: number;
  /** Successful authentications */
  successfulAuthentications: number;
  /** Failed authentications */
  failedAuthentications: number;
  /** Active sessions count */
  activeSessions: number;
  /** Expired sessions count */
  expiredSessions: number;
  /** Revoked sessions count */
  revokedSessions: number;
  /** Token usage statistics */
  tokenUsage: {
    /** Total tokens issued */
    totalIssued: number;
    /** Active tokens */
    active: number;
    /** Revoked tokens */
    revoked: number;
    /** Expired tokens */
    expired: number;
  };
  /** Client type breakdown */
  clientTypes: {
    frontend: number;
    extension: number;
    api: number;
  };
  /** Authentication events by type */
  eventsByType: Record<AuthEventType, number>;
}
```

## **3. API Endpoint Specification (OpenAPI `paths` block)**

```yaml
paths:
  /api/v1/auth/session:
    post:
      tags:
        - Authentication
      summary: Create new authentication session
      description: Creates a new local authentication session for the ReadyAI application
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                clientType:
                  type: string
                  enum: [frontend, extension, api]
                clientVersion:
                  type: string
                metadata:
                  type: object
                  description: Optional client-specific metadata
              required:
                - clientType
      responses:
        '201':
          description: Session created successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          session:
                            $ref: '#/components/schemas/AuthSession'
                          token:
                            type: string
                          refreshToken:
                            type: string
        '400':
          description: Invalid client information
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'
        '429':
          description: Too many session creation attempts
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

    get:
      tags:
        - Authentication
      summary: Get current session information
      description: Retrieves information about the current authenticated session
      security:
        - localAuth: []
      responses:
        '200':
          description: Session information retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/AuthSession'
        '401':
          description: Invalid or expired session
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

    delete:
      tags:
        - Authentication
      summary: Terminate current session
      description: Terminates the current authentication session (logout)
      security:
        - localAuth: []
      responses:
        '200':
          description: Session terminated successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          message:
                            type: string
                            example: "Session terminated successfully"
                          terminatedAt:
                            type: string
                            format: date-time
        '401':
          description: Invalid or expired session
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

  /api/v1/auth/session/refresh:
    post:
      tags:
        - Authentication
      summary: Refresh authentication session
      description: Refreshes an existing session using the refresh token
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                refreshToken:
                  type: string
                  description: Valid refresh token
              required:
                - refreshToken
      responses:
        '200':
          description: Session refreshed successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          session:
                            $ref: '#/components/schemas/AuthSession'
                          token:
                            type: string
                          refreshToken:
                            type: string
        '400':
          description: Invalid refresh token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'
        '401':
          description: Refresh token expired or revoked
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

  /api/v1/auth/session/validate:
    post:
      tags:
        - Authentication
      summary: Validate session token
      description: Validates a session token and returns session information
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                token:
                  type: string
                  description: Session token to validate
              required:
                - token
      responses:
        '200':
          description: Token validation completed
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/SessionValidationResult'
        '400':
          description: Invalid token format
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

  /api/v1/auth/sessions:
    get:
      tags:
        - Authentication
      summary: List active sessions
      description: Retrieves list of active authentication sessions
      security:
        - localAuth: []
      parameters:
        - name: status
          in: query
          description: Filter sessions by status
          required: false
          schema:
            type: string
            enum: [active, expired, revoked, refreshing]
        - name: clientType
          in: query
          description: Filter sessions by client type
          required: false
          schema:
            type: string
            enum: [frontend, extension, api]
        - name: limit
          in: query
          description: Maximum number of sessions to return
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
      responses:
        '200':
          description: Sessions retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          sessions:
                            type: array
                            items:
                              $ref: '#/components/schemas/AuthSession'
                          totalCount:
                            type: integer
        '401':
          description: Authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

  /api/v1/auth/sessions/{sessionId}:
    delete:
      tags:
        - Authentication
      summary: Revoke specific session
      description: Revokes a specific authentication session
      security:
        - localAuth: []
      parameters:
        - name: sessionId
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '200':
          description: Session revoked successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          message:
                            type: string
                          revokedAt:
                            type: string
                            format: date-time
        '404':
          description: Session not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'
        '401':
          description: Authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

  /api/v1/auth/tokens:
    get:
      tags:
        - Authentication
      summary: List authentication tokens
      description: Retrieves list of authentication tokens for the current session
      security:
        - localAuth: []
      parameters:
        - name: type
          in: query
          description: Filter tokens by type
          required: false
          schema:
            type: string
            enum: [session, refresh, api, extension]
        - name: active
          in: query
          description: Filter by active status
          required: false
          schema:
            type: boolean
      responses:
        '200':
          description: Tokens retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          tokens:
                            type: array
                            items:
                              $ref: '#/components/schemas/AuthToken'

    post:
      tags:
        - Authentication
      summary: Create new authentication token
      description: Creates a new authentication token for API access
      security:
        - localAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                type:
                  type: string
                  enum: [api, extension]
                permissions:
                  type: array
                  items:
                    type: string
                  description: Token permissions/scopes
                expiresIn:
                  type: integer
                  description: Token lifetime in seconds
                  default: 86400
                description:
                  type: string
                  description: Token description
              required:
                - type
      responses:
        '201':
          description: Token created successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/AuthToken'

  /api/v1/auth/tokens/{tokenId}:
    delete:
      tags:
        - Authentication
      summary: Revoke authentication token
      description: Revokes a specific authentication token
      security:
        - localAuth: []
      parameters:
        - name: tokenId
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '200':
          description: Token revoked successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          message:
                            type: string
                          revokedAt:
                            type: string
                            format: date-time
        '404':
          description: Token not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

  /api/v1/auth/config:
    get:
      tags:
        - Authentication
      summary: Get authentication configuration
      description: Retrieves current authentication configuration settings
      security:
        - localAuth: []
      responses:
        '200':
          description: Configuration retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/AuthConfig'

  /api/v1/auth/events:
    get:
      tags:
        - Authentication
      summary: Get authentication events
      description: Retrieves authentication event history
      security:
        - localAuth: []
      parameters:
        - name: eventType
          in: query
          description: Filter by event type
          required: false
          schema:
            type: string
            enum: [login, logout, refresh, validation, expiry, revocation]
        - name: startTime
          in: query
          description: Start time for event range
          required: false
          schema:
            type: string
            format: date-time
        - name: endTime
          in: query
          description: End time for event range
          required: false
          schema:
            type: string
            format: date-time
        - name: limit
          in: query
          description: Maximum number of events to return
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 1000
            default: 50
      responses:
        '200':
          description: Events retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          events:
                            type: array
                            items:
                              $ref: '#/components/schemas/AuthEvent'
                          totalCount:
                            type: integer

  /api/v1/auth/statistics:
    get:
      tags:
        - Authentication
      summary: Get authentication statistics
      description: Retrieves authentication usage statistics
      security:
        - localAuth: []
      parameters:
        - name: period
          in: query
          description: Statistics period
          required: false
          schema:
            type: string
            enum: [hour, day, week, month]
            default: day
      responses:
        '200':
          description: Statistics retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/AuthStatistics'

components:
  schemas:
    AuthSession:
      type: object
      required:
        - id
        - token
        - refreshToken
        - status
        - authMethod
        - createdAt
        - lastAccessedAt
        - expiresAt
        - refreshExpiresAt
        - clientInfo
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        token:
          type: string
        refreshToken:
          type: string
        status:
          type: string
          enum: [active, expired, revoked, refreshing]
        authMethod:
          type: string
          enum: [local_session, extension_handshake, api_key]
        createdAt:
          type: string
          format: date-time
        lastAccessedAt:
          type: string
          format: date-time
        expiresAt:
          type: string
          format: date-time
        refreshExpiresAt:
          type: string
          format: date-time
        clientInfo:
          type: object
          properties:
            userAgent:
              type: string
            ipAddress:
              type: string
            clientType:
              type: string
              enum: [frontend, extension, api]
            clientVersion:
              type: string
        metadata:
          type: object

    AuthToken:
      type: object
      required:
        - id
        - type
        - token
        - sessionId
        - createdAt
        - expiresAt
        - permissions
        - revoked
        - usageCount
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        type:
          type: string
          enum: [session, refresh, api, extension]
        token:
          type: string
        sessionId:
          $ref: '#/components/schemas/UUID'
        createdAt:
          type: string
          format: date-time
        expiresAt:
          type: string
          format: date-time
        permissions:
          type: array
          items:
            type: string
        revoked:
          type: boolean
        usageCount:
          type: integer
        lastUsedAt:
          type: string
          format: date-time

    AuthEvent:
      type: object
      required:
        - id
        - eventType
        - timestamp
        - clientInfo
        - success
        - details
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        eventType:
          type: string
          enum: [login, logout, refresh, validation, expiry, revocation]
        sessionId:
          $ref: '#/components/schemas/UUID'
        tokenId:
          $ref: '#/components/schemas/UUID'
        timestamp:
          type: string
          format: date-time
        clientInfo:
          type: object
          properties:
            userAgent:
              type: string
            ipAddress:
              type: string
            clientType:
              type: string
              enum: [frontend, extension, api]
        success:
          type: boolean
        details:
          type: object
          properties:
            message:
              type: string
            context:
              type: object
            error:
              type: string

    SessionValidationResult:
      type: object
      required:
        - id
        - sessionId
        - valid
        - refreshable
        - validatedAt
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        sessionId:
          $ref: '#/components/schemas/UUID'
        valid:
          type: boolean
        session:
          $ref: '#/components/schemas/AuthSession'
        reason:
          type: string
        refreshable:
          type: boolean
        validatedAt:
          type: string
          format: date-time

    AuthConfig:
      type: object
      required:
        - session
        - tokens
        - security
      properties:
        session:
          type: object
          properties:
            timeout:
              type: integer
            refreshTimeout:
              type: integer
            maxConcurrentSessions:
              type: integer
            extendOnActivity:
              type: boolean
            activityExtensionDuration:
              type: integer
        tokens:
          type: object
          properties:
            tokenLength:
              type: integer
            algorithm:
              type: string
              enum: [base64, hex, base32]
            prefix:
              type: string
        security:
          type: object
          properties:
            validateIpAddress:
              type: boolean
            validateUserAgent:
              type: boolean
            rotateTokenOnRefresh:
              type: boolean
            maxFailedAttempts:
              type: integer
            lockoutDuration:
              type: integer

    AuthStatistics:
      type: object
      required:
        - id
        - periodStart
        - periodEnd
        - totalAttempts
        - successfulAuthentications
        - failedAuthentications
        - activeSessions
        - expiredSessions
        - revokedSessions
        - tokenUsage
        - clientTypes
        - eventsByType
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        periodStart:
          type: string
          format: date-time
        periodEnd:
          type: string
          format: date-time
        totalAttempts:
          type: integer
        successfulAuthentications:
          type: integer
        failedAuthentications:
          type: integer
        activeSessions:
          type: integer
        expiredSessions:
          type: integer
        revokedSessions:
          type: integer
        tokenUsage:
          type: object
          properties:
            totalIssued:
              type: integer
            active:
              type: integer
            revoked:
              type: integer
            expired:
              type: integer
        clientTypes:
          type: object
          properties:
            frontend:
              type: integer
            extension:
              type: integer
            api:
              type: integer
        eventsByType:
          type: object
          additionalProperties:
            type: integer
```

## **4. Detailed Business Logic & Validation Rules**

| Rule ID | Rule Description | Implementation Location(s) & Notes |
|---------|------------------|-----------------------------------|
| **AUTH-01** | Authentication sessions must be created only for valid client types (frontend, extension, api) and session limits from Configuration Management Module must be enforced. | **Backend (Authoritative):** Session service must validate client types and query Configuration Management Module for maximum concurrent sessions per client type. Exceeded limits result in oldest session revocation. |
| **AUTH-02** | Session tokens must expire according to timeout values from Configuration Management Module and automatic cleanup of expired sessions must run periodically. | **Backend (Authoritative):** Session service must query Configuration Management Module for session timeout settings. Cleanup service must run on configurable intervals to remove expired sessions and log cleanup activities via Logging Service. |
| **AUTH-03** | Session refresh operations must validate the refresh token, check session status, and optionally rotate tokens based on security configuration from Configuration Management Module. | **Backend (Authoritative):** Refresh service must validate refresh token, check session status, and query Configuration Management Module for token rotation policy. Failed refreshes logged as security events via Logging Service. |
| **AUTH-04** | All authentication events (login, logout, refresh, token usage) must be logged to the Logging & Monitoring Service with appropriate security categorization for audit trails. | **Backend (Authoritative):** Authentication service must send all auth events to Logging Service with 'security' category. Critical events (failed attempts, token abuse) logged with higher severity levels. |
| **AUTH-05** | Authentication middleware must validate session tokens on every protected API request and extend session timeout if activity extension is enabled in configuration. | **Backend (Authoritative):** Middleware must intercept protected routes, validate tokens via session service, and extend session timeouts based on Configuration Management Module settings for activity extension. |
| **AUTH-06** | Failed authentication attempts must be tracked and clients must be temporarily locked out after exceeding the maximum attempts threshold from Configuration Management Module. | **Backend (Authoritative):** Authentication service must track failed attempts per client and implement lockout based on maxFailedAttempts and lockoutDuration from Configuration Management. Lockout events logged as critical security events. |
| **AUTH-07** | Session validation must check token format, expiry, revocation status, and optionally validate client IP/User-Agent based on security configuration. | **Backend (Authoritative):** Validation service must perform comprehensive token checks including format validation, database lookups for revocation status, and optional IP/User-Agent validation per Configuration Management security settings. |
| **AUTH-08** | Token generation must use cryptographically secure random generation with configurable length and encoding algorithm from Configuration Management Module. | **Backend (Authoritative):** Token service must use crypto.randomBytes() for secure token generation with length and encoding algorithm from Configuration Management Module. Token uniqueness validated before persistence. |
| **AUTH-09** | Session cleanup operations must respect backup retention policies from Configuration Management Module and maintain session history for audit purposes. | **Backend (Authoritative):** Cleanup service must query Configuration Management for retention policies and archive session data before deletion. Historical data maintained for security audits and compliance. |
| **AUTH-10** | API token creation and management must be restricted to authenticated sessions and tokens must inherit session permissions with optional scope restrictions. | **Backend (Authoritative):** Token management endpoints must validate existing session authentication. API tokens created with permissions subset of parent session, enforced through token validation middleware. |

## **5. Developer Task Checklist**

### **Backend Tasks:**
- [ ] Create database migration script for authentication tables (`auth_sessions`, `auth_tokens`, `auth_events`, `auth_config`, `auth_lockouts`)
- [ ] Implement the `AuthenticationService` class with session creation, validation, refresh, and cleanup capabilities
- [ ] Implement the `SessionService` class for session lifecycle management, timeout handling, and activity tracking
- [ ] Implement the `TokenService` class for secure token generation, validation, and management with configurable algorithms
- [ ] Implement the `AuthEventService` class for tracking and logging all authentication events with integration to Logging & Monitoring Service
- [ ] Implement authentication middleware for API Gateway integration that validates tokens and extends sessions automatically
- [ ] Implement all session management endpoints (`POST /api/v1/auth/session`, `GET /api/v1/auth/session`, `DELETE /api/v1/auth/session`)
- [ ] Implement session refresh endpoint (`POST /api/v1/auth/session/refresh`) with token rotation and validation logic
- [ ] Implement session validation endpoint (`POST /api/v1/auth/session/validate`) for internal service communication
- [ ] Implement session listing and management endpoints (`GET /api/v1/auth/sessions`, `DELETE /api/v1/auth/sessions/{id}`)
- [ ] Implement token management endpoints (`GET /api/v1/auth/tokens`, `POST /api/v1/auth/tokens`, `DELETE /api/v1/auth/tokens/{id}`)
- [ ] Implement authentication configuration endpoint (`GET /api/v1/auth/config`) with integration to Configuration Management Module
- [ ] Implement authentication events and statistics endpoints (`GET /api/v1/auth/events`, `GET /api/v1/auth/statistics`)
- [ ] Create `AuthenticationRepository` class for database operations with proper indexing on session tokens and expiry times
- [ ] Implement automatic session cleanup service with configurable cleanup intervals and retention policies
- [ ] Create authentication lockout service for tracking failed attempts and implementing temporary client lockouts
- [ ] Implement session extension logic for activity-based timeout extension based on configuration settings
- [ ] Create comprehensive unit tests for all service classes with mock dependencies on Configuration and Logging modules
- [ ] Create integration tests for authentication workflows including session creation, refresh, validation, and expiry scenarios
- [ ] Implement authentication health monitoring with session count tracking and performance metrics reporting
- [ ] Add authentication event integration with Logging & Monitoring Service for security audit trails and monitoring

### **Frontend Tasks:**
- [ ] Update existing `AuthContext.tsx` to integrate with backend Authentication Service endpoints instead of purely local logic
- [ ] Implement `useAuthSession` hook for backend session management with automatic token refresh capabilities
- [ ] Create `SessionManager` component for displaying active sessions and providing session revocation functionality
- [ ] Implement `TokenManager` component for creating, viewing, and revoking API tokens with permission management
- [ ] Create `AuthenticationSettings` component for configuring authentication preferences and viewing security settings
- [ ] Implement authentication service functions in the API client (`authService.ts`) for all authentication endpoints
- [ ] Update existing authentication logic to use backend session validation instead of localStorage-only approach
- [ ] Implement automatic session refresh logic with background token renewal and error handling
- [ ] Create authentication event viewer component for displaying login history and security events
- [ ] Implement authentication statistics dashboard showing session usage and security metrics
- [ ] Add authentication status indicator to main application header with real-time session status updates
- [ ] Create session timeout warning dialog with automatic logout and session extension options
- [ ] Implement authentication error handling with automatic retry logic and user-friendly error messages
- [ ] Add authentication configuration interface integrated with Configuration Management Module settings
- [ ] Create authentication troubleshooting guide component for common authentication issues and solutions
- [ ] Implement secure token display and copying functionality with automatic token masking for security
- [ ] Add authentication audit log viewer for security-conscious users to monitor authentication activity
- [ ] Create authentication migration guide for transitioning from frontend-only to backend session management
- [ ] Implement authentication backup and restore functionality for session and token management
- [ ] Add authentication performance monitoring with session creation/validation timing and success rate metrics



========================================================================================


# Error Handling & Recovery Module - Technical Specification

## **1. Module Overview**

**Purpose:** The Error Handling & Recovery Module serves as the centralized error management and recovery system for the entire ReadyAI application. This module provides comprehensive error classification, automatic recovery mechanisms, intelligent retry strategies, user notification systems, and fallback mechanisms to ensure system resilience and maintain the local-first architecture's reliability. It acts as the safety net that prevents system failures from disrupting the user experience and automatically recovers from transient issues while preserving context and maintaining data integrity.

**Dependencies & Interactions:** This module depends on the Logging & Monitoring Service to record all error events, recovery attempts, and system state changes for audit trails and analytics. It integrates with the API Gateway Module to provide global error handling middleware and standardized error responses across all API endpoints. The module interacts with the Configuration Management Module to obtain error handling policies, retry configurations, notification preferences, and recovery strategies. It provides error handling services that are consumed by all other ReadyAI modules including the Multi-Phase Development Orchestrator for phase failure recovery, the Claude Integration Service for AI generation error handling, the Context Management Engine for context retrieval failures, and the VS Code Extension Host for user-facing error notifications and recovery workflows.

## **2. Module-Specific Type Additions (`types.errorhandling.ts`)**

```typescript
/**
 * Error Handling & Recovery Module Types
 * Extends foundational types with error handling and recovery interfaces
 */

/** Error classification categories */
export type ErrorCategory = 
  | 'system'
  | 'network'
  | 'validation'
  | 'authentication'
  | 'authorization'
  | 'business_logic'
  | 'external_service'
  | 'user_input'
  | 'configuration'
  | 'resource_exhaustion';

/** Error severity levels for recovery prioritization */
export type ErrorSeverity = 'critical' | 'high' | 'medium' | 'low' | 'info';

/** Recovery strategy types */
export type RecoveryStrategyType = 
  | 'retry'
  | 'fallback'
  | 'circuit_breaker'
  | 'graceful_degradation'
  | 'user_intervention'
  | 'automatic_heal'
  | 'escalate'
  | 'ignore';

/** Recovery attempt status */
export type RecoveryStatus = 'pending' | 'in_progress' | 'succeeded' | 'failed' | 'abandoned';

/** Error notification types */
export type NotificationType = 'toast' | 'modal' | 'banner' | 'badge' | 'sound' | 'system_tray';

/** Circuit breaker states */
export type CircuitBreakerState = 'closed' | 'open' | 'half_open';

/** Comprehensive error information */
export interface ErrorInfo {
  /** Unique error identifier */
  id: UUID;
  /** Error category for classification */
  category: ErrorCategory;
  /** Error severity level */
  severity: ErrorSeverity;
  /** Error code for programmatic handling */
  code: string;
  /** Human-readable error message */
  message: string;
  /** Technical error details */
  technicalMessage?: string;
  /** Error stack trace */
  stackTrace?: string;
  /** Source component where error occurred */
  source: string;
  /** Context when error occurred */
  context: {
    /** Project context if applicable */
    projectId?: UUID;
    /** User session context */
    sessionId?: string;
    /** Request correlation ID */
    correlationId?: string;
    /** Component state at time of error */
    componentState?: Record<string, any>;
    /** User action that triggered error */
    userAction?: string;
    /** Additional context metadata */
    metadata?: Record<string, any>;
  };
  /** Original exception details */
  originalError?: {
    /** Exception name */
    name: string;
    /** Exception message */
    message: string;
    /** Exception code */
    code?: string;
    /** Exception stack trace */
    stack?: string;
  };
  /** Error timestamp */
  timestamp: string; // ISO 8601 format
  /** Whether error is recoverable */
  recoverable: boolean;
  /** Suggested recovery strategies */
  suggestedStrategies: RecoveryStrategyType[];
  /** Number of times this error has occurred */
  occurrenceCount: number;
  /** First occurrence timestamp */
  firstOccurrence: string; // ISO 8601 format
}

/** Recovery strategy configuration */
export interface RecoveryStrategy {
  /** Strategy identifier */
  id: UUID;
  /** Strategy type */
  type: RecoveryStrategyType;
  /** Strategy name */
  name: string;
  /** Strategy description */
  description: string;
  /** Error patterns this strategy applies to */
  errorPatterns: {
    /** Error categories to match */
    categories?: ErrorCategory[];
    /** Error codes to match */
    codes?: string[];
    /** Error sources to match */
    sources?: string[];
    /** Severity levels to match */
    severities?: ErrorSeverity[];
  };
  /** Strategy configuration */
  config: {
    /** Maximum retry attempts (for retry strategy) */
    maxRetries?: number;
    /** Retry delay in milliseconds */
    retryDelay?: number;
    /** Exponential backoff multiplier */
    backoffMultiplier?: number;
    /** Maximum retry delay */
    maxRetryDelay?: number;
    /** Timeout for recovery attempt */
    timeout?: number;
    /** Fallback action configuration */
    fallbackAction?: string;
    /** Circuit breaker threshold */
    failureThreshold?: number;
    /** Circuit breaker timeout */
    circuitTimeout?: number;
    /** Custom recovery function */
    customFunction?: string;
  };
  /** Strategy priority (higher numbers = higher priority) */
  priority: number;
  /** Whether strategy is enabled */
  enabled: boolean;
  /** Strategy creation timestamp */
  createdAt: string; // ISO 8601 format
}

/** Recovery attempt record */
export interface RecoveryAttempt {
  /** Attempt identifier */
  id: UUID;
  /** Associated error */
  errorId: UUID;
  /** Recovery strategy used */
  strategyId: UUID;
  /** Attempt status */
  status: RecoveryStatus;
  /** Attempt start time */
  startedAt: string; // ISO 8601 format
  /** Attempt completion time */
  completedAt?: string; // ISO 8601 format
  /** Attempt duration in milliseconds */
  duration?: number;
  /** Recovery result */
  result?: {
    /** Whether recovery was successful */
    success: boolean;
    /** Result message */
    message?: string;
    /** Result data */
    data?: Record<string, any>;
    /** New error if recovery failed */
    newError?: ErrorInfo;
  };
  /** Recovery context */
  context: {
    /** Retry attempt number */
    attemptNumber: number;
    /** Previous attempt results */
    previousAttempts?: RecoveryAttempt[];
    /** Recovery parameters */
    parameters?: Record<string, any>;
  };
}

/** Error notification configuration */
export interface ErrorNotification {
  /** Notification identifier */
  id: UUID;
  /** Associated error */
  errorId: UUID;
  /** Notification type */
  type: NotificationType;
  /** Notification title */
  title: string;
  /** Notification message */
  message: string;
  /** Notification severity */
  severity: ErrorSeverity;
  /** Whether notification is dismissible */
  dismissible: boolean;
  /** Auto-dismiss timeout in milliseconds */
  autoDismissTimeout?: number;
  /** Notification actions */
  actions?: Array<{
    /** Action label */
    label: string;
    /** Action type */
    type: 'retry' | 'dismiss' | 'report' | 'details' | 'custom';
    /** Action parameters */
    parameters?: Record<string, any>;
  }>;
  /** Notification display timestamp */
  displayedAt: string; // ISO 8601 format
  /** Whether notification was dismissed */
  dismissed: boolean;
  /** Dismiss timestamp */
  dismissedAt?: string; // ISO 8601 format
}

/** Circuit breaker configuration */
export interface CircuitBreaker {
  /** Circuit breaker identifier */
  id: UUID;
  /** Circuit breaker name */
  name: string;
  /** Service or operation being protected */
  service: string;
  /** Current circuit state */
  state: CircuitBreakerState;
  /** Failure threshold before opening circuit */
  failureThreshold: number;
  /** Success threshold for closing circuit */
  successThreshold: number;
  /** Timeout before trying half-open state */
  timeout: number; // milliseconds
  /** Current failure count */
  failureCount: number;
  /** Current success count (in half-open state) */
  successCount: number;
  /** Last failure timestamp */
  lastFailureAt?: string; // ISO 8601 format
  /** Last state change timestamp */
  lastStateChangeAt: string; // ISO 8601 format
  /** Circuit breaker statistics */
  statistics: {
    /** Total requests handled */
    totalRequests: number;
    /** Total successful requests */
    successfulRequests: number;
    /** Total failed requests */
    failedRequests: number;
    /** Total rejected requests (circuit open) */
    rejectedRequests: number;
    /** Average response time */
    avgResponseTime: number;
  };
}

/** Error escalation rule */
export interface ErrorEscalationRule {
  /** Rule identifier */
  id: UUID;
  /** Rule name */
  name: string;
  /** Rule description */
  description: string;
  /** Error conditions for escalation */
  conditions: {
    /** Error categories to escalate */
    categories?: ErrorCategory[];
    /** Error severities to escalate */
    severities?: ErrorSeverity[];
    /** Occurrence count threshold */
    occurrenceThreshold?: number;
    /** Time window for occurrence counting */
    timeWindow?: number; // minutes
    /** Failed recovery attempts threshold */
    failedRecoveryThreshold?: number;
  };
  /** Escalation actions */
  actions: {
    /** Notify through logging service */
    notifyLogging: boolean;
    /** Create system alert */
    createAlert: boolean;
    /** Send notification to user */
    notifyUser: boolean;
    /** Trigger emergency procedures */
    triggerEmergency: boolean;
    /** Custom escalation action */
    customAction?: string;
  };
  /** Rule priority */
  priority: number;
  /** Whether rule is enabled */
  enabled: boolean;
  /** Rule creation timestamp */
  createdAt: string; // ISO 8601 format
}

/** Error handling statistics */
export interface ErrorHandlingStatistics {
  /** Statistics identifier */
  id: UUID;
  /** Statistics period start */
  periodStart: string; // ISO 8601 format
  /** Statistics period end */
  periodEnd: string; // ISO 8601 format
  /** Total errors handled */
  totalErrors: number;
  /** Errors by category */
  errorsByCategory: Record<ErrorCategory, number>;
  /** Errors by severity */
  errorsBySeverity: Record<ErrorSeverity, number>;
  /** Total recovery attempts */
  totalRecoveryAttempts: number;
  /** Successful recoveries */
  successfulRecoveries: number;
  /** Recovery success rate */
  recoverySuccessRate: number;
  /** Average recovery time */
  avgRecoveryTime: number;
  /** Most common error patterns */
  commonErrorPatterns: Array<{
    pattern: string;
    count: number;
    successfulRecoveries: number;
  }>;
  /** Circuit breaker activations */
  circuitBreakerActivations: number;
  /** User notifications sent */
  notificationsSent: number;
  /** Escalations triggered */
  escalationsTriggered: number;
}

/** Fallback configuration */
export interface FallbackConfiguration {
  /** Fallback identifier */
  id: UUID;
  /** Service or operation name */
  serviceName: string;
  /** Fallback type */
  type: 'static_response' | 'cached_data' | 'alternative_service' | 'degraded_mode' | 'custom_function';
  /** Fallback configuration */
  config: {
    /** Static response data */
    staticResponse?: any;
    /** Cache key for cached data fallback */
    cacheKey?: string;
    /** Alternative service endpoint */
    alternativeEndpoint?: string;
    /** Degraded mode configuration */
    degradedModeConfig?: Record<string, any>;
    /** Custom fallback function */
    customFunction?: string;
  };
  /** Fallback priority */
  priority: number;
  /** Whether fallback is enabled */
  enabled: boolean;
  /** Fallback creation timestamp */
  createdAt: string; // ISO 8601 format
}
```

## **3. API Endpoint Specification (OpenAPI `paths` block)**

```yaml
paths:
  /api/v1/errors:
    get:
      tags:
        - Error Handling
      summary: Query error information
      description: Retrieves error entries with filtering, classification, and recovery status
      security:
        - localAuth: []
      parameters:
        - name: category
          in: query
          description: Filter by error category
          required: false
          schema:
            type: string
            enum: [system, network, validation, authentication, authorization, business_logic, external_service, user_input, configuration, resource_exhaustion]
        - name: severity
          in: query
          description: Filter by error severity
          required: false
          schema:
            type: string
            enum: [critical, high, medium, low, info]
        - name: source
          in: query
          description: Filter by error source component
          required: false
          schema:
            type: string
        - name: projectId
          in: query
          description: Filter by project context
          required: false
          schema:
            $ref: '#/components/schemas/UUID'
        - name: recoverable
          in: query
          description: Filter by recoverability status
          required: false
          schema:
            type: boolean
        - name: startTime
          in: query
          description: Start time for error range
          required: false
          schema:
            type: string
            format: date-time
        - name: endTime
          in: query
          description: End time for error range
          required: false
          schema:
            type: string
            format: date-time
        - name: limit
          in: query
          description: Maximum number of results
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 1000
            default: 100
        - name: offset
          in: query
          description: Offset for pagination
          required: false
          schema:
            type: integer
            minimum: 0
            default: 0
      responses:
        '200':
          description: Errors retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          errors:
                            type: array
                            items:
                              $ref: '#/components/schemas/ErrorInfo'
                          totalCount:
                            type: integer
                          hasMore:
                            type: boolean
        '400':
          description: Invalid query parameters
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

    post:
      tags:
        - Error Handling
      summary: Report error
      description: Reports a new error to the error handling system for processing and recovery
      security:
        - localAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                category:
                  type: string
                  enum: [system, network, validation, authentication, authorization, business_logic, external_service, user_input, configuration, resource_exhaustion]
                severity:
                  type: string
                  enum: [critical, high, medium, low, info]
                code:
                  type: string
                  minLength: 1
                message:
                  type: string
                  minLength: 1
                technicalMessage:
                  type: string
                stackTrace:
                  type: string
                source:
                  type: string
                  minLength: 1
                context:
                  type: object
                  properties:
                    projectId:
                      $ref: '#/components/schemas/UUID'
                    sessionId:
                      type: string
                    correlationId:
                      type: string
                    componentState:
                      type: object
                    userAction:
                      type: string
                    metadata:
                      type: object
                originalError:
                  type: object
                  properties:
                    name:
                      type: string
                    message:
                      type: string
                    code:
                      type: string
                    stack:
                      type: string
                recoverable:
                  type: boolean
                  default: true
                suggestedStrategies:
                  type: array
                  items:
                    type: string
                    enum: [retry, fallback, circuit_breaker, graceful_degradation, user_intervention, automatic_heal, escalate, ignore]
              required:
                - category
                - severity
                - code
                - message
                - source
      responses:
        '201':
          description: Error reported successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/ErrorInfo'
        '400':
          description: Invalid error data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

  /api/v1/errors/{errorId}/recover:
    post:
      tags:
        - Error Handling
      summary: Initiate error recovery
      description: Initiates recovery process for a specific error using configured recovery strategies
      security:
        - localAuth: []
      parameters:
        - name: errorId
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              properties:
                strategyId:
                  $ref: '#/components/schemas/UUID'
                  description: Specific recovery strategy to use (optional)
                parameters:
                  type: object
                  description: Custom recovery parameters
                forceRetry:
                  type: boolean
                  default: false
                  description: Force retry even if recovery was previously attempted
      responses:
        '200':
          description: Recovery initiated successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/RecoveryAttempt'
        '404':
          description: Error not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'
        '409':
          description: Recovery already in progress
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

  /api/v1/recovery-strategies:
    get:
      tags:
        - Recovery Management
      summary: List recovery strategies
      description: Retrieves all configured recovery strategies with filtering options
      security:
        - localAuth: []
      parameters:
        - name: type
          in: query
          description: Filter by strategy type
          required: false
          schema:
            type: string
            enum: [retry, fallback, circuit_breaker, graceful_degradation, user_intervention, automatic_heal, escalate, ignore]
        - name: enabled
          in: query
          description: Filter by enabled status
          required: false
          schema:
            type: boolean
      responses:
        '200':
          description: Recovery strategies retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          strategies:
                            type: array
                            items:
                              $ref: '#/components/schemas/RecoveryStrategy'

    post:
      tags:
        - Recovery Management
      summary: Create recovery strategy
      description: Creates a new recovery strategy configuration
      security:
        - localAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                type:
                  type: string
                  enum: [retry, fallback, circuit_breaker, graceful_degradation, user_intervention, automatic_heal, escalate, ignore]
                name:
                  type: string
                  minLength: 1
                  maxLength: 100
                description:
                  type: string
                  maxLength: 500
                errorPatterns:
                  type: object
                  properties:
                    categories:
                      type: array
                      items:
                        type: string
                        enum: [system, network, validation, authentication, authorization, business_logic, external_service, user_input, configuration, resource_exhaustion]
                    codes:
                      type: array
                      items:
                        type: string
                    sources:
                      type: array
                      items:
                        type: string
                    severities:
                      type: array
                      items:
                        type: string
                        enum: [critical, high, medium, low, info]
                config:
                  type: object
                priority:
                  type: integer
                  minimum: 1
                  maximum: 100
                enabled:
                  type: boolean
                  default: true
              required:
                - type
                - name
                - priority
      responses:
        '201':
          description: Recovery strategy created successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/RecoveryStrategy'

  /api/v1/recovery-attempts:
    get:
      tags:
        - Recovery Management
      summary: Query recovery attempts
      description: Retrieves recovery attempt history with filtering and analysis
      security:
        - localAuth: []
      parameters:
        - name: errorId
          in: query
          description: Filter by error ID
          required: false
          schema:
            $ref: '#/components/schemas/UUID'
        - name: strategyId
          in: query
          description: Filter by recovery strategy
          required: false
          schema:
            $ref: '#/components/schemas/UUID'
        - name: status
          in: query
          description: Filter by recovery status
          required: false
          schema:
            type: string
            enum: [pending, in_progress, succeeded, failed, abandoned]
        - name: startTime
          in: query
          description: Start time for attempt range
          required: false
          schema:
            type: string
            format: date-time
        - name: endTime
          in: query
          description: End time for attempt range
          required: false
          schema:
            type: string
            format: date-time
      responses:
        '200':
          description: Recovery attempts retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          attempts:
                            type: array
                            items:
                              $ref: '#/components/schemas/RecoveryAttempt'
                          totalCount:
                            type: integer

  /api/v1/circuit-breakers:
    get:
      tags:
        - Circuit Breakers
      summary: List circuit breakers
      description: Retrieves all configured circuit breakers with current status
      security:
        - localAuth: []
      parameters:
        - name: state
          in: query
          description: Filter by circuit breaker state
          required: false
          schema:
            type: string
            enum: [closed, open, half_open]
        - name: service
          in: query
          description: Filter by protected service
          required: false
          schema:
            type: string
      responses:
        '200':
          description: Circuit breakers retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          circuitBreakers:
                            type: array
                            items:
                              $ref: '#/components/schemas/CircuitBreaker'

    post:
      tags:
        - Circuit Breakers
      summary: Create circuit breaker
      description: Creates a new circuit breaker configuration for a service
      security:
        - localAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  minLength: 1
                  maxLength: 100
                service:
                  type: string
                  minLength: 1
                failureThreshold:
                  type: integer
                  minimum: 1
                  default: 5
                successThreshold:
                  type: integer
                  minimum: 1
                  default: 3
                timeout:
                  type: integer
                  minimum: 1000
                  default: 60000
              required:
                - name
                - service
      responses:
        '201':
          description: Circuit breaker created successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/CircuitBreaker'

  /api/v1/circuit-breakers/{circuitId}/reset:
    post:
      tags:
        - Circuit Breakers
      summary: Reset circuit breaker
      description: Manually resets a circuit breaker to closed state
      security:
        - localAuth: []
      parameters:
        - name: circuitId
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '200':
          description: Circuit breaker reset successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/CircuitBreaker'
        '404':
          description: Circuit breaker not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

  /api/v1/notifications:
    get:
      tags:
        - Notifications
      summary: Query error notifications
      description: Retrieves error notification history with filtering options
      security:
        - localAuth: []
      parameters:
        - name: severity
          in: query
          description: Filter by notification severity
          required: false
          schema:
            type: string
            enum: [critical, high, medium, low, info]
        - name: type
          in: query
          description: Filter by notification type
          required: false
          schema:
            type: string
            enum: [toast, modal, banner, badge, sound, system_tray]
        - name: dismissed
          in: query
          description: Filter by dismissal status
          required: false
          schema:
            type: boolean
      responses:
        '200':
          description: Notifications retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          notifications:
                            type: array
                            items:
                              $ref: '#/components/schemas/ErrorNotification'

    post:
      tags:
        - Notifications
      summary: Create error notification
      description: Creates a new error notification for user display
      security:
        - localAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                errorId:
                  $ref: '#/components/schemas/UUID'
                type:
                  type: string
                  enum: [toast, modal, banner, badge, sound, system_tray]
                title:
                  type: string
                  minLength: 1
                  maxLength: 100
                message:
                  type: string
                  minLength: 1
                  maxLength: 500
                severity:
                  type: string
                  enum: [critical, high, medium, low, info]
                dismissible:
                  type: boolean
                  default: true
                autoDismissTimeout:
                  type: integer
                  minimum: 1000
                actions:
                  type: array
                  items:
                    type: object
                    properties:
                      label:
                        type: string
                      type:
                        type: string
                        enum: [retry, dismiss, report, details, custom]
                      parameters:
                        type: object
              required:
                - errorId
                - type
                - title
                - message
                - severity
      responses:
        '201':
          description: Notification created successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/ErrorNotification'

  /api/v1/notifications/{notificationId}/dismiss:
    patch:
      tags:
        - Notifications
      summary: Dismiss notification
      description: Marks a notification as dismissed
      security:
        - localAuth: []
      parameters:
        - name: notificationId
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '200':
          description: Notification dismissed successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/ErrorNotification'
        '404':
          description: Notification not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

  /api/v1/error-statistics:
    get:
      tags:
        - Analytics
      summary: Get error handling statistics
      description: Retrieves comprehensive error handling and recovery statistics
      security:
        - localAuth: []
      parameters:
        - name: period
          in: query
          description: Statistics period
          required: false
          schema:
            type: string
            enum: [hour, day, week, month]
            default: day
        - name: startDate
          in: query
          description: Start date for statistics period
          required: false
          schema:
            type: string
            format: date
        - name: endDate
          in: query
          description: End date for statistics period
          required: false
          schema:
            type: string
            format: date
      responses:
        '200':
          description: Error statistics retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/ErrorHandlingStatistics'

  /api/v1/fallbacks:
    get:
      tags:
        - Fallback Management
      summary: List fallback configurations
      description: Retrieves all configured fallback mechanisms
      security:
        - localAuth: []
      parameters:
        - name: serviceName
          in: query
          description: Filter by service name
          required: false
          schema:
            type: string
        - name: type
          in: query
          description: Filter by fallback type
          required: false
          schema:
            type: string
            enum: [static_response, cached_data, alternative_service, degraded_mode, custom_function]
        - name: enabled
          in: query
          description: Filter by enabled status
          required: false
          schema:
            type: boolean
      responses:
        '200':
          description: Fallback configurations retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          fallbacks:
                            type: array
                            items:
                              $ref: '#/components/schemas/FallbackConfiguration'

    post:
      tags:
        - Fallback Management
      summary: Create fallback configuration
      description: Creates a new fallback configuration for a service
      security:
        - localAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                serviceName:
                  type: string
                  minLength: 1
                type:
                  type: string
                  enum: [static_response, cached_data, alternative_service, degraded_mode, custom_function]
                config:
                  type: object
                priority:
                  type: integer
                  minimum: 1
                  maximum: 100
                enabled:
                  type: boolean
                  default: true
              required:
                - serviceName
                - type
                - config
                - priority
      responses:
        '201':
          description: Fallback configuration created successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/FallbackConfiguration'

components:
  schemas:
    ErrorInfo:
      type: object
      required:
        - id
        - category
        - severity
        - code
        - message
        - source
        - context
        - timestamp
        - recoverable
        - suggestedStrategies
        - occurrenceCount
        - firstOccurrence
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        category:
          type: string
          enum: [system, network, validation, authentication, authorization, business_logic, external_service, user_input, configuration, resource_exhaustion]
        severity:
          type: string
          enum: [critical, high, medium, low, info]
        code:
          type: string
        message:
          type: string
        technicalMessage:
          type: string
        stackTrace:
          type: string
        source:
          type: string
        context:
          type: object
          properties:
            projectId:
              $ref: '#/components/schemas/UUID'
            sessionId:
              type: string
            correlationId:
              type: string
            componentState:
              type: object
            userAction:
              type: string
            metadata:
              type: object
        originalError:
          type: object
          properties:
            name:
              type: string
            message:
              type: string
            code:
              type: string
            stack:
              type: string
        timestamp:
          type: string
          format: date-time
        recoverable:
          type: boolean
        suggestedStrategies:
          type: array
          items:
            type: string
            enum: [retry, fallback, circuit_breaker, graceful_degradation, user_intervention, automatic_heal, escalate, ignore]
        occurrenceCount:
          type: integer
        firstOccurrence:
          type: string
          format: date-time

    RecoveryStrategy:
      type: object
      required:
        - id
        - type
        - name
        - description
        - errorPatterns
        - config
        - priority
        - enabled
        - createdAt
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        type:
          type: string
          enum: [retry, fallback, circuit_breaker, graceful_degradation, user_intervention, automatic_heal, escalate, ignore]
        name:
          type: string
        description:
          type: string
        errorPatterns:
          type: object
          properties:
            categories:
              type: array
              items:
                type: string
                enum: [system, network, validation, authentication, authorization, business_logic, external_service, user_input, configuration, resource_exhaustion]
            codes:
              type: array
              items:
                type: string
            sources:
              type: array
              items:
                type: string
            severities:
              type: array
              items:
                type: string
                enum: [critical, high, medium, low, info]
        config:
          type: object
        priority:
          type: integer
        enabled:
          type: boolean
        createdAt:
          type: string
          format: date-time

    RecoveryAttempt:
      type: object
      required:
        - id
        - errorId
        - strategyId
        - status
        - startedAt
        - context
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        errorId:
          $ref: '#/components/schemas/UUID'
        strategyId:
          $ref: '#/components/schemas/UUID'
        status:
          type: string
          enum: [pending, in_progress, succeeded, failed, abandoned]
        startedAt:
          type: string
          format: date-time
        completedAt:
          type: string
          format: date-time
        duration:
          type: number
        result:
          type: object
          properties:
            success:
              type: boolean
            message:
              type: string
            data:
              type: object
        context:
          type: object
          properties:
            attemptNumber:
              type: integer
            parameters:
              type: object

    CircuitBreaker:
      type: object
      required:
        - id
        - name
        - service
        - state
        - failureThreshold
        - successThreshold
        - timeout
        - failureCount
        - successCount
        - lastStateChangeAt
        - statistics
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        name:
          type: string
        service:
          type: string
        state:
          type: string
          enum: [closed, open, half_open]
        failureThreshold:
          type: integer
        successThreshold:
          type: integer
        timeout:
          type: integer
        failureCount:
          type: integer
        successCount:
          type: integer
        lastFailureAt:
          type: string
          format: date-time
        lastStateChangeAt:
          type: string
          format: date-time
        statistics:
          type: object
          properties:
            totalRequests:
              type: integer
            successfulRequests:
              type: integer
            failedRequests:
              type: integer
            rejectedRequests:
              type: integer
            avgResponseTime:
              type: number

    ErrorNotification:
      type: object
      required:
        - id
        - errorId
        - type
        - title
        - message
        - severity
        - dismissible
        - displayedAt
        - dismissed
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        errorId:
          $ref: '#/components/schemas/UUID'
        type:
          type: string
          enum: [toast, modal, banner, badge, sound, system_tray]
        title:
          type: string
        message:
          type: string
        severity:
          type: string
          enum: [critical, high, medium, low, info]
        dismissible:
          type: boolean
        autoDismissTimeout:
          type: integer
        actions:
          type: array
          items:
            type: object
            properties:
              label:
                type: string
              type:
                type: string
                enum: [retry, dismiss, report, details, custom]
              parameters:
                type: object
        displayedAt:
          type: string
          format: date-time
        dismissed:
          type: boolean
        dismissedAt:
          type: string
          format: date-time

    ErrorHandlingStatistics:
      type: object
      required:
        - id
        - periodStart
        - periodEnd
        - totalErrors
        - errorsByCategory
        - errorsBySeverity
        - totalRecoveryAttempts
        - successfulRecoveries
        - recoverySuccessRate
        - avgRecoveryTime
        - commonErrorPatterns
        - circuitBreakerActivations
        - notificationsSent
        - escalationsTriggered
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        periodStart:
          type: string
          format: date-time
        periodEnd:
          type: string
          format: date-time
        totalErrors:
          type: integer
        errorsByCategory:
          type: object
          additionalProperties:
            type: integer
        errorsBySeverity:
          type: object
          additionalProperties:
            type: integer
        totalRecoveryAttempts:
          type: integer
        successfulRecoveries:
          type: integer
        recoverySuccessRate:
          type: number
        avgRecoveryTime:
          type: number
        commonErrorPatterns:
          type: array
          items:
            type: object
            properties:
              pattern:
                type: string
              count:
                type: integer
              successfulRecoveries:
                type: integer
        circuitBreakerActivations:
          type: integer
        notificationsSent:
          type: integer
        escalationsTriggered:
          type: integer

    FallbackConfiguration:
      type: object
      required:
        - id
        - serviceName
        - type
        - config
        - priority
        - enabled
        - createdAt
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        serviceName:
          type: string
        type:
          type: string
          enum: [static_response, cached_data, alternative_service, degraded_mode, custom_function]
        config:
          type: object
        priority:
          type: integer
        enabled:
          type: boolean
        createdAt:
          type: string
          format: date-time
```

## **4. Detailed Business Logic & Validation Rules**

| Rule ID | Rule Description | Implementation Location(s) & Notes |
|---------|------------------|-----------------------------------|
| **ERR-01** | All errors must be automatically reported to the Logging & Monitoring Service with correlation IDs for traceability and system health monitoring. | **Backend (Authoritative):** Error handling service must send all error events to Logging Service with structured data including correlation ID, context, and recovery status for comprehensive monitoring. |
| **ERR-02** | Critical severity errors must automatically trigger circuit breakers for affected services and prevent system cascade failures. | **Backend (Authoritative):** Circuit breaker service must monitor error patterns and automatically open circuits when critical errors exceed configured thresholds to protect system stability. |
| **ERR-03** | Recovery attempts must be limited by strategy configuration and exponential backoff must be applied to prevent system overload during recovery. | **Backend (Authoritative):** Recovery service must enforce maxRetries limits and implement exponential backoff with jitter to prevent thundering herd problems during automatic recovery attempts. |
| **ERR-04** | Error notifications must respect user preferences from Configuration Management Module and not overwhelm users with duplicate notifications. | **Backend (Authoritative):** Notification service must query Configuration Management for user preferences and implement deduplication logic to prevent notification spam for recurring errors. |
| **ERR-05** | Fallback mechanisms must be activated automatically when primary services fail and must maintain data consistency during degraded operation. | **Backend (Authoritative):** Fallback service must detect service failures through circuit breakers and activate appropriate fallbacks while ensuring data integrity and consistency constraints. |
| **ERR-06** | Error escalation must occur when recovery attempts fail repeatedly and must notify through appropriate channels based on severity. | **Backend (Authoritative):** Escalation service must track failed recovery attempts and trigger escalation actions including alerts to Logging Service and user notifications based on configured rules. |
| **ERR-07** | Context information must be preserved during error recovery to maintain user workflow continuity and prevent data loss. | **Backend (Authoritative):** Recovery service must capture and preserve user context, component state, and workflow data to enable seamless recovery without loss of user progress. |
| **ERR-08** | Circuit breaker states must be synchronized across all service instances and state changes must be logged for monitoring and debugging. | **Backend (Authoritative):** Circuit breaker service must use shared state storage and log all state transitions to Logging Service for system-wide visibility and debugging capabilities. |
| **ERR-09** | Recovery strategies must be selected based on error patterns and success rates to optimize recovery effectiveness over time. | **Backend (Authoritative):** Strategy selection service must analyze error patterns, track recovery success rates, and automatically prioritize most effective strategies for each error type. |
| **ERR-10** | API Gateway integration must ensure consistent error responses and proper error propagation across all ReadyAI modules while maintaining security. | **Backend (Authoritative):** Error middleware in API Gateway must standardize error responses, sanitize sensitive data, and ensure proper error context propagation without exposing internal details. |

## **5. Developer Task Checklist**

### **Backend Tasks:**
- [ ] Create database migration script for error handling tables (`errors`, `recovery_strategies`, `recovery_attempts`, `circuit_breakers`, `error_notifications`, `escalation_rules`, `fallback_configs`)
- [ ] Implement the `ErrorHandlingService` class as the main orchestrator for error classification, strategy selection, and recovery coordination
- [ ] Implement the `RecoveryService` class for executing recovery strategies including retry logic, exponential backoff, and context preservation
- [ ] Implement the `CircuitBreakerService` class for managing circuit breaker states, failure tracking, and automatic state transitions
- [ ] Implement the `NotificationService` class for creating, managing, and delivering error notifications to users with deduplication
- [ ] Implement the `EscalationService` class for managing error escalation rules and triggering escalation actions based on failure patterns
- [ ] Implement the `FallbackService` class for managing fallback mechanisms and graceful degradation strategies
- [ ] Implement all error management endpoints (`GET /api/v1/errors`, `POST /api/v1/errors`, `POST /api/v1/errors/{id}/recover`)
- [ ] Implement recovery strategy management endpoints (`GET /api/v1/recovery-strategies`, `POST /api/v1/recovery-strategies`)
- [ ] Implement recovery attempt tracking endpoints (`GET /api/v1/recovery-attempts`)
- [ ] Implement circuit breaker management endpoints (`GET /api/v1/circuit-breakers`, `POST /api/v1/circuit-breakers`, `POST /api/v1/circuit-breakers/{id}/reset`)
- [ ] Implement notification management endpoints (`GET /api/v1/notifications`, `POST /api/v1/notifications`, `PATCH /api/v1/notifications/{id}/dismiss`)
- [ ] Implement error statistics endpoint (`GET /api/v1/error-statistics`) with comprehensive analytics and reporting
- [ ] Implement fallback configuration endpoints (`GET /api/v1/fallbacks`, `POST /api/v1/fallbacks`)
- [ ] Create `ErrorRepository` class for efficient error storage, retrieval, and pattern analysis with proper indexing
- [ ] Create `RecoveryStrategyRepository` class for strategy configuration management and performance tracking
- [ ] Implement error classification engine with pattern matching and automatic categorization capabilities
- [ ] Implement automatic recovery orchestration with strategy prioritization and success rate optimization
- [ ] Create integration middleware for API Gateway to provide consistent error handling across all endpoints
- [ ] Implement comprehensive unit tests for all service classes with mock dependencies on Logging and Configuration modules
- [ ] Create integration tests for end-to-end error handling scenarios including recovery workflows and escalation paths
- [ ] Implement performance monitoring for error handling operations to ensure sub-second response times
- [ ] Add comprehensive integration with Logging & Monitoring Service for all error events, recovery attempts, and system health metrics

### **Frontend Tasks:**
- [ ] Create `ErrorHandlingProvider` React context for global error state management and recovery coordination
- [ ] Implement `useErrorHandling` hook for component-level error handling with automatic recovery and user feedback
- [ ] Create `ErrorBoundary` components for catching React errors and integrating with the error handling system
- [ ] Implement `ErrorDashboard` component for displaying error statistics, trends, and recovery status with real-time updates
- [ ] Create `NotificationCenter` component for displaying error notifications with action buttons and dismissal functionality
- [ ] Implement `RecoveryManager` component for manual recovery initiation and strategy configuration
- [ ] Create `CircuitBreakerMonitor` component for visualizing circuit breaker states and service health status
- [ ] Implement `ErrorReportingWidget` component for user-initiated error reporting with context capture
- [ ] Create error handling service functions in the API client (`errorHandlingService.ts`) for all error management endpoints
- [ ] Implement automatic error reporting for uncaught exceptions with context collection and user consent
- [ ] Create error notification display system with toast, modal, and banner components supporting different severity levels
- [ ] Implement error recovery workflows with user-friendly progress indicators and status updates
- [ ] Add error context preservation functionality to maintain user workflow state during error recovery
- [ ] Create error analytics visualization components with charts for error trends, recovery success rates, and pattern analysis
- [ ] Implement user notification preferences interface integrated with Configuration Management Module settings
- [ ] Add error escalation interface for manual escalation and severity adjustment with proper authorization
- [ ] Create error search and filtering interface with advanced query capabilities for error investigation
- [ ] Implement fallback status indicators and manual fallback activation controls for advanced users
- [ ] Add error handling configuration interface for managing recovery strategies and circuit breaker settings
- [ ] Create comprehensive error documentation and troubleshooting guides accessible from error notifications



========================================================================================


# Project Management Module - Technical Specification

## **1. Module Overview**

**Purpose:** The Project Management Module serves as the core project lifecycle management system for ReadyAI, responsible for creating, managing, and persisting project metadata and state throughout the 7-phase development methodology. This module provides comprehensive CRUD operations for projects, manages project templates and configurations, tracks project analytics and health metrics, and handles project backup and restoration capabilities while maintaining the local-first architecture principles defined in the HLSD.

**Dependencies & Interactions:** This module depends on the Database Management Module for project data persistence and transaction management, the File System Management Module for project file operations and workspace management, and the Configuration Management Module for project configuration settings and defaults. It interacts extensively with the Multi-Phase Development Orchestrator to track phase progression and manage phase artifacts, with the Context Management Engine to maintain project context and semantic relationships, and with the VS Code Extension Host to provide workspace integration and real-time project state synchronization. The module also integrates with the Logging & Monitoring Service to track project operations, performance metrics, and usage analytics that support the ReadyAI KPIs for development velocity and user productivity.

## **2. Module-Specific Type Additions (`types.projectManagement.ts`)**

```typescript
/**
 * Project Management Module Types
 * Extends foundational types with project management-specific interfaces
 */

/** Project template types for different project categories */
export type ProjectTemplateType = 
  | 'web_application'
  | 'api_service'
  | 'mobile_app'
  | 'desktop_app'
  | 'library'
  | 'cli_tool'
  | 'data_pipeline'
  | 'custom';

/** Project status indicators */
export type ProjectStatus = 
  | 'active'
  | 'paused'
  | 'completed'
  | 'archived'
  | 'failed';

/** Project health status based on metrics and progress */
export type ProjectHealthStatus = 'excellent' | 'good' | 'fair' | 'poor' | 'critical';

/** Project analytics time periods */
export type AnalyticsPeriod = 'day' | 'week' | 'month' | 'quarter' | 'year' | 'all_time';

/** Project template definition */
export interface ProjectTemplate {
  /** Unique template identifier */
  id: UUID;
  /** Template name */
  name: string;
  /** Template description */
  description: string;
  /** Template type category */
  type: ProjectTemplateType;
  /** Default technology stack */
  defaultTechStack: TechStack;
  /** Default project configuration */
  defaultConfig: ProjectConfig;
  /** Template file structure */
  fileStructure: ProjectFileStructure[];
  /** Template variables for customization */
  variables: ProjectTemplateVariable[];
  /** Whether template is built-in or custom */
  isBuiltIn: boolean;
  /** Template creation timestamp */
  createdAt: string; // ISO 8601 format
  /** Template last modified timestamp */
  lastModified: string; // ISO 8601 format
  /** Usage statistics */
  usageCount: number;
}

/** Project file structure definition for templates */
export interface ProjectFileStructure {
  /** File or directory path */
  path: string;
  /** Whether this is a directory */
  isDirectory: boolean;
  /** File content template (for files) */
  contentTemplate?: string;
  /** Whether this path is required */
  required: boolean;
  /** Template variables used in this file */
  variables?: string[];
}

/** Template variable definition */
export interface ProjectTemplateVariable {
  /** Variable name */
  name: string;
  /** Variable description */
  description: string;
  /** Variable type */
  type: 'string' | 'number' | 'boolean' | 'select';
  /** Default value */
  defaultValue?: any;
  /** Required variable */
  required: boolean;
  /** Options for select type */
  options?: Array<{
    label: string;
    value: any;
  }>;
  /** Validation pattern (for string type) */
  pattern?: string;
}

/** Project creation request */
export interface ProjectCreationRequest {
  /** Project name */
  name: string;
  /** Project description */
  description?: string;
  /** Root directory path */
  rootPath: string;
  /** Technology stack */
  techStack: TechStack;
  /** Project configuration */
  config?: Partial<ProjectConfig>;
  /** Template to use (optional) */
  templateId?: UUID;
  /** Template variable values */
  templateVariables?: Record<string, any>;
  /** Whether to initialize with Phase 0 */
  initializePhases?: boolean;
}

/** Project update request */
export interface ProjectUpdateRequest {
  /** Updated project name */
  name?: string;
  /** Updated project description */
  description?: string;
  /** Updated technology stack */
  techStack?: TechStack;
  /** Updated project configuration */
  config?: Partial<ProjectConfig>;
  /** Updated project status */
  status?: ProjectStatus;
}

/** Project health metrics */
export interface ProjectHealth {
  /** Project identifier */
  projectId: UUID;
  /** Overall health status */
  status: ProjectHealthStatus;
  /** Health score (0-100) */
  score: number;
  /** Health check timestamp */
  timestamp: string; // ISO 8601 format
  /** Individual health indicators */
  indicators: {
    /** Phase progression health */
    phaseProgression: {
      score: number;
      status: 'on_track' | 'delayed' | 'blocked';
      currentPhase: PhaseType;
      completedPhases: number;
      totalPhases: number;
    };
    /** Code quality health */
    codeQuality: {
      score: number;
      architecturalConsistency: number;
      testCoverage: number;
      dependencyHealth: number;
    };
    /** Context efficiency health */
    contextEfficiency: {
      score: number;
      avgRetrievalTime: number;
      contextNodeCount: number;
      relevanceScore: number;
    };
    /** File system health */
    fileSystemHealth: {
      score: number;
      totalFiles: number;
      totalSize: number;
      lastBackup?: string;
    };
  };
  /** Health recommendations */
  recommendations: string[];
}

/** Project analytics summary */
export interface ProjectAnalytics {
  /** Project identifier */
  projectId: UUID;
  /** Analytics period */
  period: AnalyticsPeriod;
  /** Period start timestamp */
  periodStart: string; // ISO 8601 format
  /** Period end timestamp */
  periodEnd: string; // ISO 8601 format
  /** Development metrics */
  development: {
    /** Total development time */
    totalTime: number; // minutes
    /** Time spent per phase */
    timePerPhase: Record<PhaseType, number>;
    /** AI generations count */
    totalGenerations: number;
    /** Context retrievals count */
    totalContextRetrievals: number;
    /** Average generation time */
    avgGenerationTime: number; // milliseconds
    /** Average context retrieval time */
    avgContextRetrievalTime: number; // milliseconds
  };
  /** Quality metrics */
  quality: {
    /** Current quality score */
    currentScore: number;
    /** Quality trend */
    trend: 'improving' | 'stable' | 'declining';
    /** Test coverage progression */
    testCoverageHistory: Array<{
      timestamp: string;
      coverage: number;
    }>;
    /** Error count by severity */
    errorsBySeverity: Record<string, number>;
  };
  /** Productivity metrics */
  productivity: {
    /** Files generated per day */
    filesPerDay: number;
    /** Lines of code generated */
    linesOfCode: number;
    /** Features completed */
    featuresCompleted: number;
    /** Velocity trend */
    velocityTrend: 'increasing' | 'stable' | 'decreasing';
  };
}

/** Project backup metadata */
export interface ProjectBackup {
  /** Unique backup identifier */
  id: UUID;
  /** Associated project identifier */
  projectId: UUID;
  /** Backup name/label */
  name: string;
  /** Backup description */
  description?: string;
  /** Backup type */
  type: 'manual' | 'automatic' | 'phase_checkpoint';
  /** Backup creation timestamp */
  createdAt: string; // ISO 8601 format
  /** Backup file size in bytes */
  size: number;
  /** Backup file path */
  backupPath: string;
  /** Project state at backup time */
  projectSnapshot: {
    /** Project metadata at backup */
    project: Project;
    /** Phase states at backup */
    phases: Phase[];
    /** File count at backup */
    fileCount: number;
    /** Context node count at backup */
    contextNodeCount: number;
  };
  /** Backup integrity hash */
  integrityHash: string;
  /** Whether backup is compressed */
  compressed: boolean;
}

/** Project search and filtering options */
export interface ProjectSearchOptions {
  /** Search query text */
  query?: string;
  /** Filter by project status */
  status?: ProjectStatus[];
  /** Filter by current phase */
  currentPhase?: PhaseType[];
  /** Filter by technology stack */
  techStack?: {
    languages?: string[];
    frameworks?: string[];
    tools?: string[];
  };
  /** Filter by creation date range */
  createdAfter?: string; // ISO 8601 format
  /** Filter by creation date range */
  createdBefore?: string; // ISO 8601 format
  /** Filter by last modified date range */
  modifiedAfter?: string; // ISO 8601 format
  /** Filter by last modified date range */
  modifiedBefore?: string; // ISO 8601 format
  /** Sort options */
  sortBy?: 'name' | 'created_at' | 'modified_at' | 'status' | 'phase';
  /** Sort direction */
  sortDirection?: 'asc' | 'desc';
  /** Pagination limit */
  limit?: number;
  /** Pagination offset */
  offset?: number;
}

/** Project import/export format */
export interface ProjectExportData {
  /** Export format version */
  version: string;
  /** Export timestamp */
  exportedAt: string; // ISO 8601 format
  /** Project data */
  project: Project;
  /** Phase data */
  phases: Phase[];
  /** Project files (Base64 encoded) */
  files: Array<{
    path: string;
    content: string;
    encoding: 'utf8' | 'base64';
  }>;
  /** Context data */
  contextNodes: ContextNode[];
  /** Project health snapshot */
  health: ProjectHealth;
  /** Analytics snapshot */
  analytics: ProjectAnalytics;
}
```

## **3. API Endpoint Specification (OpenAPI `paths` block)**

```yaml
paths:
  /api/v1/projects:
    get:
      tags:
        - Projects
      summary: List projects with filtering and search
      description: Retrieves a list of projects with support for filtering, searching, and pagination. Integrates with the Multi-Phase Development Orchestrator to include current phase information.
      security:
        - localAuth: []
      parameters:
        - name: query
          in: query
          description: Search query text for project names and descriptions
          required: false
          schema:
            type: string
        - name: status
          in: query
          description: Comma-separated list of project statuses to filter by
          required: false
          schema:
            type: string
            example: "active,paused"
        - name: currentPhase
          in: query
          description: Comma-separated list of current phases to filter by
          required: false
          schema:
            type: string
            example: "Phase0_StrategicCharter,Phase1_ArchitecturalBlueprint"
        - name: languages
          in: query
          description: Comma-separated list of programming languages to filter by
          required: false
          schema:
            type: string
        - name: frameworks
          in: query
          description: Comma-separated list of frameworks to filter by
          required: false
          schema:
            type: string
        - name: createdAfter
          in: query
          description: Filter projects created after this date
          required: false
          schema:
            type: string
            format: date-time
        - name: createdBefore
          in: query
          description: Filter projects created before this date
          required: false
          schema:
            type: string
            format: date-time
        - name: sortBy
          in: query
          description: Field to sort projects by
          required: false
          schema:
            type: string
            enum: [name, created_at, modified_at, status, phase]
            default: modified_at
        - name: sortDirection
          in: query
          description: Sort direction
          required: false
          schema:
            type: string
            enum: [asc, desc]
            default: desc
        - name: limit
          in: query
          description: Maximum number of projects to return
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
        - name: offset
          in: query
          description: Number of projects to skip for pagination
          required: false
          schema:
            type: integer
            minimum: 0
            default: 0
      responses:
        '200':
          description: Projects retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/PaginatedResponse'
        '400':
          description: Invalid query parameters
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

    post:
      tags:
        - Projects
      summary: Create a new project
      description: Creates a new project with optional template initialization. Interacts with File System Management Module to set up project directory structure and Multi-Phase Development Orchestrator to initialize project phases.
      security:
        - localAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  minLength: 1
                  maxLength: 200
                description:
                  type: string
                  maxLength: 1000
                rootPath:
                  type: string
                  minLength: 1
                techStack:
                  type: object
                  properties:
                    frontend:
                      type: string
                    backend:
                      type: string
                    database:
                      type: string
                    languages:
                      type: array
                      items:
                        type: string
                    tools:
                      type: array
                      items:
                        type: string
                config:
                  type: object
                  properties:
                    quality:
                      type: object
                      properties:
                        testCoverage:
                          type: number
                          minimum: 0
                          maximum: 100
                        lintingLevel:
                          type: string
                          enum: [basic, standard, strict]
                        typeChecking:
                          type: string
                          enum: [loose, standard, strict]
                    aiSettings:
                      type: object
                      properties:
                        preferredProvider:
                          $ref: '#/components/schemas/AIProviderType'
                        extendedThinking:
                          type: boolean
                        contextCompression:
                          type: string
                          enum: [minimal, standard, aggressive]
                templateId:
                  $ref: '#/components/schemas/UUID'
                templateVariables:
                  type: object
                  additionalProperties: true
                initializePhases:
                  type: boolean
                  default: true
              required:
                - name
                - rootPath
                - techStack
      responses:
        '201':
          description: Project created successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/Project'
        '400':
          description: Invalid project data or template variables
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'
        '409':
          description: Project with same name or root path already exists
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

  /api/v1/projects/{projectId}:
    get:
      tags:
        - Projects
      summary: Get project by ID
      description: Retrieves detailed information about a specific project including current phase status and health metrics
      security:
        - localAuth: []
      parameters:
        - name: projectId
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
        - name: includeHealth
          in: query
          description: Include project health metrics in response
          required: false
          schema:
            type: boolean
            default: false
        - name: includeAnalytics
          in: query
          description: Include basic analytics in response
          required: false
          schema:
            type: boolean
            default: false
      responses:
        '200':
          description: Project retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          project:
                            $ref: '#/components/schemas/Project'
                          health:
                            $ref: '#/components/schemas/ProjectHealth'
                          analytics:
                            $ref: '#/components/schemas/ProjectAnalytics'
        '404':
          description: Project not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

    put:
      tags:
        - Projects
      summary: Update project
      description: Updates project metadata and configuration. Changes to tech stack or configuration may trigger Context Management Engine updates.
      security:
        - localAuth: []
      parameters:
        - name: projectId
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  minLength: 1
                  maxLength: 200
                description:
                  type: string
                  maxLength: 1000
                techStack:
                  type: object
                  properties:
                    frontend:
                      type: string
                    backend:
                      type: string
                    database:
                      type: string
                    languages:
                      type: array
                      items:
                        type: string
                    tools:
                      type: array
                      items:
                        type: string
                config:
                  type: object
                status:
                  type: string
                  enum: [active, paused, completed, archived, failed]
      responses:
        '200':
          description: Project updated successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/Project'
        '400':
          description: Invalid update data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'
        '404':
          description: Project not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

    delete:
      tags:
        - Projects
      summary: Delete project
      description: Deletes a project and all associated data. Interacts with File System Management Module to clean up project files and Context Management Engine to remove project context.
      security:
        - localAuth: []
      parameters:
        - name: projectId
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
        - name: deleteFiles
          in: query
          description: Whether to delete project files from file system
          required: false
          schema:
            type: boolean
            default: false
        - name: createBackup
          in: query
          description: Whether to create a backup before deletion
          required: false
          schema:
            type: boolean
            default: true
      responses:
        '200':
          description: Project deleted successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          deletedProjectId:
                            $ref: '#/components/schemas/UUID'
                          backupId:
                            $ref: '#/components/schemas/UUID'
                          filesDeleted:
                            type: boolean
        '404':
          description: Project not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

  /api/v1/projects/{projectId}/health:
    get:
      tags:
        - Projects
      summary: Get project health metrics
      description: Retrieves comprehensive health metrics for a project including phase progression, code quality, and performance indicators
      security:
        - localAuth: []
      parameters:
        - name: projectId
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
        - name: refresh
          in: query
          description: Force refresh of health metrics
          required: false
          schema:
            type: boolean
            default: false
      responses:
        '200':
          description: Project health retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/ProjectHealth'
        '404':
          description: Project not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

  /api/v1/projects/{projectId}/analytics:
    get:
      tags:
        - Projects
      summary: Get project analytics
      description: Retrieves detailed analytics for a project including development metrics, quality trends, and productivity insights
      security:
        - localAuth: []
      parameters:
        - name: projectId
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
        - name: period
          in: query
          description: Analytics time period
          required: false
          schema:
            type: string
            enum: [day, week, month, quarter, year, all_time]
            default: month
        - name: startDate
          in: query
          description: Custom start date for analytics period
          required: false
          schema:
            type: string
            format: date
        - name: endDate
          in: query
          description: Custom end date for analytics period
          required: false
          schema:
            type: string
            format: date
      responses:
        '200':
          description: Project analytics retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/ProjectAnalytics'
        '404':
          description: Project not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

  /api/v1/projects/{projectId}/backup:
    get:
      tags:
        - Projects
      summary: List project backups
      description: Retrieves list of available backups for a project
      security:
        - localAuth: []
      parameters:
        - name: projectId
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
        - name: type
          in: query
          description: Filter backups by type
          required: false
          schema:
            type: string
            enum: [manual, automatic, phase_checkpoint]
        - name: limit
          in: query
          description: Maximum number of backups to return
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 50
            default: 10
      responses:
        '200':
          description: Project backups retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          backups:
                            type: array
                            items:
                              $ref: '#/components/schemas/ProjectBackup'
                          totalCount:
                            type: integer

    post:
      tags:
        - Projects
      summary: Create project backup
      description: Creates a backup of the project including all files, metadata, and context data. Integrates with File System Management Module for file backup operations.
      security:
        - localAuth: []
      parameters:
        - name: projectId
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  minLength: 1
                  maxLength: 100
                description:
                  type: string
                  maxLength: 500
                type:
                  type: string
                  enum: [manual, automatic, phase_checkpoint]
                  default: manual
                includeFiles:
                  type: boolean
                  default: true
                includeContext:
                  type: boolean
                  default: true
                compress:
                  type: boolean
                  default: true
              required:
                - name
      responses:
        '201':
          description: Project backup created successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/ProjectBackup'
        '404':
          description: Project not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

  /api/v1/projects/{projectId}/restore/{backupId}:
    post:
      tags:
        - Projects
      summary: Restore project from backup
      description: Restores a project from a specific backup. Creates a backup of current state before restoration. Integrates with File System Management and Context Management modules.
      security:
        - localAuth: []
      parameters:
        - name: projectId
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
        - name: backupId
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              properties:
                restoreFiles:
                  type: boolean
                  default: true
                restoreContext:
                  type: boolean
                  default: true
                createPreRestoreBackup:
                  type: boolean
                  default: true
                preRestoreBackupName:
                  type: string
                  default: "Pre-restore backup"
      responses:
        '200':
          description: Project restored successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          restoredProject:
                            $ref: '#/components/schemas/Project'
                          preRestoreBackupId:
                            $ref: '#/components/schemas/UUID'
                          restoredAt:
                            type: string
                            format: date-time
        '404':
          description: Project or backup not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

  /api/v1/projects/{projectId}/export:
    post:
      tags:
        - Projects
      summary: Export project data
      description: Exports complete project data including files, metadata, phases, and context for backup or migration purposes
      security:
        - localAuth: []
      parameters:
        - name: projectId
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              properties:
                includeFiles:
                  type: boolean
                  default: true
                includeContext:
                  type: boolean
                  default: true
                includeAnalytics:
                  type: boolean
                  default: false
                format:
                  type: string
                  enum: [json, zip]
                  default: json
      responses:
        '200':
          description: Project exported successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/ProjectExportData'
        '404':
          description: Project not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

  /api/v1/projects/import:
    post:
      tags:
        - Projects
      summary: Import project data
      description: Imports a project from exported data, creating a new project with all associated files and metadata
      security:
        - localAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                projectData:
                  $ref: '#/components/schemas/ProjectExportData'
                newName:
                  type: string
                  description: New name for imported project (optional)
                newRootPath:
                  type: string
                  description: New root path for imported project
                importFiles:
                  type: boolean
                  default: true
                importContext:
                  type: boolean
                  default: true
              required:
                - projectData
                - newRootPath
      responses:
        '201':
          description: Project imported successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/Project'
        '400':
          description: Invalid import data or conflicting project exists
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

  /api/v1/projects/templates:
    get:
      tags:
        - Projects
      summary: List project templates
      description: Retrieves available project templates for project creation
      security:
        - localAuth: []
      parameters:
        - name: type
          in: query
          description: Filter templates by type
          required: false
          schema:
            type: string
            enum: [web_application, api_service, mobile_app, desktop_app, library, cli_tool, data_pipeline, custom]
        - name: builtIn
          in: query
          description: Filter by built-in vs custom templates
          required: false
          schema:
            type: boolean
      responses:
        '200':
          description: Project templates retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          templates:
                            type: array
                            items:
                              $ref: '#/components/schemas/ProjectTemplate'

    post:
      tags:
        - Projects
      summary: Create custom project template
      description: Creates a new custom project template based on an existing project or from scratch
      security:
        - localAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  minLength: 1
                  maxLength: 100
                description:
                  type: string
                  maxLength: 500
                type:
                  type: string
                  enum: [web_application, api_service, mobile_app, desktop_app, library, cli_tool, data_pipeline, custom]
                baseProjectId:
                  $ref: '#/components/schemas/UUID'
                  description: Project to base template on (optional)
                defaultTechStack:
                  type: object
                defaultConfig:
                  type: object
                fileStructure:
                  type: array
                  items:
                    $ref: '#/components/schemas/ProjectFileStructure'
                variables:
                  type: array
                  items:
                    $ref: '#/components/schemas/ProjectTemplateVariable'
              required:
                - name
                - type
      responses:
        '201':
          description: Project template created successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/ProjectTemplate'

components:
  schemas:
    ProjectHealth:
      type: object
      required:
        - projectId
        - status
        - score
        - timestamp
        - indicators
        - recommendations
      properties:
        projectId:
          $ref: '#/components/schemas/UUID'
        status:
          type: string
          enum: [excellent, good, fair, poor, critical]
        score:
          type: number
          minimum: 0
          maximum: 100
        timestamp:
          type: string
          format: date-time
        indicators:
          type: object
          properties:
            phaseProgression:
              type: object
              properties:
                score:
                  type: number
                status:
                  type: string
                  enum: [on_track, delayed, blocked]
                currentPhase:
                  $ref: '#/components/schemas/PhaseType'
                completedPhases:
                  type: integer
                totalPhases:
                  type: integer
            codeQuality:
              type: object
              properties:
                score:
                  type: number
                architecturalConsistency:
                  type: number
                testCoverage:
                  type: number
                dependencyHealth:
                  type: number
            contextEfficiency:
              type: object
              properties:
                score:
                  type: number
                avgRetrievalTime:
                  type: number
                contextNodeCount:
                  type: integer
                relevanceScore:
                  type: number
            fileSystemHealth:
              type: object
              properties:
                score:
                  type: number
                totalFiles:
                  type: integer
                totalSize:
                  type: number
                lastBackup:
                  type: string
                  format: date-time
        recommendations:
          type: array
          items:
            type: string

    ProjectAnalytics:
      type: object
      required:
        - projectId
        - period
        - periodStart
        - periodEnd
        - development
        - quality
        - productivity
      properties:
        projectId:
          $ref: '#/components/schemas/UUID'
        period:
          type: string
          enum: [day, week, month, quarter, year, all_time]
        periodStart:
          type: string
          format: date-time
        periodEnd:
          type: string
          format: date-time
        development:
          type: object
          properties:
            totalTime:
              type: number
            timePerPhase:
              type: object
              additionalProperties:
                type: number
            totalGenerations:
              type: integer
            totalContextRetrievals:
              type: integer
            avgGenerationTime:
              type: number
            avgContextRetrievalTime:
              type: number
        quality:
          type: object
          properties:
            currentScore:
              type: number
            trend:
              type: string
              enum: [improving, stable, declining]
            testCoverageHistory:
              type: array
              items:
                type: object
                properties:
                  timestamp:
                    type: string
                    format: date-time
                  coverage:
                    type: number
            errorsBySeverity:
              type: object
              additionalProperties:
                type: integer
        productivity:
          type: object
          properties:
            filesPerDay:
              type: number
            linesOfCode:
              type: integer
            featuresCompleted:
              type: integer
            velocityTrend:
              type: string
              enum: [increasing, stable, decreasing]

    ProjectBackup:
      type: object
      required:
        - id
        - projectId
        - name
        - type
        - createdAt
        - size
        - backupPath
        - projectSnapshot
        - integrityHash
        - compressed
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        projectId:
          $ref: '#/components/schemas/UUID'
        name:
          type: string
        description:
          type: string
        type:
          type: string
          enum: [manual, automatic, phase_checkpoint]
        createdAt:
          type: string
          format: date-time
        size:
          type: number
        backupPath:
          type: string
        projectSnapshot:
          type: object
          properties:
            project:
              $ref: '#/components/schemas/Project'
            phases:
              type: array
              items:
                $ref: '#/components/schemas/Phase'
            fileCount:
              type: integer
            contextNodeCount:
              type: integer
        integrityHash:
          type: string
        compressed:
          type: boolean

    ProjectTemplate:
      type: object
      required:
        - id
        - name
        - description
        - type
        - defaultTechStack
        - defaultConfig
        - fileStructure
        - variables
        - isBuiltIn
        - createdAt
        - lastModified
        - usageCount
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        name:
          type: string
        description:
          type: string
        type:
          type: string
          enum: [web_application, api_service, mobile_app, desktop_app, library, cli_tool, data_pipeline, custom]
        defaultTechStack:
          type: object
        defaultConfig:
          type: object
        fileStructure:
          type: array
          items:
            $ref: '#/components/schemas/ProjectFileStructure'
        variables:
          type: array
          items:
            $ref: '#/components/schemas/ProjectTemplateVariable'
        isBuiltIn:
          type: boolean
        createdAt:
          type: string
          format: date-time
        lastModified:
          type: string
          format: date-time
        usageCount:
          type: integer

    ProjectFileStructure:
      type: object
      required:
        - path
        - isDirectory
        - required
      properties:
        path:
          type: string
        isDirectory:
          type: boolean
        contentTemplate:
          type: string
        required:
          type: boolean
        variables:
          type: array
          items:
            type: string

    ProjectTemplateVariable:
      type: object
      required:
        - name
        - description
        - type
        - required
      properties:
        name:
          type: string
        description:
          type: string
        type:
          type: string
          enum: [string, number, boolean, select]
        defaultValue:
          oneOf:
            - type: string
            - type: number
            - type: boolean
        required:
          type: boolean
        options:
          type: array
          items:
            type: object
            properties:
              label:
                type: string
              value:
                oneOf:
                  - type: string
                  - type: number
                  - type: boolean
        pattern:
          type: string

    ProjectExportData:
      type: object
      required:
        - version
        - exportedAt
        - project
        - phases
        - files
        - contextNodes
        - health
        - analytics
      properties:
        version:
          type: string
        exportedAt:
          type: string
          format: date-time
        project:
          $ref: '#/components/schemas/Project'
        phases:
          type: array
          items:
            $ref: '#/components/schemas/Phase'
        files:
          type: array
          items:
            type: object
            properties:
              path:
                type: string
              content:
                type: string
              encoding:
                type: string
                enum: [utf8, base64]
        contextNodes:
          type: array
          items:
            $ref: '#/components/schemas/ContextNode'
        health:
          $ref: '#/components/schemas/ProjectHealth'
        analytics:
          $ref: '#/components/schemas/ProjectAnalytics'
```

## **4. Detailed Business Logic & Validation Rules**

| Rule ID | Rule Description | Implementation Location(s) & Notes |
|---------|------------------|-----------------------------------|
| **PM-01** | Project names must be unique within the system and cannot contain invalid file system characters to prevent conflicts with File System Management Module operations. | **Backend (Authoritative):** Service validation must check name uniqueness in database and validate against file system character restrictions before project creation or updates. |
| **PM-02** | Project root paths must be validated through File System Management Module to ensure directory accessibility and prevent conflicts with existing projects. | **Backend (Authoritative):** Project service must call File System Management Module to validate path accessibility, check for existing projects in same path, and verify write permissions before project creation. |
| **PM-03** | Project deletion must create a backup through the backup service unless explicitly disabled, and must coordinate with Context Management Engine to clean up project context data. | **Backend (Authoritative):** Delete service must create backup first, then call Context Management Module to remove context nodes, and optionally call File System Management to remove project files. |
| **PM-04** | Project phase transitions must be coordinated with Multi-Phase Development Orchestrator to ensure phase dependencies are satisfied and phase artifacts are properly managed. | **Backend (Authoritative):** Project service must validate phase transitions through Multi-Phase Orchestrator and update project currentPhase only after successful phase validation. |
| **PM-05** | Project health metrics must be calculated by aggregating data from Multiple modules including phase progression, Context Management efficiency, and file system status, with results cached for performance. | **Backend (Authoritative):** Health service must query Multi-Phase Orchestrator for phase status, Context Management for retrieval times, File System Management for file counts, and cache results for 5 minutes to meet <3 second KPI. |
| **PM-06** | Project template application must validate template variables and coordinate with File System Management Module to create the proper directory structure and initial files. | **Backend (Authoritative):** Template service must validate all required variables, substitute template placeholders, and call File System Management to create directories and files with proper content. |
| **PM-07** | Project analytics calculations must aggregate data from Logging & Monitoring Service metrics while respecting the local-first privacy constraints by anonymizing session-specific data. | **Backend (Authoritative):** Analytics service must query Logging Service for project-specific metrics, aggregate without exposing individual sessions, and calculate productivity trends for KPI tracking. |
| **PM-08** | Project backup operations must coordinate with File System Management Module for file backup and Context Management Engine for context data backup with integrity verification. | **Backend (Authoritative):** Backup service must call File System Management for file backup, Context Management for context export, calculate integrity hashes, and store backup metadata in database. |
| **PM-09** | Project restoration from backup must validate backup integrity, create pre-restore backup, and coordinate with both File System Management and Context Management modules for complete restoration. | **Backend (Authoritative):** Restore service must verify backup integrity hash, create current state backup, restore files via File System Management, restore context via Context Management, and update project metadata. |
| **PM-10** | Project configuration changes that affect AI settings must be propagated to Configuration Management Module to update system-wide AI provider settings and context compression levels. | **Backend (Authoritative):** Project update service must detect AI configuration changes and call Configuration Management Module to update relevant system settings for the project context. |

## **5. Developer Task Checklist**

### **Backend Tasks:**
- [ ] Create database migration script for project management tables (`projects`, `project_templates`, `project_backups`, `project_health_metrics`, `project_analytics`)
- [ ] Implement the `ProjectService` class with comprehensive project lifecycle management including CRUD operations, health tracking, and analytics calculation
- [ ] Implement the `ProjectTemplateService` class for managing project templates, template application, and custom template creation
- [ ] Implement the `ProjectBackupService` class for creating, managing, and restoring project backups with integrity verification
- [ ] Implement the `ProjectHealthService` class for calculating and caching project health metrics by aggregating data from multiple modules
- [ ] Implement the `ProjectAnalyticsService` class for generating project analytics while maintaining local-first privacy constraints
- [ ] Implement all project CRUD endpoints (`GET`, `POST /api/v1/projects`, `GET`, `PUT`, `DELETE /api/v1/projects/{id}`) with comprehensive validation and error handling
- [ ] Implement project health endpoint (`GET /api/v1/projects/{id}/health`) with real-time metric calculation and caching
- [ ] Implement project analytics endpoint (`GET /api/v1/projects/{id}/analytics`) with configurable time periods and metric aggregation
- [ ] Implement project backup management endpoints (`GET`, `POST /api/v1/projects/{id}/backup`, `POST /api/v1/projects/{id}/restore/{backupId}`)
- [ ] Implement project import/export endpoints (`POST /api/v1/projects/{id}/export`, `POST /api/v1/projects/import`) with complete data serialization
- [ ] Implement project template endpoints (`GET`, `POST /api/v1/projects/templates`) for template management and creation
- [ ] Create `ProjectRepository` class for database operations with proper indexing on name, rootPath, currentPhase, and createdAt fields
- [ ] Create `ProjectTemplateRepository` class for template storage and retrieval with usage tracking
- [ ] Create `ProjectBackupRepository` class for backup metadata management with integrity hash verification
- [ ] Implement integration with File System Management Module for project directory operations, file backup, and cleanup
- [ ] Implement integration with Context Management Engine for project context initialization, updates, and cleanup
- [ ] Implement integration with Multi-Phase Development Orchestrator for phase status tracking and validation
- [ ] Implement integration with Database Management Module for transaction management and data consistency
- [ ] Implement integration with Configuration Management Module for project-specific configuration propagation
- [ ] Implement integration with Logging & Monitoring Service for project operation logging and analytics data collection
- [ ] Create comprehensive unit tests for all service classes with mock implementations of dependent modules
- [ ] Create integration tests for project lifecycle workflows including creation, updates, backup/restore, and deletion scenarios
- [ ] Implement performance optimizations for project search and filtering with proper database indexing and query optimization
- [ ] Add project health monitoring background service for periodic health metric updates and trend analysis

### **Frontend Tasks:**
- [ ] Create `ProjectProvider` React context for project management state and operations
- [ ] Implement `useProjects` hook for project listing, filtering, and search functionality with TanStack Query integration
- [ ] Implement `useProject` hook for individual project management with real-time health and analytics updates
- [ ] Create `ProjectList` component for displaying projects with filtering, search, and pagination capabilities
- [ ] Implement `ProjectCard` component for project overview display with health status indicators and quick actions
- [ ] Create `ProjectForm` component for project creation and editing with template selection and variable configuration
- [ ] Implement `ProjectDetail` component for comprehensive project information display with tabbed interface
- [ ] Create `ProjectHealth` component for visualizing project health metrics with charts and recommendations
- [ ] Implement `ProjectAnalytics` component for displaying development metrics, quality trends, and productivity insights
- [ ] Create `ProjectBackup` component for backup management with creation, listing, and restoration capabilities
- [ ] Implement `ProjectTemplates` component for template selection, preview, and custom template creation
- [ ] Create `ProjectExport` component for project export functionality with format selection and progress tracking
- [ ] Create project service functions in the API client (`projectService.ts`) for all project management endpoints
- [ ] Implement project search and filtering interface with advanced search options and saved filters
- [ ] Add project quick actions menu with common operations like backup, export, and phase progression
- [ ] Create project dashboard widget for displaying recent projects, health status, and key metrics
- [ ] Implement project import/export workflow with drag-and-drop support and progress indicators
- [ ] Add project template gallery with preview capabilities and template customization interface
- [ ] Create project health monitoring dashboard with alerts for projects requiring attention
- [ ] Implement project analytics visualization with interactive charts and trend analysis
- [ ] Add project backup scheduling interface integrated with Configuration Management settings
- [ ] Create project comparison feature for analyzing multiple projects side-by-side
- [ ] Implement project archiving and restoration workflow with confirmation dialogs and progress tracking
- [ ] Add project collaboration features for sharing project exports and templates
- [ ] Create project troubleshooting guide with common issues and automated resolution suggestions



========================================================================================


# Context Intelligence Module - Technical Specification

## **1. Module Overview**

**Purpose:** The Context Intelligence Module serves as the advanced analytics and optimization layer for ReadyAI's context management system, providing sophisticated context quality scoring, relevance calculation, intelligent context compression, caching strategies, and context optimization algorithms. This module transforms raw context data from the Context Management Engine into intelligently processed, highly relevant context packages that maximize AI generation quality while minimizing token usage and ensuring sub-3-second retrieval times as required by the Context Management Efficiency KPI.

**Dependencies & Interactions:** This module depends on the Vector Database Service for semantic similarity calculations and embedding operations, the AI Provider Management (Claude Integration Service) for token usage optimization and generation quality feedback, and the Analytics Service (from Logging & Monitoring Service) for context usage patterns and performance metrics. It interacts extensively with the Context Management Engine by consuming raw context data and providing enhanced context packages with relevance scores and quality metrics. The module integrates with the Configuration Management Module to obtain context compression levels, relevance thresholds, and caching settings. It also coordinates with the Multi-Phase Development Orchestrator to apply phase-specific context optimization strategies and with the Project Management Module to maintain project-specific context intelligence profiles for improved accuracy over time.

## **2. Module-Specific Type Additions (`types.contextIntelligence.ts`)**

```typescript
/**
 * Context Intelligence Module Types
 * Extends foundational types with advanced context processing interfaces
 */

/** Context quality assessment levels */
export type ContextQualityLevel = 'excellent' | 'good' | 'fair' | 'poor' | 'insufficient';

/** Context compression algorithms */
export type CompressionAlgorithm = 'semantic_summary' | 'importance_ranking' | 'dependency_focused' | 'hybrid';

/** Context relevance calculation methods */
export type RelevanceCalculationMethod = 'vector_similarity' | 'dependency_weight' | 'frequency_based' | 'phase_aware' | 'combined';

/** Context caching strategies */
export type CachingStrategy = 'lru' | 'relevance_based' | 'frequency_based' | 'project_aware' | 'adaptive';

/** Context optimization objectives */
export type OptimizationObjective = 'minimize_tokens' | 'maximize_relevance' | 'balance_quality_speed' | 'phase_specific';

/** Context quality assessment result */
export interface ContextQualityAssessment {
  /** Assessment identifier */
  id: UUID;
  /** Context node being assessed */
  contextNodeId: UUID;
  /** Project context */
  projectId: UUID;
  /** Overall quality level */
  qualityLevel: ContextQualityLevel;
  /** Numerical quality score (0-100) */
  qualityScore: number;
  /** Assessment timestamp */
  assessedAt: string; // ISO 8601 format
  /** Quality dimensions */
  dimensions: {
    /** Completeness score (0-100) */
    completeness: number;
    /** Clarity score (0-100) */
    clarity: number;
    /** Recency score (0-100) */
    recency: number;
    /** Dependency consistency score (0-100) */
    dependencyConsistency: number;
    /** Semantic coherence score (0-100) */
    semanticCoherence: number;
  };
  /** Quality improvement suggestions */
  improvements: string[];
  /** Assessment metadata */
  metadata: Record<string, any>;
}

/** Context relevance calculation result */
export interface ContextRelevanceResult {
  /** Calculation identifier */
  id: UUID;
  /** Context node identifier */
  contextNodeId: UUID;
  /** Target context or generation request */
  targetContext: string;
  /** Relevance score (0-1) */
  relevanceScore: number;
  /** Calculation method used */
  calculationMethod: RelevanceCalculationMethod;
  /** Calculation timestamp */
  calculatedAt: string; // ISO 8601 format
  /** Relevance factors breakdown */
  factors: {
    /** Vector similarity score */
    vectorSimilarity: number;
    /** Dependency relationship score */
    dependencyScore: number;
    /** Usage frequency score */
    frequencyScore: number;
    /** Phase relevance score */
    phaseRelevanceScore: number;
    /** Recency bonus score */
    recencyBonus: number;
  };
  /** Calculation confidence (0-1) */
  confidence: number;
  /** Additional calculation metadata */
  metadata: Record<string, any>;
}

/** Context compression result */
export interface ContextCompressionResult {
  /** Compression identifier */
  id: UUID;
  /** Source context nodes */
  sourceContextIds: UUID[];
  /** Compressed content */
  compressedContent: string;
  /** Compression algorithm used */
  algorithm: CompressionAlgorithm;
  /** Original token count */
  originalTokenCount: number;
  /** Compressed token count */
  compressedTokenCount: number;
  /** Compression ratio (0-1) */
  compressionRatio: number;
  /** Quality preservation score (0-1) */
  qualityPreservation: number;
  /** Compression timestamp */
  compressedAt: string; // ISO 8601 format
  /** Compression settings used */
  settings: {
    /** Target compression ratio */
    targetRatio: number;
    /** Minimum quality threshold */
    minQualityThreshold: number;
    /** Phase-specific settings */
    phaseSettings?: Record<PhaseType, any>;
  };
  /** Compression metadata */
  metadata: Record<string, any>;
}

/** Context cache entry */
export interface ContextCacheEntry {
  /** Cache entry identifier */
  id: UUID;
  /** Cache key */
  cacheKey: string;
  /** Project context */
  projectId: UUID;
  /** Cached context package */
  contextPackage: ContextPackage;
  /** Cache creation timestamp */
  createdAt: string; // ISO 8601 format
  /** Last accessed timestamp */
  lastAccessedAt: string; // ISO 8601 format
  /** Access count */
  accessCount: number;
  /** Cache hit efficiency score */
  hitEfficiency: number;
  /** Cache expiry timestamp */
  expiresAt: string; // ISO 8601 format
  /** Cache size in bytes */
  sizeBytes: number;
  /** Caching strategy used */
  strategy: CachingStrategy;
  /** Cache tags for categorization */
  tags: string[];
}

/** Context optimization request */
export interface ContextOptimizationRequest {
  /** Request identifier */
  id: UUID;
  /** Project identifier */
  projectId: UUID;
  /** Input context nodes */
  inputContextIds: UUID[];
  /** Target generation context */
  targetContext: string;
  /** Current phase */
  currentPhase: PhaseType;
  /** Optimization objective */
  objective: OptimizationObjective;
  /** Optimization constraints */
  constraints: {
    /** Maximum token count */
    maxTokens: number;
    /** Minimum relevance threshold */
    minRelevance: number;
    /** Required context types */
    requiredTypes?: ContextType[];
    /** Time limit for optimization (ms) */
    timeLimit: number;
  };
  /** Request timestamp */
  createdAt: string; // ISO 8601 format
}

/** Context optimization result */
export interface ContextOptimizationResult {
  /** Request identifier */
  requestId: UUID;
  /** Optimized context package */
  optimizedContext: ContextPackage;
  /** Optimization metrics */
  metrics: {
    /** Processing time (ms) */
    processingTime: number;
    /** Token reduction achieved */
    tokenReduction: number;
    /** Average relevance score */
    avgRelevanceScore: number;
    /** Quality preservation score */
    qualityPreservation: number;
    /** Optimization efficiency score */
    efficiencyScore: number;
  };
  /** Applied optimizations */
  appliedOptimizations: string[];
  /** Optimization warnings */
  warnings: string[];
  /** Result timestamp */
  optimizedAt: string; // ISO 8601 format
}

/** Context intelligence profile for a project */
export interface ContextIntelligenceProfile {
  /** Profile identifier */
  id: UUID;
  /** Project identifier */
  projectId: UUID;
  /** Profile creation timestamp */
  createdAt: string; // ISO 8601 format
  /** Last updated timestamp */
  lastUpdated: string; // ISO 8601 format
  /** Learning statistics */
  learningStats: {
    /** Total context assessments performed */
    totalAssessments: number;
    /** Average quality score trend */
    avgQualityTrend: number[];
    /** Most relevant context types */
    topContextTypes: Array<{
      type: ContextType;
      relevanceScore: number;
      frequency: number;
    }>;
    /** Phase-specific patterns */
    phasePatterns: Record<PhaseType, {
      avgRelevanceScore: number;
      preferredCompressionRatio: number;
      optimalCacheSize: number;
    }>;
  };
  /** Optimization preferences learned */
  optimizationPreferences: {
    /** Preferred compression algorithm */
    preferredCompression: CompressionAlgorithm;
    /** Optimal relevance threshold */
    optimalRelevanceThreshold: number;
    /** Preferred caching strategy */
    preferredCaching: CachingStrategy;
    /** Custom optimization rules */
    customRules: Array<{
      condition: string;
      action: string;
      confidence: number;
    }>;
  };
  /** Performance metrics */
  performanceMetrics: {
    /** Average context retrieval time */
    avgRetrievalTime: number;
    /** Cache hit rate */
    cacheHitRate: number;
    /** Compression efficiency */
    compressionEfficiency: number;
    /** Generation quality correlation */
    generationQualityCorrelation: number;
  };
}

/** Context similarity matrix for related contexts */
export interface ContextSimilarityMatrix {
  /** Matrix identifier */
  id: UUID;
  /** Project identifier */
  projectId: UUID;
  /** Context node identifiers in matrix */
  contextNodeIds: UUID[];
  /** Similarity matrix (NxN array) */
  similarityMatrix: number[][];
  /** Matrix calculation timestamp */
  calculatedAt: string; // ISO 8601 format
  /** Calculation parameters */
  parameters: {
    /** Similarity threshold */
    similarityThreshold: number;
    /** Vector embedding model used */
    embeddingModel: string;
    /** Distance metric */
    distanceMetric: 'cosine' | 'euclidean' | 'manhattan';
  };
  /** Matrix statistics */
  statistics: {
    /** Average similarity score */
    avgSimilarity: number;
    /** Highest similarity pair */
    maxSimilarity: {
      nodeId1: UUID;
      nodeId2: UUID;
      score: number;
    };
    /** Most diverse context */
    mostDiverse: {
      nodeId: UUID;
      avgSimilarity: number;
    };
  };
}
```

## **3. API Endpoint Specification (OpenAPI `paths` block)**

```yaml
paths:
  /api/v1/context-intelligence/quality/assess:
    post:
      tags:
        - Context Intelligence
      summary: Assess context quality
      description: Performs comprehensive quality assessment of context nodes, evaluating completeness, clarity, recency, and semantic coherence
      security:
        - localAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                contextNodeIds:
                  type: array
                  items:
                    $ref: '#/components/schemas/UUID'
                  minItems: 1
                  maxItems: 50
                projectId:
                  $ref: '#/components/schemas/UUID'
                assessmentOptions:
                  type: object
                  properties:
                    includeImprovements:
                      type: boolean
                      default: true
                    detailedAnalysis:
                      type: boolean
                      default: false
                    compareToProject:
                      type: boolean
                      default: true
              required:
                - contextNodeIds
                - projectId
      responses:
        '200':
          description: Context quality assessment completed successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          assessments:
                            type: array
                            items:
                              $ref: '#/components/schemas/ContextQualityAssessment'
                          summary:
                            type: object
                            properties:
                              avgQualityScore:
                                type: number
                              qualityDistribution:
                                type: object
                                additionalProperties:
                                  type: integer
                              recommendations:
                                type: array
                                items:
                                  type: string
        '400':
          description: Invalid assessment request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

  /api/v1/context-intelligence/relevance/calculate:
    post:
      tags:
        - Context Intelligence
      summary: Calculate context relevance
      description: Calculates relevance scores for context nodes relative to a target context or generation request
      security:
        - localAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                contextNodeIds:
                  type: array
                  items:
                    $ref: '#/components/schemas/UUID'
                  minItems: 1
                  maxItems: 100
                targetContext:
                  type: string
                  minLength: 1
                projectId:
                  $ref: '#/components/schemas/UUID'
                currentPhase:
                  $ref: '#/components/schemas/PhaseType'
                calculationMethod:
                  type: string
                  enum: [vector_similarity, dependency_weight, frequency_based, phase_aware, combined]
                  default: combined
                options:
                  type: object
                  properties:
                    includeFactorBreakdown:
                      type: boolean
                      default: true
                    minRelevanceThreshold:
                      type: number
                      minimum: 0
                      maximum: 1
                      default: 0.1
              required:
                - contextNodeIds
                - targetContext
                - projectId
      responses:
        '200':
          description: Context relevance calculation completed successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          relevanceResults:
                            type: array
                            items:
                              $ref: '#/components/schemas/ContextRelevanceResult'
                          rankedContexts:
                            type: array
                            items:
                              type: object
                              properties:
                                contextNodeId:
                                  $ref: '#/components/schemas/UUID'
                                relevanceScore:
                                  type: number
                                rank:
                                  type: integer

  /api/v1/context-intelligence/compression/compress:
    post:
      tags:
        - Context Intelligence
      summary: Compress context package
      description: Intelligently compresses context content while preserving semantic meaning and relevance
      security:
        - localAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                contextNodeIds:
                  type: array
                  items:
                    $ref: '#/components/schemas/UUID'
                  minItems: 1
                algorithm:
                  type: string
                  enum: [semantic_summary, importance_ranking, dependency_focused, hybrid]
                  default: hybrid
                compressionSettings:
                  type: object
                  properties:
                    targetRatio:
                      type: number
                      minimum: 0.1
                      maximum: 0.9
                      default: 0.6
                    minQualityThreshold:
                      type: number
                      minimum: 0.5
                      maximum: 1.0
                      default: 0.8
                    preserveCriticalDependencies:
                      type: boolean
                      default: true
                projectId:
                  $ref: '#/components/schemas/UUID'
                currentPhase:
                  $ref: '#/components/schemas/PhaseType'
              required:
                - contextNodeIds
                - projectId
      responses:
        '200':
          description: Context compression completed successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/ContextCompressionResult'
        '400':
          description: Invalid compression request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

  /api/v1/context-intelligence/optimization/optimize:
    post:
      tags:
        - Context Intelligence
      summary: Optimize context package
      description: Performs comprehensive context optimization combining relevance scoring, quality assessment, and compression for optimal AI generation results
      security:
        - localAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                contextNodeIds:
                  type: array
                  items:
                    $ref: '#/components/schemas/UUID'
                  minItems: 1
                targetContext:
                  type: string
                  minLength: 1
                projectId:
                  $ref: '#/components/schemas/UUID'
                currentPhase:
                  $ref: '#/components/schemas/PhaseType'
                objective:
                  type: string
                  enum: [minimize_tokens, maximize_relevance, balance_quality_speed, phase_specific]
                  default: balance_quality_speed
                constraints:
                  type: object
                  properties:
                    maxTokens:
                      type: integer
                      minimum: 100
                      maximum: 50000
                    minRelevance:
                      type: number
                      minimum: 0
                      maximum: 1
                      default: 0.3
                    requiredTypes:
                      type: array
                      items:
                        type: string
                        enum: [file, module, dependency, pattern, artifact]
                    timeLimit:
                      type: integer
                      minimum: 1000
                      maximum: 30000
                      default: 10000
              required:
                - contextNodeIds
                - targetContext
                - projectId
      responses:
        '200':
          description: Context optimization completed successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/ContextOptimizationResult'
        '408':
          description: Optimization timeout exceeded
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

  /api/v1/context-intelligence/cache/retrieve:
    get:
      tags:
        - Context Intelligence
      summary: Retrieve cached context
      description: Retrieves intelligently cached context packages based on cache key or similarity matching
      security:
        - localAuth: []
      parameters:
        - name: cacheKey
          in: query
          description: Specific cache key to retrieve
          required: false
          schema:
            type: string
        - name: projectId
          in: query
          description: Project identifier for cache lookup
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
        - name: targetContext
          in: query
          description: Target context for similarity-based cache lookup
          required: false
          schema:
            type: string
        - name: currentPhase
          in: query
          description: Current phase for phase-aware cache lookup
          required: false
          schema:
            $ref: '#/components/schemas/PhaseType'
        - name: maxResults
          in: query
          description: Maximum number of cache entries to return
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 10
            default: 3
      responses:
        '200':
          description: Cache retrieval successful
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          cacheEntries:
                            type: array
                            items:
                              $ref: '#/components/schemas/ContextCacheEntry'
                          cacheHit:
                            type: boolean
                          similarityScores:
                            type: array
                            items:
                              type: object
                              properties:
                                cacheId:
                                  $ref: '#/components/schemas/UUID'
                                similarityScore:
                                  type: number
        '404':
          description: No matching cache entries found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

    post:
      tags:
        - Context Intelligence
      summary: Store context in cache
      description: Stores optimized context packages in intelligent cache with automatic expiry and relevance-based management
      security:
        - localAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                cacheKey:
                  type: string
                  minLength: 1
                  maxLength: 200
                contextPackage:
                  $ref: '#/components/schemas/ContextPackage'
                projectId:
                  $ref: '#/components/schemas/UUID'
                strategy:
                  type: string
                  enum: [lru, relevance_based, frequency_based, project_aware, adaptive]
                  default: adaptive
                ttlSeconds:
                  type: integer
                  minimum: 300
                  maximum: 86400
                  default: 3600
                tags:
                  type: array
                  items:
                    type: string
                  maxItems: 10
                priority:
                  type: integer
                  minimum: 1
                  maximum: 10
                  default: 5
              required:
                - cacheKey
                - contextPackage
                - projectId
      responses:
        '201':
          description: Context cached successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/ContextCacheEntry'

  /api/v1/context-intelligence/similarity/matrix:
    post:
      tags:
        - Context Intelligence
      summary: Generate context similarity matrix
      description: Generates a similarity matrix for context nodes to identify related contexts and potential optimization opportunities
      security:
        - localAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                contextNodeIds:
                  type: array
                  items:
                    $ref: '#/components/schemas/UUID'
                  minItems: 2
                  maxItems: 100
                projectId:
                  $ref: '#/components/schemas/UUID'
                parameters:
                  type: object
                  properties:
                    similarityThreshold:
                      type: number
                      minimum: 0
                      maximum: 1
                      default: 0.5
                    distanceMetric:
                      type: string
                      enum: [cosine, euclidean, manhattan]
                      default: cosine
                    includeStatistics:
                      type: boolean
                      default: true
              required:
                - contextNodeIds
                - projectId
      responses:
        '200':
          description: Similarity matrix generated successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/ContextSimilarityMatrix'

  /api/v1/context-intelligence/profiles/{projectId}:
    get:
      tags:
        - Context Intelligence
      summary: Get project context intelligence profile
      description: Retrieves the learned context intelligence profile for a specific project, including optimization preferences and performance metrics
      security:
        - localAuth: []
      parameters:
        - name: projectId
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '200':
          description: Context intelligence profile retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/ContextIntelligenceProfile'
        '404':
          description: Profile not found for project
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

    put:
      tags:
        - Context Intelligence
      summary: Update project context intelligence profile
      description: Updates learned preferences and optimization settings for a project's context intelligence profile
      security:
        - localAuth: []
      parameters:
        - name: projectId
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                optimizationPreferences:
                  type: object
                  properties:
                    preferredCompression:
                      type: string
                      enum: [semantic_summary, importance_ranking, dependency_focused, hybrid]
                    optimalRelevanceThreshold:
                      type: number
                      minimum: 0
                      maximum: 1
                    preferredCaching:
                      type: string
                      enum: [lru, relevance_based, frequency_based, project_aware, adaptive]
                    customRules:
                      type: array
                      items:
                        type: object
                        properties:
                          condition:
                            type: string
                          action:
                            type: string
                          confidence:
                            type: number
                performanceTargets:
                  type: object
                  properties:
                    targetRetrievalTime:
                      type: number
                      minimum: 500
                      maximum: 3000
                    targetCacheHitRate:
                      type: number
                      minimum: 0.5
                      maximum: 1.0
                    targetCompressionRatio:
                      type: number
                      minimum: 0.3
                      maximum: 0.8
      responses:
        '200':
          description: Context intelligence profile updated successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/ContextIntelligenceProfile'

components:
  schemas:
    ContextQualityAssessment:
      type: object
      required:
        - id
        - contextNodeId
        - projectId
        - qualityLevel
        - qualityScore
        - assessedAt
        - dimensions
        - improvements
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        contextNodeId:
          $ref: '#/components/schemas/UUID'
        projectId:
          $ref: '#/components/schemas/UUID'
        qualityLevel:
          type: string
          enum: [excellent, good, fair, poor, insufficient]
        qualityScore:
          type: number
          minimum: 0
          maximum: 100
        assessedAt:
          type: string
          format: date-time
        dimensions:
          type: object
          properties:
            completeness:
              type: number
            clarity:
              type: number
            recency:
              type: number
            dependencyConsistency:
              type: number
            semanticCoherence:
              type: number
        improvements:
          type: array
          items:
            type: string
        metadata:
          type: object

    ContextRelevanceResult:
      type: object
      required:
        - id
        - contextNodeId
        - targetContext
        - relevanceScore
        - calculationMethod
        - calculatedAt
        - factors
        - confidence
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        contextNodeId:
          $ref: '#/components/schemas/UUID'
        targetContext:
          type: string
        relevanceScore:
          type: number
          minimum: 0
          maximum: 1
        calculationMethod:
          type: string
          enum: [vector_similarity, dependency_weight, frequency_based, phase_aware, combined]
        calculatedAt:
          type: string
          format: date-time
        factors:
          type: object
          properties:
            vectorSimilarity:
              type: number
            dependencyScore:
              type: number
            frequencyScore:
              type: number
            phaseRelevanceScore:
              type: number
            recencyBonus:
              type: number
        confidence:
          type: number
          minimum: 0
          maximum: 1
        metadata:
          type: object

    ContextCompressionResult:
      type: object
      required:
        - id
        - sourceContextIds
        - compressedContent
        - algorithm
        - originalTokenCount
        - compressedTokenCount
        - compressionRatio
        - qualityPreservation
        - compressedAt
        - settings
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        sourceContextIds:
          type: array
          items:
            $ref: '#/components/schemas/UUID'
        compressedContent:
          type: string
        algorithm:
          type: string
          enum: [semantic_summary, importance_ranking, dependency_focused, hybrid]
        originalTokenCount:
          type: integer
        compressedTokenCount:
          type: integer
        compressionRatio:
          type: number
          minimum: 0
          maximum: 1
        qualityPreservation:
          type: number
          minimum: 0
          maximum: 1
        compressedAt:
          type: string
          format: date-time
        settings:
          type: object
          properties:
            targetRatio:
              type: number
            minQualityThreshold:
              type: number
            phaseSettings:
              type: object
        metadata:
          type: object

    ContextCacheEntry:
      type: object
      required:
        - id
        - cacheKey
        - projectId
        - contextPackage
        - createdAt
        - lastAccessedAt
        - accessCount
        - hitEfficiency
        - expiresAt
        - sizeBytes
        - strategy
        - tags
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        cacheKey:
          type: string
        projectId:
          $ref: '#/components/schemas/UUID'
        contextPackage:
          $ref: '#/components/schemas/ContextPackage'
        createdAt:
          type: string
          format: date-time
        lastAccessedAt:
          type: string
          format: date-time
        accessCount:
          type: integer
        hitEfficiency:
          type: number
        expiresAt:
          type: string
          format: date-time
        sizeBytes:
          type: integer
        strategy:
          type: string
          enum: [lru, relevance_based, frequency_based, project_aware, adaptive]
        tags:
          type: array
          items:
            type: string

    ContextOptimizationResult:
      type: object
      required:
        - requestId
        - optimizedContext
        - metrics
        - appliedOptimizations
        - warnings
        - optimizedAt
      properties:
        requestId:
          $ref: '#/components/schemas/UUID'
        optimizedContext:
          $ref: '#/components/schemas/ContextPackage'
        metrics:
          type: object
          properties:
            processingTime:
              type: number
            tokenReduction:
              type: number
            avgRelevanceScore:
              type: number
            qualityPreservation:
              type: number
            efficiencyScore:
              type: number
        appliedOptimizations:
          type: array
          items:
            type: string
        warnings:
          type: array
          items:
            type: string
        optimizedAt:
          type: string
          format: date-time

    ContextSimilarityMatrix:
      type: object
      required:
        - id
        - projectId
        - contextNodeIds
        - similarityMatrix
        - calculatedAt
        - parameters
        - statistics
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        projectId:
          $ref: '#/components/schemas/UUID'
        contextNodeIds:
          type: array
          items:
            $ref: '#/components/schemas/UUID'
        similarityMatrix:
          type: array
          items:
            type: array
            items:
              type: number
        calculatedAt:
          type: string
          format: date-time
        parameters:
          type: object
          properties:
            similarityThreshold:
              type: number
            embeddingModel:
              type: string
            distanceMetric:
              type: string
        statistics:
          type: object
          properties:
            avgSimilarity:
              type: number
            maxSimilarity:
              type: object
              properties:
                nodeId1:
                  $ref: '#/components/schemas/UUID'
                nodeId2:
                  $ref: '#/components/schemas/UUID'
                score:
                  type: number
            mostDiverse:
              type: object
              properties:
                nodeId:
                  $ref: '#/components/schemas/UUID'
                avgSimilarity:
                  type: number

    ContextIntelligenceProfile:
      type: object
      required:
        - id
        - projectId
        - createdAt
        - lastUpdated
        - learningStats
        - optimizationPreferences
        - performanceMetrics
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        projectId:
          $ref: '#/components/schemas/UUID'
        createdAt:
          type: string
          format: date-time
        lastUpdated:
          type: string
          format: date-time
        learningStats:
          type: object
          properties:
            totalAssessments:
              type: integer
            avgQualityTrend:
              type: array
              items:
                type: number
            topContextTypes:
              type: array
              items:
                type: object
                properties:
                  type:
                    type: string
                  relevanceScore:
                    type: number
                  frequency:
                    type: number
            phasePatterns:
              type: object
              additionalProperties:
                type: object
                properties:
                  avgRelevanceScore:
                    type: number
                  preferredCompressionRatio:
                    type: number
                  optimalCacheSize:
                    type: number
        optimizationPreferences:
          type: object
          properties:
            preferredCompression:
              type: string
            optimalRelevanceThreshold:
              type: number
            preferredCaching:
              type: string
            customRules:
              type: array
              items:
                type: object
                properties:
                  condition:
                    type: string
                  action:
                    type: string
                  confidence:
                    type: number
        performanceMetrics:
          type: object
          properties:
            avgRetrievalTime:
              type: number
            cacheHitRate:
              type: number
            compressionEfficiency:
              type: number
            generationQualityCorrelation:
              type: number
```

## **4. Detailed Business Logic & Validation Rules**

| Rule ID | Rule Description | Implementation Location(s) & Notes |
|---------|------------------|-----------------------------------|
| **CI-01** | Context quality assessments must achieve a minimum score threshold before being used in AI generation to maintain the >95% architectural consistency KPI. | **Backend (Authoritative):** Quality assessment service must validate context quality scores against project-specific thresholds from Configuration Management Module. Contexts below threshold must be flagged for improvement or excluded from generation packages. |
| **CI-02** | Context relevance calculations must prioritize dependency relationships and phase-specific patterns to ensure generated code maintains architectural integrity across the 7-phase methodology. | **Backend (Authoritative):** Relevance calculation service must integrate with Multi-Phase Development Orchestrator to apply phase-specific weighting and with Context Management Engine to access dependency graphs for relationship scoring. |
| **CI-03** | Context compression operations must preserve critical dependency information and architectural patterns while achieving target compression ratios to balance token efficiency with code quality. | **Backend (Authoritative):** Compression service must identify critical dependencies through Context Management Engine and preserve them even if they exceed target compression ratios. Quality preservation score must not fall below configured minimum threshold. |
| **CI-04** | Context cache entries must be invalidated when underlying context nodes are modified to prevent stale context from affecting AI generation quality and architectural consistency. | **Backend (Authoritative):** Cache service must register with Context Management Engine for context modification events and implement automatic cache invalidation. Integration with Logging & Monitoring Service must track cache hit rates to maintain KPI targets. |
| **CI-05** | Context optimization must respect the 3-second retrieval time KPI by implementing early termination when time limits are approached, returning the best available optimization within the constraint. | **Backend (Authoritative):** Optimization service must implement time-bounded algorithms with progressive optimization stages. Must integrate with Performance Monitoring Service to track optimization times and adjust algorithms to meet KPI requirements. |
| **CI-06** | Project context intelligence profiles must learn from AI generation quality feedback to continuously improve relevance scoring and optimization strategies for each specific project. | **Backend (Authoritative):** Profile learning service must integrate with Claude Integration Service to receive generation quality metrics and correlation data. Learning algorithms must update optimization preferences based on successful generation patterns. |
| **CI-07** | Context similarity matrices must be recalculated when significant changes occur to project context to maintain accurate similarity relationships for optimization algorithms. | **Backend (Authoritative):** Similarity matrix service must integrate with Context Management Engine to detect significant context changes (>10% of project context modified) and trigger background recalculation. Results must be cached to avoid performance impact. |
| **CI-08** | Context intelligence operations must integrate with Vector Database Service for semantic operations while maintaining local-first architecture principles and data privacy constraints. | **Backend (Authoritative):** All vector operations must use local Milvus instance through Vector Database Service. No context data may be sent to external services. Embedding operations must use locally hosted sentence transformer model. |
| **CI-09** | Context optimization results must be validated for token count accuracy and quality preservation metrics before being returned to ensure reliable KPI tracking and generation efficiency. | **Backend (Authoritative):** Optimization validation service must verify token counts using same tokenizer as Claude Integration Service and validate quality metrics against original context. Integration with Analytics Service for KPI tracking. |
| **CI-10** | Context intelligence caching strategies must adapt based on project usage patterns and performance metrics to optimize for the specific development workflow of each project. | **Backend (Authoritative):** Adaptive caching service must analyze usage patterns from Context Intelligence Profiles and adjust caching strategies dynamically. Must integrate with Configuration Management Module for cache size limits and retention policies. |

## **5. Developer Task Checklist**

### **Backend Tasks:**
- [ ] Create database migration script for context intelligence tables (`context_quality_assessments`, `context_relevance_results`, `context_compression_results`, `context_cache_entries`, `context_intelligence_profiles`, `context_similarity_matrices`)
- [ ] Implement the `ContextQualityService` class with comprehensive quality assessment algorithms including completeness, clarity, recency, dependency consistency, and semantic coherence scoring
- [ ] Implement the `ContextRelevanceService` class with multiple relevance calculation methods including vector similarity, dependency weighting, frequency analysis, and phase-aware scoring
- [ ] Implement the `ContextCompressionService` class with semantic summarization, importance ranking, dependency-focused, and hybrid compression algorithms
- [ ] Implement the `ContextCacheService` class with intelligent caching strategies including LRU, relevance-based, frequency-based, project-aware, and adaptive caching
- [ ] Implement the `ContextOptimizationService` class that orchestrates quality assessment, relevance calculation, and compression for optimal context packages
- [ ] Implement the `ContextIntelligenceProfileService` class for learning and maintaining project-specific optimization preferences and performance patterns
- [ ] Implement the `ContextSimilarityService` class for generating and maintaining context similarity matrices using vector embeddings
- [ ] Implement all context intelligence API endpoints (`POST /api/v1/context-intelligence/quality/assess`, `POST /api/v1/context-intelligence/relevance/calculate`, `POST /api/v1/context-intelligence/compression/compress`)
- [ ] Implement context optimization endpoint (`POST /api/v1/context-intelligence/optimization/optimize`) with comprehensive constraint handling and time-bounded execution
- [ ] Implement context caching endpoints (`GET`, `POST /api/v1/context-intelligence/cache/retrieve`) with intelligent cache key generation and similarity-based lookup
- [ ] Implement context similarity matrix endpoint (`POST /api/v1/context-intelligence/similarity/matrix`) with efficient matrix calculation and storage
- [ ] Implement context intelligence profile endpoints (`GET`, `PUT /api/v1/context-intelligence/profiles/{projectId}`) with learning algorithm integration
- [ ] Create `ContextIntelligenceRepository` class for efficient storage and retrieval of quality assessments, relevance calculations, and compression results
- [ ] Create `ContextCacheRepository` class with automatic expiry, cleanup, and cache hit rate tracking
- [ ] Create `ContextProfileRepository` class for storing and updating learned optimization preferences and performance metrics
- [ ] Implement integration with Vector Database Service for semantic similarity calculations and embedding operations
- [ ] Implement integration with Configuration Management Module for retrieving quality thresholds, compression settings, and cache configurations
- [ ] Implement integration with Context Management Engine for accessing context nodes, dependency graphs, and modification events
- [ ] Implement integration with Claude Integration Service for token counting, generation quality feedback, and optimization validation
- [ ] Implement integration with Logging & Monitoring Service for performance tracking, cache hit rate monitoring, and KPI reporting
- [ ] Create comprehensive unit tests for all service classes with mock implementations of dependent modules and vector operations
- [ ] Create integration tests for context intelligence workflows including quality assessment, relevance calculation, compression, and optimization scenarios
- [ ] Implement performance benchmarks for optimization algorithms to ensure <3 second processing time compliance
- [ ] Create background services for cache cleanup, profile learning updates, and similarity matrix maintenance

### **Frontend Tasks:**
- [ ] Create `ContextIntelligenceProvider` React context for accessing context intelligence operations and cached results
- [ ] Implement `useContextQuality` hook for context quality assessment with real-time quality scoring and improvement suggestions
- [ ] Implement `useContextRelevance` hook for relevance calculation with factor breakdown and ranking capabilities
- [ ] Implement `useContextOptimization` hook for context optimization with progress tracking and result visualization
- [ ] Create `ContextQualityDashboard` component for displaying project-wide context quality metrics with trend analysis and improvement recommendations
- [ ] Implement `ContextRelevanceVisualizer` component for showing relevance scores with interactive factor breakdown and sorting capabilities
- [ ] Create `ContextCompressionPanel` component for compression settings, algorithm selection, and compression result analysis
- [ ] Implement `ContextOptimizationInterface` component for configuring optimization objectives, constraints, and monitoring optimization progress
- [ ] Create `ContextCacheManager` component for cache statistics, manual cache operations, and cache strategy configuration
- [ ] Implement `ContextSimilarityExplorer` component for visualizing context relationships with interactive similarity matrix and clustering views
- [ ] Create `ContextIntelligenceProfile` component for displaying learned project patterns and allowing manual preference adjustments
- [ ] Implement `ContextAnalytics` component for comprehensive context intelligence metrics including quality trends, cache performance, and optimization effectiveness
- [ ] Create context intelligence service functions in the API client (`contextIntelligenceService.ts`) for all context intelligence endpoints
- [ ] Implement context quality monitoring widget for the main dashboard with quality alerts and recommendations
- [ ] Add context optimization suggestions to context explorer with one-click optimization actions
- [ ] Create context intelligence settings panel integrated with Configuration Management for threshold and strategy configuration
- [ ] Implement context cache performance monitoring with real-time hit rate display and cache optimization suggestions
- [ ] Add context similarity visualization to context relationship graphs with clustering and grouping capabilities
- [ ] Create context intelligence debugging tools for developers including relevance factor analysis and compression impact assessment
- [ ] Implement context optimization workflow integration with AI generation interface for seamless optimization before generation
- [ ] Add context intelligence metrics to project health dashboard with quality score trends and optimization recommendations
- [ ] Create context intelligence export capabilities for sharing optimization profiles and quality assessments
- [ ] Implement context intelligence learning feedback interface for manually correcting relevance scores and quality assessments
- [ ] Add context intelligence performance alerts for cache misses, slow optimizations, and quality degradation warnings



========================================================================================


# Advanced Context Management Engine - Technical Specification

## **1. Module Overview**

**Purpose:** The Advanced Context Management Engine serves as the core context orchestration system for ReadyAI, responsible for managing vector-based context storage, dependency tracking, intelligent summarization, relevance scoring, and hierarchical context organization across large projects. This module acts as the central nervous system that maintains semantic relationships between code elements, enables sub-3-second context retrieval as required by the Context Management Efficiency KPI, and provides the foundational context intelligence that powers the AI generation workflows throughout the 7-phase development methodology.

**Dependencies & Interactions:** This module depends on the Vector Database Service for Milvus operations and semantic similarity calculations, the File System Management Module for reading source files and monitoring file system changes, and the AI Provider Management (Claude Integration Service) for generating vector embeddings and context streaming operations. It interacts with the Configuration Management Module to obtain context management settings, compression levels, and relevance thresholds. The module integrates extensively with the Context Intelligence Module to provide raw context data for quality assessment and optimization, with the Project Management Module to maintain project-specific context graphs, and with the Multi-Phase Development Orchestrator to provide phase-aware context selection. It also coordinates with the Logging & Monitoring Service to track context operations, performance metrics, and usage analytics that support the ReadyAI KPIs.

## **2. Module-Specific Type Additions (`types.advancedContextManagement.ts`)**

```typescript
/**
 * Advanced Context Management Engine Types
 * Extends foundational types with context management-specific interfaces
 */

/** Context synchronization status */
export type ContextSyncStatus = 'synced' | 'pending' | 'syncing' | 'failed' | 'outdated';

/** Context extraction methods */
export type ContextExtractionMethod = 'full_parse' | 'semantic_chunks' | 'dependency_focused' | 'incremental';

/** Context node update operations */
export type ContextUpdateOperation = 'create' | 'update' | 'delete' | 'move' | 'merge';

/** Context hierarchy levels for large project organization */
export type ContextHierarchyLevel = 'project' | 'module' | 'component' | 'file' | 'symbol';

/** Context extraction result from file parsing */
export interface ContextExtractionResult {
  /** Unique extraction identifier */
  id: UUID;
  /** Source file path */
  filePath: string;
  /** Project identifier */
  projectId: UUID;
  /** Extraction method used */
  method: ContextExtractionMethod;
  /** Extracted context nodes */
  contextNodes: ContextNode[];
  /** Discovered dependencies */
  dependencies: ContextDependency[];
  /** Extraction metadata */
  extractionMetadata: {
    /** Lines of code analyzed */
    linesAnalyzed: number;
    /** Processing time in milliseconds */
    processingTime: number;
    /** Language detected */
    language: string;
    /** Parser used */
    parser: string;
    /** Confidence score for extraction quality */
    confidence: number;
  };
  /** Extraction timestamp */
  extractedAt: string; // ISO 8601 format
}

/** Context dependency relationship */
export interface ContextDependency {
  /** Unique dependency identifier */
  id: UUID;
  /** Source context node */
  sourceNodeId: UUID;
  /** Target context node */
  targetNodeId: UUID;
  /** Dependency type */
  type: DependencyEdge['type'];
  /** Dependency strength (0-1) */
  strength: number;
  /** Whether dependency is direct or inferred */
  isDirect: boolean;
  /** Additional dependency metadata */
  metadata: Record<string, any>;
}

/** Context hierarchy node for project organization */
export interface ContextHierarchyNode {
  /** Unique hierarchy node identifier */
  id: UUID;
  /** Project identifier */
  projectId: UUID;
  /** Hierarchy level */
  level: ContextHierarchyLevel;
  /** Node name/identifier */
  name: string;
  /** Parent hierarchy node */
  parentId?: UUID;
  /** Child hierarchy nodes */
  children: UUID[];
  /** Associated context nodes */
  contextNodeIds: UUID[];
  /** Node path from root */
  path: string;
  /** Node metadata */
  metadata: Record<string, any>;
  /** Creation timestamp */
  createdAt: string; // ISO 8601 format
  /** Last update timestamp */
  lastUpdated: string; // ISO 8601 format
}

/** Context synchronization operation */
export interface ContextSyncOperation {
  /** Unique sync operation identifier */
  id: UUID;
  /** Project identifier */
  projectId: UUID;
  /** Sync operation type */
  operation: ContextUpdateOperation;
  /** Target context nodes */
  contextNodeIds: UUID[];
  /** Sync status */
  status: ContextSyncStatus;
  /** Operation started timestamp */
  startedAt: string; // ISO 8601 format
  /** Operation completed timestamp */
  completedAt?: string; // ISO 8601 format
  /** Sync result details */
  result?: {
    /** Successfully synced nodes */
    successCount: number;
    /** Failed sync nodes */
    failureCount: number;
    /** Error details */
    errors: string[];
    /** Performance metrics */
    metrics: {
      processingTime: number;
      vectorOperations: number;
      databaseOperations: number;
    };
  };
}

/** Context search query parameters */
export interface ContextSearchQuery {
  /** Search query text */
  query: string;
  /** Project identifier filter */
  projectId?: UUID;
  /** Context types to include */
  contextTypes?: ContextType[];
  /** Similarity threshold (0-1) */
  similarityThreshold?: number;
  /** Maximum results to return */
  limit?: number;
  /** Result offset for pagination */
  offset?: number;
  /** Phase-specific filtering */
  phaseFilter?: PhaseType;
  /** Hierarchy level filtering */
  hierarchyLevel?: ContextHierarchyLevel;
  /** Include dependency information */
  includeDependencies?: boolean;
  /** Boost recent contexts */
  boostRecent?: boolean;
}

/** Context search result */
export interface ContextSearchResult {
  /** Search query identifier */
  queryId: UUID;
  /** Total matching results */
  totalResults: number;
  /** Returned context nodes with scores */
  results: Array<{
    /** Context node */
    contextNode: ContextNode;
    /** Similarity score */
    score: number;
    /** Match highlights */
    highlights: string[];
    /** Related dependencies */
    dependencies?: ContextDependency[];
  }>;
  /** Search performance metrics */
  searchMetrics: {
    /** Search execution time */
    executionTime: number;
    /** Vector similarity operations */
    vectorOps: number;
    /** Database queries executed */
    dbQueries: number;
  };
  /** Search timestamp */
  searchedAt: string; // ISO 8601 format
}

/** Context batch operation request */
export interface ContextBatchOperation {
  /** Unique batch operation identifier */
  id: UUID;
  /** Project identifier */
  projectId: UUID;
  /** Batch operation type */
  operation: ContextUpdateOperation;
  /** Target context specifications */
  targets: Array<{
    /** Context node ID (for updates/deletes) */
    contextNodeId?: UUID;
    /** File path (for creates/updates) */
    filePath?: string;
    /** Context content (for creates/updates) */
    content?: string;
    /** Context metadata */
    metadata?: Record<string, any>;
  }>;
  /** Batch processing options */
  options: {
    /** Process in parallel */
    parallel?: boolean;
    /** Skip validation */
    skipValidation?: boolean;
    /** Update dependencies */
    updateDependencies?: boolean;
    /** Force overwrite */
    forceOverwrite?: boolean;
  };
  /** Batch operation timestamp */
  createdAt: string; // ISO 8601 format
}

/** Context validation result */
export interface ContextValidationResult {
  /** Validation identifier */
  id: UUID;
  /** Context node being validated */
  contextNodeId: UUID;
  /** Validation status */
  isValid: boolean;
  /** Validation issues found */
  issues: Array<{
    /** Issue type */
    type: 'warning' | 'error' | 'info';
    /** Issue message */
    message: string;
    /** Suggested fix */
    suggestion?: string;
  }>;
  /** Validation metrics */
  metrics: {
    /** Content completeness score */
    completeness: number;
    /** Dependency consistency score */
    dependencyConsistency: number;
    /** Embedding quality score */
    embeddingQuality: number;
  };
  /** Validation timestamp */
  validatedAt: string; // ISO 8601 format
}

/** Context compression settings */
export interface ContextCompressionSettings {
  /** Target compression ratio */
  targetRatio: number;
  /** Minimum quality threshold */
  minQuality: number;
  /** Preserve critical dependencies */
  preserveCritical: boolean;
  /** Compression algorithm */
  algorithm: 'semantic' | 'frequency' | 'importance' | 'hybrid';
  /** Phase-specific settings */
  phaseSettings?: Record<PhaseType, Partial<ContextCompressionSettings>>;
}
```

## **3. API Endpoint Specification (OpenAPI `paths` block)**

```yaml
paths:
  /api/v1/context:
    get:
      tags:
        - Context Management
      summary: Query context nodes
      description: Retrieves context nodes with filtering, pagination, and hierarchical organization options
      security:
        - localAuth: []
      parameters:
        - name: projectId
          in: query
          description: Filter by project ID
          required: false
          schema:
            $ref: '#/components/schemas/UUID'
        - name: contextTypes
          in: query
          description: Comma-separated context types to filter by
          required: false
          schema:
            type: string
            example: "file,module,dependency"
        - name: hierarchyLevel
          in: query
          description: Filter by hierarchy level
          required: false
          schema:
            type: string
            enum: [project, module, component, file, symbol]
        - name: parentId
          in: query
          description: Filter by parent hierarchy node
          required: false
          schema:
            $ref: '#/components/schemas/UUID'
        - name: includeContent
          in: query
          description: Include full content in response
          required: false
          schema:
            type: boolean
            default: false
        - name: includeDependencies
          in: query
          description: Include dependency information
          required: false
          schema:
            type: boolean
            default: false
        - name: limit
          in: query
          description: Maximum number of results
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 1000
            default: 100
        - name: offset
          in: query
          description: Offset for pagination
          required: false
          schema:
            type: integer
            minimum: 0
            default: 0
      responses:
        '200':
          description: Context nodes retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          contextNodes:
                            type: array
                            items:
                              $ref: '#/components/schemas/ContextNode'
                          hierarchyNodes:
                            type: array
                            items:
                              $ref: '#/components/schemas/ContextHierarchyNode'
                          totalCount:
                            type: integer
                          hasMore:
                            type: boolean

    post:
      tags:
        - Context Management
      summary: Create context node
      description: Creates a new context node with vector embedding generation and dependency tracking
      security:
        - localAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                projectId:
                  $ref: '#/components/schemas/UUID'
                type:
                  type: string
                  enum: [file, module, dependency, pattern, artifact]
                path:
                  type: string
                  minLength: 1
                content:
                  type: string
                  minLength: 1
                parentHierarchyId:
                  $ref: '#/components/schemas/UUID'
                metadata:
                  type: object
                extractDependencies:
                  type: boolean
                  default: true
                generateEmbedding:
                  type: boolean
                  default: true
              required:
                - projectId
                - type
                - path
                - content
      responses:
        '201':
          description: Context node created successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          contextNode:
                            $ref: '#/components/schemas/ContextNode'
                          extractionResult:
                            $ref: '#/components/schemas/ContextExtractionResult'

  /api/v1/context/{contextNodeId}:
    get:
      tags:
        - Context Management
      summary: Get specific context node
      description: Retrieves detailed information about a specific context node including dependencies and hierarchy
      security:
        - localAuth: []
      parameters:
        - name: contextNodeId
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
        - name: includeContent
          in: query
          description: Include full content in response
          required: false
          schema:
            type: boolean
            default: true
        - name: includeDependencies
          in: query
          description: Include dependency information
          required: false
          schema:
            type: boolean
            default: true
        - name: includeHierarchy
          in: query
          description: Include hierarchy information
          required: false
          schema:
            type: boolean
            default: true
      responses:
        '200':
          description: Context node retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          contextNode:
                            $ref: '#/components/schemas/ContextNode'
                          dependencies:
                            type: array
                            items:
                              $ref: '#/components/schemas/ContextDependency'
                          hierarchyPath:
                            type: array
                            items:
                              $ref: '#/components/schemas/ContextHierarchyNode'
        '404':
          description: Context node not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

    put:
      tags:
        - Context Management
      summary: Update context node
      description: Updates an existing context node, regenerating embeddings and updating dependencies as needed
      security:
        - localAuth: []
      parameters:
        - name: contextNodeId
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                content:
                  type: string
                path:
                  type: string
                metadata:
                  type: object
                regenerateEmbedding:
                  type: boolean
                  default: true
                updateDependencies:
                  type: boolean
                  default: true
      responses:
        '200':
          description: Context node updated successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          contextNode:
                            $ref: '#/components/schemas/ContextNode'
                          syncOperation:
                            $ref: '#/components/schemas/ContextSyncOperation'

    delete:
      tags:
        - Context Management
      summary: Delete context node
      description: Deletes a context node and updates dependent relationships
      security:
        - localAuth: []
      parameters:
        - name: contextNodeId
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
        - name: updateDependencies
          in: query
          description: Update dependent context nodes
          required: false
          schema:
            type: boolean
            default: true
      responses:
        '200':
          description: Context node deleted successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'

  /api/v1/context/search:
    post:
      tags:
        - Context Management
      summary: Semantic context search
      description: Performs semantic search across context nodes using vector similarity and relevance scoring
      security:
        - localAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                query:
                  type: string
                  minLength: 1
                projectId:
                  $ref: '#/components/schemas/UUID'
                contextTypes:
                  type: array
                  items:
                    type: string
                    enum: [file, module, dependency, pattern, artifact]
                similarityThreshold:
                  type: number
                  minimum: 0
                  maximum: 1
                  default: 0.7
                limit:
                  type: integer
                  minimum: 1
                  maximum: 100
                  default: 20
                offset:
                  type: integer
                  minimum: 0
                  default: 0
                phaseFilter:
                  $ref: '#/components/schemas/PhaseType'
                hierarchyLevel:
                  type: string
                  enum: [project, module, component, file, symbol]
                includeDependencies:
                  type: boolean
                  default: false
                boostRecent:
                  type: boolean
                  default: true
              required:
                - query
      responses:
        '200':
          description: Search completed successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/ContextSearchResult'

  /api/v1/context/extract:
    post:
      tags:
        - Context Management
      summary: Extract context from file
      description: Extracts context nodes from a source file using various parsing methods and creates vector embeddings
      security:
        - localAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                projectId:
                  $ref: '#/components/schemas/UUID'
                filePath:
                  type: string
                  minLength: 1
                method:
                  type: string
                  enum: [full_parse, semantic_chunks, dependency_focused, incremental]
                  default: full_parse
                language:
                  type: string
                parentHierarchyId:
                  $ref: '#/components/schemas/UUID'
                extractDependencies:
                  type: boolean
                  default: true
                updateExisting:
                  type: boolean
                  default: true
              required:
                - projectId
                - filePath
      responses:
        '200':
          description: Context extraction completed successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/ContextExtractionResult'

  /api/v1/context/batch:
    post:
      tags:
        - Context Management
      summary: Batch context operations
      description: Performs batch operations on multiple context nodes for efficient bulk processing
      security:
        - localAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                projectId:
                  $ref: '#/components/schemas/UUID'
                operation:
                  type: string
                  enum: [create, update, delete, move, merge]
                targets:
                  type: array
                  items:
                    type: object
                    properties:
                      contextNodeId:
                        $ref: '#/components/schemas/UUID'
                      filePath:
                        type: string
                      content:
                        type: string
                      metadata:
                        type: object
                  minItems: 1
                  maxItems: 100
                options:
                  type: object
                  properties:
                    parallel:
                      type: boolean
                      default: true
                    skipValidation:
                      type: boolean
                      default: false
                    updateDependencies:
                      type: boolean
                      default: true
                    forceOverwrite:
                      type: boolean
                      default: false
              required:
                - projectId
                - operation
                - targets
      responses:
        '200':
          description: Batch operation completed successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/ContextBatchOperation'

  /api/v1/context/sync/{projectId}:
    post:
      tags:
        - Context Management
      summary: Synchronize project context
      description: Synchronizes all context nodes for a project with the file system and updates vector embeddings
      security:
        - localAuth: []
      parameters:
        - name: projectId
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              properties:
                syncTypes:
                  type: array
                  items:
                    type: string
                    enum: [file, module, dependency, pattern, artifact]
                forceRebuild:
                  type: boolean
                  default: false
                updateEmbeddings:
                  type: boolean
                  default: true
                validateAfterSync:
                  type: boolean
                  default: true
      responses:
        '200':
          description: Context synchronization started successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/ContextSyncOperation'

  /api/v1/context/hierarchy/{projectId}:
    get:
      tags:
        - Context Management
      summary: Get project context hierarchy
      description: Retrieves the hierarchical organization of context nodes for a project
      security:
        - localAuth: []
      parameters:
        - name: projectId
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
        - name: level
          in: query
          description: Filter by hierarchy level
          required: false
          schema:
            type: string
            enum: [project, module, component, file, symbol]
        - name: expandAll
          in: query
          description: Expand all hierarchy levels
          required: false
          schema:
            type: boolean
            default: false
      responses:
        '200':
          description: Context hierarchy retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          hierarchyNodes:
                            type: array
                            items:
                              $ref: '#/components/schemas/ContextHierarchyNode'
                          rootNodes:
                            type: array
                            items:
                              $ref: '#/components/schemas/UUID'

  /api/v1/context/validate:
    post:
      tags:
        - Context Management
      summary: Validate context nodes
      description: Validates context nodes for completeness, consistency, and embedding quality
      security:
        - localAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                contextNodeIds:
                  type: array
                  items:
                    $ref: '#/components/schemas/UUID'
                  minItems: 1
                  maxItems: 100
                projectId:
                  $ref: '#/components/schemas/UUID'
                validationRules:
                  type: array
                  items:
                    type: string
                    enum: [completeness, dependency_consistency, embedding_quality, hierarchy_integrity]
                  default: [completeness, dependency_consistency, embedding_quality]
              required:
                - contextNodeIds
      responses:
        '200':
          description: Context validation completed successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          validationResults:
                            type: array
                            items:
                              $ref: '#/components/schemas/ContextValidationResult'
                          overallStatus:
                            type: string
                            enum: [valid, warning, error]

components:
  schemas:
    ContextExtractionResult:
      type: object
      required:
        - id
        - filePath
        - projectId
        - method
        - contextNodes
        - dependencies
        - extractionMetadata
        - extractedAt
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        filePath:
          type: string
        projectId:
          $ref: '#/components/schemas/UUID'
        method:
          type: string
          enum: [full_parse, semantic_chunks, dependency_focused, incremental]
        contextNodes:
          type: array
          items:
            $ref: '#/components/schemas/ContextNode'
        dependencies:
          type: array
          items:
            $ref: '#/components/schemas/ContextDependency'
        extractionMetadata:
          type: object
          properties:
            linesAnalyzed:
              type: integer
            processingTime:
              type: number
            language:
              type: string
            parser:
              type: string
            confidence:
              type: number
        extractedAt:
          type: string
          format: date-time

    ContextDependency:
      type: object
      required:
        - id
        - sourceNodeId
        - targetNodeId
        - type
        - strength
        - isDirect
        - metadata
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        sourceNodeId:
          $ref: '#/components/schemas/UUID'
        targetNodeId:
          $ref: '#/components/schemas/UUID'
        type:
          type: string
          enum: [import, extends, implements, uses]
        strength:
          type: number
          minimum: 0
          maximum: 1
        isDirect:
          type: boolean
        metadata:
          type: object

    ContextHierarchyNode:
      type: object
      required:
        - id
        - projectId
        - level
        - name
        - children
        - contextNodeIds
        - path
        - metadata
        - createdAt
        - lastUpdated
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        projectId:
          $ref: '#/components/schemas/UUID'
        level:
          type: string
          enum: [project, module, component, file, symbol]
        name:
          type: string
        parentId:
          $ref: '#/components/schemas/UUID'
        children:
          type: array
          items:
            $ref: '#/components/schemas/UUID'
        contextNodeIds:
          type: array
          items:
            $ref: '#/components/schemas/UUID'
        path:
          type: string
        metadata:
          type: object
        createdAt:
          type: string
          format: date-time
        lastUpdated:
          type: string
          format: date-time

    ContextSyncOperation:
      type: object
      required:
        - id
        - projectId
        - operation
        - contextNodeIds
        - status
        - startedAt
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        projectId:
          $ref: '#/components/schemas/UUID'
        operation:
          type: string
          enum: [create, update, delete, move, merge]
        contextNodeIds:
          type: array
          items:
            $ref: '#/components/schemas/UUID'
        status:
          type: string
          enum: [synced, pending, syncing, failed, outdated]
        startedAt:
          type: string
          format: date-time
        completedAt:
          type: string
          format: date-time
        result:
          type: object
          properties:
            successCount:
              type: integer
            failureCount:
              type: integer
            errors:
              type: array
              items:
                type: string
            metrics:
              type: object
              properties:
                processingTime:
                  type: number
                vectorOperations:
                  type: integer
                databaseOperations:
                  type: integer

    ContextSearchResult:
      type: object
      required:
        - queryId
        - totalResults
        - results
        - searchMetrics
        - searchedAt
      properties:
        queryId:
          $ref: '#/components/schemas/UUID'
        totalResults:
          type: integer
        results:
          type: array
          items:
            type: object
            properties:
              contextNode:
                $ref: '#/components/schemas/ContextNode'
              score:
                type: number
              highlights:
                type: array
                items:
                  type: string
              dependencies:
                type: array
                items:
                  $ref: '#/components/schemas/ContextDependency'
        searchMetrics:
          type: object
          properties:
            executionTime:
              type: number
            vectorOps:
              type: integer
            dbQueries:
              type: integer
        searchedAt:
          type: string
          format: date-time

    ContextBatchOperation:
      type: object
      required:
        - id
        - projectId
        - operation
        - targets
        - options
        - createdAt
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        projectId:
          $ref: '#/components/schemas/UUID'
        operation:
          type: string
          enum: [create, update, delete, move, merge]
        targets:
          type: array
          items:
            type: object
            properties:
              contextNodeId:
                $ref: '#/components/schemas/UUID'
              filePath:
                type: string
              content:
                type: string
              metadata:
                type: object
        options:
          type: object
          properties:
            parallel:
              type: boolean
            skipValidation:
              type: boolean
            updateDependencies:
              type: boolean
            forceOverwrite:
              type: boolean
        createdAt:
          type: string
          format: date-time

    ContextValidationResult:
      type: object
      required:
        - id
        - contextNodeId
        - isValid
        - issues
        - metrics
        - validatedAt
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        contextNodeId:
          $ref: '#/components/schemas/UUID'
        isValid:
          type: boolean
        issues:
          type: array
          items:
            type: object
            properties:
              type:
                type: string
                enum: [warning, error, info]
              message:
                type: string
              suggestion:
                type: string
        metrics:
          type: object
          properties:
            completeness:
              type: number
            dependencyConsistency:
              type: number
            embeddingQuality:
              type: number
        validatedAt:
          type: string
          format: date-time
```

## **4. Detailed Business Logic & Validation Rules**

| Rule ID | Rule Description | Implementation Location(s) & Notes |
|---------|------------------|-----------------------------------|
| **ACM-01** | Context nodes must maintain referential integrity with their project and cannot exist without a valid project association to ensure data consistency across the system. | **Backend (Authoritative):** Context service must validate project existence through Project Management Module before creating or updating context nodes. Foreign key constraints must be enforced at database level. |
| **ACM-02** | Vector embeddings must be generated using the sentence-transformers/all-mpnet-base-v2 model as specified in Core Contracts to ensure consistent semantic similarity calculations across all context operations. | **Backend (Authoritative):** Embedding generation service must use the exact model specified in Configuration Management Module. All embedding operations must be routed through AI Provider Management for consistency. |
| **ACM-03** | Context dependency relationships must be validated to prevent circular dependencies that could cause infinite loops during context traversal and dependency graph construction. | **Backend (Authoritative):** Dependency validation service must implement cycle detection algorithms before creating new dependencies. Integration with existing DependencyGraph validation from foundational types. |
| **ACM-04** | Context synchronization must coordinate with File System Management Module to detect file changes and automatically update context nodes to maintain accuracy with source files. | **Backend (Authoritative):** Sync service must register file watchers through File System Management Module and process file change events to trigger context updates. Real-time sync required for KPI compliance. |
| **ACM-05** | Context search operations must achieve sub-3-second response times as required by the Context Management Efficiency KPI, implementing caching and indexing strategies to meet performance requirements. | **Backend (Authoritative):** Search service must implement vector indexing through Vector Database Service, result caching, and performance monitoring through Logging & Monitoring Service. Automatic alerting if KPI threshold exceeded. |
| **ACM-06** | Context extraction from files must respect the workspace isolation levels configured in File System Management Module to prevent unauthorized access to files outside project boundaries. | **Backend (Authoritative):** Extraction service must validate file paths through File System Management Module's workspace validation before processing any files. Security boundary enforcement is critical. |
| **ACM-07** | Context hierarchy must maintain structural integrity where child nodes cannot exist without valid parent nodes, and hierarchy path calculations must be consistent across the system. | **Backend (Authoritative):** Hierarchy service must enforce parent-child relationships through database constraints and implement path calculation algorithms that handle hierarchy restructuring operations. |
| **ACM-08** | Context batch operations must implement transactional consistency to ensure that partial failures don't leave the context graph in an inconsistent state, with proper rollback capabilities. | **Backend (Authoritative):** Batch service must use database transactions for all batch operations. Integration with Vector Database Service must support transactional operations or implement compensation patterns. |
| **ACM-09** | Context validation must integrate with Context Intelligence Module to ensure context quality meets the project-specific thresholds and architectural consistency requirements. | **Backend (Authoritative):** Validation service must query Context Intelligence Module for quality thresholds and apply project-specific validation rules. Results must be logged through Logging & Monitoring Service. |
| **ACM-10** | Context compression operations must preserve critical dependency relationships and semantic meaning while reducing token count to optimize AI generation performance within configured limits. | **Backend (Authoritative):** Compression service must coordinate with Context Intelligence Module for compression algorithms and maintain dependency integrity through dependency validation rules (ACM-03). |

## **5. Developer Task Checklist**

### **Backend Tasks:**
- [ ] Create database migration script for context management tables (`context_nodes`, `context_dependencies`, `context_hierarchy_nodes`, `context_sync_operations`, `context_extraction_results`)
- [ ] Implement the `ContextManagementService` class with comprehensive CRUD operations for context nodes including vector embedding integration
- [ ] Implement the `ContextExtractionService` class for parsing source files and extracting semantic context using Tree-sitter integration
- [ ] Implement the `ContextDependencyService` class for managing dependency relationships with cycle detection and validation
- [ ] Implement the `ContextHierarchyService` class for maintaining hierarchical organization of context nodes across project levels
- [ ] Implement the `ContextSyncService` class for real-time synchronization with file system changes and maintaining context accuracy
- [ ] Implement the `ContextSearchService` class with vector similarity search and relevance scoring to meet <3 second KPI requirements
- [ ] Implement all context CRUD endpoints (`GET`, `POST /api/v1/context`, `GET`, `PUT`, `DELETE /api/v1/context/{id}`) with comprehensive validation
- [ ] Implement context search endpoint (`POST /api/v1/context/search`) with advanced filtering and semantic similarity matching
- [ ] Implement context extraction endpoint (`POST /api/v1/context/extract`) with support for multiple parsing methods and languages
- [ ] Implement batch operations endpoint (`POST /api/v1/context/batch`) with transactional consistency and parallel processing
- [ ] Implement context synchronization endpoint (`POST /api/v1/context/sync/{projectId}`) with real-time file system integration
- [ ] Implement context hierarchy endpoint (`GET /api/v1/context/hierarchy/{projectId}`) with expandable tree structure
- [ ] Implement context validation endpoint (`POST /api/v1/context/validate`) with multiple validation rule support
- [ ] Create `ContextRepository` class for efficient database operations with proper indexing on projectId, type, path, and relevanceScore
- [ ] Create `ContextDependencyRepository` class for dependency graph operations with cycle detection and relationship management
- [ ] Create `ContextHierarchyRepository` class for hierarchy operations with path calculation and parent-child relationship management
- [ ] Implement integration with Vector Database Service for embedding storage, similarity search, and vector operations
- [ ] Implement integration with File System Management Module for file reading, change detection, and workspace validation
- [ ] Implement integration with AI Provider Management for embedding generation and context streaming operations
- [ ] Implement integration with Configuration Management Module for context settings, compression levels, and thresholds
- [ ] Implement integration with Logging & Monitoring Service for context operation tracking and performance metrics
- [ ] Create comprehensive unit tests for all service classes with mock implementations of dependent modules
- [ ] Create integration tests for context workflows including extraction, dependency tracking, and synchronization
- [ ] Implement performance optimization for vector search operations to meet <3 second KPI requirement
- [ ] Create background services for automated context synchronization and maintenance tasks

### **Frontend Tasks:**
- [ ] Create `ContextManagementProvider` React context for context state management and operations
- [ ] Implement `useContextNodes` hook for context node management with real-time synchronization and caching
- [ ] Implement `useContextSearch` hook for semantic search functionality with debouncing and result caching
- [ ] Implement `useContextHierarchy` hook for hierarchical context navigation with tree expansion and filtering
- [ ] Create `ContextExplorer` component for browsing and navigating project context with hierarchical tree view
- [ ] Implement `ContextNodeDetail` component for displaying detailed context information with dependencies and metadata
- [ ] Create `ContextSearchInterface` component for semantic search with advanced filtering and result highlighting
- [ ] Implement `ContextDependencyGraph` component for visualizing context relationships and dependencies
- [ ] Create `ContextSyncStatus` component for displaying synchronization status and progress indicators
- [ ] Implement `ContextValidation` component for showing validation results and quality metrics
- [ ] Create `ContextExtraction` component for manual context extraction from files with method selection
- [ ] Implement `ContextBatchOperations` component for bulk context management operations
- [ ] Create context management service functions in the API client (`contextService.ts`) for all context endpoints
- [ ] Implement context search interface with real-time search suggestions and result ranking
- [ ] Add context navigation sidebar with hierarchical project structure and quick access filters
- [ ] Create context quality indicators throughout the UI showing validation status and health metrics
- [ ] Implement context relationship visualization with interactive dependency graphs
- [ ] Add context synchronization monitoring with real-time status updates and error reporting
- [ ] Create context extraction workflow with file selection and parsing method configuration
- [ ] Implement context batch operation interface with progress tracking and rollback capabilities
- [ ] Add context performance monitoring dashboard showing search times and cache hit rates
- [ ] Create context debugging tools for developers including dependency analysis and quality assessment
- [ ] Implement context export/import functionality for sharing context data between projects
- [ ] Add context optimization suggestions based on Context Intelligence Module recommendations



========================================================================================


# Claude Integration Service - Technical Specification

## **1. Module Overview**

**Purpose:** The Claude Integration Service serves as the centralized AI provider interface for the entire ReadyAI application, managing native OpenRouter integration with Claude Sonnet 4, extended thinking mode processing, intelligent context streaming, and comprehensive response quality analysis. This module handles all AI-powered code generation requests, optimizes token usage, implements robust error recovery mechanisms, and provides detailed usage analytics to support the local-first architecture while ensuring reliable access to Claude's advanced reasoning capabilities for the 7-phase development methodology.

**Dependencies & Interactions:** This module depends on the Configuration Management Module to obtain OpenRouter API keys, AI provider settings, extended thinking mode configurations, and token usage limits. It interacts with the Context Management Engine to receive optimized context packages and provide feedback on context effectiveness for quality improvements. The module integrates with the Logging & Monitoring Service to track AI generation performance, token usage metrics, error rates, and response quality analytics that support ReadyAI KPIs for development velocity and code quality consistency. It provides AI generation services that are consumed by the Multi-Phase Development Orchestrator for phase-specific code generation, the Code Generation Engine for context-aware code creation, and the Quality Assurance Orchestrator for AI-powered debugging and correction loops.

## **2. Module-Specific Type Additions (`types.claudeIntegration.ts`)**

```typescript
/**
 * Claude Integration Service Module Types
 * Extends foundational types with Claude AI-specific interfaces
 */

/** Claude model variants supported by OpenRouter */
export type ClaudeModelVariant = 
  | 'claude-3-5-sonnet-20241022'
  | 'claude-3-5-sonnet-20240620'
  | 'claude-3-opus-20240229'
  | 'claude-3-haiku-20240307';

/** Extended thinking mode configuration levels */
export type ExtendedThinkingLevel = 'disabled' | 'standard' | 'detailed' | 'comprehensive';

/** Generation request priority levels */
export type GenerationPriority = 'low' | 'normal' | 'high' | 'critical';

/** Response quality assessment levels */
export type ResponseQuality = 'excellent' | 'good' | 'acceptable' | 'poor' | 'failed';

/** Token usage optimization strategies */
export type TokenOptimizationStrategy = 'speed' | 'quality' | 'balanced' | 'cost_effective';

/** Context streaming modes */
export type ContextStreamingMode = 'disabled' | 'incremental' | 'adaptive' | 'full_stream';

/** Claude API request configuration */
export interface ClaudeRequestConfig {
  /** Claude model variant to use */
  model: ClaudeModelVariant;
  /** Maximum tokens to generate */
  maxTokens: number;
  /** Temperature for response randomness (0.0-1.0) */
  temperature: number;
  /** Top-p nucleus sampling parameter */
  topP: number;
  /** Extended thinking mode level */
  extendedThinking: ExtendedThinkingLevel;
  /** Context streaming configuration */
  streaming: ContextStreamingMode;
  /** Token optimization strategy */
  optimizationStrategy: TokenOptimizationStrategy;
  /** Request timeout in milliseconds */
  timeout: number;
  /** Whether to include thinking process in response */
  includeThinking: boolean;
}

/** Claude API request payload */
export interface ClaudeApiRequest {
  /** Unique request identifier */
  id: UUID;
  /** Associated project identifier */
  projectId?: UUID;
  /** Current development phase */
  phase?: PhaseType;
  /** Generation request priority */
  priority: GenerationPriority;
  /** Request configuration */
  config: ClaudeRequestConfig;
  /** System prompt for Claude */
  systemPrompt: string;
  /** User message/prompt */
  userPrompt: string;
  /** Context data for generation */
  contextData?: {
    /** Relevant context nodes */
    nodes: any[]; // References ContextNode from foundational types
    /** Dependency information */
    dependencies: any[]; // References DependencyGraph from foundational types
    /** Phase-specific context */
    phaseContext: Record<string, any>;
  };
  /** Request metadata */
  metadata: {
    /** Source component making the request */
    source: string;
    /** User session identifier */
    sessionId?: string;
    /** Request correlation ID */
    correlationId?: string;
    /** Additional request context */
    additionalContext?: Record<string, any>;
  };
  /** Request creation timestamp */
  createdAt: string; // ISO 8601 format
}

/** Claude API response */
export interface ClaudeApiResponse {
  /** Request identifier this response belongs to */
  requestId: UUID;
  /** Response success status */
  success: boolean;
  /** Generated content */
  content?: string;
  /** Extended thinking process (if enabled) */
  thinking?: string;
  /** Response confidence score (0.0-1.0) */
  confidence: number;
  /** Response quality assessment */
  quality: ResponseQuality;
  /** Token usage information */
  tokenUsage: {
    /** Input tokens consumed */
    inputTokens: number;
    /** Output tokens generated */
    outputTokens: number;
    /** Total tokens used */
    totalTokens: number;
    /** Estimated cost in USD */
    estimatedCost: number;
  };
  /** Response timing information */
  timing: {
    /** Time to first token (ms) */
    timeToFirstToken: number;
    /** Total generation time (ms) */
    totalTime: number;
    /** Tokens per second */
    tokensPerSecond: number;
  };
  /** Any issues or warnings */
  issues: string[];
  /** Error information (if failed) */
  error?: {
    /** Error type/category */
    type: string;
    /** Error message */
    message: string;
    /** Error code from OpenRouter */
    code?: string;
    /** Whether error is retryable */
    retryable: boolean;
    /** Additional error details */
    details?: Record<string, any>;
  };
  /** Response completion timestamp */
  completedAt: string; // ISO 8601 format
}

/** Token usage tracking */
export interface TokenUsageMetrics {
  /** Metrics period identifier */
  id: UUID;
  /** Associated project (optional) */
  projectId?: UUID;
  /** Tracking period start */
  periodStart: string; // ISO 8601 format
  /** Tracking period end */
  periodEnd: string; // ISO 8601 format
  /** Total requests made */
  totalRequests: number;
  /** Successful requests */
  successfulRequests: number;
  /** Failed requests */
  failedRequests: number;
  /** Token usage breakdown */
  tokenUsage: {
    /** Total input tokens */
    totalInputTokens: number;
    /** Total output tokens */
    totalOutputTokens: number;
    /** Total tokens across all requests */
    totalTokens: number;
    /** Average tokens per request */
    avgTokensPerRequest: number;
    /** Peak tokens in single request */
    peakTokensPerRequest: number;
  };
  /** Cost information */
  costMetrics: {
    /** Total estimated cost */
    totalCost: number;
    /** Average cost per request */
    avgCostPerRequest: number;
    /** Cost breakdown by model */
    costByModel: Record<ClaudeModelVariant, number>;
  };
  /** Performance metrics */
  performanceMetrics: {
    /** Average response time */
    avgResponseTime: number;
    /** Average time to first token */
    avgTimeToFirstToken: number;
    /** Average tokens per second */
    avgTokensPerSecond: number;
    /** Error rate percentage */
    errorRate: number;
  };
  /** Quality metrics */
  qualityMetrics: {
    /** Average confidence score */
    avgConfidence: number;
    /** Quality distribution */
    qualityDistribution: Record<ResponseQuality, number>;
    /** Average response quality score */
    avgQualityScore: number;
  };
}

/** Context optimization feedback */
export interface ContextOptimizationFeedback {
  /** Feedback identifier */
  id: UUID;
  /** Associated request */
  requestId: UUID;
  /** Project context */
  projectId?: UUID;
  /** Context effectiveness score (0.0-1.0) */
  effectivenessScore: number;
  /** Context utilization metrics */
  utilization: {
    /** Context nodes actually referenced */
    referencedNodes: number;
    /** Total context nodes provided */
    totalNodes: number;
    /** Utilization percentage */
    utilizationRate: number;
  };
  /** Context relevance analysis */
  relevanceAnalysis: {
    /** High relevance context percentage */
    highRelevance: number;
    /** Medium relevance context percentage */
    mediumRelevance: number;
    /** Low relevance context percentage */
    lowRelevance: number;
    /** Irrelevant context percentage */
    irrelevant: number;
  };
  /** Optimization recommendations */
  recommendations: {
    /** Recommended context compression level */
    compressionLevel: 'minimal' | 'standard' | 'aggressive';
    /** Suggested context node limit */
    suggestedNodeLimit: number;
    /** Context types to prioritize */
    prioritizeTypes: string[];
    /** Context types to minimize */
    minimizeTypes: string[];
  };
  /** Feedback timestamp */
  createdAt: string; // ISO 8601 format
}

/** Error recovery configuration */
export interface ErrorRecoveryConfig {
  /** Maximum retry attempts */
  maxRetries: number;
  /** Base retry delay in milliseconds */
  baseRetryDelay: number;
  /** Exponential backoff multiplier */
  backoffMultiplier: number;
  /** Maximum retry delay in milliseconds */
  maxRetryDelay: number;
  /** Timeout increase per retry (ms) */
  timeoutIncrease: number;
  /** Fallback model if primary fails */
  fallbackModel?: ClaudeModelVariant;
  /** Fallback configuration */
  fallbackConfig?: Partial<ClaudeRequestConfig>;
}

/** Streaming response chunk */
export interface StreamingResponseChunk {
  /** Chunk identifier */
  id: UUID;
  /** Request identifier */
  requestId: UUID;
  /** Chunk sequence number */
  sequence: number;
  /** Chunk type */
  type: 'thinking' | 'content' | 'metadata' | 'final';
  /** Chunk content */
  content: string;
  /** Whether this is the final chunk */
  isFinal: boolean;
  /** Chunk timestamp */
  timestamp: string; // ISO 8601 format
  /** Additional chunk metadata */
  metadata?: Record<string, any>;
}
```

## **3. API Endpoint Specification (OpenAPI `paths` block)**

```yaml
paths:
  /api/v1/claude/generate:
    post:
      tags:
        - Claude Integration
      summary: Generate content using Claude AI
      description: Submits a generation request to Claude Sonnet 4 via OpenRouter with context streaming and quality analysis
      security:
        - localAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                projectId:
                  $ref: '#/components/schemas/UUID'
                phase:
                  $ref: '#/components/schemas/PhaseType'
                priority:
                  type: string
                  enum: [low, normal, high, critical]
                  default: normal
                config:
                  $ref: '#/components/schemas/ClaudeRequestConfig'
                systemPrompt:
                  type: string
                  minLength: 1
                  maxLength: 50000
                userPrompt:
                  type: string
                  minLength: 1
                  maxLength: 100000
                contextData:
                  type: object
                  properties:
                    nodes:
                      type: array
                      items:
                        type: object
                    dependencies:
                      type: array
                      items:
                        type: object
                    phaseContext:
                      type: object
                metadata:
                  type: object
                  properties:
                    source:
                      type: string
                      minLength: 1
                    sessionId:
                      type: string
                    correlationId:
                      type: string
                    additionalContext:
                      type: object
                  required:
                    - source
              required:
                - config
                - systemPrompt
                - userPrompt
                - metadata
      responses:
        '200':
          description: Generation completed successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/ClaudeApiResponse'
        '400':
          description: Invalid request parameters
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'
        '429':
          description: Rate limit exceeded
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

  /api/v1/claude/generate/stream:
    post:
      tags:
        - Claude Integration
      summary: Generate content with streaming response
      description: Submits a generation request with real-time streaming of Claude's response and thinking process
      security:
        - localAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                projectId:
                  $ref: '#/components/schemas/UUID'
                phase:
                  $ref: '#/components/schemas/PhaseType'
                priority:
                  type: string
                  enum: [low, normal, high, critical]
                  default: normal
                config:
                  $ref: '#/components/schemas/ClaudeRequestConfig'
                systemPrompt:
                  type: string
                  minLength: 1
                userPrompt:
                  type: string
                  minLength: 1
                contextData:
                  type: object
                metadata:
                  type: object
                  properties:
                    source:
                      type: string
                    sessionId:
                      type: string
                    correlationId:
                      type: string
              required:
                - config
                - systemPrompt
                - userPrompt
                - metadata
      responses:
        '200':
          description: Streaming response initiated
          content:
            text/event-stream:
              schema:
                type: string
                description: Server-sent events stream with StreamingResponseChunk data

  /api/v1/claude/requests/{requestId}:
    get:
      tags:
        - Claude Integration
      summary: Get generation request details
      description: Retrieves detailed information about a specific generation request and its response
      security:
        - localAuth: []
      parameters:
        - name: requestId
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '200':
          description: Request details retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          request:
                            $ref: '#/components/schemas/ClaudeApiRequest'
                          response:
                            $ref: '#/components/schemas/ClaudeApiResponse'
        '404':
          description: Request not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

  /api/v1/claude/requests:
    get:
      tags:
        - Claude Integration
      summary: List generation requests
      description: Retrieves a list of generation requests with filtering and pagination
      security:
        - localAuth: []
      parameters:
        - name: projectId
          in: query
          description: Filter by project ID
          required: false
          schema:
            $ref: '#/components/schemas/UUID'
        - name: phase
          in: query
          description: Filter by development phase
          required: false
          schema:
            $ref: '#/components/schemas/PhaseType'
        - name: status
          in: query
          description: Filter by request status
          required: false
          schema:
            type: string
            enum: [pending, in_progress, completed, failed]
        - name: startDate
          in: query
          description: Filter requests from this date
          required: false
          schema:
            type: string
            format: date-time
        - name: endDate
          in: query
          description: Filter requests until this date
          required: false
          schema:
            type: string
            format: date-time
        - name: limit
          in: query
          description: Maximum number of results
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
        - name: offset
          in: query
          description: Offset for pagination
          required: false
          schema:
            type: integer
            minimum: 0
            default: 0
      responses:
        '200':
          description: Requests retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          requests:
                            type: array
                            items:
                              $ref: '#/components/schemas/ClaudeApiRequest'
                          totalCount:
                            type: integer
                          hasMore:
                            type: boolean

  /api/v1/claude/usage:
    get:
      tags:
        - Claude Integration
      summary: Get token usage metrics
      description: Retrieves comprehensive token usage and cost metrics for specified time periods
      security:
        - localAuth: []
      parameters:
        - name: projectId
          in: query
          description: Filter metrics by project ID
          required: false
          schema:
            $ref: '#/components/schemas/UUID'
        - name: period
          in: query
          description: Metrics aggregation period
          required: false
          schema:
            type: string
            enum: [hour, day, week, month]
            default: day
        - name: startDate
          in: query
          description: Start date for metrics period
          required: false
          schema:
            type: string
            format: date
        - name: endDate
          in: query
          description: End date for metrics period
          required: false
          schema:
            type: string
            format: date
      responses:
        '200':
          description: Usage metrics retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/TokenUsageMetrics'

  /api/v1/claude/models:
    get:
      tags:
        - Claude Integration
      summary: Get available Claude models
      description: Retrieves list of available Claude model variants with their capabilities and pricing
      security:
        - localAuth: []
      responses:
        '200':
          description: Available models retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          models:
                            type: array
                            items:
                              type: object
                              properties:
                                id:
                                  type: string
                                name:
                                  type: string
                                description:
                                  type: string
                                maxTokens:
                                  type: integer
                                inputCostPer1K:
                                  type: number
                                outputCostPer1K:
                                  type: number
                                capabilities:
                                  type: array
                                  items:
                                    type: string
                                recommended:
                                  type: boolean

  /api/v1/claude/health:
    get:
      tags:
        - Claude Integration
      summary: Check Claude API health
      description: Performs health check of OpenRouter and Claude API connectivity
      security:
        - localAuth: []
      responses:
        '200':
          description: Health check completed
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          status:
                            type: string
                            enum: [healthy, degraded, unhealthy]
                          openrouterStatus:
                            type: string
                            enum: [online, degraded, offline]
                          responseTime:
                            type: number
                            description: Response time in milliseconds
                          availableModels:
                            type: array
                            items:
                              type: string
                          lastChecked:
                            type: string
                            format: date-time
                          issues:
                            type: array
                            items:
                              type: string

  /api/v1/claude/feedback:
    post:
      tags:
        - Claude Integration
      summary: Submit context optimization feedback
      description: Provides feedback on context effectiveness to improve future context optimization
      security:
        - localAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                requestId:
                  $ref: '#/components/schemas/UUID'
                projectId:
                  $ref: '#/components/schemas/UUID'
                effectivenessScore:
                  type: number
                  minimum: 0.0
                  maximum: 1.0
                utilization:
                  type: object
                  properties:
                    referencedNodes:
                      type: integer
                    totalNodes:
                      type: integer
                relevanceAnalysis:
                  type: object
                  properties:
                    highRelevance:
                      type: number
                    mediumRelevance:
                      type: number
                    lowRelevance:
                      type: number
                    irrelevant:
                      type: number
              required:
                - requestId
                - effectivenessScore
      responses:
        '201':
          description: Feedback submitted successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/ContextOptimizationFeedback'

components:
  schemas:
    ClaudeRequestConfig:
      type: object
      required:
        - model
        - maxTokens
        - temperature
        - topP
        - extendedThinking
        - streaming
        - optimizationStrategy
        - timeout
        - includeThinking
      properties:
        model:
          type: string
          enum: [claude-3-5-sonnet-20241022, claude-3-5-sonnet-20240620, claude-3-opus-20240229, claude-3-haiku-20240307]
        maxTokens:
          type: integer
          minimum: 1
          maximum: 200000
        temperature:
          type: number
          minimum: 0.0
          maximum: 1.0
        topP:
          type: number
          minimum: 0.0
          maximum: 1.0
        extendedThinking:
          type: string
          enum: [disabled, standard, detailed, comprehensive]
        streaming:
          type: string
          enum: [disabled, incremental, adaptive, full_stream]
        optimizationStrategy:
          type: string
          enum: [speed, quality, balanced, cost_effective]
        timeout:
          type: integer
          minimum: 5000
          maximum: 300000
        includeThinking:
          type: boolean

    ClaudeApiRequest:
      type: object
      required:
        - id
        - priority
        - config
        - systemPrompt
        - userPrompt
        - metadata
        - createdAt
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        projectId:
          $ref: '#/components/schemas/UUID'
        phase:
          $ref: '#/components/schemas/PhaseType'
        priority:
          type: string
          enum: [low, normal, high, critical]
        config:
          $ref: '#/components/schemas/ClaudeRequestConfig'
        systemPrompt:
          type: string
        userPrompt:
          type: string
        contextData:
          type: object
          properties:
            nodes:
              type: array
              items:
                type: object
            dependencies:
              type: array
              items:
                type: object
            phaseContext:
              type: object
        metadata:
          type: object
          properties:
            source:
              type: string
            sessionId:
              type: string
            correlationId:
              type: string
            additionalContext:
              type: object
        createdAt:
          type: string
          format: date-time

    ClaudeApiResponse:
      type: object
      required:
        - requestId
        - success
        - confidence
        - quality
        - tokenUsage
        - timing
        - issues
        - completedAt
      properties:
        requestId:
          $ref: '#/components/schemas/UUID'
        success:
          type: boolean
        content:
          type: string
        thinking:
          type: string
        confidence:
          type: number
          minimum: 0.0
          maximum: 1.0
        quality:
          type: string
          enum: [excellent, good, acceptable, poor, failed]
        tokenUsage:
          type: object
          properties:
            inputTokens:
              type: integer
            outputTokens:
              type: integer
            totalTokens:
              type: integer
            estimatedCost:
              type: number
        timing:
          type: object
          properties:
            timeToFirstToken:
              type: number
            totalTime:
              type: number
            tokensPerSecond:
              type: number
        issues:
          type: array
          items:
            type: string
        error:
          type: object
          properties:
            type:
              type: string
            message:
              type: string
            code:
              type: string
            retryable:
              type: boolean
            details:
              type: object
        completedAt:
          type: string
          format: date-time

    TokenUsageMetrics:
      type: object
      required:
        - id
        - periodStart
        - periodEnd
        - totalRequests
        - successfulRequests
        - failedRequests
        - tokenUsage
        - costMetrics
        - performanceMetrics
        - qualityMetrics
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        projectId:
          $ref: '#/components/schemas/UUID'
        periodStart:
          type: string
          format: date-time
        periodEnd:
          type: string
          format: date-time
        totalRequests:
          type: integer
        successfulRequests:
          type: integer
        failedRequests:
          type: integer
        tokenUsage:
          type: object
          properties:
            totalInputTokens:
              type: integer
            totalOutputTokens:
              type: integer
            totalTokens:
              type: integer
            avgTokensPerRequest:
              type: number
            peakTokensPerRequest:
              type: integer
        costMetrics:
          type: object
          properties:
            totalCost:
              type: number
            avgCostPerRequest:
              type: number
            costByModel:
              type: object
              additionalProperties:
                type: number
        performanceMetrics:
          type: object
          properties:
            avgResponseTime:
              type: number
            avgTimeToFirstToken:
              type: number
            avgTokensPerSecond:
              type: number
            errorRate:
              type: number
        qualityMetrics:
          type: object
          properties:
            avgConfidence:
              type: number
            qualityDistribution:
              type: object
              additionalProperties:
                type: integer
            avgQualityScore:
              type: number

    ContextOptimizationFeedback:
      type: object
      required:
        - id
        - requestId
        - effectivenessScore
        - utilization
        - relevanceAnalysis
        - recommendations
        - createdAt
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        requestId:
          $ref: '#/components/schemas/UUID'
        projectId:
          $ref: '#/components/schemas/UUID'
        effectivenessScore:
          type: number
          minimum: 0.0
          maximum: 1.0
        utilization:
          type: object
          properties:
            referencedNodes:
              type: integer
            totalNodes:
              type: integer
            utilizationRate:
              type: number
        relevanceAnalysis:
          type: object
          properties:
            highRelevance:
              type: number
            mediumRelevance:
              type: number
            lowRelevance:
              type: number
            irrelevant:
              type: number
        recommendations:
          type: object
          properties:
            compressionLevel:
              type: string
              enum: [minimal, standard, aggressive]
            suggestedNodeLimit:
              type: integer
            prioritizeTypes:
              type: array
              items:
                type: string
            minimizeTypes:
              type: array
              items:
                type: string
        createdAt:
          type: string
          format: date-time

    StreamingResponseChunk:
      type: object
      required:
        - id
        - requestId
        - sequence
        - type
        - content
        - isFinal
        - timestamp
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        requestId:
          $ref: '#/components/schemas/UUID'
        sequence:
          type: integer
        type:
          type: string
          enum: [thinking, content, metadata, final]
        content:
          type: string
        isFinal:
          type: boolean
        timestamp:
          type: string
          format: date-time
        metadata:
          type: object
```

## **4. Detailed Business Logic & Validation Rules**

| Rule ID | Rule Description | Implementation Location(s) & Notes |
|---------|------------------|-----------------------------------|
| **CIS-01** | All Claude API requests must obtain OpenRouter API key and configuration settings from Configuration Management Module before making external API calls. | **Backend (Authoritative):** Claude service must call Configuration Management Module to retrieve API keys, model preferences, and timeout settings before each request. Cache configuration for 5 minutes to optimize performance. |
| **CIS-02** | Extended thinking mode must be enabled for all requests related to architectural decisions (Phase 1) and complex generation tasks, but can be disabled for simple operations to optimize token usage. | **Backend (Authoritative):** Service must analyze request phase and complexity to automatically enable extended thinking for Phase 1 (architectural blueprint) and when context complexity exceeds configured threshold from Configuration Management. |
| **CIS-03** | Context streaming must be coordinated with Context Management Engine to provide optimized context packages while respecting Claude's token limits and maintaining semantic coherence. | **Backend (Authoritative):** Integration service must call Context Management Engine to get optimized context, validate token count against Claude model limits, and implement intelligent context truncation if needed while preserving most relevant context nodes. |
| **CIS-04** | Token usage tracking must be logged with Logging & Monitoring Service for every request to support cost monitoring and usage analytics aligned with ReadyAI development velocity KPIs. | **Backend (Authoritative):** Service must log detailed token usage metrics to Logging Service after each request completion, including input/output tokens, cost estimates, and performance timing for KPI tracking and billing analysis. |
| **CIS-05** | Error recovery must implement exponential backoff with configurable retry limits based on error type, with automatic fallback to alternative Claude models when primary model is unavailable. | **Backend (Authoritative):** Retry service must classify errors as retryable/non-retryable, implement exponential backoff for rate limits and temporary failures, and fallback to claude-3-haiku-20240307 for speed-critical operations when primary model fails. |
| **CIS-06** | Response quality assessment must analyze confidence scores, content completeness, and context utilization to provide feedback to Context Management Engine for continuous optimization. | **Backend (Authoritative):** Quality analyzer must evaluate response against request complexity, calculate confidence metrics, assess context utilization, and send feedback to Context Management Engine to improve future context selection and compression. |
| **CIS-07** | Streaming responses must maintain proper chunk sequencing and provide real-time progress updates while handling connection interruptions gracefully with resumption capability. | **Backend (Authoritative):** Streaming service must implement WebSocket/SSE with chunk sequencing, connection heartbeat monitoring, and graceful handling of client disconnections with ability to resume streaming from last confirmed chunk. |
| **CIS-08** | Priority-based request queuing must ensure critical phase transitions and error corrections are processed before lower-priority requests while maintaining fairness. | **Backend (Authoritative):** Request queue service must implement priority queues with anti-starvation mechanisms, ensuring critical requests (error corrections, phase blockers) are processed first while preventing indefinite delay of normal requests. |
| **CIS-09** | Model selection must be optimized based on request type, context complexity, and performance requirements, with automatic cost-performance trade-off optimization. | **Backend (Authoritative):** Model selector must analyze request characteristics (complexity, urgency, context size) and automatically choose optimal Claude variant, with claude-3-opus for architectural decisions and claude-3-haiku for simple code generation. |
| **CIS-10** | Health monitoring must continuously verify OpenRouter API connectivity and Claude model availability, with automatic degradation handling and notification through Logging Service. | **Backend (Authoritative):** Health service must perform periodic API health checks every 60 seconds, track model availability and response times, and automatically report degraded service conditions to Logging Service for alert generation and status dashboard updates. |

## **5. Developer Task Checklist**

### **Backend Tasks:**
- [ ] Create database migration script for Claude integration tables (`claude_requests`, `claude_responses`, `token_usage_metrics`, `context_feedback`, `error_recovery_logs`)
- [ ] Implement the `ClaudeIntegrationService` class with OpenRouter API client, request/response handling, and comprehensive error management
- [ ] Implement the `TokenUsageTrackingService` class for monitoring token consumption, cost calculation, and usage analytics with Logging Service integration
- [ ] Implement the `ResponseQualityAnalyzer` class for assessing generation quality, confidence scoring, and context effectiveness measurement
- [ ] Implement the `ErrorRecoveryService` class with exponential backoff, retry logic, and automatic model fallback capabilities
- [ ] Implement the `StreamingService` class for real-time response streaming with WebSocket/SSE support and connection management
- [ ] Implement the `ContextOptimizationService` class for analyzing context utilization and providing feedback to Context Management Engine
- [ ] Implement all Claude generation endpoints (`POST /api/v1/claude/generate`, `POST /api/v1/claude/generate/stream`) with comprehensive request validation and response processing
- [ ] Implement request management endpoints (`GET /api/v1/claude/requests`, `GET /api/v1/claude/requests/{id}`) with filtering, pagination, and detailed status tracking
- [ ] Implement usage analytics endpoint (`GET /api/v1/claude/usage`) with configurable time periods and project-specific metrics
- [ ] Implement model information endpoint (`GET /api/v1/claude/models`) with real-time availability and pricing data from OpenRouter
- [ ] Implement health monitoring endpoint (`GET /api/v1/claude/health`) with comprehensive API connectivity and model availability checks
- [ ] Implement context feedback endpoint (`POST /api/v1/claude/feedback`) for continuous learning and optimization
- [ ] Create `ClaudeRequestRepository` class for request/response storage with efficient querying and archival policies
- [ ] Create `TokenUsageRepository` class for usage metrics storage with time-series data optimization and aggregation capabilities
- [ ] Implement OpenRouter API client with proper authentication, rate limiting, and connection pooling
- [ ] Implement integration with Configuration Management Module for API keys, model preferences, and operational settings
- [ ] Implement integration with Context Management Engine for context optimization and feedback loops
- [ ] Implement integration with Logging & Monitoring Service for comprehensive request logging, performance tracking, and error reporting
- [ ] Create comprehensive unit tests for all service classes with mock OpenRouter API responses and error scenarios
- [ ] Create integration tests for complete request/response cycles including streaming, error recovery, and context optimization
- [ ] Implement performance optimization including request batching, response caching, and connection reuse
- [ ] Add monitoring and alerting for API quota limits, cost thresholds, and service degradation with automatic notifications

### **Frontend Tasks:**
- [ ] Create `ClaudeIntegrationProvider` React context for managing AI generation state and request tracking
- [ ] Implement `useClaudeGeneration` hook for making generation requests with built-in loading states, error handling, and retry logic
- [ ] Create `GenerationRequestForm` component for configuring and submitting Claude generation requests with model selection and parameter tuning
- [ ] Implement `StreamingResponseViewer` component for real-time display of streaming responses with thinking process visualization
- [ ] Create `TokenUsageDashboard` component for displaying usage metrics, cost tracking, and quota monitoring
- [ ] Implement `ResponseQualityIndicator` component for showing confidence scores, quality ratings, and optimization suggestions
- [ ] Create `RequestHistoryViewer` component for browsing past generation requests with filtering, search, and detailed response inspection
- [ ] Implement `ModelSelector` component for choosing Claude model variants with capability descriptions and cost estimates
- [ ] Create Claude integration service functions in API client (`claudeService.ts`) for all generation and management endpoints
- [ ] Implement automatic error boundary integration for handling Claude API failures with user-friendly error messages
- [ ] Create real-time streaming interface using WebSocket/SSE for live response updates in VS Code extension
- [ ] Implement request progress tracking with cancellation capability for long-running generation tasks
- [ ] Add generation request templates and presets for common use cases (code generation, documentation, debugging)
- [ ] Create context optimization interface showing context utilization metrics and optimization recommendations
- [ ] Implement usage monitoring widgets for tracking token consumption, costs, and API health status
- [ ] Add integration with VS Code extension for seamless in-editor generation requests and response handling
- [ ] Create debugging tools for analyzing request/response cycles, token usage patterns, and quality trends
- [ ] Implement configuration interface for Claude integration settings linked to Configuration Management Module
- [ ] Add export functionality for generation history, usage reports, and quality analytics
- [ ] Create notification system for quota alerts, API health issues, and optimization suggestions



========================================================================================


# AI Provider Management - Technical Specification

## **1. Module Overview**

**Purpose:** The AI Provider Management Module serves as the centralized AI orchestration layer for the entire ReadyAI application, managing multiple AI providers, handling request routing, provider failover, usage optimization, and quality assessment. This module abstracts AI provider interactions, ensures optimal provider selection based on request type and context, manages token budgets and usage tracking, and provides intelligent request queuing and response quality validation while maintaining the local-first architecture principles and supporting the development velocity KPIs.

**Dependencies & Interactions:** This module depends on the Configuration Management Module to obtain AI provider configurations, API keys, usage limits, and routing preferences. It integrates with the Logging & Monitoring Service to track AI provider performance, token usage, response times, and error rates. The module orchestrates interactions with the Claude Integration Service (and future AI provider implementations) by routing requests, managing provider health, and coordinating failover scenarios. It interacts with the Context Management Engine to optimize context packaging for different providers and with the Multi-Phase Development Orchestrator to handle phase-specific AI generation requests. The module also provides usage analytics and optimization recommendations to support the 70-90% development velocity KPI and maintains provider abstractions that enable future AI model integrations.

## **2. Module-Specific Type Additions (`types.aiProviderManagement.ts`)**

```typescript
/**
 * AI Provider Management Module Types
 * Extends foundational types with AI provider orchestration interfaces
 */

/** AI provider status indicators */
export type AIProviderStatus = 'active' | 'inactive' | 'degraded' | 'failed' | 'maintenance';

/** AI request priority levels */
export type AIRequestPriority = 'low' | 'normal' | 'high' | 'critical';

/** AI request routing strategies */
export type RoutingStrategy = 'round_robin' | 'least_loaded' | 'quality_based' | 'cost_optimized' | 'failover_only';

/** Token budget period types */
export type BudgetPeriod = 'hourly' | 'daily' | 'weekly' | 'monthly';

/** Provider capability types */
export type ProviderCapability = 
  | 'code_generation'
  | 'architecture_design'
  | 'code_review'
  | 'documentation'
  | 'testing'
  | 'debugging'
  | 'refactoring';

/** AI provider configuration */
export interface AIProviderConfig {
  /** Unique provider identifier */
  id: UUID;
  /** Provider name */
  name: string;
  /** Provider type (matches AIProviderType) */
  type: AIProviderType;
  /** Provider description */
  description?: string;
  /** Provider status */
  status: AIProviderStatus;
  /** Provider priority (1-10, lower = higher priority) */
  priority: number;
  /** Provider capabilities */
  capabilities: ProviderCapability[];
  /** API configuration */
  apiConfig: {
    /** Base URL for provider API */
    baseUrl: string;
    /** API key reference (stored in Configuration Management) */
    apiKeyRef: string;
    /** Request timeout in milliseconds */
    timeout: number;
    /** Maximum retries */
    maxRetries: number;
    /** Rate limiting configuration */
    rateLimit?: {
      requestsPerMinute: number;
      tokensPerMinute: number;
    };
  };
  /** Token budget configuration */
  tokenBudget: {
    /** Maximum tokens per period */
    maxTokensPerPeriod: number;
    /** Budget period */
    period: BudgetPeriod;
    /** Current usage in period */
    currentUsage: number;
    /** Budget reset timestamp */
    resetAt: string; // ISO 8601 format
  };
  /** Quality thresholds */
  qualityThresholds: {
    /** Minimum confidence score */
    minConfidence: number;
    /** Maximum response time (ms) */
    maxResponseTime: number;
    /** Maximum error rate */
    maxErrorRate: number;
  };
  /** Provider configuration */
  config: Record<string, any>;
  /** Creation timestamp */
  createdAt: string; // ISO 8601 format
  /** Last update timestamp */
  updatedAt: string; // ISO 8601 format
}

/** AI request routing information */
export interface AIRequestRoute {
  /** Request identifier */
  requestId: UUID;
  /** Selected provider */
  providerId: UUID;
  /** Routing strategy used */
  strategy: RoutingStrategy;
  /** Routing decision factors */
  factors: {
    /** Provider health score */
    healthScore: number;
    /** Current load */
    currentLoad: number;
    /** Quality score */
    qualityScore: number;
    /** Cost factor */
    costFactor: number;
    /** Capability match score */
    capabilityMatch: number;
  };
  /** Fallback providers (in order) */
  fallbackProviders: UUID[];
  /** Routing timestamp */
  routedAt: string; // ISO 8601 format
}

/** AI provider health status */
export interface AIProviderHealth {
  /** Provider identifier */
  providerId: UUID;
  /** Overall health status */
  status: AIProviderStatus;
  /** Health score (0-100) */
  healthScore: number;
  /** Last health check timestamp */
  lastChecked: string; // ISO 8601 format
  /** Health metrics */
  metrics: {
    /** Average response time (ms) */
    avgResponseTime: number;
    /** Success rate (0-1) */
    successRate: number;
    /** Error rate (0-1) */
    errorRate: number;
    /** Current load (0-1) */
    currentLoad: number;
    /** Token usage efficiency */
    tokenEfficiency: number;
    /** Quality score (0-1) */
    avgQualityScore: number;
  };
  /** Recent errors */
  recentErrors: Array<{
    timestamp: string;
    error: string;
    severity: 'low' | 'medium' | 'high' | 'critical';
  }>;
  /** Next health check timestamp */
  nextCheckAt: string; // ISO 8601 format
}

/** AI usage analytics */
export interface AIUsageAnalytics {
  /** Analytics identifier */
  id: UUID;
  /** Time period */
  period: {
    start: string; // ISO 8601 format
    end: string; // ISO 8601 format
  };
  /** Overall usage statistics */
  overall: {
    /** Total requests */
    totalRequests: number;
    /** Successful requests */
    successfulRequests: number;
    /** Failed requests */
    failedRequests: number;
    /** Total tokens used */
    totalTokens: number;
    /** Average response time */
    avgResponseTime: number;
    /** Average quality score */
    avgQualityScore: number;
  };
  /** Per-provider statistics */
  providerStats: Array<{
    providerId: UUID;
    providerName: string;
    requests: number;
    tokens: number;
    avgResponseTime: number;
    successRate: number;
    avgQualityScore: number;
    costEstimate?: number;
  }>;
  /** Per-capability statistics */
  capabilityStats: Array<{
    capability: ProviderCapability;
    requests: number;
    tokens: number;
    avgResponseTime: number;
    successRate: number;
    avgQualityScore: number;
  }>;
  /** Usage trends */
  trends: {
    requestTrend: Array<{
      timestamp: string;
      count: number;
    }>;
    tokenTrend: Array<{
      timestamp: string;
      tokens: number;
    }>;
    qualityTrend: Array<{
      timestamp: string;
      avgQuality: number;
    }>;
  };
}

/** AI request queue entry */
export interface AIRequestQueueEntry {
  /** Queue entry identifier */
  id: UUID;
  /** Original generation request */
  generationRequest: GenerationRequest;
  /** Request priority */
  priority: AIRequestPriority;
  /** Routing information */
  routing: AIRequestRoute;
  /** Queue timestamps */
  timestamps: {
    /** When request was queued */
    queuedAt: string; // ISO 8601 format
    /** When request started processing */
    startedAt?: string; // ISO 8601 format
    /** When request completed */
    completedAt?: string; // ISO 8601 format
  };
  /** Queue status */
  status: 'queued' | 'processing' | 'completed' | 'failed' | 'cancelled';
  /** Retry information */
  retries: {
    /** Current retry count */
    count: number;
    /** Maximum retries allowed */
    maxRetries: number;
    /** Next retry timestamp */
    nextRetryAt?: string; // ISO 8601 format
  };
  /** Error information (if failed) */
  error?: {
    code: string;
    message: string;
    details?: Record<string, any>;
  };
}

/** Provider optimization recommendation */
export interface ProviderOptimization {
  /** Recommendation identifier */
  id: UUID;
  /** Provider identifier */
  providerId: UUID;
  /** Recommendation type */
  type: 'performance' | 'cost' | 'quality' | 'usage' | 'configuration';
  /** Recommendation title */
  title: string;
  /** Recommendation description */
  description: string;
  /** Expected impact */
  impact: {
    /** Performance improvement */
    performanceGain?: number;
    /** Cost reduction */
    costReduction?: number;
    /** Quality improvement */
    qualityGain?: number;
  };
  /** Implementation complexity */
  complexity: 'low' | 'medium' | 'high';
  /** Recommendation priority */
  priority: 'low' | 'medium' | 'high' | 'critical';
  /** Generated timestamp */
  generatedAt: string; // ISO 8601 format
  /** Whether recommendation has been applied */
  applied: boolean;
}
```

## **3. API Endpoint Specification (OpenAPI `paths` block)**

```yaml
paths:
  /api/v1/ai-providers:
    get:
      tags:
        - AI Provider Management
      summary: List AI providers
      description: Retrieves all configured AI providers with their status and configuration
      security:
        - localAuth: []
      parameters:
        - name: status
          in: query
          description: Filter providers by status
          required: false
          schema:
            type: string
            enum: [active, inactive, degraded, failed, maintenance]
        - name: capability
          in: query
          description: Filter providers by capability
          required: false
          schema:
            type: string
            enum: [code_generation, architecture_design, code_review, documentation, testing, debugging, refactoring]
      responses:
        '200':
          description: AI providers retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          providers:
                            type: array
                            items:
                              $ref: '#/components/schemas/AIProviderConfig'
                          totalCount:
                            type: integer
        '400':
          description: Invalid query parameters
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

    post:
      tags:
        - AI Provider Management
      summary: Add new AI provider
      description: Configures a new AI provider in the system
      security:
        - localAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  minLength: 1
                  maxLength: 100
                type:
                  $ref: '#/components/schemas/AIProviderType'
                description:
                  type: string
                  maxLength: 500
                priority:
                  type: integer
                  minimum: 1
                  maximum: 10
                capabilities:
                  type: array
                  items:
                    type: string
                    enum: [code_generation, architecture_design, code_review, documentation, testing, debugging, refactoring]
                  minItems: 1
                apiConfig:
                  type: object
                  properties:
                    baseUrl:
                      type: string
                      format: uri
                    apiKeyRef:
                      type: string
                    timeout:
                      type: integer
                      minimum: 1000
                      maximum: 300000
                    maxRetries:
                      type: integer
                      minimum: 0
                      maximum: 10
                    rateLimit:
                      type: object
                      properties:
                        requestsPerMinute:
                          type: integer
                          minimum: 1
                        tokensPerMinute:
                          type: integer
                          minimum: 100
                  required:
                    - baseUrl
                    - apiKeyRef
                    - timeout
                    - maxRetries
                tokenBudget:
                  type: object
                  properties:
                    maxTokensPerPeriod:
                      type: integer
                      minimum: 1000
                    period:
                      type: string
                      enum: [hourly, daily, weekly, monthly]
                  required:
                    - maxTokensPerPeriod
                    - period
                qualityThresholds:
                  type: object
                  properties:
                    minConfidence:
                      type: number
                      minimum: 0
                      maximum: 1
                    maxResponseTime:
                      type: integer
                      minimum: 1000
                    maxErrorRate:
                      type: number
                      minimum: 0
                      maximum: 1
                  required:
                    - minConfidence
                    - maxResponseTime
                    - maxErrorRate
                config:
                  type: object
              required:
                - name
                - type
                - priority
                - capabilities
                - apiConfig
                - tokenBudget
                - qualityThresholds
      responses:
        '201':
          description: AI provider added successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/AIProviderConfig'
        '400':
          description: Invalid provider configuration
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

  /api/v1/ai-providers/{providerId}:
    get:
      tags:
        - AI Provider Management
      summary: Get AI provider details
      description: Retrieves detailed information about a specific AI provider
      security:
        - localAuth: []
      parameters:
        - name: providerId
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '200':
          description: AI provider details retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/AIProviderConfig'
        '404':
          description: AI provider not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

    put:
      tags:
        - AI Provider Management
      summary: Update AI provider configuration
      description: Updates the configuration of an existing AI provider
      security:
        - localAuth: []
      parameters:
        - name: providerId
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  minLength: 1
                  maxLength: 100
                description:
                  type: string
                  maxLength: 500
                status:
                  type: string
                  enum: [active, inactive, degraded, failed, maintenance]
                priority:
                  type: integer
                  minimum: 1
                  maximum: 10
                capabilities:
                  type: array
                  items:
                    type: string
                    enum: [code_generation, architecture_design, code_review, documentation, testing, debugging, refactoring]
                apiConfig:
                  type: object
                  properties:
                    baseUrl:
                      type: string
                      format: uri
                    apiKeyRef:
                      type: string
                    timeout:
                      type: integer
                      minimum: 1000
                      maximum: 300000
                    maxRetries:
                      type: integer
                      minimum: 0
                      maximum: 10
                tokenBudget:
                  type: object
                  properties:
                    maxTokensPerPeriod:
                      type: integer
                      minimum: 1000
                    period:
                      type: string
                      enum: [hourly, daily, weekly, monthly]
                qualityThresholds:
                  type: object
                  properties:
                    minConfidence:
                      type: number
                      minimum: 0
                      maximum: 1
                    maxResponseTime:
                      type: integer
                      minimum: 1000
                    maxErrorRate:
                      type: number
                      minimum: 0
                      maximum: 1
                config:
                  type: object
      responses:
        '200':
          description: AI provider updated successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/AIProviderConfig'
        '404':
          description: AI provider not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

    delete:
      tags:
        - AI Provider Management
      summary: Remove AI provider
      description: Removes an AI provider from the system (requires no active requests)
      security:
        - localAuth: []
      parameters:
        - name: providerId
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '200':
          description: AI provider removed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '409':
          description: Cannot remove provider with active requests
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

  /api/v1/ai-providers/{providerId}/health:
    get:
      tags:
        - AI Provider Management
      summary: Get provider health status
      description: Retrieves the current health status and metrics for an AI provider
      security:
        - localAuth: []
      parameters:
        - name: providerId
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '200':
          description: Provider health status retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/AIProviderHealth'

    post:
      tags:
        - AI Provider Management
      summary: Trigger health check
      description: Triggers an immediate health check for the specified AI provider
      security:
        - localAuth: []
      parameters:
        - name: providerId
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '200':
          description: Health check triggered successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/AIProviderHealth'

  /api/v1/ai-providers/route:
    post:
      tags:
        - AI Provider Management
      summary: Route AI generation request
      description: Routes an AI generation request to the optimal provider based on routing strategy and current conditions
      security:
        - localAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                generationRequest:
                  $ref: '#/components/schemas/GenerationRequest'
                priority:
                  type: string
                  enum: [low, normal, high, critical]
                  default: normal
                routingStrategy:
                  type: string
                  enum: [round_robin, least_loaded, quality_based, cost_optimized, failover_only]
                  default: quality_based
                requiredCapabilities:
                  type: array
                  items:
                    type: string
                    enum: [code_generation, architecture_design, code_review, documentation, testing, debugging, refactoring]
              required:
                - generationRequest
      responses:
        '200':
          description: Request routed successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          queueEntry:
                            $ref: '#/components/schemas/AIRequestQueueEntry'
                          estimatedWaitTime:
                            type: integer
                            description: Estimated wait time in milliseconds
        '503':
          description: No available providers for request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

  /api/v1/ai-providers/queue:
    get:
      tags:
        - AI Provider Management
      summary: Get request queue status
      description: Retrieves the current status of the AI request queue
      security:
        - localAuth: []
      parameters:
        - name: status
          in: query
          description: Filter by queue entry status
          required: false
          schema:
            type: string
            enum: [queued, processing, completed, failed, cancelled]
        - name: providerId
          in: query
          description: Filter by provider ID
          required: false
          schema:
            $ref: '#/components/schemas/UUID'
        - name: limit
          in: query
          description: Maximum number of entries to return
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
      responses:
        '200':
          description: Queue status retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          queueEntries:
                            type: array
                            items:
                              $ref: '#/components/schemas/AIRequestQueueEntry'
                          queueStats:
                            type: object
                            properties:
                              totalQueued:
                                type: integer
                              totalProcessing:
                                type: integer
                              avgWaitTime:
                                type: number
                              avgProcessingTime:
                                type: number

  /api/v1/ai-providers/analytics:
    get:
      tags:
        - AI Provider Management
      summary: Get AI usage analytics
      description: Retrieves comprehensive usage analytics and performance metrics for AI providers
      security:
        - localAuth: []
      parameters:
        - name: period
          in: query
          description: Analytics time period
          required: false
          schema:
            type: string
            enum: [hour, day, week, month]
            default: day
        - name: startDate
          in: query
          description: Start date for custom period
          required: false
          schema:
            type: string
            format: date
        - name: endDate
          in: query
          description: End date for custom period
          required: false
          schema:
            type: string
            format: date
        - name: providerId
          in: query
          description: Filter analytics by specific provider
          required: false
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '200':
          description: AI usage analytics retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/AIUsageAnalytics'

  /api/v1/ai-providers/optimization:
    get:
      tags:
        - AI Provider Management
      summary: Get optimization recommendations
      description: Retrieves AI provider optimization recommendations based on usage patterns and performance metrics
      security:
        - localAuth: []
      parameters:
        - name: providerId
          in: query
          description: Get recommendations for specific provider
          required: false
          schema:
            $ref: '#/components/schemas/UUID'
        - name: type
          in: query
          description: Filter recommendations by type
          required: false
          schema:
            type: string
            enum: [performance, cost, quality, usage, configuration]
        - name: priority
          in: query
          description: Filter recommendations by priority
          required: false
          schema:
            type: string
            enum: [low, medium, high, critical]
      responses:
        '200':
          description: Optimization recommendations retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          recommendations:
                            type: array
                            items:
                              $ref: '#/components/schemas/ProviderOptimization'
                          summary:
                            type: object
                            properties:
                              totalRecommendations:
                                type: integer
                              criticalCount:
                                type: integer
                              potentialSavings:
                                type: object
                                properties:
                                  performance:
                                    type: number
                                  cost:
                                    type: number
                                  quality:
                                    type: number

components:
  schemas:
    AIProviderConfig:
      type: object
      required:
        - id
        - name
        - type
        - status
        - priority
        - capabilities
        - apiConfig
        - tokenBudget
        - qualityThresholds
        - config
        - createdAt
        - updatedAt
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        name:
          type: string
        type:
          $ref: '#/components/schemas/AIProviderType'
        description:
          type: string
        status:
          type: string
          enum: [active, inactive, degraded, failed, maintenance]
        priority:
          type: integer
        capabilities:
          type: array
          items:
            type: string
            enum: [code_generation, architecture_design, code_review, documentation, testing, debugging, refactoring]
        apiConfig:
          type: object
          properties:
            baseUrl:
              type: string
            apiKeyRef:
              type: string
            timeout:
              type: integer
            maxRetries:
              type: integer
            rateLimit:
              type: object
              properties:
                requestsPerMinute:
                  type: integer
                tokensPerMinute:
                  type: integer
        tokenBudget:
          type: object
          properties:
            maxTokensPerPeriod:
              type: integer
            period:
              type: string
              enum: [hourly, daily, weekly, monthly]
            currentUsage:
              type: integer
            resetAt:
              type: string
              format: date-time
        qualityThresholds:
          type: object
          properties:
            minConfidence:
              type: number
            maxResponseTime:
              type: integer
            maxErrorRate:
              type: number
        config:
          type: object
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    AIProviderHealth:
      type: object
      required:
        - providerId
        - status
        - healthScore
        - lastChecked
        - metrics
        - recentErrors
        - nextCheckAt
      properties:
        providerId:
          $ref: '#/components/schemas/UUID'
        status:
          type: string
          enum: [active, inactive, degraded, failed, maintenance]
        healthScore:
          type: number
          minimum: 0
          maximum: 100
        lastChecked:
          type: string
          format: date-time
        metrics:
          type: object
          properties:
            avgResponseTime:
              type: number
            successRate:
              type: number
            errorRate:
              type: number
            currentLoad:
              type: number
            tokenEfficiency:
              type: number
            avgQualityScore:
              type: number
        recentErrors:
          type: array
          items:
            type: object
            properties:
              timestamp:
                type: string
                format: date-time
              error:
                type: string
              severity:
                type: string
                enum: [low, medium, high, critical]
        nextCheckAt:
          type: string
          format: date-time

    AIRequestQueueEntry:
      type: object
      required:
        - id
        - generationRequest
        - priority
        - routing
        - timestamps
        - status
        - retries
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        generationRequest:
          $ref: '#/components/schemas/GenerationRequest'
        priority:
          type: string
          enum: [low, normal, high, critical]
        routing:
          type: object
          properties:
            requestId:
              $ref: '#/components/schemas/UUID'
            providerId:
              $ref: '#/components/schemas/UUID'
            strategy:
              type: string
              enum: [round_robin, least_loaded, quality_based, cost_optimized, failover_only]
            factors:
              type: object
              properties:
                healthScore:
                  type: number
                currentLoad:
                  type: number
                qualityScore:
                  type: number
                costFactor:
                  type: number
                capabilityMatch:
                  type: number
            fallbackProviders:
              type: array
              items:
                $ref: '#/components/schemas/UUID'
            routedAt:
              type: string
              format: date-time
        timestamps:
          type: object
          properties:
            queuedAt:
              type: string
              format: date-time
            startedAt:
              type: string
              format: date-time
            completedAt:
              type: string
              format: date-time
        status:
          type: string
          enum: [queued, processing, completed, failed, cancelled]
        retries:
          type: object
          properties:
            count:
              type: integer
            maxRetries:
              type: integer
            nextRetryAt:
              type: string
              format: date-time
        error:
          type: object
          properties:
            code:
              type: string
            message:
              type: string
            details:
              type: object

    AIUsageAnalytics:
      type: object
      required:
        - id
        - period
        - overall
        - providerStats
        - capabilityStats
        - trends
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        period:
          type: object
          properties:
            start:
              type: string
              format: date-time
            end:
              type: string
              format: date-time
        overall:
          type: object
          properties:
            totalRequests:
              type: integer
            successfulRequests:
              type: integer
            failedRequests:
              type: integer
            totalTokens:
              type: integer
            avgResponseTime:
              type: number
            avgQualityScore:
              type: number
        providerStats:
          type: array
          items:
            type: object
            properties:
              providerId:
                $ref: '#/components/schemas/UUID'
              providerName:
                type: string
              requests:
                type: integer
              tokens:
                type: integer
              avgResponseTime:
                type: number
              successRate:
                type: number
              avgQualityScore:
                type: number
              costEstimate:
                type: number
        capabilityStats:
          type: array
          items:
            type: object
            properties:
              capability:
                type: string
                enum: [code_generation, architecture_design, code_review, documentation, testing, debugging, refactoring]
              requests:
                type: integer
              tokens:
                type: integer
              avgResponseTime:
                type: number
              successRate:
                type: number
              avgQualityScore:
                type: number
        trends:
          type: object
          properties:
            requestTrend:
              type: array
              items:
                type: object
                properties:
                  timestamp:
                    type: string
                    format: date-time
                  count:
                    type: integer
            tokenTrend:
              type: array
              items:
                type: object
                properties:
                  timestamp:
                    type: string
                    format: date-time
                  tokens:
                    type: integer
            qualityTrend:
              type: array
              items:
                type: object
                properties:
                  timestamp:
                    type: string
                    format: date-time
                  avgQuality:
                    type: number

    ProviderOptimization:
      type: object
      required:
        - id
        - providerId
        - type
        - title
        - description
        - impact
        - complexity
        - priority
        - generatedAt
        - applied
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        providerId:
          $ref: '#/components/schemas/UUID'
        type:
          type: string
          enum: [performance, cost, quality, usage, configuration]
        title:
          type: string
        description:
          type: string
        impact:
          type: object
          properties:
            performanceGain:
              type: number
            costReduction:
              type: number
            qualityGain:
              type: number
        complexity:
          type: string
          enum: [low, medium, high]
        priority:
          type: string
          enum: [low, medium, high, critical]
        generatedAt:
          type: string
          format: date-time
        applied:
          type: boolean
```

## **4. Detailed Business Logic & Validation Rules**

| Rule ID | Rule Description | Implementation Location(s) & Notes |
|---------|------------------|-----------------------------------|
| **AIP-01** | AI provider configurations must be validated against the Configuration Management Module to ensure API keys exist and are valid before activation. | **Backend (Authoritative):** Provider service must query Configuration Management Module to validate apiKeyRef exists and perform test API calls during provider registration and updates. |
| **AIP-02** | Request routing must respect provider token budgets and automatically exclude providers that have exceeded their allocated tokens for the current period. | **Backend (Authoritative):** Routing service must check tokenBudget.currentUsage against maxTokensPerPeriod and exclude providers at limit. Must reset usage counters based on period configuration. |
| **AIP-03** | Provider health checks must be performed automatically every 5 minutes for active providers and results must be logged to the Logging & Monitoring Service for trend analysis. | **Backend (Authoritative):** Health monitoring service must schedule periodic checks, update provider status based on health thresholds, and log all health metrics to Logging Service for analytics. |
| **AIP-04** | AI generation requests must be routed through this module and cannot directly access provider integrations like Claude Integration Service to ensure proper usage tracking and failover. | **Backend (Authoritative):** All GenerationRequest routing must go through AI Provider Management. Claude Integration Service and other providers should only accept requests from this module's orchestration layer. |
| **AIP-05** | Request queue prioritization must ensure critical and high-priority requests are processed before normal and low-priority requests, with automatic escalation for requests waiting over 30 seconds. | **Backend (Authoritative):** Queue processing service must implement priority-based dequeuing and automatic priority escalation based on wait time thresholds to maintain development velocity KPIs. |
| **AIP-06** | Provider failover must be automatic when primary provider fails, with requests automatically retried on fallback providers in order until success or max retries reached. | **Backend (Authoritative):** Request processing service must implement cascading failover through fallbackProviders array with exponential backoff and comprehensive error logging for each attempt. |
| **AIP-07** | Usage analytics must aggregate data from all provider interactions while maintaining privacy by not storing individual request contents, only metadata and performance metrics. | **Backend (Authoritative):** Analytics service must collect usage metrics, response times, token counts, and quality scores without storing actual request/response content to maintain local-first privacy principles. |
| **AIP-08** | Provider optimization recommendations must be generated weekly based on usage patterns, performance metrics, and cost analysis, with automatic application of low-risk optimizations. | **Backend (Authoritative):** Optimization engine must analyze provider performance trends, identify improvement opportunities, and automatically apply safe optimizations while alerting users to high-impact recommendations. |
| **AIP-09** | Token budget enforcement must prevent providers from exceeding their allocated limits and must provide warnings at 80% usage with automatic notifications to Configuration Management Module. | **Backend (Authoritative):** Budget monitoring service must track token usage in real-time, send warnings at thresholds, and coordinate with Configuration Management to update budget configurations. |
| **AIP-10** | Provider capability matching must ensure requests are only routed to providers that support the required capabilities, with quality-based selection among capable providers. | **Backend (Authoritative):** Routing service must filter providers by required capabilities before applying routing strategy, ensuring capability compatibility while optimizing for quality and performance metrics. |

## **5. Developer Task Checklist**

### **Backend Tasks:**
- [ ] Create database migration script for AI provider management tables (`ai_providers`, `ai_provider_health`, `ai_request_queue`, `ai_usage_analytics`, `provider_optimizations`)
- [ ] Implement the `AIProviderService` class with comprehensive provider lifecycle management including registration, configuration, health monitoring, and deactivation
- [ ] Implement the `AIRequestRoutingService` class for intelligent request routing with multiple strategies (round_robin, least_loaded, quality_based, cost_optimized, failover_only)
- [ ] Implement the `AIRequestQueueService` class for managing request queues with priority handling, automatic escalation, and retry logic
- [ ] Implement the `AIProviderHealthService` class for automated health monitoring, status tracking, and health score calculation based on performance metrics
- [ ] Implement the `AIUsageAnalyticsService` class for collecting and aggregating usage statistics, performance trends, and cost analysis
- [ ] Implement the `AIProviderOptimizationService` class for generating optimization recommendations and applying safe automatic optimizations
- [ ] Implement all AI provider management endpoints (`GET`, `POST /api/v1/ai-providers`, `GET`, `PUT`, `DELETE /api/v1/ai-providers/{id}`) with comprehensive validation
- [ ] Implement provider health monitoring endpoints (`GET`, `POST /api/v1/ai-providers/{id}/health`) with real-time status updates
- [ ] Implement request routing endpoint (`POST /api/v1/ai-providers/route`) with intelligent provider selection and queue management
- [ ] Implement queue management endpoint (`GET /api/v1/ai-providers/queue`) with status filtering and performance statistics
- [ ] Implement analytics endpoint (`GET /api/v1/ai-providers/analytics`) with time-based filtering and trend analysis
- [ ] Implement optimization recommendations endpoint (`GET /api/v1/ai-providers/optimization`) with actionable insights and impact analysis
- [ ] Create `AIProviderRepository` class for database operations with proper indexing on provider status, capabilities, and performance metrics
- [ ] Create `AIRequestQueueRepository` class for queue persistence with priority-based querying and cleanup of completed requests
- [ ] Create `AIUsageAnalyticsRepository` class for time-series usage data storage with efficient aggregation capabilities
- [ ] Implement integration with Configuration Management Module for API key validation, budget configuration, and system settings coordination
- [ ] Implement integration with Logging & Monitoring Service for comprehensive usage tracking, performance metrics, and error reporting
- [ ] Implement integration with Claude Integration Service as the primary AI provider implementation with proper abstraction layers
- [ ] Implement automated background services for health monitoring, queue processing, analytics calculation, and optimization recommendation generation
- [ ] Create comprehensive unit tests for all service classes with mock implementations of dependent modules and edge case coverage
- [ ] Create integration tests for request routing workflows including failover scenarios, budget enforcement, and queue processing
- [ ] Implement performance optimizations for request routing decisions with caching of provider health and capability data
- [ ] Add comprehensive monitoring and alerting for provider failures, budget exhaustion, and performance degradation scenarios

### **Frontend Tasks:**
- [ ] Create `AIProviderProvider` React context for accessing AI provider management functionality throughout the application
- [ ] Implement `useAIProviders` hook for managing provider configurations, health monitoring, and usage analytics
- [ ] Create `AIProviderDashboard` component for displaying provider status, performance metrics, and health indicators
- [ ] Implement `AIProviderConfig` component for adding, editing, and configuring AI providers with validation and testing capabilities
- [ ] Create `AIProviderHealth` component for real-time health monitoring with visual status indicators and alert notifications
- [ ] Implement `AIRequestQueue` component for displaying current queue status, processing times, and request priorities
- [ ] Create `AIUsageAnalytics` component for visualizing usage statistics, cost analysis, and performance trends with charts and graphs
- [ ] Implement `AIOptimizationRecommendations` component for displaying and managing optimization suggestions with impact assessments
- [ ] Create AI provider service functions in the API client (`aiProviderService.ts`) for all provider management endpoints
- [ ] Implement provider selection interface for manually choosing providers for specific requests or project configurations
- [ ] Create provider comparison tools for evaluating provider performance, costs, and quality across different metrics
- [ ] Implement real-time provider status monitoring with automatic updates and notification systems for status changes
- [ ] Add provider configuration wizards for easy setup of new providers with guided validation and testing procedures
- [ ] Create usage budget monitoring interface with alerts and recommendations for budget optimization
- [ ] Implement provider performance analytics with historical trend analysis and comparative performance metrics
- [ ] Add integration with settings page for global AI provider configuration and preference management
- [ ] Create debugging tools for troubleshooting provider issues including request tracing, error analysis, and health diagnostics
- [ ] Implement export functionality for usage analytics and performance reports for external analysis
- [ ] Add provider marketplace interface for discovering and adding new AI providers with capability and cost comparisons
- [ ] Create automated optimization application interface for reviewing and applying system-generated optimization recommendations



========================================================================================


# Phase Management Module - Technical Specification

## **1. Module Overview**

**Purpose:** The Phase Management Module serves as the core orchestrator for ReadyAI's 7-phase development methodology, managing individual phase lifecycles, tracking phase artifacts and dependencies, validating phase completion criteria, and enabling phase progression and rollback capabilities. This module ensures structured project development flow from Phase 0 (Strategic Charter) through Phase 7 (Iteration) while maintaining architectural integrity and supporting the 70-90% development velocity KPI defined in the charter.

**Dependencies & Interactions:** This module depends on the Project Management Module to access and update project state and metadata, ensuring phase operations are performed within valid project contexts. It interacts with the AI Provider Management Module (referenced in dependencies but not yet specified) to trigger AI-powered generation tasks during specific phases like Phase 3.1 (File Generation) and Phase 2.1/2.3 (Module Specification). The module integrates with the File System Management Module to persist phase artifacts, manage file dependencies, and coordinate with workspace operations. It also utilizes the Configuration Management Module for phase-specific configuration settings and validation thresholds, and leverages the Logging & Monitoring Service to track phase progression metrics, performance monitoring for the development velocity KPI, and audit trails for phase state changes.

## **2. Module-Specific Type Additions (`types.phaseManagement.ts`)**

```typescript
/**
 * Phase Management Module Types
 * Extends foundational types with phase-specific management interfaces
 */

/** Phase transition types */
export type PhaseTransition = 
  | 'start'
  | 'complete'
  | 'validate'
  | 'rollback'
  | 'skip'
  | 'retry';

/** Phase validation result types */
export type PhaseValidationType = 
  | 'dependency_check'
  | 'artifact_validation'
  | 'quality_gate'
  | 'ai_generation_check'
  | 'file_integrity'
  | 'phase_completion';

/** Phase execution context */
export interface PhaseExecutionContext {
  /** Project context */
  projectId: UUID;
  /** Current phase being executed */
  phaseId: PhaseType;
  /** Execution mode */
  mode: 'automatic' | 'manual' | 'ai_assisted';
  /** AI provider preferences */
  aiConfig?: {
    provider: AIProviderType;
    extendedThinking: boolean;
    contextCompression: 'minimal' | 'standard' | 'aggressive';
  };
  /** User session information */
  sessionId?: string;
  /** Execution timestamp */
  startedAt: string; // ISO 8601 format
  /** Estimated completion time */
  estimatedCompletion?: string; // ISO 8601 format
}

/** Phase transition request */
export interface PhaseTransitionRequest {
  /** Target phase transition */
  transition: PhaseTransition;
  /** Optional reason for transition */
  reason?: string;
  /** Force transition even if validations fail */
  force?: boolean;
  /** Skip validation checks */
  skipValidation?: boolean;
  /** Additional metadata */
  metadata?: Record<string, any>;
}

/** Phase validation summary */
export interface PhaseValidationSummary {
  /** Validation identifier */
  id: UUID;
  /** Phase being validated */
  phaseId: PhaseType;
  /** Overall validation status */
  overallStatus: 'passed' | 'failed' | 'warning';
  /** Individual validation results */
  validations: ValidationResult[];
  /** Validation timestamp */
  validatedAt: string; // ISO 8601 format
  /** Validation execution time */
  executionTime: number; // milliseconds
  /** Validation summary message */
  summary?: string;
  /** Recommendations for fixing failures */
  recommendations?: string[];
}

/** Phase dependency information */
export interface PhaseDependencyInfo {
  /** Dependent phase */
  phaseId: PhaseType;
  /** Required predecessor phases */
  dependencies: PhaseType[];
  /** Optional phases that enhance this phase */
  optionalDependencies?: PhaseType[];
  /** Whether dependencies are currently satisfied */
  dependenciesSatisfied: boolean;
  /** Unsatisfied dependencies */
  unsatisfiedDependencies: PhaseType[];
  /** Dependency validation timestamp */
  lastChecked: string; // ISO 8601 format
}

/** Phase rollback information */
export interface PhaseRollbackInfo {
  /** Rollback identifier */
  id: UUID;
  /** Source phase (rolling back from) */
  fromPhase: PhaseType;
  /** Target phase (rolling back to) */
  toPhase: PhaseType;
  /** Rollback timestamp */
  rolledBackAt: string; // ISO 8601 format
  /** Reason for rollback */
  reason: string;
  /** Artifacts affected by rollback */
  affectedArtifacts: UUID[];
  /** Whether rollback was successful */
  successful: boolean;
  /** Rollback execution details */
  details?: string;
}

/** Phase progression history */
export interface PhaseProgressionHistory {
  /** Progression entry identifier */
  id: UUID;
  /** Project context */
  projectId: UUID;
  /** Phase transition details */
  fromPhase?: PhaseType;
  /** Target phase */
  toPhase: PhaseType;
  /** Type of transition */
  transitionType: PhaseTransition;
  /** Transition timestamp */
  transitionedAt: string; // ISO 8601 format
  /** User or system that initiated transition */
  initiatedBy: string;
  /** Transition success status */
  successful: boolean;
  /** Execution duration */
  executionDuration: number; // milliseconds
  /** Additional transition metadata */
  metadata?: Record<string, any>;
}

/** Phase performance metrics */
export interface PhasePerformanceMetrics {
  /** Metrics identifier */
  id: UUID;
  /** Project context */
  projectId: UUID;
  /** Phase identifier */
  phaseId: PhaseType;
  /** Phase start time */
  startTime: string; // ISO 8601 format
  /** Phase completion time */
  completionTime?: string; // ISO 8601 format
  /** Total duration in milliseconds */
  duration?: number;
  /** Number of artifacts generated */
  artifactsGenerated: number;
  /** Number of validation attempts */
  validationAttempts: number;
  /** Number of AI generation requests */
  aiGenerationRequests: number;
  /** Average AI response time */
  avgAiResponseTime?: number;
  /** File system operations count */
  fileSystemOperations: number;
  /** Quality score (0-100) */
  qualityScore?: number;
  /** Metrics collection timestamp */
  collectedAt: string; // ISO 8601 format
}

/** Phase template configuration */
export interface PhaseTemplate {
  /** Template identifier */
  id: UUID;
  /** Phase type this template applies to */
  phaseType: PhaseType;
  /** Template name */
  name: string;
  /** Template description */
  description?: string;
  /** Default validation rules */
  validationRules: ValidationRule[];
  /** Required artifacts template */
  requiredArtifacts: ArtifactTemplate[];
  /** Default AI generation settings */
  aiSettings?: {
    provider: AIProviderType;
    extendedThinking: boolean;
    contextCompression: 'minimal' | 'standard' | 'aggressive';
  };
  /** Template creation timestamp */
  createdAt: string; // ISO 8601 format
  /** Template last updated timestamp */
  updatedAt: string; // ISO 8601 format
}

/** Validation rule configuration */
export interface ValidationRule {
  /** Rule identifier */
  id: UUID;
  /** Rule name */
  name: string;
  /** Validation type */
  type: PhaseValidationType;
  /** Whether rule is required for phase completion */
  required: boolean;
  /** Rule configuration parameters */
  parameters: Record<string, any>;
  /** Rule description */
  description?: string;
}

/** Artifact template */
export interface ArtifactTemplate {
  /** Template identifier */
  id: UUID;
  /** Artifact filename pattern */
  filenamePattern: string;
  /** Artifact path pattern */
  pathPattern: string;
  /** Whether artifact is required */
  required: boolean;
  /** Artifact type/category */
  category: string;
  /** Template description */
  description?: string;
}
```

## **3. API Endpoint Specification (OpenAPI `paths` block)**

```yaml
paths:
  /api/v1/phases/project/{projectId}:
    get:
      tags:
        - Phases
      summary: Get project phase status
      description: Retrieves the current phase status and progression for a specific project, including phase history and performance metrics
      security:
        - localAuth: []
      parameters:
        - name: projectId
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
        - name: includeHistory
          in: query
          description: Include phase progression history
          required: false
          schema:
            type: boolean
            default: false
        - name: includeMetrics
          in: query
          description: Include phase performance metrics
          required: false
          schema:
            type: boolean
            default: false
      responses:
        '200':
          description: Project phase status retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          currentPhase:
                            $ref: '#/components/schemas/PhaseType'
                          phases:
                            type: array
                            items:
                              type: object
                              properties:
                                phase:
                                  $ref: '#/components/schemas/Phase'
                                dependencies:
                                  $ref: '#/components/schemas/PhaseDependencyInfo'
                          progressionHistory:
                            type: array
                            items:
                              $ref: '#/components/schemas/PhaseProgressionHistory'
                          performanceMetrics:
                            type: array
                            items:
                              $ref: '#/components/schemas/PhasePerformanceMetrics'
        '404':
          description: Project not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

  /api/v1/phases/project/{projectId}/phase/{phaseId}/transition:
    post:
      tags:
        - Phases
      summary: Execute phase transition
      description: Executes a phase transition (start, complete, validate, rollback) with validation and dependency checking. Interacts with Project Management Module to update project state and File System Management for artifact operations.
      security:
        - localAuth: []
      parameters:
        - name: projectId
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
        - name: phaseId
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/PhaseType'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PhaseTransitionRequest'
      responses:
        '200':
          description: Phase transition executed successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          transitionResult:
                            type: object
                            properties:
                              successful:
                                type: boolean
                              newPhaseStatus:
                                $ref: '#/components/schemas/PhaseStatus'
                              validationResults:
                                type: array
                                items:
                                  $ref: '#/components/schemas/ValidationResult'
                              executionTime:
                                type: number
                              artifactsCreated:
                                type: array
                                items:
                                  $ref: '#/components/schemas/UUID'
                              nextRecommendedPhase:
                                $ref: '#/components/schemas/PhaseType'
        '400':
          description: Invalid transition request or validation failures
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiErrorResponse'
                  - type: object
                    properties:
                      error:
                        type: object
                        properties:
                          validationErrors:
                            type: array
                            items:
                              $ref: '#/components/schemas/ValidationResult'
        '404':
          description: Project or phase not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

  /api/v1/phases/project/{projectId}/phase/{phaseId}/validate:
    post:
      tags:
        - Phases
      summary: Validate phase completion
      description: Validates whether a phase meets all completion criteria including dependencies, artifacts, and quality gates without executing transition
      security:
        - localAuth: []
      parameters:
        - name: projectId
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
        - name: phaseId
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/PhaseType'
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              properties:
                validationTypes:
                  type: array
                  items:
                    type: string
                    enum: [dependency_check, artifact_validation, quality_gate, ai_generation_check, file_integrity, phase_completion]
                strictMode:
                  type: boolean
                  default: false
      responses:
        '200':
          description: Phase validation completed
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/PhaseValidationSummary'

  /api/v1/phases/project/{projectId}/phase/{phaseId}/artifacts:
    get:
      tags:
        - Phases
      summary: Get phase artifacts
      description: Retrieves all artifacts associated with a specific phase, with integration to File System Management Module for file metadata
      security:
        - localAuth: []
      parameters:
        - name: projectId
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
        - name: phaseId
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/PhaseType'
        - name: includeContent
          in: query
          description: Include artifact content in response
          required: false
          schema:
            type: boolean
            default: false
      responses:
        '200':
          description: Phase artifacts retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          artifacts:
                            type: array
                            items:
                              $ref: '#/components/schemas/PhaseArtifact'
                          totalCount:
                            type: integer
                          totalSize:
                            type: integer
                            description: Total size in bytes

    post:
      tags:
        - Phases
      summary: Create phase artifact
      description: Creates a new phase artifact with coordination to File System Management Module for file operations and Logging Service for audit trails
      security:
        - localAuth: []
      parameters:
        - name: projectId
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
        - name: phaseId
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/PhaseType'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                filename:
                  type: string
                  minLength: 1
                path:
                  type: string
                  minLength: 1
                content:
                  type: string
                  minLength: 1
                contentType:
                  type: string
                  default: "text/plain"
                metadata:
                  type: object
                overwrite:
                  type: boolean
                  default: false
              required:
                - filename
                - path
                - content
      responses:
        '201':
          description: Phase artifact created successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/PhaseArtifact'
        '409':
          description: Artifact already exists and overwrite not specified
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

  /api/v1/phases/project/{projectId}/phase/{phaseId}/rollback:
    post:
      tags:
        - Phases
      summary: Rollback phase
      description: Rollback a phase to a previous state with artifact restoration and dependency validation
      security:
        - localAuth: []
      parameters:
        - name: projectId
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
        - name: phaseId
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/PhaseType'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                targetPhase:
                  $ref: '#/components/schemas/PhaseType'
                reason:
                  type: string
                  minLength: 1
                preserveArtifacts:
                  type: boolean
                  default: false
                force:
                  type: boolean
                  default: false
              required:
                - targetPhase
                - reason
      responses:
        '200':
          description: Phase rollback completed successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/PhaseRollbackInfo'
        '400':
          description: Invalid rollback request or rollback not possible
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

  /api/v1/phases/project/{projectId}/dependencies:
    get:
      tags:
        - Phases
      summary: Get project phase dependencies
      description: Retrieves dependency information for all phases in a project
      security:
        - localAuth: []
      parameters:
        - name: projectId
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '200':
          description: Phase dependencies retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          dependencies:
                            type: array
                            items:
                              $ref: '#/components/schemas/PhaseDependencyInfo'
                          dependencyGraph:
                            type: object
                            description: Visual representation of phase dependencies

  /api/v1/phases/templates:
    get:
      tags:
        - Phases
      summary: Get phase templates
      description: Retrieves available phase templates for different project types
      security:
        - localAuth: []
      parameters:
        - name: phaseType
          in: query
          description: Filter templates by phase type
          required: false
          schema:
            $ref: '#/components/schemas/PhaseType'
      responses:
        '200':
          description: Phase templates retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          templates:
                            type: array
                            items:
                              $ref: '#/components/schemas/PhaseTemplate'

    post:
      tags:
        - Phases
      summary: Create phase template
      description: Creates a new phase template for reuse across projects
      security:
        - localAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                phaseType:
                  $ref: '#/components/schemas/PhaseType'
                name:
                  type: string
                  minLength: 1
                  maxLength: 100
                description:
                  type: string
                  maxLength: 500
                validationRules:
                  type: array
                  items:
                    $ref: '#/components/schemas/ValidationRule'
                requiredArtifacts:
                  type: array
                  items:
                    $ref: '#/components/schemas/ArtifactTemplate'
                aiSettings:
                  type: object
                  properties:
                    provider:
                      $ref: '#/components/schemas/AIProviderType'
                    extendedThinking:
                      type: boolean
                    contextCompression:
                      type: string
                      enum: [minimal, standard, aggressive]
              required:
                - phaseType
                - name
                - validationRules
                - requiredArtifacts
      responses:
        '201':
          description: Phase template created successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/PhaseTemplate'

  /api/v1/phases/metrics:
    get:
      tags:
        - Phases
      summary: Get phase performance metrics
      description: Retrieves aggregated performance metrics across projects and phases for KPI tracking
      security:
        - localAuth: []
      parameters:
        - name: projectId
          in: query
          description: Filter metrics by project
          required: false
          schema:
            $ref: '#/components/schemas/UUID'
        - name: phaseType
          in: query
          description: Filter metrics by phase type
          required: false
          schema:
            $ref: '#/components/schemas/PhaseType'
        - name: startDate
          in: query
          description: Start date for metrics period
          required: false
          schema:
            type: string
            format: date
        - name: endDate
          in: query
          description: End date for metrics period
          required: false
          schema:
            type: string
            format: date
        - name: aggregation
          in: query
          description: Metrics aggregation level
          required: false
          schema:
            type: string
            enum: [project, phase, daily, weekly]
            default: project
      responses:
        '200':
          description: Phase performance metrics retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          metrics:
                            type: array
                            items:
                              $ref: '#/components/schemas/PhasePerformanceMetrics'
                          aggregatedMetrics:
                            type: object
                            properties:
                              avgPhaseCompletionTime:
                                type: number
                              totalArtifactsGenerated:
                                type: integer
                              avgQualityScore:
                                type: number
                              phaseSuccessRate:
                                type: number
                              developmentVelocityImpact:
                                type: number
                                description: Impact on 70-90% velocity KPI

components:
  schemas:
    PhaseTransitionRequest:
      type: object
      required:
        - transition
      properties:
        transition:
          type: string
          enum: [start, complete, validate, rollback, skip, retry]
        reason:
          type: string
        force:
          type: boolean
          default: false
        skipValidation:
          type: boolean
          default: false
        metadata:
          type: object

    PhaseValidationSummary:
      type: object
      required:
        - id
        - phaseId
        - overallStatus
        - validations
        - validatedAt
        - executionTime
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        phaseId:
          $ref: '#/components/schemas/PhaseType'
        overallStatus:
          type: string
          enum: [passed, failed, warning]
        validations:
          type: array
          items:
            $ref: '#/components/schemas/ValidationResult'
        validatedAt:
          type: string
          format: date-time
        executionTime:
          type: number
        summary:
          type: string
        recommendations:
          type: array
          items:
            type: string

    PhaseDependencyInfo:
      type: object
      required:
        - phaseId
        - dependencies
        - dependenciesSatisfied
        - unsatisfiedDependencies
        - lastChecked
      properties:
        phaseId:
          $ref: '#/components/schemas/PhaseType'
        dependencies:
          type: array
          items:
            $ref: '#/components/schemas/PhaseType'
        optionalDependencies:
          type: array
          items:
            $ref: '#/components/schemas/PhaseType'
        dependenciesSatisfied:
          type: boolean
        unsatisfiedDependencies:
          type: array
          items:
            $ref: '#/components/schemas/PhaseType'
        lastChecked:
          type: string
          format: date-time

    PhaseRollbackInfo:
      type: object
      required:
        - id
        - fromPhase
        - toPhase
        - rolledBackAt
        - reason
        - affectedArtifacts
        - successful
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        fromPhase:
          $ref: '#/components/schemas/PhaseType'
        toPhase:
          $ref: '#/components/schemas/PhaseType'
        rolledBackAt:
          type: string
          format: date-time
        reason:
          type: string
        affectedArtifacts:
          type: array
          items:
            $ref: '#/components/schemas/UUID'
        successful:
          type: boolean
        details:
          type: string

    PhaseProgressionHistory:
      type: object
      required:
        - id
        - projectId
        - toPhase
        - transitionType
        - transitionedAt
        - initiatedBy
        - successful
        - executionDuration
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        projectId:
          $ref: '#/components/schemas/UUID'
        fromPhase:
          $ref: '#/components/schemas/PhaseType'
        toPhase:
          $ref: '#/components/schemas/PhaseType'
        transitionType:
          type: string
          enum: [start, complete, validate, rollback, skip, retry]
        transitionedAt:
          type: string
          format: date-time
        initiatedBy:
          type: string
        successful:
          type: boolean
        executionDuration:
          type: number
        metadata:
          type: object

    PhasePerformanceMetrics:
      type: object
      required:
        - id
        - projectId
        - phaseId
        - startTime
        - artifactsGenerated
        - validationAttempts
        - aiGenerationRequests
        - fileSystemOperations
        - collectedAt
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        projectId:
          $ref: '#/components/schemas/UUID'
        phaseId:
          $ref: '#/components/schemas/PhaseType'
        startTime:
          type: string
          format: date-time
        completionTime:
          type: string
          format: date-time
        duration:
          type: number
        artifactsGenerated:
          type: integer
        validationAttempts:
          type: integer
        aiGenerationRequests:
          type: integer
        avgAiResponseTime:
          type: number
        fileSystemOperations:
          type: integer
        qualityScore:
          type: number
          minimum: 0
          maximum: 100
        collectedAt:
          type: string
          format: date-time

    PhaseTemplate:
      type: object
      required:
        - id
        - phaseType
        - name
        - validationRules
        - requiredArtifacts
        - createdAt
        - updatedAt
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        phaseType:
          $ref: '#/components/schemas/PhaseType'
        name:
          type: string
        description:
          type: string
        validationRules:
          type: array
          items:
            $ref: '#/components/schemas/ValidationRule'
        requiredArtifacts:
          type: array
          items:
            $ref: '#/components/schemas/ArtifactTemplate'
        aiSettings:
          type: object
          properties:
            provider:
              $ref: '#/components/schemas/AIProviderType'
            extendedThinking:
              type: boolean
            contextCompression:
              type: string
              enum: [minimal, standard, aggressive]
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    ValidationRule:
      type: object
      required:
        - id
        - name
        - type
        - required
        - parameters
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        name:
          type: string
        type:
          type: string
          enum: [dependency_check, artifact_validation, quality_gate, ai_generation_check, file_integrity, phase_completion]
        required:
          type: boolean
        parameters:
          type: object
        description:
          type: string

    ArtifactTemplate:
      type: object
      required:
        - id
        - filenamePattern
        - pathPattern
        - required
        - category
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        filenamePattern:
          type: string
        pathPattern:
          type: string
        required:
          type: boolean
        category:
          type: string
        description:
          type: string
```

## **4. Detailed Business Logic & Validation Rules**

| Rule ID | Rule Description | Implementation Location(s) & Notes |
|---------|------------------|-----------------------------------|
| **PHS-01** | Phase transitions must respect the 7-phase methodology dependency order and cannot skip required predecessor phases without explicit force override. | **Backend (Authoritative):** Phase transition service must validate dependency chain by checking Project Management Module project state and ensuring all required predecessor phases are completed before allowing transition. |
| **PHS-02** | Phase 3.1 (File Generation) transitions must coordinate with AI Provider Management Module to trigger context-aware code generation using project's configured AI provider settings. | **Backend (Authoritative):** Phase transition service must invoke AI Provider Management endpoints with context package from Context Management Engine when transitioning to Phase 3.1, respecting project's AI configuration from Project Management Module. |
| **PHS-03** | Phase artifacts must be persisted through File System Management Module and tracked for integrity, with automatic backup creation before any phase rollback operations. | **Backend (Authoritative):** Artifact management service must coordinate with File System Management for all file operations and create restoration points before rollbacks, ensuring data consistency across modules. |
| **PHS-04** | Phase validation must check artifact completeness, dependency satisfaction, and quality gates before allowing phase completion, with results logged to Logging & Monitoring Service for KPI tracking. | **Backend (Authoritative):** Validation service must perform comprehensive checks including file integrity via File System Management, dependency resolution, and quality metrics, reporting results to Logging Service for development velocity KPI calculation. |
| **PHS-05** | Phase performance metrics must automatically track and report development velocity impact to support the 70-90% time-to-working-application KPI defined in the charter. | **Backend (Authoritative):** Metrics collection service must calculate phase completion times, compare against historical baselines, and report velocity impact metrics to Logging & Monitoring Service for KPI dashboard integration. |
| **PHS-06** | Phase rollback operations must preserve artifact history and maintain audit trails for all affected files through coordination with File System Management and Logging services. | **Backend (Authoritative):** Rollback service must create complete snapshots before rollback, coordinate file restoration with File System Management, and log all operations to Logging Service for compliance and debugging. |
| **PHS-07** | Phase templates must be validated against Configuration Management Module settings to ensure compatibility with project-specific AI provider preferences and quality requirements. | **Backend (Authoritative):** Template validation service must check template AI settings against Configuration Management Module values and ensure template requirements align with project quality configuration from Project Management Module. |
| **PHS-08** | Phase transitions that involve AI generation must respect the context compression settings from Configuration Management Module and monitor token usage for cost optimization. | **Backend (Authoritative):** AI integration logic must retrieve compression settings from Configuration Management and pass optimized context packages to AI Provider Management, logging token usage metrics for cost tracking. |
| **PHS-09** | Critical phase failures (validation failures, AI generation errors) must trigger error reporting to Logging & Monitoring Service and potentially affect overall system health status. | **Backend (Authoritative):** Error handling service must classify phase failures by severity and report critical failures to Logging Service, which may impact system health monitoring depending on failure frequency and impact. |
| **PHS-10** | Phase progression history must be maintained for audit purposes and integrated with Configuration Management Module retention policies for data cleanup scheduling. | **Backend (Authoritative):** History management service must persist progression events and coordinate with Configuration Management Module for retention policy compliance, ensuring historical data is preserved according to configured retention periods. |

## **5. Developer Task Checklist**

### **Backend Tasks:**
- [ ] Create database migration script for phase management tables (`phase_transitions`, `phase_validations`, `phase_artifacts`, `phase_dependencies`, `phase_rollbacks`, `phase_history`, `phase_metrics`, `phase_templates`, `validation_rules`, `artifact_templates`)
- [ ] Implement the `PhaseManagementService` class with core phase lifecycle management, dependency validation, and transition orchestration capabilities
- [ ] Implement the `PhaseValidationService` class for comprehensive phase validation including dependency checks, artifact validation, and quality gates
- [ ] Implement the `PhaseArtifactService` class with File System Management Module integration for artifact creation, tracking, and integrity management
- [ ] Implement the `PhaseRollbackService` class for safe phase rollbacks with artifact restoration and dependency reconciliation
- [ ] Implement the `PhaseMetricsService` class for performance tracking and KPI calculation supporting the 70-90% development velocity target
- [ ] Implement the `PhaseTemplateService` class for template management, validation, and reuse across projects
- [ ] Implement all phase management API endpoints (`GET /api/v1/phases/project/{projectId}`) with integration to Project Management Module for project context
- [ ] Implement phase transition endpoint (`POST /api/v1/phases/project/{projectId}/phase/{phaseId}/transition`) with AI Provider Management coordination for Phase 3.1 transitions
- [ ] Implement phase validation endpoint (`POST /api/v1/phases/project/{projectId}/phase/{phaseId}/validate`) with comprehensive validation rule execution
- [ ] Implement phase artifact management endpoints (`GET`, `POST /api/v1/phases/project/{projectId}/phase/{phaseId}/artifacts`) with File System Management integration
- [ ] Implement phase rollback endpoint (`POST /api/v1/phases/project/{projectId}/phase/{phaseId}/rollback`) with backup creation and restoration capabilities
- [ ] Implement dependency management endpoint (`GET /api/v1/phases/project/{projectId}/dependencies`) with visual dependency graph generation
- [ ] Implement template management endpoints (`GET`, `POST /api/v1/phases/templates`) with Configuration Management Module integration for validation
- [ ] Implement metrics endpoint (`GET /api/v1/phases/metrics`) with aggregated performance data and KPI tracking
- [ ] Create `PhaseRepository` class for efficient phase state storage and retrieval with optimized indexing on project ID and phase type
- [ ] Create `PhaseArtifactRepository` class for artifact metadata storage with coordination to File System Management for content storage
- [ ] Create `PhaseHistoryRepository` class for progression history tracking with retention policy integration from Configuration Management
- [ ] Implement phase dependency graph calculation algorithms for validation and visualization
- [ ] Implement phase performance metrics calculation for development velocity KPI tracking
- [ ] Create integration adapters for Project Management Module to update project state during phase transitions
- [ ] Create integration adapters for AI Provider Management Module for Phase 3.1 AI generation coordination
- [ ] Create integration adapters for File System Management Module for artifact operations and backup management
- [ ] Create integration adapters for Logging & Monitoring Service for phase event logging and metrics reporting
- [ ] Implement comprehensive unit tests for all service classes with mock dependencies for isolated testing
- [ ] Create integration tests for phase transition workflows with real database and mock external module interactions
- [ ] Create performance tests for phase validation and transition operations under various project sizes
- [ ] Implement error handling and recovery mechanisms for failed phase transitions and AI generation timeouts

### **Frontend Tasks:**
- [ ] Create `PhaseManagementProvider` React context for global phase state management and real-time phase progression updates
- [ ] Implement `usePhaseManagement` hook for accessing phase operations, validation, and progression capabilities
- [ ] Create `PhaseProgressIndicator` component for visual representation of current phase status and progression through 7-phase methodology
- [ ] Implement `PhaseTransitionDialog` component for executing phase transitions with validation feedback and confirmation prompts
- [ ] Create `PhaseValidationResults` component for displaying validation outcomes, warnings, and recommendations for fixing failures
- [ ] Implement `PhaseArtifactManager` component for viewing, creating, and managing phase artifacts with File System Management integration
- [ ] Create `PhaseRollbackInterface` component for safe phase rollback operations with impact assessment and confirmation
- [ ] Implement `PhaseDependencyVisualization` component for displaying phase dependencies as an interactive graph or tree structure
- [ ] Create `PhaseMetricsDashboard` component for displaying phase performance metrics, KPI tracking, and development velocity impact
- [ ] Implement `PhaseTemplateManager` component for creating, editing, and applying phase templates across projects
- [ ] Create phase management service functions in the API client (`phaseService.ts`) for all phase management endpoints with proper error handling
- [ ] Implement real-time phase progression monitoring using WebSockets or polling for live project status updates
- [ ] Create phase-specific wizards for guided progression through complex phases like Phase 2.1 (Module Specification) and Phase 3.1 (File Generation)
- [ ] Implement phase validation feedback system with inline error messages and actionable recommendations
- [ ] Create phase artifact browser with syntax highlighting, diff viewing, and integration with File System Management file operations
- [ ] Add phase progression history viewer with timeline visualization and rollback capabilities
- [ ] Implement phase performance analytics with charts showing development velocity impact and KPI compliance
- [ ] Create phase template library interface with template search, categorization, and preview capabilities
- [ ] Add phase-aware context menu integration in VS Code extension for quick phase operations
- [ ] Implement phase status indicators in project cards and lists with visual progress representation
- [ ] Create error handling for phase failures with user-friendly error messages and recovery suggestions
- [ ] Add phase notification system for important phase events like completion, validation failures, and rollback completion
- [ ] Implement phase automation settings interface for configuring automatic phase progressions and validation rules
- [ ] Create phase export/import functionality for sharing phase configurations and templates between projects



========================================================================================


# Multi-Phase Development Orchestrator - Technical Specification

## **1. Module Overview**

**Purpose:** The Multi-Phase Development Orchestrator serves as the central coordination engine for ReadyAI's 7-phase development methodology, managing the complete workflow from strategic charter creation through architecture, implementation, testing, and documentation. This module orchestrates phase transitions, validates phase dependencies, manages phase artifacts, tracks progress against KPIs, and provides intelligent phase rollback capabilities while ensuring architectural consistency and code quality throughout the development lifecycle.

**Dependencies & Interactions:** This module depends on the Configuration Management Module to obtain phase configuration settings, transition rules, and validation criteria. It integrates with the Project Management Module to track project state and update currentPhase, with the Context Management Engine to maintain phase-specific context and semantic relationships, and with the Claude Integration Service for AI-powered phase artifact generation. The module interacts with the Quality Assurance Orchestrator to validate phase outputs and ensure architectural consistency, with the File System Management Module to manage phase artifacts and project scaffolding, and with the Logging & Monitoring Service to track phase progression metrics and identify bottlenecks against the development velocity KPIs. It also coordinates with the Dependency Analysis Engine to ensure proper code generation order during implementation phases.

## **2. Module-Specific Type Additions (`types.multiPhase.ts`)**

```typescript
/**
 * Multi-Phase Development Orchestrator Module Types
 * Extends foundational types with phase orchestration-specific interfaces
 */

/** Phase workflow execution states */
export type PhaseWorkflowState = 'idle' | 'planning' | 'executing' | 'validating' | 'completed' | 'failed' | 'rollback';

/** Phase transition trigger types */
export type PhaseTransitionTrigger = 'manual' | 'automatic' | 'conditional' | 'scheduled';

/** Phase rollback reasons */
export type PhaseRollbackReason = 
  | 'validation_failure'
  | 'dependency_conflict'
  | 'user_request'
  | 'quality_gate_failure'
  | 'context_corruption'
  | 'artifact_generation_failure';

/** Phase execution strategy types */
export type PhaseExecutionStrategy = 'sequential' | 'parallel' | 'conditional' | 'adaptive';

/** Phase workflow configuration */
export interface PhaseWorkflowConfig {
  /** Workflow configuration identifier */
  id: UUID;
  /** Project this workflow applies to */
  projectId: UUID;
  /** Phase execution strategy */
  executionStrategy: PhaseExecutionStrategy;
  /** Automatic phase progression settings */
  autoProgression: {
    /** Whether auto-progression is enabled */
    enabled: boolean;
    /** Validation threshold for auto-progression */
    validationThreshold: number;
    /** Phases that can auto-progress */
    allowedPhases: PhaseType[];
    /** Timeout for phase execution in seconds */
    executionTimeout: number;
  };
  /** Phase dependency override rules */
  dependencyOverrides: Array<{
    phase: PhaseType;
    requiredPhases: PhaseType[];
    optionalPhases: PhaseType[];
  }>;
  /** Quality gate configurations per phase */
  qualityGates: Record<PhaseType, {
    enabled: boolean;
    minimumScore: number;
    requiredChecks: string[];
    blockingFailures: string[];
  }>;
  /** Workflow creation timestamp */
  createdAt: string; // ISO 8601 format
  /** Last workflow modification timestamp */
  lastModified: string; // ISO 8601 format
}

/** Phase execution context */
export interface PhaseExecutionContext {
  /** Execution context identifier */
  id: UUID;
  /** Associated project */
  projectId: UUID;
  /** Phase being executed */
  phase: PhaseType;
  /** Workflow execution state */
  workflowState: PhaseWorkflowState;
  /** Execution session identifier */
  sessionId: string;
  /** AI provider context */
  aiContext: {
    provider: AIProviderType;
    extendedThinking: boolean;
    contextCompressionLevel: 'minimal' | 'standard' | 'aggressive';
    tokenBudget: number;
  };
  /** Input artifacts from previous phases */
  inputArtifacts: PhaseArtifact[];
  /** Generated output artifacts */
  outputArtifacts: PhaseArtifact[];
  /** Validation results from quality gates */
  validationResults: ValidationResult[];
  /** Execution metrics */
  metrics: {
    startTime: string; // ISO 8601 format
    endTime?: string; // ISO 8601 format
    executionDuration?: number; // milliseconds
    tokenUsage: {
      input: number;
      output: number;
      total: number;
    };
    qualityScore: number;
    validationScore: number;
  };
  /** Execution error information */
  error?: {
    code: string;
    message: string;
    phase: PhaseType;
    artifact?: string;
    stackTrace?: string;
  };
}

/** Phase transition request */
export interface PhaseTransitionRequest {
  /** Transition request identifier */
  id: UUID;
  /** Project to transition */
  projectId: UUID;
  /** Source phase */
  fromPhase: PhaseType;
  /** Target phase */
  toPhase: PhaseType;
  /** Transition trigger type */
  trigger: PhaseTransitionTrigger;
  /** Whether to force transition despite validation failures */
  force: boolean;
  /** User-provided reason for transition */
  reason?: string;
  /** Additional transition parameters */
  parameters?: Record<string, any>;
  /** Transition request timestamp */
  requestedAt: string; // ISO 8601 format
  /** Requesting user session */
  sessionId?: string;
}

/** Phase transition result */
export interface PhaseTransitionResult {
  /** Transition request identifier */
  requestId: UUID;
  /** Whether transition was successful */
  success: boolean;
  /** Previous phase */
  previousPhase: PhaseType;
  /** Current phase after transition */
  currentPhase: PhaseType;
  /** Transition execution time */
  executionTime: number; // milliseconds
  /** Pre-transition validation results */
  preValidation: ValidationResult[];
  /** Post-transition validation results */
  postValidation: ValidationResult[];
  /** Artifacts affected by transition */
  affectedArtifacts: PhaseArtifact[];
  /** Rollback information if transition failed */
  rollbackInfo?: {
    reason: PhaseRollbackReason;
    rollbackPhase: PhaseType;
    preservedArtifacts: PhaseArtifact[];
  };
  /** Transition completion timestamp */
  completedAt: string; // ISO 8601 format
}

/** Phase workflow execution plan */
export interface PhaseExecutionPlan {
  /** Execution plan identifier */
  id: UUID;
  /** Project this plan applies to */
  projectId: UUID;
  /** Planned execution sequence */
  executionSequence: Array<{
    phase: PhaseType;
    estimatedDuration: number; // milliseconds
    dependencies: PhaseType[];
    requiredArtifacts: string[];
    outputArtifacts: string[];
    qualityGates: string[];
  }>;
  /** Total estimated execution time */
  totalEstimatedTime: number; // milliseconds
  /** Plan creation timestamp */
  createdAt: string; // ISO 8601 format
  /** Execution plan status */
  status: 'draft' | 'approved' | 'executing' | 'completed' | 'failed' | 'cancelled';
  /** Plan validation results */
  validationResults: ValidationResult[];
}

/** Phase progress tracking */
export interface PhaseProgress {
  /** Progress tracking identifier */
  id: UUID;
  /** Associated project */
  projectId: UUID;
  /** Current phase */
  currentPhase: PhaseType;
  /** Phase completion percentage (0-100) */
  completionPercentage: number;
  /** Completed phases */
  completedPhases: PhaseType[];
  /** Phase execution timeline */
  timeline: Array<{
    phase: PhaseType;
    status: PhaseStatus;
    startTime: string; // ISO 8601 format
    endTime?: string; // ISO 8601 format
    duration?: number; // milliseconds
    artifactCount: number;
    qualityScore: number;
  }>;
  /** Overall progress metrics */
  metrics: {
    totalPhases: number;
    completedPhases: number;
    failedPhases: number;
    averagePhaseTime: number; // milliseconds
    totalExecutionTime: number; // milliseconds
    overallQualityScore: number;
  };
  /** Progress milestones */
  milestones: Array<{
    name: string;
    phase: PhaseType;
    target: string; // ISO 8601 format
    achieved?: string; // ISO 8601 format
    status: 'pending' | 'achieved' | 'overdue';
  }>;
  /** Last progress update timestamp */
  lastUpdated: string; // ISO 8601 format
}

/** Phase dependency graph for orchestration */
export interface PhaseDependencyGraph {
  /** Dependency graph identifier */
  id: UUID;
  /** Project this graph applies to */
  projectId: UUID;
  /** Phase dependency nodes */
  nodes: Map<PhaseType, {
    phase: PhaseType;
    status: PhaseStatus;
    dependencies: PhaseType[];
    dependents: PhaseType[];
    artifacts: PhaseArtifact[];
    canExecute: boolean;
    executionOrder: number;
  }>;
  /** Dependency relationships */
  edges: Array<{
    from: PhaseType;
    to: PhaseType;
    dependencyType: 'required' | 'optional' | 'conditional';
    validated: boolean;
  }>;
  /** Execution order for phases */
  executionOrder: PhaseType[];
  /** Detected circular dependencies */
  circularDependencies: PhaseType[][];
  /** Graph validation status */
  isValid: boolean;
  /** Graph creation timestamp */
  createdAt: string; // ISO 8601 format
}

/** Phase rollback state */
export interface PhaseRollbackState {
  /** Rollback state identifier */
  id: UUID;
  /** Project being rolled back */
  projectId: UUID;
  /** Phase being rolled back from */
  fromPhase: PhaseType;
  /** Phase being rolled back to */
  toPhase: PhaseType;
  /** Rollback reason */
  reason: PhaseRollbackReason;
  /** Snapshot of artifacts before rollback */
  artifactSnapshot: PhaseArtifact[];
  /** Snapshot of project state before rollback */
  projectStateSnapshot: {
    currentPhase: PhaseType;
    config: ProjectConfig;
    lastModified: string;
  };
  /** Context state snapshot */
  contextSnapshot: {
    nodeCount: number;
    lastUpdated: string;
    relevanceScore: number;
  };
  /** Rollback execution metrics */
  metrics: {
    rollbackTime: number; // milliseconds
    artifactsRestored: number;
    contextNodesRestored: number;
    validationsPassed: number;
  };
  /** Rollback timestamp */
  rolledBackAt: string; // ISO 8601 format
  /** Whether rollback can be undone */
  canUndo: boolean;
}
```

## **3. API Endpoint Specification (OpenAPI `paths` block)**

```yaml
paths:
  /api/v1/phases/workflow:
    get:
      tags:
        - Multi-Phase Orchestrator
      summary: Get phase workflow configuration
      description: Retrieves the phase workflow configuration for a specific project
      security:
        - localAuth: []
      parameters:
        - name: projectId
          in: query
          description: Project ID to get workflow configuration for
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '200':
          description: Phase workflow configuration retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/PhaseWorkflowConfig'
        '404':
          description: Project or workflow configuration not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

    put:
      tags:
        - Multi-Phase Orchestrator
      summary: Update phase workflow configuration
      description: Updates phase workflow configuration for a project including execution strategy and quality gates
      security:
        - localAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                projectId:
                  $ref: '#/components/schemas/UUID'
                executionStrategy:
                  type: string
                  enum: [sequential, parallel, conditional, adaptive]
                autoProgression:
                  type: object
                  properties:
                    enabled:
                      type: boolean
                    validationThreshold:
                      type: number
                      minimum: 0
                      maximum: 100
                    allowedPhases:
                      type: array
                      items:
                        $ref: '#/components/schemas/PhaseType'
                    executionTimeout:
                      type: integer
                      minimum: 60
                qualityGates:
                  type: object
                  additionalProperties:
                    type: object
                    properties:
                      enabled:
                        type: boolean
                      minimumScore:
                        type: number
                      requiredChecks:
                        type: array
                        items:
                          type: string
                      blockingFailures:
                        type: array
                        items:
                          type: string
              required:
                - projectId
      responses:
        '200':
          description: Workflow configuration updated successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/PhaseWorkflowConfig'

  /api/v1/phases/execute:
    post:
      tags:
        - Multi-Phase Orchestrator
      summary: Execute a specific phase
      description: Initiates execution of a specific development phase with AI-powered artifact generation and validation
      security:
        - localAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                projectId:
                  $ref: '#/components/schemas/UUID'
                phase:
                  $ref: '#/components/schemas/PhaseType'
                executionStrategy:
                  type: string
                  enum: [sequential, parallel, conditional, adaptive]
                  default: sequential
                aiContext:
                  type: object
                  properties:
                    provider:
                      $ref: '#/components/schemas/AIProviderType'
                    extendedThinking:
                      type: boolean
                      default: true
                    contextCompressionLevel:
                      type: string
                      enum: [minimal, standard, aggressive]
                      default: standard
                    tokenBudget:
                      type: integer
                      minimum: 1000
                force:
                  type: boolean
                  default: false
                  description: Force execution even if dependencies are not met
                parameters:
                  type: object
                  description: Additional phase-specific parameters
              required:
                - projectId
                - phase
      responses:
        '200':
          description: Phase execution started successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/PhaseExecutionContext'
        '400':
          description: Invalid phase execution request or dependencies not met
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'
        '409':
          description: Phase execution conflict or already in progress
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

  /api/v1/phases/execute/{executionId}:
    get:
      tags:
        - Multi-Phase Orchestrator
      summary: Get phase execution status
      description: Retrieves the current status and progress of a phase execution
      security:
        - localAuth: []
      parameters:
        - name: executionId
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '200':
          description: Phase execution status retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/PhaseExecutionContext'

    delete:
      tags:
        - Multi-Phase Orchestrator
      summary: Cancel phase execution
      description: Cancels an ongoing phase execution and performs cleanup
      security:
        - localAuth: []
      parameters:
        - name: executionId
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              properties:
                reason:
                  type: string
                  maxLength: 500
                preserveArtifacts:
                  type: boolean
                  default: true
      responses:
        '200':
          description: Phase execution cancelled successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          cancelled:
                            type: boolean
                          preservedArtifacts:
                            type: array
                            items:
                              $ref: '#/components/schemas/PhaseArtifact'

  /api/v1/phases/transition:
    post:
      tags:
        - Multi-Phase Orchestrator
      summary: Request phase transition
      description: Requests transition from current phase to target phase with validation and dependency checking
      security:
        - localAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                projectId:
                  $ref: '#/components/schemas/UUID'
                toPhase:
                  $ref: '#/components/schemas/PhaseType'
                trigger:
                  type: string
                  enum: [manual, automatic, conditional, scheduled]
                  default: manual
                force:
                  type: boolean
                  default: false
                  description: Force transition despite validation failures
                reason:
                  type: string
                  maxLength: 500
                parameters:
                  type: object
              required:
                - projectId
                - toPhase
      responses:
        '200':
          description: Phase transition completed successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/PhaseTransitionResult'
        '400':
          description: Invalid transition request or failed validation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'
        '409':
          description: Phase transition conflict or dependencies not met
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

  /api/v1/phases/rollback:
    post:
      tags:
        - Multi-Phase Orchestrator
      summary: Rollback to previous phase
      description: Rolls back project to a previous phase state with artifact and context restoration
      security:
        - localAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                projectId:
                  $ref: '#/components/schemas/UUID'
                toPhase:
                  $ref: '#/components/schemas/PhaseType'
                reason:
                  type: string
                  enum: [validation_failure, dependency_conflict, user_request, quality_gate_failure, context_corruption, artifact_generation_failure]
                preserveArtifacts:
                  type: array
                  items:
                    type: string
                  description: Specific artifacts to preserve during rollback
                createSnapshot:
                  type: boolean
                  default: true
                  description: Create snapshot before rollback for undo capability
              required:
                - projectId
                - toPhase
                - reason
      responses:
        '200':
          description: Phase rollback completed successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/PhaseRollbackState'
        '400':
          description: Invalid rollback request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

  /api/v1/phases/progress:
    get:
      tags:
        - Multi-Phase Orchestrator
      summary: Get phase progress
      description: Retrieves detailed progress information for a project's phase execution
      security:
        - localAuth: []
      parameters:
        - name: projectId
          in: query
          description: Project ID to get progress for
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '200':
          description: Phase progress retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/PhaseProgress'

  /api/v1/phases/plan:
    post:
      tags:
        - Multi-Phase Orchestrator
      summary: Create phase execution plan
      description: Creates a comprehensive execution plan for all remaining phases based on current project state
      security:
        - localAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                projectId:
                  $ref: '#/components/schemas/UUID'
                startPhase:
                  $ref: '#/components/schemas/PhaseType'
                endPhase:
                  $ref: '#/components/schemas/PhaseType'
                executionStrategy:
                  type: string
                  enum: [sequential, parallel, conditional, adaptive]
                  default: sequential
                estimationMode:
                  type: string
                  enum: [conservative, moderate, aggressive]
                  default: moderate
              required:
                - projectId
      responses:
        '200':
          description: Phase execution plan created successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/PhaseExecutionPlan'

  /api/v1/phases/dependencies:
    get:
      tags:
        - Multi-Phase Orchestrator
      summary: Get phase dependency graph
      description: Retrieves the phase dependency graph showing relationships and execution order
      security:
        - localAuth: []
      parameters:
        - name: projectId
          in: query
          description: Project ID to get dependencies for
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '200':
          description: Phase dependency graph retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/PhaseDependencyGraph'

    put:
      tags:
        - Multi-Phase Orchestrator
      summary: Update phase dependencies
      description: Updates phase dependency relationships and execution order for a project
      security:
        - localAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                projectId:
                  $ref: '#/components/schemas/UUID'
                dependencies:
                  type: array
                  items:
                    type: object
                    properties:
                      phase:
                        $ref: '#/components/schemas/PhaseType'
                      requiredPhases:
                        type: array
                        items:
                          $ref: '#/components/schemas/PhaseType'
                      optionalPhases:
                        type: array
                        items:
                          $ref: '#/components/schemas/PhaseType'
                validateGraph:
                  type: boolean
                  default: true
              required:
                - projectId
                - dependencies
      responses:
        '200':
          description: Phase dependencies updated successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/PhaseDependencyGraph'

components:
  schemas:
    PhaseWorkflowConfig:
      type: object
      required:
        - id
        - projectId
        - executionStrategy
        - autoProgression
        - qualityGates
        - createdAt
        - lastModified
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        projectId:
          $ref: '#/components/schemas/UUID'
        executionStrategy:
          type: string
          enum: [sequential, parallel, conditional, adaptive]
        autoProgression:
          type: object
          properties:
            enabled:
              type: boolean
            validationThreshold:
              type: number
            allowedPhases:
              type: array
              items:
                $ref: '#/components/schemas/PhaseType'
            executionTimeout:
              type: integer
        dependencyOverrides:
          type: array
          items:
            type: object
            properties:
              phase:
                $ref: '#/components/schemas/PhaseType'
              requiredPhases:
                type: array
                items:
                  $ref: '#/components/schemas/PhaseType'
              optionalPhases:
                type: array
                items:
                  $ref: '#/components/schemas/PhaseType'
        qualityGates:
          type: object
          additionalProperties:
            type: object
            properties:
              enabled:
                type: boolean
              minimumScore:
                type: number
              requiredChecks:
                type: array
                items:
                  type: string
              blockingFailures:
                type: array
                items:
                  type: string
        createdAt:
          type: string
          format: date-time
        lastModified:
          type: string
          format: date-time

    PhaseExecutionContext:
      type: object
      required:
        - id
        - projectId
        - phase
        - workflowState
        - sessionId
        - aiContext
        - inputArtifacts
        - outputArtifacts
        - validationResults
        - metrics
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        projectId:
          $ref: '#/components/schemas/UUID'
        phase:
          $ref: '#/components/schemas/PhaseType'
        workflowState:
          type: string
          enum: [idle, planning, executing, validating, completed, failed, rollback]
        sessionId:
          type: string
        aiContext:
          type: object
          properties:
            provider:
              $ref: '#/components/schemas/AIProviderType'
            extendedThinking:
              type: boolean
            contextCompressionLevel:
              type: string
              enum: [minimal, standard, aggressive]
            tokenBudget:
              type: integer
        inputArtifacts:
          type: array
          items:
            $ref: '#/components/schemas/PhaseArtifact'
        outputArtifacts:
          type: array
          items:
            $ref: '#/components/schemas/PhaseArtifact'
        validationResults:
          type: array
          items:
            $ref: '#/components/schemas/ValidationResult'
        metrics:
          type: object
          properties:
            startTime:
              type: string
              format: date-time
            endTime:
              type: string
              format: date-time
            executionDuration:
              type: number
            tokenUsage:
              type: object
              properties:
                input:
                  type: integer
                output:
                  type: integer
                total:
                  type: integer
            qualityScore:
              type: number
            validationScore:
              type: number
        error:
          type: object
          properties:
            code:
              type: string
            message:
              type: string
            phase:
              $ref: '#/components/schemas/PhaseType'
            artifact:
              type: string
            stackTrace:
              type: string

    PhaseTransitionResult:
      type: object
      required:
        - requestId
        - success
        - previousPhase
        - currentPhase
        - executionTime
        - preValidation
        - postValidation
        - affectedArtifacts
        - completedAt
      properties:
        requestId:
          $ref: '#/components/schemas/UUID'
        success:
          type: boolean
        previousPhase:
          $ref: '#/components/schemas/PhaseType'
        currentPhase:
          $ref: '#/components/schemas/PhaseType'
        executionTime:
          type: number
        preValidation:
          type: array
          items:
            $ref: '#/components/schemas/ValidationResult'
        postValidation:
          type: array
          items:
            $ref: '#/components/schemas/ValidationResult'
        affectedArtifacts:
          type: array
          items:
            $ref: '#/components/schemas/PhaseArtifact'
        rollbackInfo:
          type: object
          properties:
            reason:
              type: string
              enum: [validation_failure, dependency_conflict, user_request, quality_gate_failure, context_corruption, artifact_generation_failure]
            rollbackPhase:
              $ref: '#/components/schemas/PhaseType'
            preservedArtifacts:
              type: array
              items:
                $ref: '#/components/schemas/PhaseArtifact'
        completedAt:
          type: string
          format: date-time

    PhaseExecutionPlan:
      type: object
      required:
        - id
        - projectId
        - executionSequence
        - totalEstimatedTime
        - createdAt
        - status
        - validationResults
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        projectId:
          $ref: '#/components/schemas/UUID'
        executionSequence:
          type: array
          items:
            type: object
            properties:
              phase:
                $ref: '#/components/schemas/PhaseType'
              estimatedDuration:
                type: number
              dependencies:
                type: array
                items:
                  $ref: '#/components/schemas/PhaseType'
              requiredArtifacts:
                type: array
                items:
                  type: string
              outputArtifacts:
                type: array
                items:
                  type: string
              qualityGates:
                type: array
                items:
                  type: string
        totalEstimatedTime:
          type: number
        createdAt:
          type: string
          format: date-time
        status:
          type: string
          enum: [draft, approved, executing, completed, failed, cancelled]
        validationResults:
          type: array
          items:
            $ref: '#/components/schemas/ValidationResult'

    PhaseProgress:
      type: object
      required:
        - id
        - projectId
        - currentPhase
        - completionPercentage
        - completedPhases
        - timeline
        - metrics
        - milestones
        - lastUpdated
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        projectId:
          $ref: '#/components/schemas/UUID'
        currentPhase:
          $ref: '#/components/schemas/PhaseType'
        completionPercentage:
          type: number
          minimum: 0
          maximum: 100
        completedPhases:
          type: array
          items:
            $ref: '#/components/schemas/PhaseType'
        timeline:
          type: array
          items:
            type: object
            properties:
              phase:
                $ref: '#/components/schemas/PhaseType'
              status:
                $ref: '#/components/schemas/PhaseStatus'
              startTime:
                type: string
                format: date-time
              endTime:
                type: string
                format: date-time
              duration:
                type: number
              artifactCount:
                type: integer
              qualityScore:
                type: number
        metrics:
          type: object
          properties:
            totalPhases:
              type: integer
            completedPhases:
              type: integer
            failedPhases:
              type: integer
            averagePhaseTime:
              type: number
            totalExecutionTime:
              type: number
            overallQualityScore:
              type: number
        milestones:
          type: array
          items:
            type: object
            properties:
              name:
                type: string
              phase:
                $ref: '#/components/schemas/PhaseType'
              target:
                type: string
                format: date-time
              achieved:
                type: string
                format: date-time
              status:
                type: string
                enum: [pending, achieved, overdue]
        lastUpdated:
          type: string
          format: date-time

    PhaseDependencyGraph:
      type: object
      required:
        - id
        - projectId
        - executionOrder
        - circularDependencies
        - isValid
        - createdAt
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        projectId:
          $ref: '#/components/schemas/UUID'
        executionOrder:
          type: array
          items:
            $ref: '#/components/schemas/PhaseType'
        circularDependencies:
          type: array
          items:
            type: array
            items:
              $ref: '#/components/schemas/PhaseType'
        isValid:
          type: boolean
        createdAt:
          type: string
          format: date-time

    PhaseRollbackState:
      type: object
      required:
        - id
        - projectId
        - fromPhase
        - toPhase
        - reason
        - artifactSnapshot
        - projectStateSnapshot
        - contextSnapshot
        - metrics
        - rolledBackAt
        - canUndo
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        projectId:
          $ref: '#/components/schemas/UUID'
        fromPhase:
          $ref: '#/components/schemas/PhaseType'
        toPhase:
          $ref: '#/components/schemas/PhaseType'
        reason:
          type: string
          enum: [validation_failure, dependency_conflict, user_request, quality_gate_failure, context_corruption, artifact_generation_failure]
        artifactSnapshot:
          type: array
          items:
            $ref: '#/components/schemas/PhaseArtifact'
        projectStateSnapshot:
          type: object
          properties:
            currentPhase:
              $ref: '#/components/schemas/PhaseType'
            lastModified:
              type: string
              format: date-time
        contextSnapshot:
          type: object
          properties:
            nodeCount:
              type: integer
            lastUpdated:
              type: string
              format: date-time
            relevanceScore:
              type: number
        metrics:
          type: object
          properties:
            rollbackTime:
              type: number
            artifactsRestored:
              type: integer
            contextNodesRestored:
              type: integer
            validationsPassed:
              type: integer
        rolledBackAt:
          type: string
          format: date-time
        canUndo:
          type: boolean
```

## **4. Detailed Business Logic & Validation Rules**

| Rule ID | Rule Description | Implementation Location(s) & Notes |
|---------|------------------|-----------------------------------|
| **MPO-01** | Phase transitions must validate all dependencies are satisfied before allowing progression to prevent incomplete or unstable project states. | **Backend (Authoritative):** Phase transition service must query Project Management Module for current phase, validate all required dependencies through dependency graph, and ensure all prerequisite artifacts exist before allowing transition. |
| **MPO-02** | Phase execution must coordinate with Context Management Engine to ensure proper context is available and updated throughout the execution lifecycle. | **Backend (Authoritative):** Phase execution service must call Context Management Engine to retrieve relevant context for AI generation, update context with new artifacts, and maintain context relevance scores during execution. |
| **MPO-03** | AI-powered phase artifact generation must integrate with Claude Integration Service and respect token budgets while maintaining quality thresholds defined in Configuration Management Module. | **Backend (Authoritative):** Artifact generation service must call Claude Integration Service with phase-specific context, monitor token usage against budget, and validate generated artifacts meet quality gates before phase completion. |
| **MPO-04** | Phase rollbacks must create complete snapshots of project state, artifacts, and context before execution to enable reliable undo functionality. | **Backend (Authoritative):** Rollback service must call Project Management Module to snapshot project state, File System Management Module to backup artifacts, Context Management Engine to export context state, and store rollback metadata for undo capability. |
| **MPO-05** | Quality gates must be enforced before phase completion and integration with Quality Assurance Orchestrator to validate architectural consistency against the >95% KPI requirement. | **Backend (Authoritative):** Quality validation service must call Quality Assurance Module to run architectural consistency checks, code quality validation, and dependency health verification before marking phase as completed. |
| **MPO-06** | Phase execution metrics must be tracked and reported to Logging & Monitoring Service to support development velocity KPI (70-90% reduction) and identify performance bottlenecks. | **Backend (Authoritative):** Metrics collection service must log phase start/end times, AI token usage, artifact generation times, and validation durations to Logging Service for KPI analysis and bottleneck identification. |
| **MPO-07** | Parallel phase execution must coordinate resource usage and prevent conflicts by managing concurrent access to Context Management and File System operations. | **Backend (Authoritative):** Parallel execution manager must implement resource locking mechanisms, coordinate with File System Management for concurrent file access, and Context Management for context update sequencing. |
| **MPO-08** | Phase workflow configurations must be validated through Configuration Management Module and persisted to ensure consistent phase execution across project sessions. | **Backend (Authoritative):** Workflow configuration service must validate settings through Configuration Management Module, ensure execution strategy compatibility with project tech stack, and persist configurations for session continuity. |
| **MPO-09** | Phase dependency graphs must be validated for circular dependencies and execution order conflicts before allowing phase plan creation or execution. | **Backend (Authoritative):** Dependency validation service must detect circular dependencies using topological sorting algorithms, validate execution order constraints, and prevent invalid phase plans from being created or executed. |
| **MPO-10** | Phase progress tracking must update Project Management Module's currentPhase and coordinate with VS Code Extension Host for real-time progress display to meet <30 second setup time KPI. | **Backend (Authoritative):** Progress tracking service must update Project Management Module when phase status changes, notify VS Code Extension Host through real-time updates, and maintain progress metrics for productivity tracking. |

## **5. Developer Task Checklist**

### **Backend Tasks:**
- [ ] Create database migration script for multi-phase orchestrator tables (`phase_workflow_configs`, `phase_execution_contexts`, `phase_transitions`, `phase_rollback_states`, `phase_progress_tracking`, `phase_dependency_graphs`, `phase_execution_plans`)
- [ ] Implement the `PhaseOrchestratorService` class as the main orchestrator with workflow management, execution coordination, and state tracking
- [ ] Implement the `PhaseExecutionService` class for managing individual phase executions with AI integration and artifact generation
- [ ] Implement the `PhaseTransitionService` class for handling phase transitions with dependency validation and rollback capabilities
- [ ] Implement the `PhaseWorkflowService` class for managing workflow configurations, execution strategies, and quality gates
- [ ] Implement the `PhaseDependencyService` class for dependency graph management, validation, and execution order determination
- [ ] Implement the `PhaseProgressTracker` class for real-time progress tracking, metrics collection, and milestone management
- [ ] Implement the `PhaseRollbackService` class for creating snapshots, executing rollbacks, and managing undo functionality
- [ ] Implement phase workflow configuration endpoints (`GET`, `PUT /api/v1/phases/workflow`) with validation and persistence
- [ ] Implement phase execution endpoints (`POST /api/v1/phases/execute`, `GET`, `DELETE /api/v1/phases/execute/{id}`) with AI integration and monitoring
- [ ] Implement phase transition endpoint (`POST /api/v1/phases/transition`) with dependency validation and quality gates
- [ ] Implement phase rollback endpoint (`POST /api/v1/phases/rollback`) with snapshot creation and state restoration
- [ ] Implement phase progress endpoint (`GET /api/v1/phases/progress`) with real-time metrics and timeline tracking
- [ ] Implement phase planning endpoint (`POST /api/v1/phases/plan`) with execution strategy and time estimation
- [ ] Implement phase dependency endpoints (`GET`, `PUT /api/v1/phases/dependencies`) with graph validation and ordering
- [ ] Create `PhaseOrchestratorRepository` class for workflow configuration and execution context persistence
- [ ] Create `PhaseTransitionRepository` class for transition history and rollback state management
- [ ] Create `PhaseProgressRepository` class for progress metrics and timeline data storage
- [ ] Implement integration with Project Management Module for project state updates and currentPhase synchronization
- [ ] Implement integration with Context Management Engine for context retrieval, updates, and relevance scoring during phase execution
- [ ] Implement integration with Claude Integration Service for AI-powered artifact generation with token budget management
- [ ] Implement integration with Quality Assurance Orchestrator for quality gate validation and architectural consistency checking
- [ ] Implement integration with File System Management Module for artifact creation, backup, and restoration
- [ ] Implement integration with Configuration Management Module for workflow configuration validation and phase settings
- [ ] Implement integration with Logging & Monitoring Service for comprehensive phase execution metrics and KPI tracking
- [ ] Create comprehensive unit tests for all service classes with mock implementations of dependent modules
- [ ] Create integration tests for complete phase workflow scenarios including execution, transition, rollback, and recovery
- [ ] Implement performance optimizations for phase execution with parallel processing and resource management
- [ ] Create background services for automatic phase progression, quality monitoring, and progress tracking

### **Frontend Tasks:**
- [ ] Create `PhaseOrchestratorProvider` React context for managing phase orchestration state and workflow configuration
- [ ] Implement `usePhaseOrchestrator` hook for accessing phase execution status, progress, and workflow controls
- [ ] Create `PhaseWorkflowDashboard` component as the main interface for phase management and monitoring
- [ ] Implement `PhaseExecutionPanel` component for initiating, monitoring, and controlling phase execution with real-time updates
- [ ] Create `PhaseProgressVisualization` component with timeline, progress bars, and milestone tracking
- [ ] Implement `PhaseDependencyGraph` component for visual representation of phase relationships and execution order
- [ ] Create `PhaseTransitionManager` component for manual phase transitions with validation feedback
- [ ] Implement `PhaseRollbackInterface` component for rollback management and undo functionality
- [ ] Create `PhaseConfiguration` component for workflow settings, quality gates, and execution strategy configuration
- [ ] Implement `PhaseMetricsDashboard` component for displaying execution metrics, performance trends, and KPI progress
- [ ] Create phase orchestration service functions in the API client (`phaseOrchestratorService.ts`) for all endpoints
- [ ] Implement real-time phase status updates using WebSockets or Server-Sent Events for live progress tracking
- [ ] Create phase workflow templates and presets for different project types and execution strategies
- [ ] Implement phase execution logs viewer with filtering, searching, and export capabilities
- [ ] Add phase validation feedback system with inline error messages and resolution suggestions
- [ ] Create automated phase progression interface with configurable triggers and conditions
- [ ] Implement phase milestone management with target dates, progress tracking, and notification system
- [ ] Add phase execution analytics with time estimation, resource utilization, and efficiency metrics
- [ ] Create phase workflow export/import functionality for sharing configurations between projects
- [ ] Implement integration with VS Code Extension commands for phase management from command palette
- [ ] Add keyboard shortcuts and quick actions for common phase operations (execute, transition, rollback)
- [ ] Create phase execution notifications and alerts for completion, failures, and quality gate violations
- [ ] Implement phase workflow guided tour and onboarding for new users
- [ ] Add phase template marketplace for sharing and discovering workflow configurations



========================================================================================


# Frontend Application Module - Technical Specification

## **1. Module Overview**

**Purpose:** The Frontend Application Module serves as the primary React-based web interface for ReadyAI, providing a comprehensive user experience for project management, phase progress tracking, context exploration, and system monitoring. This module implements the main dashboard, project management interfaces, real-time updates, and settings management while maintaining seamless integration with the local-first architecture. It acts as the central hub where Solo Developer Sam can monitor project health, track development progress, explore context relationships, and manage system configurations through an intuitive and responsive web interface.

**Dependencies & Interactions:** This module depends on the Authentication Service for local session management and user authentication state, consuming authentication context and session validation. It interacts extensively with the API Gateway Module to access all backend services through the established REST API patterns. The module consumes data from the Project Management Module for project CRUD operations and health metrics, from the Logging & Monitoring Service for system health dashboards and error tracking, from the Configuration Management Module for settings management, and from the Context Management Engine for context exploration interfaces. It utilizes the established TanStack Query patterns for server state management and integrates with the VS Code Extension Host through shared state mechanisms for workspace synchronization and real-time updates.

## **2. Module-Specific Type Additions (`types.frontend.ts`)**

```typescript
/**
 * Frontend Application Module Types
 * Extends foundational types with frontend-specific interfaces
 */

/** Dashboard widget types */
export type DashboardWidgetType = 
  | 'project_overview'
  | 'phase_progress'
  | 'system_health'
  | 'recent_activity'
  | 'context_metrics'
  | 'ai_usage'
  | 'quick_actions';

/** Dashboard layout configuration */
export type DashboardLayout = 'grid' | 'list' | 'compact';

/** Theme preferences */
export type ThemeMode = 'light' | 'dark' | 'system';

/** Navigation item types */
export type NavigationItemType = 'page' | 'section' | 'action' | 'external';

/** Real-time update types */
export type RealtimeUpdateType = 
  | 'project_updated'
  | 'phase_changed'
  | 'health_changed'
  | 'context_updated'
  | 'error_occurred'
  | 'generation_completed';

/** Dashboard widget configuration */
export interface DashboardWidget {
  /** Widget identifier */
  id: UUID;
  /** Widget type */
  type: DashboardWidgetType;
  /** Widget title */
  title: string;
  /** Widget position in grid */
  position: {
    x: number;
    y: number;
    width: number;
    height: number;
  };
  /** Widget-specific configuration */
  config: Record<string, any>;
  /** Whether widget is visible */
  visible: boolean;
  /** Widget refresh interval in seconds */
  refreshInterval?: number;
}

/** Dashboard configuration */
export interface DashboardConfig {
  /** Dashboard identifier */
  id: UUID;
  /** Dashboard name */
  name: string;
  /** Dashboard layout type */
  layout: DashboardLayout;
  /** Configured widgets */
  widgets: DashboardWidget[];
  /** Dashboard creation timestamp */
  createdAt: string; // ISO 8601 format
  /** Last modification timestamp */
  lastModified: string; // ISO 8601 format
  /** Whether this is the active dashboard */
  isActive: boolean;
}

/** User interface preferences */
export interface UIPreferences {
  /** User session identifier */
  sessionId: string;
  /** Theme mode preference */
  theme: ThemeMode;
  /** Dashboard configuration */
  dashboard: DashboardConfig;
  /** Navigation preferences */
  navigation: {
    /** Collapsed sidebar */
    sidebarCollapsed: boolean;
    /** Recently accessed items */
    recentItems: NavigationItem[];
    /** Pinned navigation items */
    pinnedItems: NavigationItem[];
  };
  /** Table and list preferences */
  tables: {
    /** Default page size */
    defaultPageSize: number;
    /** Column visibility settings */
    columnVisibility: Record<string, boolean>;
    /** Sort preferences */
    sortPreferences: Record<string, { field: string; direction: 'asc' | 'desc' }>;
  };
  /** Notification preferences */
  notifications: {
    /** Show system notifications */
    systemNotifications: boolean;
    /** Show error notifications */
    errorNotifications: boolean;
    /** Show success notifications */
    successNotifications: boolean;
    /** Notification duration in seconds */
    duration: number;
  };
  /** Auto-refresh settings */
  autoRefresh: {
    /** Enable auto-refresh */
    enabled: boolean;
    /** Refresh interval in seconds */
    interval: number;
    /** Auto-refresh on focus */
    onFocus: boolean;
  };
}

/** Navigation item */
export interface NavigationItem {
  /** Item identifier */
  id: string;
  /** Item label */
  label: string;
  /** Item type */
  type: NavigationItemType;
  /** Navigation path or URL */
  path: string;
  /** Item icon name */
  icon?: string;
  /** Badge text */
  badge?: string;
  /** Whether item is active */
  active: boolean;
  /** Child navigation items */
  children?: NavigationItem[];
  /** Last accessed timestamp */
  lastAccessed?: string; // ISO 8601 format
}

/** Real-time update message */
export interface RealtimeUpdate {
  /** Update identifier */
  id: UUID;
  /** Update type */
  type: RealtimeUpdateType;
  /** Update timestamp */
  timestamp: string; // ISO 8601 format
  /** Update data payload */
  data: Record<string, any>;
  /** Project context (if applicable) */
  projectId?: UUID;
  /** Session context */
  sessionId?: string;
}

/** Frontend error boundary state */
export interface ErrorBoundaryState {
  /** Whether error boundary has caught an error */
  hasError: boolean;
  /** Error information */
  error?: {
    /** Error message */
    message: string;
    /** Error stack trace */
    stack?: string;
    /** Component stack */
    componentStack?: string;
    /** Error boundary identifier */
    boundaryId: string;
  };
  /** Error occurrence timestamp */
  errorTime?: string; // ISO 8601 format
  /** User session context */
  sessionId?: string;
  /** Current route */
  currentRoute?: string;
}

/** Component loading state */
export interface ComponentLoadingState {
  /** Component identifier */
  componentId: string;
  /** Loading status */
  isLoading: boolean;
  /** Loading message */
  message?: string;
  /** Progress percentage (0-100) */
  progress?: number;
  /** Loading start timestamp */
  startTime: string; // ISO 8601 format
}

/** Search and filter state */
export interface SearchFilterState {
  /** Search query */
  query: string;
  /** Active filters */
  filters: Record<string, any>;
  /** Sort configuration */
  sort: {
    field: string;
    direction: 'asc' | 'desc';
  };
  /** Pagination state */
  pagination: {
    page: number;
    pageSize: number;
    total: number;
  };
  /** Search results */
  results: any[];
  /** Whether search is in progress */
  isSearching: boolean;
}

/** Toast notification */
export interface ToastNotification {
  /** Notification identifier */
  id: UUID;
  /** Notification type */
  type: 'info' | 'success' | 'warning' | 'error';
  /** Notification title */
  title: string;
  /** Notification message */
  message: string;
  /** Notification duration in milliseconds */
  duration?: number;
  /** Whether notification is dismissible */
  dismissible: boolean;
  /** Notification actions */
  actions?: Array<{
    label: string;
    action: () => void;
  }>;
  /** Notification timestamp */
  timestamp: string; // ISO 8601 format
}

/** Modal dialog state */
export interface ModalState {
  /** Modal identifier */
  id: string;
  /** Whether modal is open */
  isOpen: boolean;
  /** Modal title */
  title: string;
  /** Modal content component */
  component?: string;
  /** Modal props */
  props?: Record<string, any>;
  /** Modal size */
  size: 'small' | 'medium' | 'large' | 'fullscreen';
  /** Whether modal is closeable */
  closeable: boolean;
  /** Modal backdrop behavior */
  backdrop: 'static' | 'clickable';
}
```

## **3. API Endpoint Specification (OpenAPI `paths` block)**

```yaml
paths:
  /api/v1/frontend/dashboard:
    get:
      tags:
        - Frontend
      summary: Get dashboard configuration
      description: Retrieves the current user's dashboard configuration including widgets and layout preferences
      security:
        - localAuth: []
      responses:
        '200':
          description: Dashboard configuration retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/DashboardConfig'
        '401':
          description: Authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

    put:
      tags:
        - Frontend
      summary: Update dashboard configuration
      description: Updates the user's dashboard configuration including widget positions and settings
      security:
        - localAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  minLength: 1
                  maxLength: 100
                layout:
                  type: string
                  enum: [grid, list, compact]
                widgets:
                  type: array
                  items:
                    $ref: '#/components/schemas/DashboardWidget'
              required:
                - widgets
      responses:
        '200':
          description: Dashboard configuration updated successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/DashboardConfig'
        '400':
          description: Invalid dashboard configuration
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

  /api/v1/frontend/dashboard/data:
    get:
      tags:
        - Frontend
      summary: Get dashboard data
      description: Retrieves aggregated data for all dashboard widgets including project summaries, health metrics, and recent activity
      security:
        - localAuth: []
      parameters:
        - name: widgets
          in: query
          description: Comma-separated list of widget types to include
          required: false
          schema:
            type: string
            example: "project_overview,system_health,recent_activity"
        - name: timeRange
          in: query
          description: Time range for time-based widgets
          required: false
          schema:
            type: string
            enum: [hour, day, week, month]
            default: day
      responses:
        '200':
          description: Dashboard data retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          project_overview:
                            type: object
                            properties:
                              totalProjects:
                                type: integer
                              activeProjects:
                                type: integer
                              completedProjects:
                                type: integer
                              healthDistribution:
                                type: object
                                additionalProperties:
                                  type: integer
                          system_health:
                            $ref: '#/components/schemas/SystemHealth'
                          recent_activity:
                            type: array
                            items:
                              type: object
                              properties:
                                id:
                                  $ref: '#/components/schemas/UUID'
                                type:
                                  type: string
                                message:
                                  type: string
                                timestamp:
                                  type: string
                                  format: date-time
                                projectId:
                                  $ref: '#/components/schemas/UUID'
                          context_metrics:
                            type: object
                            properties:
                              totalNodes:
                                type: integer
                              avgRetrievalTime:
                                type: number
                              cacheHitRate:
                                type: number
                          ai_usage:
                            type: object
                            properties:
                              totalGenerations:
                                type: integer
                              totalTokens:
                                type: integer
                              avgGenerationTime:
                                type: number
                              successRate:
                                type: number

  /api/v1/frontend/preferences:
    get:
      tags:
        - Frontend
      summary: Get user interface preferences
      description: Retrieves the current user's UI preferences including theme, navigation, and notification settings
      security:
        - localAuth: []
      responses:
        '200':
          description: UI preferences retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/UIPreferences'

    put:
      tags:
        - Frontend
      summary: Update user interface preferences
      description: Updates the user's UI preferences with new settings
      security:
        - localAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                theme:
                  type: string
                  enum: [light, dark, system]
                navigation:
                  type: object
                  properties:
                    sidebarCollapsed:
                      type: boolean
                    pinnedItems:
                      type: array
                      items:
                        $ref: '#/components/schemas/NavigationItem'
                tables:
                  type: object
                  properties:
                    defaultPageSize:
                      type: integer
                      minimum: 10
                      maximum: 100
                    columnVisibility:
                      type: object
                      additionalProperties:
                        type: boolean
                notifications:
                  type: object
                  properties:
                    systemNotifications:
                      type: boolean
                    errorNotifications:
                      type: boolean
                    successNotifications:
                      type: boolean
                    duration:
                      type: integer
                      minimum: 1000
                      maximum: 10000
                autoRefresh:
                  type: object
                  properties:
                    enabled:
                      type: boolean
                    interval:
                      type: integer
                      minimum: 5
                      maximum: 300
                    onFocus:
                      type: boolean
      responses:
        '200':
          description: UI preferences updated successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/UIPreferences'

  /api/v1/frontend/search:
    post:
      tags:
        - Frontend
      summary: Perform global search
      description: Performs a global search across projects, files, logs, and other system entities
      security:
        - localAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                query:
                  type: string
                  minLength: 1
                  maxLength: 1000
                types:
                  type: array
                  items:
                    type: string
                    enum: [projects, files, logs, errors, contexts, phases]
                  default: [projects, files, logs]
                filters:
                  type: object
                  properties:
                    projectId:
                      $ref: '#/components/schemas/UUID'
                    dateRange:
                      type: object
                      properties:
                        start:
                          type: string
                          format: date-time
                        end:
                          type: string
                          format: date-time
                    categories:
                      type: array
                      items:
                        type: string
                limit:
                  type: integer
                  minimum: 1
                  maximum: 100
                  default: 20
              required:
                - query
      responses:
        '200':
          description: Search completed successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          results:
                            type: array
                            items:
                              type: object
                              properties:
                                id:
                                  $ref: '#/components/schemas/UUID'
                                type:
                                  type: string
                                title:
                                  type: string
                                description:
                                  type: string
                                relevanceScore:
                                  type: number
                                  minimum: 0
                                  maximum: 1
                                url:
                                  type: string
                                metadata:
                                  type: object
                          totalResults:
                            type: integer
                          searchTime:
                            type: number
                          suggestions:
                            type: array
                            items:
                              type: string

  /api/v1/frontend/notifications:
    get:
      tags:
        - Frontend
      summary: Get notifications
      description: Retrieves recent notifications for the current user session
      security:
        - localAuth: []
      parameters:
        - name: unreadOnly
          in: query
          description: Return only unread notifications
          required: false
          schema:
            type: boolean
            default: false
        - name: limit
          in: query
          description: Maximum number of notifications to return
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 50
      responses:
        '200':
          description: Notifications retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          notifications:
                            type: array
                            items:
                              $ref: '#/components/schemas/ToastNotification'
                          unreadCount:
                            type: integer

    post:
      tags:
        - Frontend
      summary: Create notification
      description: Creates a new notification for the current user session
      security:
        - localAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                type:
                  type: string
                  enum: [info, success, warning, error]
                title:
                  type: string
                  minLength: 1
                  maxLength: 100
                message:
                  type: string
                  minLength: 1
                  maxLength: 500
                duration:
                  type: integer
                  minimum: 1000
                  maximum: 30000
                dismissible:
                  type: boolean
                  default: true
              required:
                - type
                - title
                - message
      responses:
        '201':
          description: Notification created successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/ToastNotification'

  /api/v1/frontend/realtime:
    get:
      tags:
        - Frontend
      summary: Get real-time updates via Server-Sent Events
      description: Establishes a Server-Sent Events connection for real-time updates including project changes, health status, and system events
      security:
        - localAuth: []
      parameters:
        - name: types
          in: query
          description: Comma-separated list of update types to subscribe to
          required: false
          schema:
            type: string
            example: "project_updated,phase_changed,health_changed"
        - name: projectId
          in: query
          description: Subscribe to updates for specific project only
          required: false
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '200':
          description: Server-Sent Events stream established
          content:
            text/event-stream:
              schema:
                type: string
                description: Event stream with RealtimeUpdate objects as JSON
        '401':
          description: Authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

components:
  schemas:
    DashboardWidget:
      type: object
      required:
        - id
        - type
        - title
        - position
        - visible
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        type:
          type: string
          enum: [project_overview, phase_progress, system_health, recent_activity, context_metrics, ai_usage, quick_actions]
        title:
          type: string
        position:
          type: object
          properties:
            x:
              type: integer
            y:
              type: integer
            width:
              type: integer
            height:
              type: integer
        config:
          type: object
        visible:
          type: boolean
        refreshInterval:
          type: integer

    DashboardConfig:
      type: object
      required:
        - id
        - name
        - layout
        - widgets
        - createdAt
        - lastModified
        - isActive
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        name:
          type: string
        layout:
          type: string
          enum: [grid, list, compact]
        widgets:
          type: array
          items:
            $ref: '#/components/schemas/DashboardWidget'
        createdAt:
          type: string
          format: date-time
        lastModified:
          type: string
          format: date-time
        isActive:
          type: boolean

    UIPreferences:
      type: object
      required:
        - sessionId
        - theme
        - dashboard
        - navigation
        - tables
        - notifications
        - autoRefresh
      properties:
        sessionId:
          type: string
        theme:
          type: string
          enum: [light, dark, system]
        dashboard:
          $ref: '#/components/schemas/DashboardConfig'
        navigation:
          type: object
          properties:
            sidebarCollapsed:
              type: boolean
            recentItems:
              type: array
              items:
                $ref: '#/components/schemas/NavigationItem'
            pinnedItems:
              type: array
              items:
                $ref: '#/components/schemas/NavigationItem'
        tables:
          type: object
          properties:
            defaultPageSize:
              type: integer
            columnVisibility:
              type: object
              additionalProperties:
                type: boolean
            sortPreferences:
              type: object
              additionalProperties:
                type: object
                properties:
                  field:
                    type: string
                  direction:
                    type: string
                    enum: [asc, desc]
        notifications:
          type: object
          properties:
            systemNotifications:
              type: boolean
            errorNotifications:
              type: boolean
            successNotifications:
              type: boolean
            duration:
              type: integer
        autoRefresh:
          type: object
          properties:
            enabled:
              type: boolean
            interval:
              type: integer
            onFocus:
              type: boolean

    NavigationItem:
      type: object
      required:
        - id
        - label
        - type
        - path
        - active
      properties:
        id:
          type: string
        label:
          type: string
        type:
          type: string
          enum: [page, section, action, external]
        path:
          type: string
        icon:
          type: string
        badge:
          type: string
        active:
          type: boolean
        children:
          type: array
          items:
            $ref: '#/components/schemas/NavigationItem'
        lastAccessed:
          type: string
          format: date-time

    ToastNotification:
      type: object
      required:
        - id
        - type
        - title
        - message
        - dismissible
        - timestamp
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        type:
          type: string
          enum: [info, success, warning, error]
        title:
          type: string
        message:
          type: string
        duration:
          type: integer
        dismissible:
          type: boolean
        timestamp:
          type: string
          format: date-time
```

## **4. Detailed Business Logic & Validation Rules**

| Rule ID | Rule Description | Implementation Location(s) & Notes |
|---------|------------------|-----------------------------------|
| **FE-01** | Dashboard configuration changes must be validated to ensure all widget positions fit within the layout grid and don't overlap with other widgets. | **Frontend (Authoritative):** Dashboard service must validate widget positions against grid constraints and detect overlaps before persisting configuration to backend API. |
| **FE-02** | Real-time updates must be filtered based on user session context and project access permissions to prevent unauthorized data exposure. | **Backend (Authoritative):** Real-time update service must validate session permissions against Project Management Module before sending updates via Server-Sent Events stream. |
| **FE-03** | UI preferences must respect the Configuration Management Module's global settings and cannot override system-wide security or performance constraints. | **Frontend (Authoritative):** Preferences validation must check against Configuration Management API for allowed ranges and security constraints before applying user preferences. |
| **FE-04** | Global search must integrate with Logging & Monitoring Service to track search patterns and performance metrics while respecting local-first privacy constraints. | **Backend (Authoritative):** Search service must log search queries and performance to Logging Service while anonymizing user-specific data per privacy requirements. |
| **FE-05** | Dashboard data aggregation must efficiently coordinate with multiple backend modules (Project Management, Logging & Monitoring, Context Management) while maintaining <3 second load times. | **Backend (Authoritative):** Dashboard data service must implement parallel API calls with timeouts, caching strategies, and fallback mechanisms to meet KPI requirements. |
| **FE-06** | Error boundaries must automatically report frontend errors to the Logging & Monitoring Service with sufficient context for debugging while protecting sensitive user data. | **Frontend (Authoritative):** Error boundary components must sanitize error data and call Logging Service API to report errors with component stack and user session context. |
| **FE-07** | Navigation state changes must be persisted to maintain user experience consistency across browser sessions and integrate with VS Code Extension workspace context. | **Frontend (Authoritative):** Navigation service must persist state to localStorage and sync with Authentication Service session state for cross-session consistency. |
| **FE-08** | Widget refresh intervals must respect system performance constraints and user preferences while coordinating with backend rate limiting from the API Gateway Module. | **Frontend (Authoritative):** Widget refresh service must implement intelligent refresh scheduling that respects API rate limits and adapts intervals based on system performance. |
| **FE-09** | Notification system must integrate with system-wide alert configurations from Configuration Management Module and coordinate with Logging & Monitoring Service for error notifications. | **Frontend (Authoritative):** Notification service must query Configuration Management for alert settings and receive error notifications from Logging Service via real-time updates. |
| **FE-10** | Theme and accessibility preferences must be applied consistently across all components and persist across sessions while supporting system-level theme detection. | **Frontend (Authoritative):** Theme service must implement CSS custom properties, detect system theme changes, persist preferences via UIPreferences API, and ensure WCAG compliance. |

## **5. Developer Task Checklist**

### **Backend Tasks:**
- [ ] Create database migration script for frontend-specific tables (`dashboard_configs`, `ui_preferences`, `user_notifications`, `search_cache`)
- [ ] Implement the `FrontendService` class for managing dashboard configurations, UI preferences, and frontend-specific data aggregation
- [ ] Implement the `DashboardDataService` class for aggregating data from multiple modules (Project Management, Logging & Monitoring, Context Management) with parallel API calls and caching
- [ ] Implement the `GlobalSearchService` class for searching across projects, files, logs, and contexts with relevance scoring and result ranking
- [ ] Implement the `RealtimeUpdateService` class for managing Server-Sent Events connections and filtering updates based on user permissions
- [ ] Implement the `NotificationService` class for managing user notifications with integration to system alerts and error reporting
- [ ] Implement all frontend API endpoints (`GET`, `PUT /api/v1/frontend/dashboard`, `GET`, `PUT /api/v1/frontend/preferences`) with proper validation and error handling
- [ ] Implement dashboard data aggregation endpoint (`GET /api/v1/frontend/dashboard/data`) with intelligent caching and parallel data fetching
- [ ] Implement global search endpoint (`POST /api/v1/frontend/search`) with full-text search capabilities and result relevance ranking
- [ ] Implement notification management endpoints (`GET`, `POST /api/v1/frontend/notifications`) with read/unread status tracking
- [ ] Implement real-time updates endpoint (`GET /api/v1/frontend/realtime`) using Server-Sent Events with proper connection management
- [ ] Create `FrontendRepository` class for dashboard and preference data persistence with optimized queries
- [ ] Create middleware for dashboard data caching with cache invalidation strategies based on underlying data changes
- [ ] Implement integration with Project Management Module for project-specific dashboard data and health metrics
- [ ] Implement integration with Logging & Monitoring Service for system health widgets and error notification forwarding
- [ ] Implement integration with Configuration Management Module for UI preference validation and system constraint checking
- [ ] Implement performance monitoring for dashboard data aggregation to ensure <3 second KPI compliance
- [ ] Create comprehensive unit tests for all service classes with proper mocking of dependent module APIs
- [ ] Create integration tests for dashboard data aggregation with multiple module dependencies and error scenarios
- [ ] Implement real-time update filtering and permission validation to prevent unauthorized data access
- [ ] Add performance optimization for global search with indexing strategies and result caching mechanisms

### **Frontend Tasks:**
- [ ] Create comprehensive dashboard component architecture with `Dashboard.tsx`, `DashboardGrid.tsx`, and individual widget components (`ProjectOverviewWidget.tsx`, `SystemHealthWidget.tsx`, `RecentActivityWidget.tsx`)
- [ ] Implement `DashboardProvider` React context for managing dashboard state, widget configurations, and real-time data updates
- [ ] Create drag-and-drop widget positioning system with collision detection and grid snapping for dashboard customization
- [ ] Implement `useRealtime` hook for managing Server-Sent Events connections with automatic reconnection and error handling
- [ ] Create global search interface with `SearchBar.tsx`, `SearchResults.tsx`, and `SearchFilters.tsx` components with debounced search and result highlighting
- [ ] Implement `NotificationProvider` and `useNotifications` hook for managing toast notifications with queue management and auto-dismiss functionality
- [ ] Create comprehensive settings interface with `SettingsPanel.tsx`, `ThemeSelector.tsx`, `PreferencesForm.tsx` for user preference management
- [ ] Implement responsive navigation with `Sidebar.tsx`, `NavigationMenu.tsx`, and breadcrumb components with mobile-first design
- [ ] Create project management interface components (`ProjectList.tsx`, `ProjectCard.tsx`, `ProjectDetails.tsx`) with filtering, sorting, and pagination
- [ ] Implement phase progress tracking components (`PhaseProgressBar.tsx`, `PhaseTimeline.tsx`, `PhaseDetails.tsx`) with visual progress indicators
- [ ] Create context exploration interface with `ContextExplorer.tsx`, `ContextGraph.tsx`, and `ContextDetails.tsx` for semantic relationship visualization
- [ ] Implement system monitoring dashboard with `SystemHealthOverview.tsx`, `MetricsCharts.tsx`, and `ErrorTracker.tsx` components
- [ ] Create error boundary components with user-friendly error messages and automatic error reporting to backend
- [ ] Implement data visualization components using charts library for metrics display, progress tracking, and analytics
- [ ] Create loading states and skeleton components for all major UI sections with consistent loading experiences
- [ ] Implement accessibility features including keyboard navigation, screen reader support, and WCAG compliance
- [ ] Create responsive design system with consistent spacing, typography, and color schemes across all components
- [ ] Implement performance optimization with React.memo, useMemo, and lazy loading for large component trees
- [ ] Create comprehensive component testing suite with React Testing Library for all major UI components
- [ ] Implement user onboarding flow with guided tours and feature introductions for new users
- [ ] Create export and import functionality for dashboard configurations and user preferences
- [ ] Add keyboard shortcuts and hotkey support for common actions and navigation
- [ ] Implement advanced filtering and sorting capabilities for all list views and data tables
- [ ] Create dark mode and theme switching with smooth transitions and system preference detection



========================================================================================


# State Management Module - Technical Specification

## **1. Module Overview**

**Purpose:** The State Management Module serves as the centralized frontend state management system for the ReadyAI application, providing comprehensive server state caching, optimistic updates, cache invalidation, and state persistence using TanStack Query and local state management. This module ensures consistent, efficient, and synchronized state management across all ReadyAI frontend components while supporting the local-first architecture and maintaining optimal user experience with <30 second project resume times as defined in the KPIs.

**Dependencies & Interactions:** This module depends on the API Gateway Module to communicate with backend services and retrieve/update server state data. It integrates deeply with the Authentication Service to manage authentication state and ensure all API calls include proper authentication context. The module interacts with all other frontend modules by providing state management hooks and utilities, particularly integrating with the Configuration Management Module for settings persistence, the Logging & Monitoring Service for state change tracking, and the Project Management Module for project-specific state caching and synchronization.

## **2. Module-Specific Type Additions (`types.stateManagement.ts`)**

```typescript
/**
 * State Management Module Types
 * Extends foundational types with state management interfaces
 */

/** Cache strategy types for different data categories */
export type CacheStrategy = 
  | 'aggressive' // Long cache times, minimal refetching
  | 'balanced'   // Moderate cache times, smart refetching
  | 'fresh'      // Short cache times, frequent refetching
  | 'realtime';  // Minimal cache, constant updates

/** State synchronization modes */
export type SyncMode = 
  | 'immediate'  // Sync state changes immediately
  | 'debounced'  // Sync with debouncing
  | 'manual'     // Sync only on explicit triggers
  | 'offline';   // Queue changes for later sync

/** Optimistic update status */
export type OptimisticStatus = 'pending' | 'confirmed' | 'failed' | 'reverted';

/** Query key configuration for different data types */
export interface QueryKeyConfig {
  /** Base key for the query type */
  baseKey: string;
  /** Cache strategy to use */
  cacheStrategy: CacheStrategy;
  /** Stale time in milliseconds */
  staleTime: number;
  /** Cache time in milliseconds */
  cacheTime: number;
  /** Whether to enable background refetch */
  refetchInBackground: boolean;
  /** Refetch interval for realtime data */
  refetchInterval?: number;
}

/** State persistence configuration */
export interface StatePersistenceConfig {
  /** Storage key for persistence */
  key: string;
  /** Storage type to use */
  storage: 'localStorage' | 'sessionStorage' | 'indexedDB';
  /** Whether to encrypt persisted data */
  encrypt: boolean;
  /** Expiration time for persisted data */
  expirationTime?: number;
  /** Version for migration handling */
  version: number;
}

/** Optimistic update configuration */
export interface OptimisticUpdateConfig<TData> {
  /** Unique identifier for the optimistic update */
  id: UUID;
  /** Query keys affected by this update */
  queryKeys: string[][];
  /** Optimistic data to apply */
  optimisticData: TData;
  /** Original data for rollback */
  originalData?: TData;
  /** Update status */
  status: OptimisticStatus;
  /** Timestamp when update was initiated */
  timestamp: string; // ISO 8601 format
  /** Rollback timeout in milliseconds */
  rollbackTimeout: number;
}

/** State synchronization event */
export interface StateSyncEvent {
  /** Event identifier */
  id: UUID;
  /** Type of synchronization event */
  type: 'cache_invalidation' | 'data_update' | 'connection_change' | 'auth_change';
  /** Affected query keys */
  queryKeys: string[][];
  /** Event timestamp */
  timestamp: string; // ISO 8601 format
  /** Additional event data */
  data?: Record<string, any>;
  /** Source of the event */
  source: 'user' | 'background' | 'system' | 'network';
}

/** Cache invalidation pattern */
export interface CacheInvalidationPattern {
  /** Pattern identifier */
  id: UUID;
  /** Query key patterns to match */
  patterns: string[];
  /** Invalidation strategy */
  strategy: 'exact' | 'prefix' | 'regex';
  /** Whether to refetch after invalidation */
  refetch: boolean;
  /** Conditions for invalidation */
  conditions?: {
    /** Project context requirement */
    projectId?: UUID;
    /** Authentication state requirement */
    authenticated?: boolean;
    /** Minimum age for invalidation */
    minAge?: number;
  };
}

/** State persistence entry */
export interface PersistedState<TData = any> {
  /** Persistence key */
  key: string;
  /** Persisted data */
  data: TData;
  /** Persistence timestamp */
  persistedAt: string; // ISO 8601 format
  /** Data version */
  version: number;
  /** Expiration timestamp */
  expiresAt?: string; // ISO 8601 format
  /** Data checksum for integrity */
  checksum: string;
}

/** Query client configuration */
export interface QueryClientConfiguration {
  /** Default query options */
  defaultOptions: {
    queries: {
      staleTime: number;
      cacheTime: number;
      retry: number;
      retryDelay: number;
      refetchOnWindowFocus: boolean;
      refetchOnMount: boolean;
    };
    mutations: {
      retry: number;
      retryDelay: number;
    };
  };
  /** Query key configurations by type */
  queryKeyConfigs: Record<string, QueryKeyConfig>;
  /** State persistence configurations */
  persistenceConfigs: Record<string, StatePersistenceConfig>;
}

/** State management metrics */
export interface StateManagementMetrics {
  /** Total queries in cache */
  totalQueries: number;
  /** Cache hit ratio */
  cacheHitRatio: number;
  /** Average query response time */
  avgResponseTime: number;
  /** Number of optimistic updates */
  optimisticUpdates: number;
  /** Failed optimistic updates */
  failedOptimisticUpdates: number;
  /** Cache size in bytes */
  cacheSizeBytes: number;
  /** Number of persisted states */
  persistedStates: number;
  /** Last metrics calculation */
  calculatedAt: string; // ISO 8601 format
}

/** Background sync status */
export interface BackgroundSyncStatus {
  /** Whether background sync is active */
  active: boolean;
  /** Queue of pending sync operations */
  pendingOperations: number;
  /** Last successful sync */
  lastSync?: string; // ISO 8601 format
  /** Sync errors */
  errors: string[];
  /** Network connectivity status */
  online: boolean;
}

/** State management error */
export interface StateManagementError {
  /** Error identifier */
  id: UUID;
  /** Error type */
  type: 'cache_error' | 'persistence_error' | 'sync_error' | 'optimistic_error';
  /** Error message */
  message: string;
  /** Affected query keys */
  queryKeys: string[][];
  /** Error timestamp */
  timestamp: string; // ISO 8601 format
  /** Error details */
  details?: Record<string, any>;
  /** Recovery action taken */
  recoveryAction?: string;
}
```

## **3. API Endpoint Specification (OpenAPI `paths` block)**

```yaml
paths:
  /api/v1/state/sync:
    post:
      tags:
        - State Management
      summary: Synchronize client state with server
      description: Synchronizes client-side state changes with the server, handling conflict resolution and ensuring data consistency
      security:
        - localAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                syncEvents:
                  type: array
                  items:
                    $ref: '#/components/schemas/StateSyncEvent'
                clientTimestamp:
                  type: string
                  format: date-time
                conflictResolution:
                  type: string
                  enum: [server_wins, client_wins, merge]
                  default: server_wins
              required:
                - syncEvents
                - clientTimestamp
      responses:
        '200':
          description: State synchronized successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          syncedEvents:
                            type: array
                            items:
                              $ref: '#/components/schemas/StateSyncEvent'
                          conflicts:
                            type: array
                            items:
                              type: object
                              properties:
                                queryKey:
                                  type: string
                                clientValue:
                                  type: object
                                serverValue:
                                  type: object
                                resolution:
                                  type: string
                          serverTimestamp:
                            type: string
                            format: date-time
        '409':
          description: Synchronization conflicts detected
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

  /api/v1/state/invalidate:
    post:
      tags:
        - State Management
      summary: Invalidate cache entries
      description: Invalidates specific cache entries or patterns to force data refresh
      security:
        - localAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                patterns:
                  type: array
                  items:
                    $ref: '#/components/schemas/CacheInvalidationPattern'
                reason:
                  type: string
                  maxLength: 500
              required:
                - patterns
      responses:
        '200':
          description: Cache invalidated successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          invalidatedKeys:
                            type: array
                            items:
                              type: string
                          refetchTriggered:
                            type: boolean

  /api/v1/state/persist:
    post:
      tags:
        - State Management
      summary: Persist state data
      description: Persists client state data to server for cross-session availability
      security:
        - localAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                persistedStates:
                  type: array
                  items:
                    $ref: '#/components/schemas/PersistedState'
              required:
                - persistedStates
      responses:
        '200':
          description: State persisted successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          persistedKeys:
                            type: array
                            items:
                              type: string
                          persistedAt:
                            type: string
                            format: date-time

    get:
      tags:
        - State Management
      summary: Retrieve persisted state
      description: Retrieves previously persisted state data for session restoration
      security:
        - localAuth: []
      parameters:
        - name: keys
          in: query
          description: Comma-separated list of state keys to retrieve
          required: false
          schema:
            type: string
        - name: projectId
          in: query
          description: Filter by project ID
          required: false
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '200':
          description: Persisted state retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          states:
                            type: array
                            items:
                              $ref: '#/components/schemas/PersistedState'

  /api/v1/state/metrics:
    get:
      tags:
        - State Management
      summary: Get state management metrics
      description: Retrieves metrics about state management performance and usage
      security:
        - localAuth: []
      responses:
        '200':
          description: State management metrics retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/StateManagementMetrics'

  /api/v1/state/warm-cache:
    post:
      tags:
        - State Management
      summary: Warm cache with essential data
      description: Pre-loads cache with essential data for improved performance on application startup
      security:
        - localAuth: []
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              properties:
                projectId:
                  $ref: '#/components/schemas/UUID'
                dataTypes:
                  type: array
                  items:
                    type: string
                    enum: [projects, phases, context, configuration]
      responses:
        '200':
          description: Cache warming initiated successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          warmedQueries:
                            type: array
                            items:
                              type: string
                          estimatedTime:
                            type: number

components:
  schemas:
    StateSyncEvent:
      type: object
      required:
        - id
        - type
        - queryKeys
        - timestamp
        - source
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        type:
          type: string
          enum: [cache_invalidation, data_update, connection_change, auth_change]
        queryKeys:
          type: array
          items:
            type: array
            items:
              type: string
        timestamp:
          type: string
          format: date-time
        data:
          type: object
        source:
          type: string
          enum: [user, background, system, network]

    CacheInvalidationPattern:
      type: object
      required:
        - id
        - patterns
        - strategy
        - refetch
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        patterns:
          type: array
          items:
            type: string
        strategy:
          type: string
          enum: [exact, prefix, regex]
        refetch:
          type: boolean
        conditions:
          type: object
          properties:
            projectId:
              $ref: '#/components/schemas/UUID'
            authenticated:
              type: boolean
            minAge:
              type: number

    PersistedState:
      type: object
      required:
        - key
        - data
        - persistedAt
        - version
        - checksum
      properties:
        key:
          type: string
        data:
          type: object
        persistedAt:
          type: string
          format: date-time
        version:
          type: number
        expiresAt:
          type: string
          format: date-time
        checksum:
          type: string

    StateManagementMetrics:
      type: object
      required:
        - totalQueries
        - cacheHitRatio
        - avgResponseTime
        - optimisticUpdates
        - failedOptimisticUpdates
        - cacheSizeBytes
        - persistedStates
        - calculatedAt
      properties:
        totalQueries:
          type: integer
        cacheHitRatio:
          type: number
          minimum: 0
          maximum: 1
        avgResponseTime:
          type: number
        optimisticUpdates:
          type: integer
        failedOptimisticUpdates:
          type: integer
        cacheSizeBytes:
          type: integer
        persistedStates:
          type: integer
        calculatedAt:
          type: string
          format: date-time
```

## **4. Detailed Business Logic & Validation Rules**

| Rule ID | Rule Description | Implementation Location(s) & Notes |
|---------|------------------|-----------------------------------|
| **SM-01** | Query cache must invalidate automatically when authentication state changes to prevent unauthorized data access. | **Frontend (Authoritative):** Authentication Service integration must trigger cache invalidation for all user-specific queries when auth state changes. Authentication Service provides the trigger mechanism. |
| **SM-02** | Optimistic updates must automatically rollback after 30 seconds if server confirmation is not received to prevent indefinite inconsistent state. | **Frontend (Authoritative):** State management service must implement timeout-based rollback for all optimistic updates. Integrates with API Gateway Module for confirmation handling. |
| **SM-03** | Project-specific state data must be isolated and cleared when switching between projects to prevent data leakage. | **Frontend (Authoritative):** Query keys must include project context and cache must be cleared when project context changes. Depends on Project Management Module for project change events. |
| **SM-04** | State persistence must respect the Configuration Management Module's retention policies and never persist sensitive authentication tokens. | **Frontend & Backend (Authoritative):** Persistence service must query Configuration Management Module for retention settings and filter sensitive data before storage. Configuration Management Module provides retention policies. |
| **SM-05** | Background sync must pause when the application detects network connectivity issues to prevent failed update accumulation. | **Frontend (Authoritative):** Background sync service must integrate with network status detection and queue operations during offline periods. Network status changes trigger sync resume/pause. |
| **SM-06** | Cache warming on application startup must prioritize data based on the current project phase to optimize the <30 second project resume KPI. | **Frontend (Authoritative):** Cache warming service must query Project Management Module for current phase and prioritize relevant data types. Phase Management Module provides phase-specific data priorities. |
| **SM-07** | Stale data must be automatically refetched in the background when cache entries exceed their configured stale time to maintain data freshness. | **Frontend (Authoritative):** Query client configuration must enforce background refetch based on data type-specific stale time settings from Configuration Management Module. |
| **SM-08** | State synchronization conflicts must be resolved using server-wins strategy by default to maintain data consistency across the local-first architecture. | **Backend (Authoritative):** Sync endpoint must implement conflict detection and resolution logic, defaulting to server data when conflicts are detected. Logging & Monitoring Service tracks conflict frequency. |
| **SM-09** | Cache size must not exceed browser storage limits and automatically evict least recently used entries when approaching limits. | **Frontend (Authoritative):** Cache management must monitor storage usage and implement LRU eviction policy. Storage limits are determined by browser capabilities and configuration settings. |
| **SM-10** | State management metrics must be reported to the Logging & Monitoring Service for performance tracking and optimization. | **Frontend (Authoritative):** State management service must integrate with Logging & Monitoring Service to report cache performance, optimistic update success rates, and sync metrics. |

## **5. Developer Task Checklist**

### **Backend Tasks:**
- [ ] Create database migration script for state persistence tables (`persisted_states`, `state_sync_events`, `state_sync_conflicts`)
- [ ] Implement the `StateManagementService` class for server-side state synchronization and conflict resolution
- [ ] Implement the `POST /api/v1/state/sync` endpoint with conflict detection and resolution logic
- [ ] Implement the `POST /api/v1/state/invalidate` endpoint for server-triggered cache invalidation
- [ ] Implement state persistence endpoints (`GET`, `POST /api/v1/state/persist`) with data validation and encryption
- [ ] Implement the `GET /api/v1/state/metrics` endpoint for state management performance monitoring
- [ ] Implement the `POST /api/v1/state/warm-cache` endpoint for proactive cache population
- [ ] Create `StatePersistenceRepository` class for database operations with proper indexing on keys and timestamps
- [ ] Implement state synchronization conflict detection algorithm with configurable resolution strategies
- [ ] Add integration with Logging & Monitoring Service for state management event tracking
- [ ] Create comprehensive unit tests for all state synchronization logic with edge case coverage
- [ ] Create integration tests for state persistence and retrieval with concurrent access scenarios
- [ ] Implement state data validation and sanitization to prevent security issues
- [ ] Add background cleanup job for expired persisted state entries

### **Frontend Tasks:**
- [ ] Create `StateManagementProvider` React context for global state management configuration
- [ ] Implement `useQueryConfig` hook for dynamic query configuration based on data types
- [ ] Create `useOptimisticUpdate` hook for handling optimistic updates with automatic rollback
- [ ] Implement `useStatePersistence` hook for automatic state persistence and restoration
- [ ] Create `useCacheInvalidation` hook for manual and automatic cache invalidation
- [ ] Implement `useBackgroundSync` hook for managing background synchronization operations
- [ ] Create `StateMetricsProvider` component for collecting and reporting state management metrics
- [ ] Implement query key factory functions for consistent query key generation across modules
- [ ] Create cache warming utilities for application startup optimization
- [ ] Implement network-aware background sync with automatic pause/resume functionality
- [ ] Add state management error boundary component for graceful error handling
- [ ] Create development tools for state management debugging and monitoring
- [ ] Implement automatic cache eviction based on storage limits and usage patterns
- [ ] Add state synchronization conflict resolution UI for manual conflict handling
- [ ] Implement state export/import functionality for debugging and backup purposes
- [ ] Create state management configuration panel for adjusting cache strategies and persistence settings
- [ ] Add performance monitoring dashboard for state management metrics visualization
- [ ] Implement automatic state cleanup when switching between projects or logging out
- [ ] Create state management service functions for all backend endpoints (`stateManagementService.ts`)
- [ ] Add comprehensive error handling and retry logic for all state management operations
- [ ] Implement state migration system for handling application updates and schema changes
- [ ] Create unit and integration tests for all state management hooks and utilities with React Testing Library



========================================================================================


# VS Code Extension Host - Technical Specification

## **1. Module Overview**

**Purpose:** The VS Code Extension Host serves as the primary user interface for ReadyAI, running as a native VS Code extension that provides seamless workspace integration, intelligent file operations, context-aware development assistance, and real-time project state synchronization. This module acts as the bridge between the ReadyAI backend services and the developer's VS Code environment, enabling the complete 7-phase development methodology through intuitive command palette integration, interactive tree views, rich webview panels, and automated workspace management while maintaining the local-first architecture principles.

**Dependencies & Interactions:** This module depends on the API Gateway Module for secure communication with all backend services using the local authentication model. It interacts extensively with the Project Management Module to create, manage, and monitor project lifecycle states, with the Context Management Engine to provide intelligent context-aware suggestions and real-time context updates, and with the Multi-Phase Development Orchestrator to guide users through the 7-phase methodology with visual progress tracking and automated phase transitions. The module also integrates with the File System Management Module for workspace file operations, the Logging & Monitoring Service for telemetry and error reporting, and the Configuration Management Module for extension settings and preferences synchronization.

## **2. Module-Specific Type Additions (`types.vscodeExtension.ts`)**

```typescript
/**
 * VS Code Extension Host Module Types
 * Extends foundational types with VS Code extension-specific interfaces
 */

/** VS Code command identifiers for ReadyAI functionality */
export type ReadyAICommandId = 
  | 'readyai.createProject'
  | 'readyai.openProject'
  | 'readyai.deleteProject'
  | 'readyai.nextPhase'
  | 'readyai.generateFile'
  | 'readyai.analyzeContext'
  | 'readyai.runValidation'
  | 'readyai.showHealth'
  | 'readyai.openWebview'
  | 'readyai.refreshExplorer'
  | 'readyai.exportProject'
  | 'readyai.importProject';

/** Tree view item types for ReadyAI explorer */
export type TreeItemType = 
  | 'project'
  | 'phase'
  | 'artifact'
  | 'context_node'
  | 'dependency'
  | 'generated_file'
  | 'validation_result'
  | 'error'
  | 'folder'
  | 'file';

/** Tree view item context values for conditional commands */
export type TreeItemContextValue = 
  | 'readyai-project'
  | 'readyai-active-project'
  | 'readyai-phase-pending'
  | 'readyai-phase-active'
  | 'readyai-phase-completed'
  | 'readyai-artifact'
  | 'readyai-generated-file'
  | 'readyai-context-node'
  | 'readyai-error-item';

/** Webview panel types */
export type WebviewPanelType = 
  | 'project-dashboard'
  | 'phase-progress'
  | 'context-explorer'
  | 'generation-console'
  | 'quality-dashboard'
  | 'analytics-view'
  | 'settings-panel'
  | 'help-documentation';

/** Extension state management */
export interface ExtensionState {
  /** Currently active project */
  activeProject: Project | null;
  /** Extension initialization status */
  initialized: boolean;
  /** Backend connection status */
  backendConnected: boolean;
  /** Last backend health check */
  lastHealthCheck: string; // ISO 8601 format
  /** Extension configuration cache */
  configCache: Record<string, any>;
  /** Active webview panels */
  activeWebviews: Map<string, WebviewPanelState>;
  /** File watchers state */
  fileWatchers: Map<string, FileWatcherState>;
  /** Command execution queue */
  commandQueue: CommandExecution[];
}

/** Webview panel state */
export interface WebviewPanelState {
  /** Panel identifier */
  id: string;
  /** Panel type */
  type: WebviewPanelType;
  /** Panel title */
  title: string;
  /** Whether panel is active/visible */
  active: boolean;
  /** Panel creation timestamp */
  createdAt: string; // ISO 8601 format
  /** Panel data state */
  data: Record<string, any>;
  /** Panel view column */
  viewColumn: number;
}

/** File watcher state */
export interface FileWatcherState {
  /** Watcher identifier */
  id: string;
  /** File pattern being watched */
  pattern: string;
  /** Project context */
  projectId: UUID;
  /** Watcher active status */
  active: boolean;
  /** Last event timestamp */
  lastEvent: string; // ISO 8601 format
  /** Event count */
  eventCount: number;
}

/** Command execution tracking */
export interface CommandExecution {
  /** Execution identifier */
  id: UUID;
  /** Command identifier */
  commandId: ReadyAICommandId;
  /** Command arguments */
  args: any[];
  /** Execution status */
  status: 'queued' | 'executing' | 'completed' | 'failed';
  /** Execution start time */
  startedAt: string; // ISO 8601 format
  /** Execution completion time */
  completedAt?: string; // ISO 8601 format
  /** Execution result */
  result?: any;
  /** Error information */
  error?: string;
  /** Execution context */
  context: {
    projectId?: UUID;
    workspace?: string;
    activeFile?: string;
  };
}

/** Tree view item definition */
export interface ReadyAITreeItem {
  /** Item identifier */
  id: string;
  /** Display label */
  label: string;
  /** Item description */
  description?: string;
  /** Item tooltip */
  tooltip?: string;
  /** Item type */
  type: TreeItemType;
  /** Context value for conditional commands */
  contextValue: TreeItemContextValue;
  /** Tree item state */
  collapsibleState: 'none' | 'collapsed' | 'expanded';
  /** Icon path or theme icon */
  iconPath?: string | { light: string; dark: string };
  /** Item command to execute on click */
  command?: {
    command: ReadyAICommandId;
    title: string;
    arguments: any[];
  };
  /** Child items */
  children?: ReadyAITreeItem[];
  /** Associated data */
  data?: Record<string, any>;
  /** Item badges */
  badges?: Array<{
    text: string;
    color: string;
    tooltip?: string;
  }>;
}

/** Webview message types for communication */
export type WebviewMessageType = 
  | 'initialized'
  | 'dataRequest'
  | 'dataUpdate'
  | 'commandRequest'
  | 'settingsUpdate'
  | 'errorReport'
  | 'stateChanged';

/** Webview message structure */
export interface WebviewMessage {
  /** Message type */
  type: WebviewMessageType;
  /** Message identifier */
  id: string;
  /** Message payload */
  payload: any;
  /** Message timestamp */
  timestamp: string; // ISO 8601 format
  /** Response required */
  expectsResponse?: boolean;
}

/** Extension configuration interface */
export interface ExtensionConfiguration {
  /** Backend API endpoint */
  apiEndpoint: string;
  /** Authentication token */
  authToken: string;
  /** Auto-refresh interval in seconds */
  autoRefreshInterval: number;
  /** Enable file watching */
  enableFileWatching: boolean;
  /** Default project root */
  defaultProjectRoot: string;
  /** Extension logging level */
  logLevel: 'debug' | 'info' | 'warn' | 'error';
  /** UI theme preferences */
  theme: {
    colorScheme: 'auto' | 'light' | 'dark';
    iconTheme: 'default' | 'minimal' | 'detailed';
  };
  /** Feature flags */
  features: {
    enableAdvancedContext: boolean;
    enablePhaseAutomation: boolean;
    enableCodeGeneration: boolean;
    enableQualityChecks: boolean;
  };
  /** Notification preferences */
  notifications: {
    showPhaseCompletion: boolean;
    showGenerationResults: boolean;
    showErrorAlerts: boolean;
    showHealthWarnings: boolean;
  };
}

/** Workspace synchronization state */
export interface WorkspaceSyncState {
  /** Workspace identifier */
  workspaceId: string;
  /** Workspace root path */
  rootPath: string;
  /** Associated project */
  projectId: UUID | null;
  /** Sync status */
  syncStatus: 'synced' | 'syncing' | 'conflict' | 'error';
  /** Last sync timestamp */
  lastSync: string; // ISO 8601 format
  /** Pending changes */
  pendingChanges: Array<{
    type: 'file' | 'directory';
    action: 'created' | 'modified' | 'deleted';
    path: string;
    timestamp: string;
  }>;
  /** Sync conflicts */
  conflicts: Array<{
    path: string;
    conflictType: 'content' | 'timestamp' | 'permissions';
    description: string;
  }>;
}

/** Extension telemetry event */
export interface ExtensionTelemetryEvent {
  /** Event identifier */
  id: UUID;
  /** Event name */
  eventName: string;
  /** Event category */
  category: 'command' | 'ui' | 'performance' | 'error' | 'usage';
  /** Event properties */
  properties: Record<string, any>;
  /** Event timestamp */
  timestamp: string; // ISO 8601 format
  /** Session identifier */
  sessionId: string;
  /** Extension version */
  extensionVersion: string;
}
```

## **3. API Endpoint Specification (OpenAPI `paths` block)**

```yaml
paths:
  /api/v1/extension/state:
    get:
      tags:
        - VSCode Extension
      summary: Get extension state
      description: Retrieves the current state of the VS Code extension for synchronization
      security:
        - localAuth: []
      parameters:
        - name: sessionId
          in: query
          description: Extension session identifier
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Extension state retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/ExtensionState'
        '400':
          description: Invalid session or parameters
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

    put:
      tags:
        - VSCode Extension
      summary: Update extension state
      description: Updates the extension state for synchronization across sessions
      security:
        - localAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                sessionId:
                  type: string
                state:
                  $ref: '#/components/schemas/ExtensionState'
                partialUpdate:
                  type: boolean
                  default: false
              required:
                - sessionId
                - state
      responses:
        '200':
          description: Extension state updated successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/ExtensionState'

  /api/v1/extension/workspace/sync:
    post:
      tags:
        - VSCode Extension
      summary: Synchronize workspace
      description: Synchronizes VS Code workspace with ReadyAI project state
      security:
        - localAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                workspacePath:
                  type: string
                  description: Absolute path to workspace root
                projectId:
                  $ref: '#/components/schemas/UUID'
                  description: Associated project identifier
                forceSync:
                  type: boolean
                  default: false
                  description: Force synchronization even if conflicts exist
              required:
                - workspacePath
      responses:
        '200':
          description: Workspace synchronized successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/WorkspaceSyncState'
        '409':
          description: Sync conflicts detected
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiErrorResponse'
                  - type: object
                    properties:
                      error:
                        type: object
                        properties:
                          conflicts:
                            type: array
                            items:
                              type: object
                              properties:
                                path:
                                  type: string
                                conflictType:
                                  type: string
                                description:
                                  type: string

  /api/v1/extension/commands/{commandId}/execute:
    post:
      tags:
        - VSCode Extension
      summary: Execute ReadyAI command
      description: Executes a ReadyAI command with proper context and validation
      security:
        - localAuth: []
      parameters:
        - name: commandId
          in: path
          required: true
          schema:
            type: string
            enum: [createProject, openProject, deleteProject, nextPhase, generateFile, analyzeContext, runValidation, showHealth, openWebview, refreshExplorer, exportProject, importProject]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                args:
                  type: array
                  items: {}
                  description: Command arguments
                context:
                  type: object
                  properties:
                    projectId:
                      $ref: '#/components/schemas/UUID'
                    workspace:
                      type: string
                    activeFile:
                      type: string
                    selection:
                      type: object
                      properties:
                        start:
                          type: object
                          properties:
                            line:
                              type: integer
                            character:
                              type: integer
                        end:
                          type: object
                          properties:
                            line:
                              type: integer
                            character:
                              type: integer
                async:
                  type: boolean
                  default: true
                  description: Execute command asynchronously
              required:
                - args
      responses:
        '200':
          description: Command executed successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/CommandExecution'
        '400':
          description: Invalid command or arguments
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

  /api/v1/extension/treeview/{viewType}/items:
    get:
      tags:
        - VSCode Extension
      summary: Get tree view items
      description: Retrieves tree view items for ReadyAI explorer panels
      security:
        - localAuth: []
      parameters:
        - name: viewType
          in: path
          required: true
          schema:
            type: string
            enum: [projects, phases, context, files, validation]
        - name: projectId
          in: query
          description: Filter by project ID
          required: false
          schema:
            $ref: '#/components/schemas/UUID'
        - name: parentId
          in: query
          description: Parent item ID for hierarchical views
          required: false
          schema:
            type: string
        - name: depth
          in: query
          description: Maximum depth for tree expansion
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 10
            default: 3
      responses:
        '200':
          description: Tree view items retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          items:
                            type: array
                            items:
                              $ref: '#/components/schemas/ReadyAITreeItem'
                          hasMore:
                            type: boolean
                          totalCount:
                            type: integer

  /api/v1/extension/webview/{panelType}/data:
    get:
      tags:
        - VSCode Extension
      summary: Get webview panel data
      description: Retrieves data for specific webview panels
      security:
        - localAuth: []
      parameters:
        - name: panelType
          in: path
          required: true
          schema:
            type: string
            enum: [project-dashboard, phase-progress, context-explorer, generation-console, quality-dashboard, analytics-view, settings-panel, help-documentation]
        - name: projectId
          in: query
          description: Project context for panel data
          required: false
          schema:
            $ref: '#/components/schemas/UUID'
        - name: refresh
          in: query
          description: Force refresh of cached data
          required: false
          schema:
            type: boolean
            default: false
      responses:
        '200':
          description: Webview data retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        description: Panel-specific data structure
                        additionalProperties: true

    post:
      tags:
        - VSCode Extension
      summary: Handle webview messages
      description: Processes messages from webview panels
      security:
        - localAuth: []
      parameters:
        - name: panelType
          in: path
          required: true
          schema:
            type: string
            enum: [project-dashboard, phase-progress, context-explorer, generation-console, quality-dashboard, analytics-view, settings-panel, help-documentation]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/WebviewMessage'
      responses:
        '200':
          description: Message processed successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        description: Response data if required
                        additionalProperties: true

  /api/v1/extension/telemetry:
    post:
      tags:
        - VSCode Extension
      summary: Submit telemetry events
      description: Submits extension telemetry and usage events
      security:
        - localAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                events:
                  type: array
                  items:
                    $ref: '#/components/schemas/ExtensionTelemetryEvent'
                batchId:
                  type: string
                  description: Batch identifier for event grouping
              required:
                - events
      responses:
        '200':
          description: Telemetry events submitted successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          processed:
                            type: integer
                            description: Number of events processed
                          errors:
                            type: array
                            items:
                              type: string
                            description: Processing errors if any

  /api/v1/extension/configuration:
    get:
      tags:
        - VSCode Extension
      summary: Get extension configuration
      description: Retrieves current extension configuration settings
      security:
        - localAuth: []
      responses:
        '200':
          description: Configuration retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/ExtensionConfiguration'

    put:
      tags:
        - VSCode Extension
      summary: Update extension configuration
      description: Updates extension configuration settings
      security:
        - localAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ExtensionConfiguration'
      responses:
        '200':
          description: Configuration updated successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/ExtensionConfiguration'

components:
  schemas:
    ExtensionState:
      type: object
      required:
        - activeProject
        - initialized
        - backendConnected
        - lastHealthCheck
        - configCache
        - activeWebviews
        - fileWatchers
        - commandQueue
      properties:
        activeProject:
          $ref: '#/components/schemas/Project'
        initialized:
          type: boolean
        backendConnected:
          type: boolean
        lastHealthCheck:
          type: string
          format: date-time
        configCache:
          type: object
          additionalProperties: true
        activeWebviews:
          type: object
          additionalProperties:
            $ref: '#/components/schemas/WebviewPanelState'
        fileWatchers:
          type: object
          additionalProperties:
            $ref: '#/components/schemas/FileWatcherState'
        commandQueue:
          type: array
          items:
            $ref: '#/components/schemas/CommandExecution'

    WebviewPanelState:
      type: object
      required:
        - id
        - type
        - title
        - active
        - createdAt
        - data
        - viewColumn
      properties:
        id:
          type: string
        type:
          type: string
          enum: [project-dashboard, phase-progress, context-explorer, generation-console, quality-dashboard, analytics-view, settings-panel, help-documentation]
        title:
          type: string
        active:
          type: boolean
        createdAt:
          type: string
          format: date-time
        data:
          type: object
          additionalProperties: true
        viewColumn:
          type: integer

    FileWatcherState:
      type: object
      required:
        - id
        - pattern
        - projectId
        - active
        - lastEvent
        - eventCount
      properties:
        id:
          type: string
        pattern:
          type: string
        projectId:
          $ref: '#/components/schemas/UUID'
        active:
          type: boolean
        lastEvent:
          type: string
          format: date-time
        eventCount:
          type: integer

    CommandExecution:
      type: object
      required:
        - id
        - commandId
        - args
        - status
        - startedAt
        - context
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        commandId:
          type: string
          enum: [createProject, openProject, deleteProject, nextPhase, generateFile, analyzeContext, runValidation, showHealth, openWebview, refreshExplorer, exportProject, importProject]
        args:
          type: array
          items: {}
        status:
          type: string
          enum: [queued, executing, completed, failed]
        startedAt:
          type: string
          format: date-time
        completedAt:
          type: string
          format: date-time
        result:
          type: object
        error:
          type: string
        context:
          type: object
          properties:
            projectId:
              $ref: '#/components/schemas/UUID'
            workspace:
              type: string
            activeFile:
              type: string

    ReadyAITreeItem:
      type: object
      required:
        - id
        - label
        - type
        - contextValue
        - collapsibleState
      properties:
        id:
          type: string
        label:
          type: string
        description:
          type: string
        tooltip:
          type: string
        type:
          type: string
          enum: [project, phase, artifact, context_node, dependency, generated_file, validation_result, error, folder, file]
        contextValue:
          type: string
          enum: [readyai-project, readyai-active-project, readyai-phase-pending, readyai-phase-active, readyai-phase-completed, readyai-artifact, readyai-generated-file, readyai-context-node, readyai-error-item]
        collapsibleState:
          type: string
          enum: [none, collapsed, expanded]
        iconPath:
          oneOf:
            - type: string
            - type: object
              properties:
                light:
                  type: string
                dark:
                  type: string
        command:
          type: object
          properties:
            command:
              type: string
            title:
              type: string
            arguments:
              type: array
              items: {}
        children:
          type: array
          items:
            $ref: '#/components/schemas/ReadyAITreeItem'
        data:
          type: object
          additionalProperties: true
        badges:
          type: array
          items:
            type: object
            properties:
              text:
                type: string
              color:
                type: string
              tooltip:
                type: string

    WebviewMessage:
      type: object
      required:
        - type
        - id
        - payload
        - timestamp
      properties:
        type:
          type: string
          enum: [initialized, dataRequest, dataUpdate, commandRequest, settingsUpdate, errorReport, stateChanged]
        id:
          type: string
        payload:
          type: object
        timestamp:
          type: string
          format: date-time
        expectsResponse:
          type: boolean

    ExtensionConfiguration:
      type: object
      required:
        - apiEndpoint
        - authToken
        - autoRefreshInterval
        - enableFileWatching
        - defaultProjectRoot
        - logLevel
        - theme
        - features
        - notifications
      properties:
        apiEndpoint:
          type: string
          format: uri
        authToken:
          type: string
        autoRefreshInterval:
          type: integer
          minimum: 5
          maximum: 300
        enableFileWatching:
          type: boolean
        defaultProjectRoot:
          type: string
        logLevel:
          type: string
          enum: [debug, info, warn, error]
        theme:
          type: object
          properties:
            colorScheme:
              type: string
              enum: [auto, light, dark]
            iconTheme:
              type: string
              enum: [default, minimal, detailed]
        features:
          type: object
          properties:
            enableAdvancedContext:
              type: boolean
            enablePhaseAutomation:
              type: boolean
            enableCodeGeneration:
              type: boolean
            enableQualityChecks:
              type: boolean
        notifications:
          type: object
          properties:
            showPhaseCompletion:
              type: boolean
            showGenerationResults:
              type: boolean
            showErrorAlerts:
              type: boolean
            showHealthWarnings:
              type: boolean

    WorkspaceSyncState:
      type: object
      required:
        - workspaceId
        - rootPath
        - syncStatus
        - lastSync
        - pendingChanges
        - conflicts
      properties:
        workspaceId:
          type: string
        rootPath:
          type: string
        projectId:
          $ref: '#/components/schemas/UUID'
        syncStatus:
          type: string
          enum: [synced, syncing, conflict, error]
        lastSync:
          type: string
          format: date-time
        pendingChanges:
          type: array
          items:
            type: object
            properties:
              type:
                type: string
                enum: [file, directory]
              action:
                type: string
                enum: [created, modified, deleted]
              path:
                type: string
              timestamp:
                type: string
                format: date-time
        conflicts:
          type: array
          items:
            type: object
            properties:
              path:
                type: string
              conflictType:
                type: string
                enum: [content, timestamp, permissions]
              description:
                type: string

    ExtensionTelemetryEvent:
      type: object
      required:
        - id
        - eventName
        - category
        - properties
        - timestamp
        - sessionId
        - extensionVersion
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        eventName:
          type: string
        category:
          type: string
          enum: [command, ui, performance, error, usage]
        properties:
          type: object
          additionalProperties: true
        timestamp:
          type: string
          format: date-time
        sessionId:
          type: string
        extensionVersion:
          type: string
```

## **4. Detailed Business Logic & Validation Rules**

| Rule ID | Rule Description | Implementation Location(s) & Notes |
|---------|------------------|-----------------------------------|
| **VSE-01** | Extension initialization must validate backend connectivity through API Gateway before enabling any ReadyAI functionality to ensure reliable service integration. | **Extension (Authoritative):** Extension activation must perform health check via API Gateway Module, authenticate using local auth model, and disable commands if backend is unreachable. Cache connection status for offline graceful degradation. |
| **VSE-02** | Workspace synchronization must coordinate with Project Management Module to ensure workspace root matches project rootPath and prevent conflicts with existing projects. | **Backend (Authoritative):** Workspace sync service must validate workspace path through Project Management Module, check for existing project associations, and enforce workspace isolation to prevent path conflicts. |
| **VSE-03** | Command execution must validate project context through Project Management Module and ensure appropriate phase status before allowing phase-specific operations. | **Backend (Authoritative):** Command execution service must verify project existence, check phase status via Multi-Phase Development Orchestrator, and validate user permissions for requested operations before proceeding. |
| **VSE-04** | Tree view item generation must reflect real-time project state from Project Management, Context Management, and Multi-Phase Orchestrator modules with proper caching for performance. | **Backend (Authoritative):** Tree view service must aggregate data from multiple modules, implement 30-second cache TTL for performance, and use change notifications to invalidate cache when project state changes. |
| **VSE-05** | File watching must coordinate with File System Management Module to track changes and update Context Management Engine while respecting workspace isolation boundaries. | **Extension (Authoritative):** File watchers must use VS Code file system API, filter events through File System Management Module validation, and trigger Context Management updates only for relevant project files. |
| **VSE-06** | Webview panel data must be fetched through appropriate backend modules (Project Management for dashboards, Context Management for context explorer) with proper error boundaries and loading states. | **Backend (Authoritative):** Webview data endpoints must route requests to appropriate modules, implement circuit breaker pattern for module failures, and provide graceful degradation with cached data when services are unavailable. |
| **VSE-07** | Extension telemetry must integrate with Logging & Monitoring Service while anonymizing user data and respecting the local-first privacy constraints defined in the charter. | **Backend (Authoritative):** Telemetry service must sanitize user-specific data, aggregate usage patterns without exposing individual actions, and store telemetry through Logging & Monitoring Service for analytics. |
| **VSE-08** | Configuration management must synchronize with Configuration Management Module to ensure extension settings align with backend configuration and support hot reloading of non-critical settings. | **Backend (Authoritative):** Extension configuration must validate settings through Configuration Management Module, support hot reload for UI preferences, and require extension restart for critical settings like API endpoints. |
| **VSE-09** | Extension state persistence must survive VS Code restarts and workspace switches while maintaining project associations and active panel states through proper serialization. | **Extension (Authoritative):** Extension must use VS Code workspace state API for persistence, serialize/deserialize complex state objects, and restore active projects, webviews, and file watchers on activation. |
| **VSE-10** | Real-time updates from backend modules must be delivered through efficient change notification mechanisms to maintain <30 second project resume time KPI and avoid polling overhead. | **Backend (Authoritative):** Extension state endpoint must implement change notifications via websockets or long polling, batch updates to reduce network traffic, and provide delta updates for large state objects to meet performance requirements. |

## **5. Developer Task Checklist**

### **Backend Tasks:**
- [ ] Create database migration script for extension support tables (`extension_states`, `workspace_sync_states`, `telemetry_events`, `command_executions`)
- [ ] Implement the `ExtensionService` class for managing extension state, workspace synchronization, and command coordination
- [ ] Implement the `ExtensionCommandService` class for executing ReadyAI commands with proper validation and context management
- [ ] Implement the `ExtensionTreeViewService` class for generating tree view items with real-time data from multiple modules
- [ ] Implement the `ExtensionWebviewService` class for serving webview panel data with proper routing to backend modules
- [ ] Implement the `ExtensionTelemetryService` class for processing telemetry events with privacy-aware data handling
- [ ] Implement all extension state endpoints (`GET`, `PUT /api/v1/extension/state`) with proper session management
- [ ] Implement workspace synchronization endpoint (`POST /api/v1/extension/workspace/sync`) with conflict detection and resolution
- [ ] Implement command execution endpoint (`POST /api/v1/extension/commands/{commandId}/execute`) with async execution support
- [ ] Implement tree view endpoints (`GET /api/v1/extension/treeview/{viewType}/items`) with hierarchical data loading
- [ ] Implement webview data endpoints (`GET`, `POST /api/v1/extension/webview/{panelType}/data`) with panel-specific routing
- [ ] Implement telemetry endpoint (`POST /api/v1/extension/telemetry`) with batch processing and data anonymization
- [ ] Implement configuration endpoints (`GET`, `PUT /api/v1/extension/configuration`) with Configuration Management Module integration
- [ ] Create `ExtensionRepository` class for efficient state storage and retrieval with proper indexing
- [ ] Create integration with Project Management Module for project state synchronization and workspace validation
- [ ] Create integration with Context Management Engine for real-time context updates and change notifications
- [ ] Create integration with Multi-Phase Development Orchestrator for phase status tracking and command validation
- [ ] Create integration with File System Management Module for workspace operations and file watching coordination
- [ ] Create integration with Logging & Monitoring Service for extension operation logging and performance metrics
- [ ] Implement comprehensive unit tests for all service classes with mock implementations of dependent modules
- [ ] Create integration tests for extension endpoints including state persistence, workspace sync, and command execution scenarios
- [ ] Implement performance optimizations for tree view data loading and webview panel rendering
- [ ] Add extension telemetry analysis tools for usage pattern identification and performance monitoring

### **Frontend Tasks (VS Code Extension):**
- [ ] Create VS Code extension project structure with proper TypeScript configuration and build setup
- [ ] Implement `ExtensionManager` class for extension lifecycle management, activation, and backend connectivity
- [ ] Implement `ProjectExplorerProvider` tree data provider for project and phase hierarchy visualization
- [ ] Implement `ContextExplorerProvider` tree data provider for context nodes and dependency visualization
- [ ] Implement `FileExplorerProvider` tree data provider for generated files and artifacts with status indicators
- [ ] Create `CommandManager` class for registering and executing all ReadyAI commands with proper validation
- [ ] Create `WebviewManager` class for creating and managing all webview panels with proper lifecycle management
- [ ] Create `StateManager` class for extension state persistence and workspace synchronization
- [ ] Create `TelemetryManager` class for collecting and batching extension usage telemetry
- [ ] Create `ConfigurationManager` class for managing extension settings and backend configuration sync
- [ ] Implement all ReadyAI commands (`readyai.createProject`, `readyai.openProject`, `readyai.nextPhase`, etc.) with proper argument handling
- [ ] Create webview HTML/CSS/JavaScript for project dashboard with real-time project health and phase progress
- [ ] Create webview HTML/CSS/JavaScript for phase progress panel with interactive phase management
- [ ] Create webview HTML/CSS/JavaScript for context explorer with semantic relationship visualization
- [ ] Create webview HTML/CSS/JavaScript for generation console with real-time AI generation monitoring
- [ ] Create webview HTML/CSS/JavaScript for quality dashboard with metrics visualization and validation results
- [ ] Create webview HTML/CSS/JavaScript for analytics view with usage statistics and KPI tracking
- [ ] Create webview HTML/CSS/JavaScript for settings panel with extension configuration management
- [ ] Implement file system watchers for project files with proper event handling and Context Management integration
- [ ] Create status bar integration for active project display and quick access to common commands
- [ ] Implement notification system for phase completion, generation results, and error alerts
- [ ] Create extension contribution points in package.json for commands, views, menus, and keybindings
- [ ] Implement workspace integration for automatic project detection and workspace-to-project association
- [ ] Add proper error handling and user feedback for all extension operations with graceful degradation
- [ ] Create extension documentation with setup instructions, command reference, and troubleshooting guide
- [ ] Implement extension packaging and distribution setup with proper versioning and update mechanisms



========================================================================================


# Workspace Integration Module - Technical Specification

## **1. Module Overview**

**Purpose:** The Workspace Integration Module provides deep VS Code workspace integration and file system synchronization capabilities for ReadyAI. This module manages workspace detection, multi-folder workspace support, workspace-specific settings, and real-time file system event handling to ensure seamless integration between ReadyAI's AI-powered development orchestrator and the VS Code environment. It enables automatic project discovery, workspace-aware context management, and synchronized file operations that support the local-first architecture while maintaining workspace isolation and security.

**Dependencies & Interactions:** This module depends on the VS Code Extension Host to access VS Code workspace APIs, extension configuration, and workspace event handling. It interacts extensively with the File System Management Module to coordinate file operations, monitor file system events, and maintain workspace-file system synchronization. The module integrates with the Project Management Module to automatically detect and configure ReadyAI projects within VS Code workspaces, with the Context Management Engine to provide workspace-aware context filtering and relevance scoring, and with the Configuration Management Module to handle workspace-specific settings and preferences. It also coordinates with the Multi-Phase Development Orchestrator to ensure phase operations respect workspace boundaries and multi-folder configurations.

## **2. Module-Specific Type Additions (`types.workspaceIntegration.ts`)**

```typescript
/**
 * Workspace Integration Module Types
 * Extends foundational types with workspace integration interfaces
 */

/** VS Code workspace folder information */
export interface WorkspaceFolder {
  /** Folder URI */
  uri: string;
  /** Folder name */
  name: string;
  /** Index in workspace folders array */
  index: number;
  /** Whether this is the primary folder */
  isPrimary: boolean;
  /** Associated ReadyAI project ID */
  projectId?: UUID;
}

/** Workspace configuration scope */
export type WorkspaceConfigScope = 'workspace' | 'folder' | 'global';

/** File system event types for workspace monitoring */
export type WorkspaceFileEventType = 'created' | 'changed' | 'deleted' | 'renamed' | 'will-save' | 'did-save';

/** Workspace synchronization status */
export type WorkspaceSyncStatus = 'synchronized' | 'synchronizing' | 'out_of_sync' | 'error';

/** Workspace detection mode */
export type WorkspaceDetectionMode = 'automatic' | 'manual' | 'disabled';

/** Complete workspace information */
export interface WorkspaceInfo {
  /** Unique workspace identifier */
  id: UUID;
  /** Workspace name */
  name: string;
  /** Workspace folders */
  folders: WorkspaceFolder[];
  /** Workspace root URI (for single folder workspaces) */
  rootUri?: string;
  /** Whether this is a multi-folder workspace */
  isMultiFolder: boolean;
  /** Workspace settings */
  settings: WorkspaceSettings;
  /** Associated ReadyAI projects */
  projects: UUID[];
  /** Workspace detection timestamp */
  detectedAt: string; // ISO 8601 format
  /** Last synchronization timestamp */
  lastSyncAt?: string; // ISO 8601 format
  /** Synchronization status */
  syncStatus: WorkspaceSyncStatus;
}

/** Workspace-specific settings for ReadyAI */
export interface WorkspaceSettings {
  /** ReadyAI configuration scope */
  configScope: WorkspaceConfigScope;
  /** Project detection settings */
  projectDetection: {
    /** Detection mode */
    mode: WorkspaceDetectionMode;
    /** Auto-create projects for detected folders */
    autoCreateProjects: boolean;
    /** Exclude patterns for project detection */
    excludePatterns: string[];
    /** Include patterns for project detection */
    includePatterns: string[];
  };
  /** File synchronization settings */
  fileSynchronization: {
    /** Enable real-time file watching */
    enableFileWatching: boolean;
    /** File watching patterns */
    watchPatterns: string[];
    /** Exclude patterns from watching */
    excludePatterns: string[];
    /** Sync interval in milliseconds */
    syncInterval: number;
    /** Maximum file size for sync (bytes) */
    maxFileSize: number;
  };
  /** Context management settings */
  contextManagement: {
    /** Enable workspace-aware context filtering */
    enableWorkspaceFiltering: boolean;
    /** Cross-folder context sharing */
    enableCrossFolderContext: boolean;
    /** Folder-specific context weights */
    folderContextWeights: Record<string, number>;
  };
  /** AI generation settings */
  aiGeneration: {
    /** Respect workspace boundaries */
    respectWorkspaceBoundaries: boolean;
    /** Allow cross-folder dependencies */
    allowCrossFolderDependencies: boolean;
    /** Folder-specific AI preferences */
    folderAiPreferences: Record<string, Partial<ProjectConfig['aiSettings']>>;
  };
}

/** File system event within workspace */
export interface WorkspaceFileEvent {
  /** Unique event identifier */
  id: UUID;
  /** Workspace identifier */
  workspaceId: UUID;
  /** Event type */
  eventType: WorkspaceFileEventType;
  /** File URI */
  fileUri: string;
  /** File path relative to workspace root */
  relativePath: string;
  /** Workspace folder index */
  folderIndex: number;
  /** Associated project ID */
  projectId?: UUID;
  /** Event timestamp */
  timestamp: string; // ISO 8601 format
  /** Event metadata */
  metadata?: {
    /** File size in bytes */
    fileSize?: number;
    /** File type/extension */
    fileType?: string;
    /** Whether file is text-based */
    isTextFile?: boolean;
    /** Old URI for rename events */
    oldUri?: string;
    /** Change type for change events */
    changeType?: 'content' | 'metadata';
  };
}

/** Workspace synchronization result */
export interface WorkspaceSyncResult {
  /** Synchronization identifier */
  id: UUID;
  /** Workspace identifier */
  workspaceId: UUID;
  /** Synchronization start timestamp */
  startedAt: string; // ISO 8601 format
  /** Synchronization completion timestamp */
  completedAt: string; // ISO 8601 format
  /** Synchronization status */
  status: 'success' | 'partial' | 'failed';
  /** Synchronization statistics */
  stats: {
    /** Files processed */
    filesProcessed: number;
    /** Files synchronized */
    filesSynchronized: number;
    /** Files skipped */
    filesSkipped: number;
    /** Errors encountered */
    errorsEncountered: number;
    /** Context nodes updated */
    contextNodesUpdated: number;
    /** Projects updated */
    projectsUpdated: number;
  };
  /** Synchronization errors */
  errors: Array<{
    /** File path */
    filePath: string;
    /** Error message */
    message: string;
    /** Error code */
    code: string;
  }>;
}

/** Workspace project detection result */
export interface WorkspaceProjectDetection {
  /** Detection identifier */
  id: UUID;
  /** Workspace identifier */
  workspaceId: UUID;
  /** Detected projects */
  detectedProjects: Array<{
    /** Suggested project name */
    name: string;
    /** Project root path */
    rootPath: string;
    /** Workspace folder index */
    folderIndex: number;
    /** Detected technology stack */
    detectedTechStack: TechStack;
    /** Confidence score (0-1) */
    confidence: number;
    /** Detection reasons */
    reasons: string[];
    /** Whether project already exists */
    alreadyExists: boolean;
    /** Existing project ID if applicable */
    existingProjectId?: UUID;
  }>;
  /** Detection timestamp */
  detectedAt: string; // ISO 8601 format
  /** Detection settings used */
  detectionSettings: WorkspaceSettings['projectDetection'];
}

/** Workspace configuration update request */
export interface WorkspaceConfigurationUpdate {
  /** Settings to update */
  settings?: Partial<WorkspaceSettings>;
  /** Folders to add */
  addFolders?: Array<{
    uri: string;
    name: string;
  }>;
  /** Folder indices to remove */
  removeFolders?: number[];
  /** Project associations to update */
  projectAssociations?: Array<{
    folderIndex: number;
    projectId: UUID | null;
  }>;
}

/** Multi-folder workspace context */
export interface MultiFolderContext {
  /** Workspace identifier */
  workspaceId: UUID;
  /** Context per folder */
  folderContexts: Array<{
    /** Folder index */
    folderIndex: number;
    /** Folder name */
    folderName: string;
    /** Associated project ID */
    projectId?: UUID;
    /** Context nodes in this folder */
    contextNodeCount: number;
    /** Average relevance score */
    avgRelevanceScore: number;
    /** Context efficiency metrics */
    efficiency: {
      /** Average retrieval time */
      avgRetrievalTime: number;
      /** Cache hit rate */
      cacheHitRate: number;
      /** Context freshness score */
      freshnessScore: number;
    };
  }>;
  /** Cross-folder dependencies */
  crossFolderDependencies: Array<{
    /** Source folder index */
    fromFolder: number;
    /** Target folder index */
    toFolder: number;
    /** Number of dependencies */
    dependencyCount: number;
    /** Dependency types */
    dependencyTypes: string[];
  }>;
  /** Global workspace metrics */
  globalMetrics: {
    /** Total context nodes */
    totalContextNodes: number;
    /** Cross-folder context sharing ratio */
    crossFolderSharingRatio: number;
    /** Workspace context coherence score */
    coherenceScore: number;
  };
}
```

## **3. API Endpoint Specification (OpenAPI `paths` block)**

```yaml
paths:
  /api/v1/workspace:
    get:
      tags:
        - Workspace
      summary: Get current workspace information
      description: Retrieves information about the currently active VS Code workspace including folders, settings, and associated projects
      security:
        - localAuth: []
      responses:
        '200':
          description: Workspace information retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/WorkspaceInfo'
        '404':
          description: No active workspace found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

    put:
      tags:
        - Workspace
      summary: Update workspace configuration
      description: Updates workspace settings, folder associations, and project mappings
      security:
        - localAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/WorkspaceConfigurationUpdate'
      responses:
        '200':
          description: Workspace configuration updated successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/WorkspaceInfo'
        '400':
          description: Invalid workspace configuration
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

  /api/v1/workspace/detect-projects:
    post:
      tags:
        - Workspace
      summary: Detect ReadyAI projects in workspace
      description: Analyzes workspace folders to detect potential ReadyAI projects based on file structure and technology stack indicators
      security:
        - localAuth: []
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              properties:
                folders:
                  type: array
                  items:
                    type: integer
                  description: Specific folder indices to analyze (optional)
                detectionSettings:
                  type: object
                  properties:
                    includePatterns:
                      type: array
                      items:
                        type: string
                    excludePatterns:
                      type: array
                      items:
                        type: string
                    confidenceThreshold:
                      type: number
                      minimum: 0
                      maximum: 1
                      default: 0.6
      responses:
        '200':
          description: Project detection completed successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/WorkspaceProjectDetection'

  /api/v1/workspace/synchronize:
    post:
      tags:
        - Workspace
      summary: Synchronize workspace with ReadyAI
      description: Performs full synchronization of workspace files, context, and project data with ReadyAI system
      security:
        - localAuth: []
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              properties:
                folders:
                  type: array
                  items:
                    type: integer
                  description: Specific folder indices to synchronize (optional)
                forceSync:
                  type: boolean
                  default: false
                  description: Force synchronization even if already in sync
                syncOptions:
                  type: object
                  properties:
                    updateContext:
                      type: boolean
                      default: true
                    updateProjects:
                      type: boolean
                      default: true
                    processFileEvents:
                      type: boolean
                      default: true
      responses:
        '200':
          description: Workspace synchronization completed
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/WorkspaceSyncResult'
        '409':
          description: Synchronization already in progress
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

  /api/v1/workspace/events:
    get:
      tags:
        - Workspace
      summary: Get workspace file events
      description: Retrieves recent file system events within the workspace with filtering options
      security:
        - localAuth: []
      parameters:
        - name: eventTypes
          in: query
          description: Comma-separated event types to filter by
          required: false
          schema:
            type: string
            example: "created,changed,deleted"
        - name: folders
          in: query
          description: Comma-separated folder indices to filter by
          required: false
          schema:
            type: string
        - name: projectId
          in: query
          description: Filter events by associated project
          required: false
          schema:
            $ref: '#/components/schemas/UUID'
        - name: since
          in: query
          description: Return events since this timestamp
          required: false
          schema:
            type: string
            format: date-time
        - name: limit
          in: query
          description: Maximum number of events to return
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 1000
            default: 100
      responses:
        '200':
          description: Workspace events retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          events:
                            type: array
                            items:
                              $ref: '#/components/schemas/WorkspaceFileEvent'
                          totalCount:
                            type: integer
                          hasMore:
                            type: boolean

    post:
      tags:
        - Workspace
      summary: Report workspace file event
      description: Reports a file system event that occurred within the workspace (typically used by VS Code extension)
      security:
        - localAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                eventType:
                  type: string
                  enum: [created, changed, deleted, renamed, will-save, did-save]
                fileUri:
                  type: string
                  format: uri
                relativePath:
                  type: string
                folderIndex:
                  type: integer
                  minimum: 0
                metadata:
                  type: object
                  properties:
                    fileSize:
                      type: integer
                    fileType:
                      type: string
                    isTextFile:
                      type: boolean
                    oldUri:
                      type: string
                      format: uri
                    changeType:
                      type: string
                      enum: [content, metadata]
              required:
                - eventType
                - fileUri
                - relativePath
                - folderIndex
      responses:
        '201':
          description: File event recorded successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/WorkspaceFileEvent'

  /api/v1/workspace/folders/{folderIndex}/context:
    get:
      tags:
        - Workspace
      summary: Get folder-specific context information
      description: Retrieves context information and metrics for a specific workspace folder
      security:
        - localAuth: []
      parameters:
        - name: folderIndex
          in: path
          required: true
          schema:
            type: integer
            minimum: 0
      responses:
        '200':
          description: Folder context information retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          folderIndex:
                            type: integer
                          folderName:
                            type: string
                          projectId:
                            $ref: '#/components/schemas/UUID'
                          contextNodes:
                            type: array
                            items:
                              $ref: '#/components/schemas/ContextNode'
                          contextMetrics:
                            type: object
                            properties:
                              totalNodes:
                                type: integer
                              avgRelevanceScore:
                                type: number
                              avgRetrievalTime:
                                type: number
                              cacheHitRate:
                                type: number
        '404':
          description: Folder not found in workspace
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

  /api/v1/workspace/multi-folder-context:
    get:
      tags:
        - Workspace
      summary: Get multi-folder workspace context
      description: Retrieves comprehensive context information for multi-folder workspaces including cross-folder dependencies
      security:
        - localAuth: []
      responses:
        '200':
          description: Multi-folder context information retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/MultiFolderContext'
        '400':
          description: Not a multi-folder workspace
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

  /api/v1/workspace/settings:
    get:
      tags:
        - Workspace
      summary: Get workspace settings
      description: Retrieves current ReadyAI-specific settings for the workspace
      security:
        - localAuth: []
      responses:
        '200':
          description: Workspace settings retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/WorkspaceSettings'

    put:
      tags:
        - Workspace
      summary: Update workspace settings
      description: Updates ReadyAI-specific settings for the workspace
      security:
        - localAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/WorkspaceSettings'
      responses:
        '200':
          description: Workspace settings updated successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/WorkspaceSettings'
        '400':
          description: Invalid workspace settings
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

components:
  schemas:
    WorkspaceInfo:
      type: object
      required:
        - id
        - name
        - folders
        - isMultiFolder
        - settings
        - projects
        - detectedAt
        - syncStatus
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        name:
          type: string
        folders:
          type: array
          items:
            $ref: '#/components/schemas/WorkspaceFolder'
        rootUri:
          type: string
          format: uri
        isMultiFolder:
          type: boolean
        settings:
          $ref: '#/components/schemas/WorkspaceSettings'
        projects:
          type: array
          items:
            $ref: '#/components/schemas/UUID'
        detectedAt:
          type: string
          format: date-time
        lastSyncAt:
          type: string
          format: date-time
        syncStatus:
          type: string
          enum: [synchronized, synchronizing, out_of_sync, error]

    WorkspaceFolder:
      type: object
      required:
        - uri
        - name
        - index
        - isPrimary
      properties:
        uri:
          type: string
          format: uri
        name:
          type: string
        index:
          type: integer
          minimum: 0
        isPrimary:
          type: boolean
        projectId:
          $ref: '#/components/schemas/UUID'

    WorkspaceSettings:
      type: object
      required:
        - configScope
        - projectDetection
        - fileSynchronization
        - contextManagement
        - aiGeneration
      properties:
        configScope:
          type: string
          enum: [workspace, folder, global]
        projectDetection:
          type: object
          properties:
            mode:
              type: string
              enum: [automatic, manual, disabled]
            autoCreateProjects:
              type: boolean
            excludePatterns:
              type: array
              items:
                type: string
            includePatterns:
              type: array
              items:
                type: string
        fileSynchronization:
          type: object
          properties:
            enableFileWatching:
              type: boolean
            watchPatterns:
              type: array
              items:
                type: string
            excludePatterns:
              type: array
              items:
                type: string
            syncInterval:
              type: integer
            maxFileSize:
              type: integer
        contextManagement:
          type: object
          properties:
            enableWorkspaceFiltering:
              type: boolean
            enableCrossFolderContext:
              type: boolean
            folderContextWeights:
              type: object
              additionalProperties:
                type: number
        aiGeneration:
          type: object
          properties:
            respectWorkspaceBoundaries:
              type: boolean
            allowCrossFolderDependencies:
              type: boolean
            folderAiPreferences:
              type: object
              additionalProperties:
                type: object

    WorkspaceFileEvent:
      type: object
      required:
        - id
        - workspaceId
        - eventType
        - fileUri
        - relativePath
        - folderIndex
        - timestamp
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        workspaceId:
          $ref: '#/components/schemas/UUID'
        eventType:
          type: string
          enum: [created, changed, deleted, renamed, will-save, did-save]
        fileUri:
          type: string
          format: uri
        relativePath:
          type: string
        folderIndex:
          type: integer
        projectId:
          $ref: '#/components/schemas/UUID'
        timestamp:
          type: string
          format: date-time
        metadata:
          type: object
          properties:
            fileSize:
              type: integer
            fileType:
              type: string
            isTextFile:
              type: boolean
            oldUri:
              type: string
              format: uri
            changeType:
              type: string
              enum: [content, metadata]

    WorkspaceSyncResult:
      type: object
      required:
        - id
        - workspaceId
        - startedAt
        - completedAt
        - status
        - stats
        - errors
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        workspaceId:
          $ref: '#/components/schemas/UUID'
        startedAt:
          type: string
          format: date-time
        completedAt:
          type: string
          format: date-time
        status:
          type: string
          enum: [success, partial, failed]
        stats:
          type: object
          properties:
            filesProcessed:
              type: integer
            filesSynchronized:
              type: integer
            filesSkipped:
              type: integer
            errorsEncountered:
              type: integer
            contextNodesUpdated:
              type: integer
            projectsUpdated:
              type: integer
        errors:
          type: array
          items:
            type: object
            properties:
              filePath:
                type: string
              message:
                type: string
              code:
                type: string

    WorkspaceProjectDetection:
      type: object
      required:
        - id
        - workspaceId
        - detectedProjects
        - detectedAt
        - detectionSettings
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        workspaceId:
          $ref: '#/components/schemas/UUID'
        detectedProjects:
          type: array
          items:
            type: object
            properties:
              name:
                type: string
              rootPath:
                type: string
              folderIndex:
                type: integer
              detectedTechStack:
                type: object
              confidence:
                type: number
              reasons:
                type: array
                items:
                  type: string
              alreadyExists:
                type: boolean
              existingProjectId:
                $ref: '#/components/schemas/UUID'
        detectedAt:
          type: string
          format: date-time
        detectionSettings:
          type: object

    WorkspaceConfigurationUpdate:
      type: object
      properties:
        settings:
          $ref: '#/components/schemas/WorkspaceSettings'
        addFolders:
          type: array
          items:
            type: object
            properties:
              uri:
                type: string
                format: uri
              name:
                type: string
        removeFolders:
          type: array
          items:
            type: integer
        projectAssociations:
          type: array
          items:
            type: object
            properties:
              folderIndex:
                type: integer
              projectId:
                $ref: '#/components/schemas/UUID'

    MultiFolderContext:
      type: object
      required:
        - workspaceId
        - folderContexts
        - crossFolderDependencies
        - globalMetrics
      properties:
        workspaceId:
          $ref: '#/components/schemas/UUID'
        folderContexts:
          type: array
          items:
            type: object
            properties:
              folderIndex:
                type: integer
              folderName:
                type: string
              projectId:
                $ref: '#/components/schemas/UUID'
              contextNodeCount:
                type: integer
              avgRelevanceScore:
                type: number
              efficiency:
                type: object
                properties:
                  avgRetrievalTime:
                    type: number
                  cacheHitRate:
                    type: number
                  freshnessScore:
                    type: number
        crossFolderDependencies:
          type: array
          items:
            type: object
            properties:
              fromFolder:
                type: integer
              toFolder:
                type: integer
              dependencyCount:
                type: integer
              dependencyTypes:
                type: array
                items:
                  type: string
        globalMetrics:
          type: object
          properties:
            totalContextNodes:
              type: integer
            crossFolderSharingRatio:
              type: number
            coherenceScore:
              type: number
```

## **4. Detailed Business Logic & Validation Rules**

| Rule ID | Rule Description | Implementation Location(s) & Notes |
|---------|------------------|-----------------------------------|
| **WSI-01** | Workspace detection must be triggered automatically when VS Code Extension Host reports workspace changes, and must validate workspace accessibility through File System Management Module. | **Backend (Authoritative):** Workspace service must listen to VS Code extension events, validate each folder path via File System Management, and create/update workspace records with proper error handling. |
| **WSI-02** | Multi-folder workspace synchronization must respect folder isolation boundaries unless cross-folder context sharing is explicitly enabled in workspace settings. | **Backend (Authoritative):** Sync service must check workspace settings before sharing context across folders, enforce folder-specific project associations, and prevent unauthorized cross-folder file access. |
| **WSI-03** | File system events must be filtered and processed according to workspace settings watch patterns, and must update Context Management Engine only for relevant file types. | **Backend (Authoritative):** Event processing service must validate events against include/exclude patterns, determine file relevance for context updates, and batch events for efficient Context Management updates. |
| **WSI-04** | Project detection within workspace folders must respect exclude patterns, validate detected tech stacks against Project Management Module templates, and avoid duplicate project creation. | **Backend (Authoritative):** Detection service must filter folders by patterns, analyze file structures for tech stack indicators, query Project Management for existing projects, and provide confidence scoring. |
| **WSI-05** | Workspace settings changes must be propagated to Configuration Management Module and trigger re-synchronization of affected folders when settings impact file watching or context management. | **Backend (Authoritative):** Settings service must validate changes, update Configuration Management, trigger selective re-sync for affected folders, and maintain settings history for rollback. |
| **WSI-06** | File synchronization must coordinate with File System Management Module for file operations and Context Management Engine for context updates while respecting workspace boundaries. | **Backend (Authoritative):** Sync orchestrator must batch file operations via File System Management, update context via Context Management with workspace context, and maintain sync state consistency. |
| **WSI-07** | Cross-folder dependencies in multi-folder workspaces must be tracked and validated to ensure AI code generation respects workspace architecture when allowCrossFolderDependencies is disabled. | **Backend (Authoritative):** Dependency tracker must monitor imports/references across folders, validate against workspace settings, and provide dependency information to AI generation services. |
| **WSI-08** | Workspace folder additions and removals must trigger project association updates, context re-indexing through Context Management Engine, and file system validation. | **Backend (Authoritative):** Folder management service must validate new folder paths, update project associations, trigger context re-indexing for affected folders, and cleanup orphaned data. |
| **WSI-09** | File watching events must be throttled and batched to prevent overwhelming the system during bulk file operations while maintaining real-time responsiveness for individual file changes. | **Backend (Authoritative):** Event throttling service must implement sliding window batching, detect bulk operations, prioritize interactive changes, and maintain event ordering for context updates. |
| **WSI-10** | Workspace synchronization status must be monitored and reported to Logging & Monitoring Service, with automatic recovery mechanisms for failed synchronizations and conflict resolution. | **Backend (Authoritative):** Sync monitor must track sync status, log metrics to Monitoring Service, implement exponential backoff retry logic, and provide user notifications for persistent failures. |

## **5. Developer Task Checklist**

### **Backend Tasks:**
- [ ] Create database migration script for workspace integration tables (`workspaces`, `workspace_folders`, `workspace_settings`, `workspace_events`, `workspace_sync_status`)
- [ ] Implement the `WorkspaceIntegrationService` class with workspace detection, configuration management, and multi-folder support capabilities
- [ ] Implement the `WorkspaceDetectionService` class for automatic workspace discovery and project detection within workspace folders
- [ ] Implement the `WorkspaceSynchronizationService` class for coordinating file system events, context updates, and project synchronization
- [ ] Implement the `WorkspaceFileEventService` class for processing, filtering, and batching file system events with throttling mechanisms
- [ ] Implement the `MultiFolderContextService` class for managing context relationships and dependencies across workspace folders
- [ ] Implement all workspace API endpoints (`GET`, `PUT /api/v1/workspace`) with comprehensive workspace information and configuration management
- [ ] Implement workspace project detection endpoint (`POST /api/v1/workspace/detect-projects`) with tech stack analysis and confidence scoring
- [ ] Implement workspace synchronization endpoint (`POST /api/v1/workspace/synchronize`) with selective folder sync and progress tracking
- [ ] Implement file event endpoints (`GET`, `POST /api/v1/workspace/events`) with real-time event streaming and filtering capabilities
- [ ] Implement folder-specific context endpoint (`GET /api/v1/workspace/folders/{folderIndex}/context`) with context metrics and performance data
- [ ] Implement multi-folder context endpoint (`GET /api/v1/workspace/multi-folder-context`) with cross-folder dependency analysis
- [ ] Implement workspace settings endpoints (`GET`, `PUT /api/v1/workspace/settings`) with validation and change propagation
- [ ] Create `WorkspaceRepository` class for database operations with proper indexing on workspace paths, folder URIs, and project associations
- [ ] Create `WorkspaceEventRepository` class for efficient event storage and retrieval with time-based indexing and cleanup policies
- [ ] Create `WorkspaceSettingsRepository` class for settings persistence with schema validation and change tracking
- [ ] Implement integration with VS Code Extension Host for workspace event subscriptions, API access, and configuration synchronization
- [ ] Implement integration with File System Management Module for file operations, directory watching, and path validation
- [ ] Implement integration with Project Management Module for project detection, creation, and association management
- [ ] Implement integration with Context Management Engine for workspace-aware context filtering and cross-folder context sharing
- [ ] Implement integration with Configuration Management Module for workspace-specific settings propagation and validation
- [ ] Implement integration with Logging & Monitoring Service for workspace operation tracking, sync status monitoring, and performance metrics
- [ ] Create comprehensive unit tests for all service classes with mock implementations of dependent modules and VS Code API simulation
- [ ] Create integration tests for workspace lifecycle workflows including detection, synchronization, multi-folder scenarios, and error recovery
- [ ] Implement performance optimizations for file event processing with proper batching, throttling, and memory management
- [ ] Add workspace health monitoring with automatic sync recovery, conflict detection, and user notification systems

### **Frontend Tasks:**
- [ ] Create `WorkspaceProvider` React context for managing workspace state and integration with VS Code extension APIs
- [ ] Implement `useWorkspace` hook for accessing workspace information, settings, and real-time synchronization status
- [ ] Create `WorkspaceExplorer` component for displaying multi-folder workspace structure with project associations and context metrics
- [ ] Implement `WorkspaceSettings` component for configuring detection, synchronization, and context management settings
- [ ] Create `ProjectDetectionDialog` component for displaying detected projects with confidence scores and creation options
- [ ] Implement `WorkspaceSyncStatus` component for showing synchronization progress, statistics, and error reporting
- [ ] Create `FolderContextView` component for displaying folder-specific context information and performance metrics
- [ ] Implement `CrossFolderDependencies` component for visualizing and managing dependencies between workspace folders
- [ ] Create workspace service functions in the API client (`workspaceService.ts`) for all workspace management endpoints
- [ ] Implement real-time workspace event handling with WebSocket integration for live file system event updates
- [ ] Create workspace file explorer integration with VS Code TreeView API for enhanced project navigation
- [ ] Implement workspace configuration interface with form validation and real-time settings synchronization
- [ ] Add workspace health indicators to main application interface with status badges and quick action buttons
- [ ] Create workspace project management interface with drag-and-drop folder associations and bulk project operations
- [ ] Implement workspace backup and restore functionality integrated with project backup systems
- [ ] Add workspace analytics dashboard with synchronization metrics, context efficiency, and usage statistics
- [ ] Create workspace troubleshooting tools with sync conflict resolution and diagnostic information
- [ ] Implement workspace templates and presets for common multi-folder development scenarios
- [ ] Add workspace onboarding flow with automatic detection, project setup wizard, and configuration recommendations
- [ ] Create workspace command palette commands for quick access to synchronization, detection, and configuration functions



========================================================================================


# Code Generation Engine - Technical Specification

## **1. Module Overview**

**Purpose:** The Code Generation Engine serves as the centralized AI-powered code generation system for ReadyAI, responsible for creating high-quality, context-aware code files throughout the 7-phase development methodology. This module orchestrates template-free code generation by leveraging the Claude Integration Service, maintains comprehensive context awareness through the Context Management Engine, validates generated code quality, tracks generation history for optimization, and ensures seamless integration with the local-first architecture while supporting the development velocity KPI of 70-90% reduction in time-to-working-application.

**Dependencies & Interactions:** This module depends on the Claude Integration Service to perform AI-powered code generation with extended thinking mode capabilities, the Context Management Engine to retrieve relevant context nodes and maintain semantic relationships, the Quality Assurance Orchestrator to validate generated code quality and architectural consistency, and the File System Management Module to write generated files and manage file operations. It interacts extensively with the Multi-Phase Development Orchestrator to receive generation requests for specific phases and provide phase-appropriate code artifacts, with the Project Management Module to track project-specific generation metrics and preferences, and with the Logging & Monitoring Service to record generation performance, token usage, and quality metrics that support ReadyAI's KPIs for code quality consistency and context management efficiency.

## **2. Module-Specific Type Additions (`types.codeGeneration.ts`)**

```typescript
/**
 * Code Generation Engine Module Types
 * Extends foundational types with code generation-specific interfaces
 */

/** Code generation request priorities */
export type GenerationPriority = 'low' | 'normal' | 'high' | 'critical';

/** Code generation strategies */
export type GenerationStrategy = 
  | 'context_aware'
  | 'dependency_first' 
  | 'incremental'
  | 'full_file'
  | 'patch_based'
  | 'template_guided';

/** Code generation quality levels */
export type GenerationQualityLevel = 'draft' | 'standard' | 'production' | 'enterprise';

/** Code generation status */
export type GenerationStatus = 'queued' | 'preparing' | 'generating' | 'validating' | 'completed' | 'failed' | 'cancelled';

/** Programming language support */
export type SupportedLanguage = 
  | 'typescript'
  | 'javascript'
  | 'python'
  | 'java'
  | 'csharp'
  | 'go'
  | 'rust'
  | 'cpp'
  | 'php'
  | 'ruby'
  | 'swift'
  | 'kotlin';

/** Code generation optimization techniques */
export type OptimizationTechnique = 
  | 'context_compression'
  | 'dependency_ordering'
  | 'cache_reuse'
  | 'pattern_matching'
  | 'incremental_updates';

/** Enhanced code generation request */
export interface CodeGenerationRequest {
  /** Unique generation request identifier */
  id: UUID;
  /** Associated project */
  projectId: UUID;
  /** Current development phase */
  phase: PhaseType;
  /** Target file to generate */
  targetFile: string;
  /** Programming language for the file */
  language: SupportedLanguage;
  /** Generation strategy to use */
  strategy: GenerationStrategy;
  /** Quality level requirement */
  qualityLevel: GenerationQualityLevel;
  /** Generation priority */
  priority: GenerationPriority;
  /** Specific generation requirements */
  requirements: {
    /** Functional requirements description */
    description: string;
    /** Specific features to implement */
    features?: string[];
    /** Integration requirements */
    integrations?: string[];
    /** Performance requirements */
    performance?: string[];
    /** Security requirements */
    security?: string[];
  };
  /** Context selection criteria */
  contextCriteria: {
    /** Required context types */
    requiredTypes: ContextType[];
    /** Relevance threshold (0-1) */
    relevanceThreshold: number;
    /** Maximum context nodes */
    maxContextNodes: number;
    /** Include dependency context */
    includeDependencies: boolean;
  };
  /** AI provider settings */
  aiSettings: {
    /** AI provider to use */
    provider: AIProviderType;
    /** Enable extended thinking mode */
    extendedThinking: boolean;
    /** Temperature for generation (0-1) */
    temperature?: number;
    /** Max tokens for response */
    maxTokens?: number;
  };
  /** Request metadata */
  metadata: {
    /** User session context */
    sessionId?: string;
    /** Request source */
    source: 'manual' | 'orchestrator' | 'auto_complete' | 'refactor';
    /** Parent generation request */
    parentRequestId?: UUID;
    /** Related generation requests */
    relatedRequestIds?: UUID[];
  };
  /** Request creation timestamp */
  createdAt: string; // ISO 8601 format
  /** Request status */
  status: GenerationStatus;
}

/** Code generation result with enhanced metadata */
export interface CodeGenerationResult {
  /** Generation request identifier */
  requestId: UUID;
  /** Generation success status */
  success: boolean;
  /** Generated code content */
  content?: string;
  /** Generation confidence score (0-1) */
  confidence: number;
  /** Quality assessment results */
  qualityAssessment: {
    /** Overall quality score (0-100) */
    overallScore: number;
    /** Code complexity assessment */
    complexity: {
      cyclomaticComplexity: number;
      cognitiveComplexity: number;
      maintainabilityIndex: number;
    };
    /** Architectural consistency score */
    architecturalConsistency: number;
    /** Security assessment */
    securityScore: number;
    /** Performance indicators */
    performanceIndicators: string[];
  };
  /** Context utilization metrics */
  contextUtilization: {
    /** Total context nodes provided */
    totalContextNodes: number;
    /** Context nodes actually used */
    usedContextNodes: number;
    /** Context effectiveness score */
    effectivenessScore: number;
    /** Most influential context nodes */
    keyContextNodes: UUID[];
  };
  /** Token usage statistics */
  tokenUsage: {
    /** Input tokens consumed */
    inputTokens: number;
    /** Output tokens generated */
    outputTokens: number;
    /** Total tokens used */
    totalTokens: number;
    /** Token efficiency ratio */
    efficiency: number;
  };
  /** Generation performance metrics */
  performance: {
    /** Context preparation time (ms) */
    contextPreparationTime: number;
    /** AI generation time (ms) */
    aiGenerationTime: number;
    /** Quality validation time (ms) */
    validationTime: number;
    /** Total generation time (ms) */
    totalTime: number;
  };
  /** Issues and warnings */
  issues: GenerationIssue[];
  /** Optimization suggestions */
  optimizations: GenerationOptimization[];
  /** Generation completion timestamp */
  completedAt: string; // ISO 8601 format
}

/** Generation issue or warning */
export interface GenerationIssue {
  /** Issue severity */
  severity: 'info' | 'warning' | 'error' | 'critical';
  /** Issue type */
  type: 'syntax' | 'logic' | 'security' | 'performance' | 'style' | 'dependency';
  /** Issue description */
  message: string;
  /** Line number (if applicable) */
  line?: number;
  /** Column number (if applicable) */
  column?: number;
  /** Suggested fix */
  suggestion?: string;
  /** Issue confidence score */
  confidence: number;
}

/** Generation optimization suggestion */
export interface GenerationOptimization {
  /** Optimization technique */
  technique: OptimizationTechnique;
  /** Optimization description */
  description: string;
  /** Potential improvement */
  improvement: {
    /** Performance improvement estimate */
    performanceGain?: string;
    /** Quality improvement estimate */
    qualityGain?: string;
    /** Token usage reduction estimate */
    tokenReduction?: string;
  };
  /** Implementation effort estimate */
  effort: 'low' | 'medium' | 'high';
  /** Priority recommendation */
  priority: number; // 1-10 scale
}

/** Generation history entry */
export interface GenerationHistoryEntry {
  /** History entry identifier */
  id: UUID;
  /** Project identifier */
  projectId: UUID;
  /** Original generation request */
  request: CodeGenerationRequest;
  /** Generation result */
  result: CodeGenerationResult;
  /** File path that was generated */
  filePath: string;
  /** Generation version for the same file */
  version: number;
  /** Whether generation was accepted */
  accepted: boolean;
  /** User feedback */
  feedback?: {
    /** Quality rating (1-5) */
    qualityRating?: number;
    /** Usefulness rating (1-5) */
    usefulnessRating?: number;
    /** Comments */
    comments?: string;
  };
  /** History entry timestamp */
  timestamp: string; // ISO 8601 format
}

/** Generation template for reusable patterns */
export interface GenerationTemplate {
  /** Template identifier */
  id: UUID;
  /** Template name */
  name: string;
  /** Template description */
  description: string;
  /** Supported language */
  language: SupportedLanguage;
  /** Template category */
  category: string;
  /** Template pattern */
  pattern: string;
  /** Template variables */
  variables: Array<{
    name: string;
    type: string;
    description: string;
    required: boolean;
    defaultValue?: any;
  }>;
  /** Usage statistics */
  usageCount: number;
  /** Success rate */
  successRate: number;
  /** Template creation timestamp */
  createdAt: string; // ISO 8601 format
  /** Last usage timestamp */
  lastUsed?: string; // ISO 8601 format
}

/** Code generation batch request for multiple files */
export interface BatchGenerationRequest {
  /** Batch request identifier */
  id: UUID;
  /** Batch name */
  name: string;
  /** Associated project */
  projectId: UUID;
  /** Development phase */
  phase: PhaseType;
  /** Individual generation requests */
  requests: CodeGenerationRequest[];
  /** Batch processing options */
  options: {
    /** Process requests in parallel */
    parallel: boolean;
    /** Maximum concurrent generations */
    maxConcurrency: number;
    /** Continue on individual failures */
    continueOnFailure: boolean;
    /** Dependency ordering */
    respectDependencies: boolean;
  };
  /** Batch status */
  status: 'pending' | 'processing' | 'completed' | 'failed' | 'cancelled';
  /** Batch creation timestamp */
  createdAt: string; // ISO 8601 format
}

/** Generation analytics and insights */
export interface GenerationAnalytics {
  /** Analytics identifier */
  id: UUID;
  /** Project identifier */
  projectId: UUID;
  /** Analytics period */
  period: {
    /** Period start */
    startDate: string; // ISO 8601 format
    /** Period end */
    endDate: string; // ISO 8601 format
  };
  /** Generation statistics */
  statistics: {
    /** Total generations attempted */
    totalGenerations: number;
    /** Successful generations */
    successfulGenerations: number;
    /** Success rate percentage */
    successRate: number;
    /** Average generation time */
    avgGenerationTime: number;
    /** Average quality score */
    avgQualityScore: number;
    /** Total tokens consumed */
    totalTokensUsed: number;
    /** Average tokens per generation */
    avgTokensPerGeneration: number;
  };
  /** Language breakdown */
  languageBreakdown: Record<SupportedLanguage, {
    count: number;
    successRate: number;
    avgQualityScore: number;
    avgGenerationTime: number;
  }>;
  /** Phase breakdown */
  phaseBreakdown: Record<PhaseType, {
    count: number;
    successRate: number;
    avgComplexity: number;
  }>;
  /** Top issues encountered */
  topIssues: Array<{
    type: string;
    count: number;
    severity: string;
    trend: 'increasing' | 'stable' | 'decreasing';
  }>;
  /** Optimization opportunities */
  optimizationOpportunities: Array<{
    technique: OptimizationTechnique;
    potentialSavings: string;
    estimatedImpact: 'low' | 'medium' | 'high';
  }>;
}
```

## **3. API Endpoint Specification (OpenAPI `paths` block)**

```yaml
paths:
  /api/v1/generation/requests:
    get:
      tags:
        - Code Generation
      summary: List generation requests
      description: Retrieves code generation requests with filtering, pagination, and search capabilities
      security:
        - localAuth: []
      parameters:
        - name: projectId
          in: query
          description: Filter by project ID
          required: false
          schema:
            $ref: '#/components/schemas/UUID'
        - name: phase
          in: query
          description: Filter by development phase
          required: false
          schema:
            $ref: '#/components/schemas/PhaseType'
        - name: status
          in: query
          description: Filter by generation status
          required: false
          schema:
            type: string
            enum: [queued, preparing, generating, validating, completed, failed, cancelled]
        - name: language
          in: query
          description: Filter by programming language
          required: false
          schema:
            type: string
            enum: [typescript, javascript, python, java, csharp, go, rust, cpp, php, ruby, swift, kotlin]
        - name: startDate
          in: query
          description: Filter by requests created after this date
          required: false
          schema:
            type: string
            format: date-time
        - name: endDate
          in: query
          description: Filter by requests created before this date
          required: false
          schema:
            type: string
            format: date-time
        - name: limit
          in: query
          description: Maximum number of results
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
        - name: offset
          in: query
          description: Offset for pagination
          required: false
          schema:
            type: integer
            minimum: 0
            default: 0
      responses:
        '200':
          description: Generation requests retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          requests:
                            type: array
                            items:
                              $ref: '#/components/schemas/CodeGenerationRequest'
                          totalCount:
                            type: integer
                          hasMore:
                            type: boolean
        '400':
          description: Invalid query parameters
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

    post:
      tags:
        - Code Generation
      summary: Create generation request
      description: Creates a new code generation request with context-aware settings
      security:
        - localAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                projectId:
                  $ref: '#/components/schemas/UUID'
                phase:
                  $ref: '#/components/schemas/PhaseType'
                targetFile:
                  type: string
                  minLength: 1
                language:
                  type: string
                  enum: [typescript, javascript, python, java, csharp, go, rust, cpp, php, ruby, swift, kotlin]
                strategy:
                  type: string
                  enum: [context_aware, dependency_first, incremental, full_file, patch_based, template_guided]
                  default: context_aware
                qualityLevel:
                  type: string
                  enum: [draft, standard, production, enterprise]
                  default: standard
                priority:
                  type: string
                  enum: [low, normal, high, critical]
                  default: normal
                requirements:
                  type: object
                  properties:
                    description:
                      type: string
                      minLength: 1
                    features:
                      type: array
                      items:
                        type: string
                    integrations:
                      type: array
                      items:
                        type: string
                    performance:
                      type: array
                      items:
                        type: string
                    security:
                      type: array
                      items:
                        type: string
                  required:
                    - description
                contextCriteria:
                  type: object
                  properties:
                    requiredTypes:
                      type: array
                      items:
                        type: string
                        enum: [file, module, dependency, pattern, artifact]
                    relevanceThreshold:
                      type: number
                      minimum: 0
                      maximum: 1
                      default: 0.7
                    maxContextNodes:
                      type: integer
                      minimum: 1
                      maximum: 100
                      default: 20
                    includeDependencies:
                      type: boolean
                      default: true
                aiSettings:
                  type: object
                  properties:
                    provider:
                      $ref: '#/components/schemas/AIProviderType'
                    extendedThinking:
                      type: boolean
                      default: true
                    temperature:
                      type: number
                      minimum: 0
                      maximum: 1
                    maxTokens:
                      type: integer
                      minimum: 100
                      maximum: 10000
                metadata:
                  type: object
                  properties:
                    sessionId:
                      type: string
                    source:
                      type: string
                      enum: [manual, orchestrator, auto_complete, refactor]
                      default: manual
                    parentRequestId:
                      $ref: '#/components/schemas/UUID'
                    relatedRequestIds:
                      type: array
                      items:
                        $ref: '#/components/schemas/UUID'
              required:
                - projectId
                - phase
                - targetFile
                - language
                - requirements
      responses:
        '201':
          description: Generation request created successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/CodeGenerationRequest'
        '400':
          description: Invalid request parameters
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

  /api/v1/generation/requests/{requestId}:
    get:
      tags:
        - Code Generation
      summary: Get generation request details
      description: Retrieves detailed information about a specific generation request including results
      security:
        - localAuth: []
      parameters:
        - name: requestId
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '200':
          description: Generation request retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          request:
                            $ref: '#/components/schemas/CodeGenerationRequest'
                          result:
                            $ref: '#/components/schemas/CodeGenerationResult'
        '404':
          description: Generation request not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

    patch:
      tags:
        - Code Generation
      summary: Update generation request
      description: Updates a generation request (mainly for status changes or cancellation)
      security:
        - localAuth: []
      parameters:
        - name: requestId
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                status:
                  type: string
                  enum: [cancelled]
                feedback:
                  type: object
                  properties:
                    qualityRating:
                      type: integer
                      minimum: 1
                      maximum: 5
                    usefulnessRating:
                      type: integer
                      minimum: 1
                      maximum: 5
                    comments:
                      type: string
      responses:
        '200':
          description: Generation request updated successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/CodeGenerationRequest'

  /api/v1/generation/requests/{requestId}/execute:
    post:
      tags:
        - Code Generation
      summary: Execute generation request
      description: Triggers the execution of a queued generation request
      security:
        - localAuth: []
      parameters:
        - name: requestId
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '202':
          description: Generation execution started
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          message:
                            type: string
                          estimatedCompletionTime:
                            type: string
                            format: date-time

  /api/v1/generation/batch:
    post:
      tags:
        - Code Generation
      summary: Create batch generation request
      description: Creates a batch generation request for multiple files with dependency management
      security:
        - localAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  minLength: 1
                projectId:
                  $ref: '#/components/schemas/UUID'
                phase:
                  $ref: '#/components/schemas/PhaseType'
                requests:
                  type: array
                  items:
                    type: object
                    # Simplified version of CodeGenerationRequest for batch
                  minItems: 1
                options:
                  type: object
                  properties:
                    parallel:
                      type: boolean
                      default: true
                    maxConcurrency:
                      type: integer
                      minimum: 1
                      maximum: 10
                      default: 3
                    continueOnFailure:
                      type: boolean
                      default: false
                    respectDependencies:
                      type: boolean
                      default: true
              required:
                - name
                - projectId
                - phase
                - requests
      responses:
        '201':
          description: Batch generation request created successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/BatchGenerationRequest'

  /api/v1/generation/history:
    get:
      tags:
        - Code Generation
      summary: Get generation history
      description: Retrieves generation history with filtering and analytics
      security:
        - localAuth: []
      parameters:
        - name: projectId
          in: query
          description: Filter by project ID
          required: false
          schema:
            $ref: '#/components/schemas/UUID'
        - name: filePath
          in: query
          description: Filter by specific file path
          required: false
          schema:
            type: string
        - name: language
          in: query
          description: Filter by programming language
          required: false
          schema:
            type: string
        - name: startDate
          in: query
          description: Filter by history entries after this date
          required: false
          schema:
            type: string
            format: date-time
        - name: endDate
          in: query
          description: Filter by history entries before this date
          required: false
          schema:
            type: string
            format: date-time
        - name: limit
          in: query
          description: Maximum number of results
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
      responses:
        '200':
          description: Generation history retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          history:
                            type: array
                            items:
                              $ref: '#/components/schemas/GenerationHistoryEntry'
                          totalCount:
                            type: integer

  /api/v1/generation/templates:
    get:
      tags:
        - Code Generation
      summary: List generation templates
      description: Retrieves available generation templates for reusable patterns
      security:
        - localAuth: []
      parameters:
        - name: language
          in: query
          description: Filter by programming language
          required: false
          schema:
            type: string
        - name: category
          in: query
          description: Filter by template category
          required: false
          schema:
            type: string
        - name: sortBy
          in: query
          description: Sort templates by criteria
          required: false
          schema:
            type: string
            enum: [usage, success_rate, created_date, name]
            default: usage
      responses:
        '200':
          description: Generation templates retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          templates:
                            type: array
                            items:
                              $ref: '#/components/schemas/GenerationTemplate'

    post:
      tags:
        - Code Generation
      summary: Create generation template
      description: Creates a new reusable generation template from successful patterns
      security:
        - localAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  minLength: 1
                description:
                  type: string
                  minLength: 1
                language:
                  type: string
                  enum: [typescript, javascript, python, java, csharp, go, rust, cpp, php, ruby, swift, kotlin]
                category:
                  type: string
                  minLength: 1
                pattern:
                  type: string
                  minLength: 1
                variables:
                  type: array
                  items:
                    type: object
                    properties:
                      name:
                        type: string
                      type:
                        type: string
                      description:
                        type: string
                      required:
                        type: boolean
                      defaultValue:
                        type: string
              required:
                - name
                - description
                - language
                - category
                - pattern
      responses:
        '201':
          description: Generation template created successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/GenerationTemplate'

  /api/v1/generation/analytics:
    get:
      tags:
        - Code Generation
      summary: Get generation analytics
      description: Retrieves comprehensive analytics and insights for code generation performance
      security:
        - localAuth: []
      parameters:
        - name: projectId
          in: query
          description: Filter analytics by project ID
          required: false
          schema:
            $ref: '#/components/schemas/UUID'
        - name: period
          in: query
          description: Analytics period
          required: false
          schema:
            type: string
            enum: [day, week, month, quarter, year]
            default: month
        - name: startDate
          in: query
          description: Custom period start date
          required: false
          schema:
            type: string
            format: date
        - name: endDate
          in: query
          description: Custom period end date
          required: false
          schema:
            type: string
            format: date
      responses:
        '200':
          description: Generation analytics retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/GenerationAnalytics'

components:
  schemas:
    CodeGenerationRequest:
      type: object
      required:
        - id
        - projectId
        - phase
        - targetFile
        - language
        - strategy
        - qualityLevel
        - priority
        - requirements
        - contextCriteria
        - aiSettings
        - metadata
        - createdAt
        - status
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        projectId:
          $ref: '#/components/schemas/UUID'
        phase:
          $ref: '#/components/schemas/PhaseType'
        targetFile:
          type: string
        language:
          type: string
          enum: [typescript, javascript, python, java, csharp, go, rust, cpp, php, ruby, swift, kotlin]
        strategy:
          type: string
          enum: [context_aware, dependency_first, incremental, full_file, patch_based, template_guided]
        qualityLevel:
          type: string
          enum: [draft, standard, production, enterprise]
        priority:
          type: string
          enum: [low, normal, high, critical]
        requirements:
          type: object
          properties:
            description:
              type: string
            features:
              type: array
              items:
                type: string
            integrations:
              type: array
              items:
                type: string
            performance:
              type: array
              items:
                type: string
            security:
              type: array
              items:
                type: string
        contextCriteria:
          type: object
          properties:
            requiredTypes:
              type: array
              items:
                type: string
            relevanceThreshold:
              type: number
            maxContextNodes:
              type: integer
            includeDependencies:
              type: boolean
        aiSettings:
          type: object
          properties:
            provider:
              $ref: '#/components/schemas/AIProviderType'
            extendedThinking:
              type: boolean
            temperature:
              type: number
            maxTokens:
              type: integer
        metadata:
          type: object
          properties:
            sessionId:
              type: string
            source:
              type: string
            parentRequestId:
              $ref: '#/components/schemas/UUID'
            relatedRequestIds:
              type: array
              items:
                $ref: '#/components/schemas/UUID'
        createdAt:
          type: string
          format: date-time
        status:
          type: string
          enum: [queued, preparing, generating, validating, completed, failed, cancelled]

    CodeGenerationResult:
      type: object
      required:
        - requestId
        - success
        - confidence
        - qualityAssessment
        - contextUtilization
        - tokenUsage
        - performance
        - issues
        - optimizations
        - completedAt
      properties:
        requestId:
          $ref: '#/components/schemas/UUID'
        success:
          type: boolean
        content:
          type: string
        confidence:
          type: number
          minimum: 0
          maximum: 1
        qualityAssessment:
          type: object
          properties:
            overallScore:
              type: number
            complexity:
              type: object
              properties:
                cyclomaticComplexity:
                  type: number
                cognitiveComplexity:
                  type: number
                maintainabilityIndex:
                  type: number
            architecturalConsistency:
              type: number
            securityScore:
              type: number
            performanceIndicators:
              type: array
              items:
                type: string
        contextUtilization:
          type: object
          properties:
            totalContextNodes:
              type: integer
            usedContextNodes:
              type: integer
            effectivenessScore:
              type: number
            keyContextNodes:
              type: array
              items:
                $ref: '#/components/schemas/UUID'
        tokenUsage:
          type: object
          properties:
            inputTokens:
              type: integer
            outputTokens:
              type: integer
            totalTokens:
              type: integer
            efficiency:
              type: number
        performance:
          type: object
          properties:
            contextPreparationTime:
              type: number
            aiGenerationTime:
              type: number
            validationTime:
              type: number
            totalTime:
              type: number
        issues:
          type: array
          items:
            $ref: '#/components/schemas/GenerationIssue'
        optimizations:
          type: array
          items:
            $ref: '#/components/schemas/GenerationOptimization'
        completedAt:
          type: string
          format: date-time

    GenerationIssue:
      type: object
      required:
        - severity
        - type
        - message
        - confidence
      properties:
        severity:
          type: string
          enum: [info, warning, error, critical]
        type:
          type: string
          enum: [syntax, logic, security, performance, style, dependency]
        message:
          type: string
        line:
          type: integer
        column:
          type: integer
        suggestion:
          type: string
        confidence:
          type: number

    GenerationOptimization:
      type: object
      required:
        - technique
        - description
        - improvement
        - effort
        - priority
      properties:
        technique:
          type: string
          enum: [context_compression, dependency_ordering, cache_reuse, pattern_matching, incremental_updates]
        description:
          type: string
        improvement:
          type: object
          properties:
            performanceGain:
              type: string
            qualityGain:
              type: string
            tokenReduction:
              type: string
        effort:
          type: string
          enum: [low, medium, high]
        priority:
          type: integer
          minimum: 1
          maximum: 10

    GenerationHistoryEntry:
      type: object
      required:
        - id
        - projectId
        - request
        - result
        - filePath
        - version
        - accepted
        - timestamp
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        projectId:
          $ref: '#/components/schemas/UUID'
        request:
          $ref: '#/components/schemas/CodeGenerationRequest'
        result:
          $ref: '#/components/schemas/CodeGenerationResult'
        filePath:
          type: string
        version:
          type: integer
        accepted:
          type: boolean
        feedback:
          type: object
          properties:
            qualityRating:
              type: integer
            usefulnessRating:
              type: integer
            comments:
              type: string
        timestamp:
          type: string
          format: date-time

    GenerationTemplate:
      type: object
      required:
        - id
        - name
        - description
        - language
        - category
        - pattern
        - variables
        - usageCount
        - successRate
        - createdAt
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        name:
          type: string
        description:
          type: string
        language:
          type: string
          enum: [typescript, javascript, python, java, csharp, go, rust, cpp, php, ruby, swift, kotlin]
        category:
          type: string
        pattern:
          type: string
        variables:
          type: array
          items:
            type: object
            properties:
              name:
                type: string
              type:
                type: string
              description:
                type: string
              required:
                type: boolean
              defaultValue:
                type: string
        usageCount:
          type: integer
        successRate:
          type: number
        createdAt:
          type: string
          format: date-time
        lastUsed:
          type: string
          format: date-time

    BatchGenerationRequest:
      type: object
      required:
        - id
        - name
        - projectId
        - phase
        - requests
        - options
        - status
        - createdAt
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        name:
          type: string
        projectId:
          $ref: '#/components/schemas/UUID'
        phase:
          $ref: '#/components/schemas/PhaseType'
        requests:
          type: array
          items:
            $ref: '#/components/schemas/CodeGenerationRequest'
        options:
          type: object
          properties:
            parallel:
              type: boolean
            maxConcurrency:
              type: integer
            continueOnFailure:
              type: boolean
            respectDependencies:
              type: boolean
        status:
          type: string
          enum: [pending, processing, completed, failed, cancelled]
        createdAt:
          type: string
          format: date-time

    GenerationAnalytics:
      type: object
      required:
        - id
        - projectId
        - period
        - statistics
        - languageBreakdown
        - phaseBreakdown
        - topIssues
        - optimizationOpportunities
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        projectId:
          $ref: '#/components/schemas/UUID'
        period:
          type: object
          properties:
            startDate:
              type: string
              format: date-time
            endDate:
              type: string
              format: date-time
        statistics:
          type: object
          properties:
            totalGenerations:
              type: integer
            successfulGenerations:
              type: integer
            successRate:
              type: number
            avgGenerationTime:
              type: number
            avgQualityScore:
              type: number
            totalTokensUsed:
              type: integer
            avgTokensPerGeneration:
              type: number
        languageBreakdown:
          type: object
          additionalProperties:
            type: object
            properties:
              count:
                type: integer
              successRate:
                type: number
              avgQualityScore:
                type: number
              avgGenerationTime:
                type: number
        phaseBreakdown:
          type: object
          additionalProperties:
            type: object
            properties:
              count:
                type: integer
              successRate:
                type: number
              avgComplexity:
                type: number
        topIssues:
          type: array
          items:
            type: object
            properties:
              type:
                type: string
              count:
                type: integer
              severity:
                type: string
              trend:
                type: string
                enum: [increasing, stable, decreasing]
        optimizationOpportunities:
          type: array
          items:
            type: object
            properties:
              technique:
                type: string
              potentialSavings:
                type: string
              estimatedImpact:
                type: string
                enum: [low, medium, high]
```

## **4. Detailed Business Logic & Validation Rules**

| Rule ID | Rule Description | Implementation Location(s) & Notes |
|---------|------------------|-----------------------------------|
| **CGE-01** | Code generation requests must validate that the target project exists and is accessible through Project Management Module before proceeding with context retrieval and generation. | **Backend (Authoritative):** Generation service must query Project Management Module to verify project existence, access permissions, and current phase status before creating generation requests. |
| **CGE-02** | Context selection must query the Context Management Engine to retrieve relevant context nodes based on criteria, respecting the <3 second KPI for context retrieval performance. | **Backend (Authoritative):** Context preparation service must call Context Management Module API with relevance thresholds and limits, implementing timeout handling to meet performance requirements. |
| **CGE-03** | AI generation must integrate with Claude Integration Service using extended thinking mode for complex generations (production/enterprise quality levels) to ensure architectural consistency. | **Backend (Authoritative):** AI service layer must call Claude Integration Service with extended thinking enabled for quality levels above 'standard', passing context package and generation requirements. |
| **CGE-04** | Generated code must be validated through Quality Assurance Orchestrator for syntax, architectural consistency, and security before being marked as completed. | **Backend (Authoritative):** Generation pipeline must call Quality Assurance Module validation endpoints and incorporate results into quality assessment scores and issue detection. |
| **CGE-05** | File writing operations must use File System Management Module to ensure proper workspace isolation, backup creation, and file versioning. | **Backend (Authoritative):** File operation service must call File System Management APIs for all write operations, respecting workspace boundaries and backup policies defined in Configuration Management. |
| **CGE-06** | Generation results must be logged through Logging & Monitoring Service with performance metrics, token usage, and quality scores for KPI tracking and optimization. | **Backend (Authoritative):** All generation operations must log metrics to Monitoring Service including context retrieval time, AI generation time, token usage, and quality scores for analytics. |
| **CGE-07** | Batch generation requests must respect dependency ordering by coordinating with Dependency Analysis Engine to determine optimal generation sequence. | **Backend (Authoritative):** Batch processing service must query dependency information and order generation requests based on file dependencies to prevent compilation errors. |
| **CGE-08** | Generation history must maintain version tracking for the same file path, allowing rollback and comparison of different generation attempts. | **Backend (Authoritative):** History service must increment version numbers for repeated generations on same file path and maintain complete generation context for comparison features. |
| **CGE-09** | Template creation must analyze successful generation patterns and extract reusable components using pattern recognition algorithms for future optimization. | **Backend (Authoritative):** Template service must analyze high-quality generations to identify common patterns, extract variables, and create reusable templates with success rate tracking. |
| **CGE-10** | Generation analytics must aggregate data while maintaining local-first privacy by anonymizing session data and respecting Configuration Management privacy settings. | **Backend (Authoritative):** Analytics service must aggregate metrics without exposing individual session identifiers and respect privacy configuration flags from Configuration Management Module. |

## **5. Developer Task Checklist**

### **Backend Tasks:**
- [ ] Create database migration script for code generation tables (`generation_requests`, `generation_results`, `generation_history`, `generation_templates`, `batch_requests`, `generation_analytics`)
- [ ] Implement the `CodeGenerationService` class with request lifecycle management, context coordination, and AI integration orchestration
- [ ] Implement the `GenerationContextService` class for intelligent context selection, preparation, and compression using Context Management Engine
- [ ] Implement the `AIGenerationService` class for coordinating with Claude Integration Service with extended thinking mode and quality-aware generation
- [ ] Implement the `GenerationValidationService` class for integrating with Quality Assurance Orchestrator to validate generated code quality and consistency
- [ ] Implement the `GenerationFileService` class for coordinating with File System Management Module for secure file operations and versioning
- [ ] Implement the `BatchGenerationService` class for managing parallel generations with dependency ordering and failure handling
- [ ] Implement the `GenerationTemplateService` class for pattern recognition, template creation, and reusable generation optimization
- [ ] Implement the `GenerationAnalyticsService` class for performance tracking, usage analytics, and KPI measurement while maintaining privacy
- [ ] Implement all generation request endpoints (`GET`, `POST /api/v1/generation/requests`, `GET`, `PATCH /api/v1/generation/requests/{id}`)
- [ ] Implement generation execution endpoint (`POST /api/v1/generation/requests/{requestId}/execute`) with asynchronous processing and real-time status updates
- [ ] Implement batch generation endpoints (`POST /api/v1/generation/batch`) with dependency-aware processing and progress tracking
- [ ] Implement generation history endpoints (`GET /api/v1/generation/history`) with filtering, version tracking, and analytics integration
- [ ] Implement generation template endpoints (`GET`, `POST /api/v1/generation/templates`) with usage tracking and success rate calculation
- [ ] Implement generation analytics endpoint (`GET /api/v1/generation/analytics`) with comprehensive metrics and optimization recommendations
- [ ] Create `GenerationRepository` class for database operations with proper indexing on projectId, phase, status, language, and timestamp fields
- [ ] Create `GenerationHistoryRepository` class for version tracking and historical analysis with efficient querying capabilities
- [ ] Create `GenerationTemplateRepository` class for pattern storage and retrieval with usage statistics and success rate tracking
- [ ] Implement integration with Project Management Module for project validation, phase coordination, and health metric updates
- [ ] Implement integration with Context Management Engine for intelligent context retrieval with performance optimization and relevance scoring
- [ ] Implement integration with Claude Integration Service for AI generation with extended thinking mode and token usage optimization
- [ ] Implement integration with Quality Assurance Orchestrator for code validation, architectural consistency checking, and security assessment
- [ ] Implement integration with File System Management Module for secure file operations, workspace isolation, and backup coordination
- [ ] Implement integration with Logging & Monitoring Service for comprehensive performance tracking and KPI measurement
- [ ] Create generation queue management system with priority handling, resource allocation, and failure recovery mechanisms
- [ ] Implement caching layer for frequently used context patterns and generation templates to improve performance
- [ ] Create comprehensive unit tests for all service classes with mock implementations of dependent modules and edge case coverage
- [ ] Create integration tests for generation workflows including context preparation, AI generation, validation, and file writing scenarios
- [ ] Implement load testing for batch generation scenarios to ensure system stability under concurrent generation requests
- [ ] Add background services for generation analytics calculation, template pattern recognition, and performance optimization recommendations

### **Frontend Tasks:**
- [ ] Create `CodeGenerationProvider` React context for managing generation state, requests, and real-time updates
- [ ] Implement `useCodeGeneration` hook for accessing generation functionality with request tracking and status monitoring
- [ ] Create `GenerationRequestForm` component for creating new generation requests with intelligent form validation and context selection
- [ ] Implement `GenerationRequestList` component for displaying generation requests with filtering, search, and status tracking
- [ ] Create `GenerationRequestDetails` component for showing detailed generation results, quality metrics, and issue reports
- [ ] Implement `GenerationProgress` component for real-time status tracking during generation execution with progress indicators
- [ ] Create `BatchGenerationManager` component for managing multiple file generations with dependency visualization and progress tracking
- [ ] Implement `GenerationHistory` component for browsing historical generations with version comparison and rollback capabilities
- [ ] Create `GenerationTemplateManager` component for managing reusable templates with usage statistics and pattern recognition
- [ ] Implement `GenerationAnalyticsDashboard` component for displaying comprehensive analytics, performance metrics, and optimization insights
- [ ] Create `GenerationQualityViewer` component for displaying quality assessment results, code complexity metrics, and improvement suggestions
- [ ] Implement `GenerationIssueReporter` component for viewing and managing generation issues with severity classification and fix suggestions
- [ ] Create generation service functions in the API client (`generationService.ts`) for all generation endpoints with proper error handling
- [ ] Implement real-time generation status updates using WebSocket connections or Server-Sent Events for live progress monitoring
- [ ] Create code diff viewer component for comparing generated code versions with syntax highlighting and change detection
- [ ] Implement generation feedback system for collecting user ratings and comments to improve template patterns and AI generation quality
- [ ] Add generation performance monitoring hooks for tracking frontend performance metrics and user interaction patterns
- [ ] Create generation export functionality for downloading generation results, analytics reports, and template definitions
- [ ] Implement generation import system for restoring previous generations and sharing successful patterns between projects
- [ ] Add integration with VS Code extension for seamless generation request creation directly from editor context and file navigation
- [ ] Create generation optimization recommendations interface showing actionable insights for improving generation performance and quality
- [ ] Implement drag-and-drop interface for batch generation with visual dependency mapping and generation order optimization
- [ ] Add keyboard shortcuts and command palette integration for quick access to generation features and frequent operations



========================================================================================


# Command Palette Integration - Technical Specification

## **1. Module Overview**

**Purpose:** The Command Palette Integration module provides seamless VS Code command palette integration for all ReadyAI operations, enabling developers to access the complete 7-phase development methodology and AI-powered features through native VS Code commands. This module registers context-aware commands, manages keyboard shortcuts, and provides intelligent command suggestions based on current project state and phase progression.

**Dependencies & Interactions:** This module depends on the VS Code Extension Host for command registration and execution infrastructure, and heavily interacts with the Multi-Phase Development Orchestrator to execute phase transitions, project operations, and development workflow commands. It also integrates with the Project Management Module to access project state for context-aware command availability, the Configuration Management Module for customizable keyboard shortcuts and command preferences, and the Logging & Monitoring Service for command execution tracking and performance metrics.

## **2. Module-Specific Type Additions (`types.commandPalette.ts`)**

```typescript
/**
 * Command Palette Integration Module Types
 * Extends foundational types with command palette specific interfaces
 */

/** Command categories for organization in palette */
export type CommandCategory = 
  | 'project'
  | 'phase'
  | 'generation'
  | 'context'
  | 'quality'
  | 'testing'
  | 'configuration'
  | 'debugging'
  | 'navigation';

/** Command execution context */
export type CommandExecutionContext = 
  | 'global'
  | 'workspace'
  | 'project'
  | 'file'
  | 'selection';

/** Command availability conditions */
export type CommandCondition = 
  | 'always'
  | 'workspace_open'
  | 'project_exists'
  | 'phase_pending'
  | 'phase_in_progress'
  | 'phase_completed'
  | 'file_selected'
  | 'text_selected';

/** Command execution priority */
export type CommandPriority = 'low' | 'normal' | 'high' | 'critical';

/** ReadyAI command definition */
export interface ReadyAICommand {
  /** Unique command identifier */
  id: string;
  /** Command display title */
  title: string;
  /** Command description */
  description?: string;
  /** Command category for grouping */
  category: CommandCategory;
  /** Execution context requirements */
  executionContext: CommandExecutionContext;
  /** Conditions for command availability */
  conditions: CommandCondition[];
  /** Command icon (codicon name) */
  icon?: string;
  /** Keyboard shortcut */
  keybinding?: string;
  /** Command priority for sorting */
  priority: CommandPriority;
  /** Whether command is enabled */
  enabled: boolean;
  /** Phase type association (if applicable) */
  associatedPhase?: PhaseType;
  /** Project ID context (if applicable) */
  projectId?: UUID;
  /** Additional command metadata */
  metadata?: Record<string, any>;
  /** Command creation timestamp */
  createdAt: string; // ISO 8601 format
  /** Last execution timestamp */
  lastExecuted?: string; // ISO 8601 format
  /** Execution count */
  executionCount: number;
}

/** Command execution request */
export interface CommandExecutionRequest {
  /** Unique execution request identifier */
  id: UUID;
  /** Command being executed */
  commandId: string;
  /** Execution context data */
  context: {
    /** Current workspace path */
    workspacePath?: string;
    /** Active project ID */
    projectId?: UUID;
    /** Current phase type */
    currentPhase?: PhaseType;
    /** Selected file path */
    selectedFile?: string;
    /** Selected text range */
    selectedText?: {
      startLine: number;
      startColumn: number;
      endLine: number;
      endColumn: number;
      content: string;
    };
    /** Additional context data */
    additionalContext?: Record<string, any>;
  };
  /** Command arguments */
  args?: any[];
  /** Request timestamp */
  timestamp: string; // ISO 8601 format
  /** User session ID */
  sessionId?: string;
}

/** Command execution result */
export interface CommandExecutionResult {
  /** Execution request ID */
  requestId: UUID;
  /** Whether execution was successful */
  success: boolean;
  /** Execution result data */
  result?: any;
  /** Error information if failed */
  error?: {
    message: string;
    code?: string;
    details?: Record<string, any>;
  };
  /** Execution duration in milliseconds */
  duration: number;
  /** Execution completion timestamp */
  completedAt: string; // ISO 8601 format
  /** Resources affected by command */
  affectedResources?: {
    projects?: UUID[];
    files?: string[];
    phases?: PhaseType[];
  };
}

/** Command palette state */
export interface CommandPaletteState {
  /** Available commands */
  availableCommands: ReadyAICommand[];
  /** Recently executed commands */
  recentCommands: ReadyAICommand[];
  /** Favorite/pinned commands */
  favoriteCommands: string[]; // command IDs
  /** Command execution history */
  executionHistory: CommandExecutionResult[];
  /** Current execution context */
  currentContext: {
    workspacePath?: string;
    projectId?: UUID;
    currentPhase?: PhaseType;
    selectedFile?: string;
  };
  /** Command suggestions based on context */
  suggestedCommands: ReadyAICommand[];
}

/** Keyboard shortcut configuration */
export interface KeybindingConfig {
  /** Command ID */
  commandId: string;
  /** Keyboard shortcut combination */
  keybinding: string;
  /** When clause for conditional activation */
  when?: string;
  /** Whether keybinding is enabled */
  enabled: boolean;
  /** Custom user-defined shortcut */
  isCustom: boolean;
  /** Configuration timestamp */
  configuredAt: string; // ISO 8601 format
}

/** Command execution analytics */
export interface CommandAnalytics {
  /** Analytics period identifier */
  id: UUID;
  /** Analytics period start */
  periodStart: string; // ISO 8601 format
  /** Analytics period end */
  periodEnd: string; // ISO 8601 format
  /** Total command executions */
  totalExecutions: number;
  /** Most executed commands */
  topCommands: {
    commandId: string;
    title: string;
    executionCount: number;
    avgDuration: number;
  }[];
  /** Command category usage */
  categoryUsage: Record<CommandCategory, number>;
  /** Phase-specific command usage */
  phaseCommandUsage: Record<PhaseType, number>;
  /** Error rate by command */
  errorRates: Record<string, number>;
  /** Average execution times by category */
  avgExecutionTimes: Record<CommandCategory, number>;
}

/** Command suggestion context */
export interface CommandSuggestionContext {
  /** Current project state */
  projectState?: {
    id: UUID;
    name: string;
    currentPhase: PhaseType;
    phaseStatus: PhaseStatus;
  };
  /** Recent user actions */
  recentActions: string[];
  /** Time of day context */
  timeContext: {
    hour: number;
    dayOfWeek: number;
    timezone: string;
  };
  /** File context */
  fileContext?: {
    activeFile?: string;
    fileType?: string;
    hasSelection: boolean;
  };
  /** Workspace context */
  workspaceContext: {
    hasOpenFiles: boolean;
    projectCount: number;
    hasUnsavedChanges: boolean;
  };
}
```

## **3. API Endpoint Specification (OpenAPI `paths` block)**

```yaml
paths:
  /api/v1/commands:
    get:
      tags:
        - Commands
      summary: Get available commands
      description: Retrieves available ReadyAI commands with context-aware filtering
      security:
        - localAuth: []
      parameters:
        - name: category
          in: query
          description: Filter commands by category
          required: false
          schema:
            type: string
            enum: [project, phase, generation, context, quality, testing, configuration, debugging, navigation]
        - name: context
          in: query
          description: Execution context filter
          required: false
          schema:
            type: string
            enum: [global, workspace, project, file, selection]
        - name: projectId
          in: query
          description: Filter commands for specific project context
          required: false
          schema:
            $ref: '#/components/schemas/UUID'
        - name: currentPhase
          in: query
          description: Filter commands relevant to current phase
          required: false
          schema:
            $ref: '#/components/schemas/PhaseType'
        - name: enabled
          in: query
          description: Filter by enabled status
          required: false
          schema:
            type: boolean
      responses:
        '200':
          description: Available commands retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          commands:
                            type: array
                            items:
                              $ref: '#/components/schemas/ReadyAICommand'
                          totalCount:
                            type: integer
                          contextualSuggestions:
                            type: array
                            items:
                              $ref: '#/components/schemas/ReadyAICommand'

  /api/v1/commands/{commandId}:
    get:
      tags:
        - Commands
      summary: Get specific command details
      description: Retrieves detailed information about a specific command
      security:
        - localAuth: []
      parameters:
        - name: commandId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Command details retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/ReadyAICommand'
        '404':
          description: Command not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

  /api/v1/commands/execute:
    post:
      tags:
        - Commands
      summary: Execute ReadyAI command
      description: Executes a ReadyAI command with provided context and arguments. Integrates with Multi-Phase Orchestrator and other modules based on command type.
      security:
        - localAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                commandId:
                  type: string
                  minLength: 1
                context:
                  type: object
                  properties:
                    workspacePath:
                      type: string
                    projectId:
                      $ref: '#/components/schemas/UUID'
                    currentPhase:
                      $ref: '#/components/schemas/PhaseType'
                    selectedFile:
                      type: string
                    selectedText:
                      type: object
                      properties:
                        startLine:
                          type: integer
                        startColumn:
                          type: integer
                        endLine:
                          type: integer
                        endColumn:
                          type: integer
                        content:
                          type: string
                    additionalContext:
                      type: object
                args:
                  type: array
                  items: {}
              required:
                - commandId
      responses:
        '200':
          description: Command executed successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/CommandExecutionResult'
        '400':
          description: Invalid command execution request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'
        '404':
          description: Command not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

  /api/v1/commands/suggestions:
    post:
      tags:
        - Commands
      summary: Get contextual command suggestions
      description: Returns intelligent command suggestions based on current context and user behavior patterns
      security:
        - localAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                projectState:
                  type: object
                  properties:
                    id:
                      $ref: '#/components/schemas/UUID'
                    name:
                      type: string
                    currentPhase:
                      $ref: '#/components/schemas/PhaseType'
                    phaseStatus:
                      $ref: '#/components/schemas/PhaseStatus'
                recentActions:
                  type: array
                  items:
                    type: string
                fileContext:
                  type: object
                  properties:
                    activeFile:
                      type: string
                    fileType:
                      type: string
                    hasSelection:
                      type: boolean
                workspaceContext:
                  type: object
                  properties:
                    hasOpenFiles:
                      type: boolean
                    projectCount:
                      type: integer
                    hasUnsavedChanges:
                      type: boolean
      responses:
        '200':
          description: Command suggestions retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          suggestions:
                            type: array
                            items:
                              $ref: '#/components/schemas/ReadyAICommand'
                          reasoning:
                            type: array
                            items:
                              type: string

  /api/v1/commands/keybindings:
    get:
      tags:
        - Commands
      summary: Get keyboard shortcuts configuration
      description: Retrieves current keyboard shortcut configurations for ReadyAI commands
      security:
        - localAuth: []
      responses:
        '200':
          description: Keybindings retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          keybindings:
                            type: array
                            items:
                              $ref: '#/components/schemas/KeybindingConfig'

    put:
      tags:
        - Commands
      summary: Update keyboard shortcuts
      description: Updates keyboard shortcut configurations for ReadyAI commands
      security:
        - localAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                keybindings:
                  type: array
                  items:
                    type: object
                    properties:
                      commandId:
                        type: string
                      keybinding:
                        type: string
                      when:
                        type: string
                      enabled:
                        type: boolean
                    required:
                      - commandId
                      - keybinding
              required:
                - keybindings
      responses:
        '200':
          description: Keybindings updated successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          updatedKeybindings:
                            type: array
                            items:
                              $ref: '#/components/schemas/KeybindingConfig'

  /api/v1/commands/analytics:
    get:
      tags:
        - Commands
      summary: Get command usage analytics
      description: Retrieves command execution analytics and usage patterns
      security:
        - localAuth: []
      parameters:
        - name: period
          in: query
          description: Analytics period
          required: false
          schema:
            type: string
            enum: [day, week, month]
            default: week
        - name: startDate
          in: query
          description: Start date for analytics period
          required: false
          schema:
            type: string
            format: date
        - name: endDate
          in: query
          description: End date for analytics period
          required: false
          schema:
            type: string
            format: date
      responses:
        '200':
          description: Command analytics retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/CommandAnalytics'

  /api/v1/commands/favorites:
    get:
      tags:
        - Commands
      summary: Get favorite commands
      description: Retrieves user's favorite/pinned commands
      security:
        - localAuth: []
      responses:
        '200':
          description: Favorite commands retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          favoriteCommands:
                            type: array
                            items:
                              $ref: '#/components/schemas/ReadyAICommand'

    post:
      tags:
        - Commands
      summary: Add command to favorites
      description: Adds a command to user's favorites list
      security:
        - localAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                commandId:
                  type: string
                  minLength: 1
              required:
                - commandId
      responses:
        '201':
          description: Command added to favorites successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'

    delete:
      tags:
        - Commands
      summary: Remove command from favorites
      description: Removes a command from user's favorites list
      security:
        - localAuth: []
      parameters:
        - name: commandId
          in: query
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Command removed from favorites successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'

components:
  schemas:
    ReadyAICommand:
      type: object
      required:
        - id
        - title
        - category
        - executionContext
        - conditions
        - priority
        - enabled
        - createdAt
        - executionCount
      properties:
        id:
          type: string
        title:
          type: string
        description:
          type: string
        category:
          type: string
          enum: [project, phase, generation, context, quality, testing, configuration, debugging, navigation]
        executionContext:
          type: string
          enum: [global, workspace, project, file, selection]
        conditions:
          type: array
          items:
            type: string
            enum: [always, workspace_open, project_exists, phase_pending, phase_in_progress, phase_completed, file_selected, text_selected]
        icon:
          type: string
        keybinding:
          type: string
        priority:
          type: string
          enum: [low, normal, high, critical]
        enabled:
          type: boolean
        associatedPhase:
          $ref: '#/components/schemas/PhaseType'
        projectId:
          $ref: '#/components/schemas/UUID'
        metadata:
          type: object
        createdAt:
          type: string
          format: date-time
        lastExecuted:
          type: string
          format: date-time
        executionCount:
          type: integer

    CommandExecutionResult:
      type: object
      required:
        - requestId
        - success
        - duration
        - completedAt
      properties:
        requestId:
          $ref: '#/components/schemas/UUID'
        success:
          type: boolean
        result:
          type: object
        error:
          type: object
          properties:
            message:
              type: string
            code:
              type: string
            details:
              type: object
        duration:
          type: number
        completedAt:
          type: string
          format: date-time
        affectedResources:
          type: object
          properties:
            projects:
              type: array
              items:
                $ref: '#/components/schemas/UUID'
            files:
              type: array
              items:
                type: string
            phases:
              type: array
              items:
                $ref: '#/components/schemas/PhaseType'

    KeybindingConfig:
      type: object
      required:
        - commandId
        - keybinding
        - enabled
        - isCustom
        - configuredAt
      properties:
        commandId:
          type: string
        keybinding:
          type: string
        when:
          type: string
        enabled:
          type: boolean
        isCustom:
          type: boolean
        configuredAt:
          type: string
          format: date-time

    CommandAnalytics:
      type: object
      required:
        - id
        - periodStart
        - periodEnd
        - totalExecutions
        - topCommands
        - categoryUsage
        - phaseCommandUsage
        - errorRates
        - avgExecutionTimes
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        periodStart:
          type: string
          format: date-time
        periodEnd:
          type: string
          format: date-time
        totalExecutions:
          type: integer
        topCommands:
          type: array
          items:
            type: object
            properties:
              commandId:
                type: string
              title:
                type: string
              executionCount:
                type: integer
              avgDuration:
                type: number
        categoryUsage:
          type: object
          additionalProperties:
            type: integer
        phaseCommandUsage:
          type: object
          additionalProperties:
            type: integer
        errorRates:
          type: object
          additionalProperties:
            type: number
        avgExecutionTimes:
          type: object
          additionalProperties:
            type: number
```

## **4. Detailed Business Logic & Validation Rules**

| Rule ID | Rule Description | Implementation Location(s) & Notes |
|---------|------------------|-----------------------------------|
| **CMD-01** | Commands must only be available when their execution context conditions are met (e.g., project commands only available when a project exists). | **VS Code Extension (Authoritative):** Command registration must dynamically enable/disable commands based on workspace state. Backend provides command metadata, but extension enforces availability. |
| **CMD-02** | Phase-specific commands must only be executable when the project is in the appropriate phase or phase status (pending, in_progress, completed). | **Backend (Authoritative):** Command execution service must validate current phase status via Multi-Phase Development Orchestrator before executing phase-related commands. |
| **CMD-03** | Command execution must be logged for analytics and debugging purposes, including execution time, success/failure, and affected resources. | **Backend (Authoritative):** All command executions must be logged via Logging & Monitoring Service with detailed execution context and performance metrics. |
| **CMD-04** | Keyboard shortcuts must not conflict with existing VS Code shortcuts or other ReadyAI commands, and must support user customization. | **VS Code Extension (Authoritative):** Keybinding registration must check for conflicts and allow user overrides. Configuration Management Module stores custom shortcuts. |
| **CMD-05** | Command suggestions must be contextually relevant based on current project state, recent actions, and phase progression patterns. | **Backend (Authoritative):** Suggestion engine must analyze project context from Project Management Module and user behavior patterns from Logging & Monitoring Service. |
| **CMD-06** | Commands that modify project state must create automatic backups through the Configuration Management Module before execution. | **Backend (Authoritative):** State-modifying commands must trigger backup creation via Configuration Management Module before calling Multi-Phase Development Orchestrator. |
| **CMD-07** | Command execution must respect user productivity KPI by providing immediate feedback and completing within reasonable time limits. | **VS Code Extension (Authoritative):** Commands must show progress indicators and timeout after reasonable periods. Long-running commands must provide cancellation options. |
| **CMD-08** | Failed command executions must provide actionable error messages and suggested recovery actions based on the specific failure context. | **Backend (Authoritative):** Error handling must provide context-specific error messages and recovery suggestions based on project state and phase context. |
| **CMD-09** | Commands must be organized by categories and support search functionality to maintain usability as the command set grows. | **VS Code Extension (Authoritative):** Command palette integration must support categorization, filtering, and fuzzy search to maintain <30 second setup time KPI. |
| **CMD-10** | Recent and frequently used commands must be prioritized in command suggestions to improve development velocity. | **Backend (Authoritative):** Command analytics service must track usage patterns and provide prioritized suggestions based on execution frequency and recency. |

## **5. Developer Task Checklist**

### **Backend Tasks:**
- [ ] Create database migration script for command management tables (`commands`, `command_executions`, `keybinding_configs`, `command_analytics`, `user_favorites`)
- [ ] Implement the `CommandService` class for command registration, metadata management, and execution coordination
- [ ] Implement the `CommandExecutionService` class that integrates with Multi-Phase Development Orchestrator for phase-related commands
- [ ] Implement the `CommandSuggestionEngine` class for intelligent contextual command recommendations
- [ ] Implement the `KeybindingService` class for managing keyboard shortcuts and conflict resolution
- [ ] Implement all command API endpoints (`GET /api/v1/commands`, `POST /api/v1/commands/execute`) with proper validation
- [ ] Implement command suggestions endpoint (`POST /api/v1/commands/suggestions`) with context analysis
- [ ] Implement keybinding management endpoints (`GET`, `PUT /api/v1/commands/keybindings`)
- [ ] Implement command analytics endpoints (`GET /api/v1/commands/analytics`) with usage pattern analysis
- [ ] Implement favorites management endpoints (`GET`, `POST`, `DELETE /api/v1/commands/favorites`)
- [ ] Create `CommandRepository` class for efficient command storage and retrieval with indexing
- [ ] Create `CommandAnalyticsRepository` class for tracking command usage and performance metrics
- [ ] Implement command execution middleware that logs all executions via Logging & Monitoring Service
- [ ] Implement command validation service that checks execution context and prerequisites
- [ ] Create integration layer with Multi-Phase Development Orchestrator for phase command execution
- [ ] Implement comprehensive unit tests for all service classes with mocked dependencies
- [ ] Create integration tests for command execution with real Multi-Phase Development Orchestrator interactions
- [ ] Implement performance tests for command suggestion engine under various context scenarios

### **VS Code Extension Tasks:**
- [ ] Create `CommandPaletteManager` class for VS Code command registration and management
- [ ] Implement `CommandExecutor` class for executing ReadyAI commands via backend API calls
- [ ] Create `KeybindingManager` class for registering and managing keyboard shortcuts
- [ ] Implement `ContextProvider` class for gathering current workspace and project context
- [ ] Create `CommandSuggestionProvider` class for intelligent command completion and suggestions
- [ ] Implement all ReadyAI command registrations with proper when clauses and context requirements
- [ ] Create command execution progress indicators and cancellation support
- [ ] Implement command palette filtering and search functionality for command categories
- [ ] Create keyboard shortcut conflict detection and resolution system
- [ ] Implement command favorites system with persistent storage
- [ ] Create context-aware command availability system that enables/disables commands dynamically
- [ ] Implement command analytics integration for tracking usage patterns
- [ ] Create error handling and recovery system for failed command executions
- [ ] Implement command documentation and help system accessible from palette
- [ ] Create automated testing for command registration and execution flows
- [ ] Implement command execution caching for frequently used operations
- [ ] Create command customization interface for user preferences and shortcuts
- [ ] Implement real-time command suggestion updates based on workspace changes
- [ ] Create command execution history and recent commands functionality
- [ ] Implement integration with VS Code's native command system and extension marketplace guidelines



========================================================================================


# Dependency Analysis Engine - Technical Specification

## **1. Module Overview**

**Purpose:** The Dependency Analysis Engine serves as the intelligent dependency management system for ReadyAI, responsible for automatic dependency tracking, impact analysis, generation order optimization, and circular dependency detection across all project files. This module integrates with Tree-sitter parsers to analyze source code, constructs and maintains dependency graphs, and ensures optimal file generation ordering to support the dependency-aware code generation feature while maintaining architectural integrity throughout the 7-phase development methodology.

**Dependencies & Interactions:** This module depends on the File System Management Module to read source files and monitor file system changes for dependency analysis, the Context Management Engine to access project context and update dependency information in context nodes, and the Code Analysis Service to parse source code and extract Abstract Syntax Tree (AST) information using Tree-sitter parsers. It interacts extensively with the Multi-Phase Development Orchestrator to provide dependency-aware generation ordering for phase artifacts, with the Code Generation Engine to ensure files are generated in proper dependency order, and with the Quality Assurance Orchestrator to validate dependency integrity and detect architectural inconsistencies. The module also integrates with the Logging & Monitoring Service to track dependency analysis performance metrics and with the Configuration Management Module to obtain parsing configuration and language-specific settings.

## **2. Module-Specific Type Additions (`types.dependencyAnalysis.ts`)**

```typescript
/**
 * Dependency Analysis Engine Module Types
 * Extends foundational types with dependency analysis-specific interfaces
 */

/** Dependency analysis operation types */
export type DependencyAnalysisOperation = 
  | 'full_analysis'
  | 'incremental_analysis'
  | 'impact_analysis'
  | 'circular_detection'
  | 'order_optimization';

/** Dependency relationship strength levels */
export type DependencyStrength = 'strong' | 'medium' | 'weak';

/** Impact analysis scope levels */
export type ImpactScope = 'direct' | 'transitive' | 'full_cascade';

/** Tree-sitter parser language support */
export type SupportedLanguage = 
  | 'typescript'
  | 'javascript'
  | 'python'
  | 'java'
  | 'csharp'
  | 'go'
  | 'rust'
  | 'cpp'
  | 'generic';

/** Dependency analysis request */
export interface DependencyAnalysisRequest {
  /** Unique analysis request identifier */
  id: UUID;
  /** Project identifier */
  projectId: UUID;
  /** Analysis operation type */
  operation: DependencyAnalysisOperation;
  /** Target file paths for analysis (optional, all files if not specified) */
  targetPaths?: string[];
  /** Analysis configuration options */
  options: {
    /** Include test files in analysis */
    includeTestFiles: boolean;
    /** Include external dependencies */
    includeExternalDeps: boolean;
    /** Maximum analysis depth */
    maxDepth: number;
    /** Language-specific parser settings */
    parserOptions: Record<string, any>;
    /** Force re-analysis even if cached results exist */
    forceRefresh: boolean;
  };
  /** Request timestamp */
  createdAt: string; // ISO 8601 format
  /** Optional session context */
  sessionId?: string;
}

/** Dependency analysis result */
export interface DependencyAnalysisResult {
  /** Analysis request identifier */
  requestId: UUID;
  /** Analysis success status */
  success: boolean;
  /** Analysis execution time in milliseconds */
  executionTime: number;
  /** Analyzed dependency graph */
  dependencyGraph?: DependencyGraph;
  /** Analysis statistics */
  statistics: {
    /** Total files analyzed */
    filesAnalyzed: number;
    /** Total dependencies found */
    totalDependencies: number;
    /** Circular dependencies found */
    circularDependencies: number;
    /** Language breakdown */
    languageBreakdown: Record<SupportedLanguage, number>;
    /** Parsing errors encountered */
    parsingErrors: number;
  };
  /** Detected circular dependencies with detailed information */
  circularDependencyDetails?: CircularDependencyChain[];
  /** Generation order recommendations */
  optimizedGenerationOrder?: string[];
  /** Analysis warnings and recommendations */
  warnings: string[];
  /** Analysis errors (if any) */
  errors?: string[];
  /** Analysis completion timestamp */
  completedAt: string; // ISO 8601 format
}

/** Detailed circular dependency chain information */
export interface CircularDependencyChain {
  /** Chain identifier */
  id: UUID;
  /** Files involved in the circular dependency */
  chain: string[];
  /** Dependency types in the chain */
  dependencyTypes: DependencyEdge['type'][];
  /** Severity level of the circular dependency */
  severity: 'low' | 'medium' | 'high' | 'critical';
  /** Suggested resolution strategies */
  resolutionSuggestions: string[];
  /** Whether this chain blocks file generation */
  blocksGeneration: boolean;
}

/** Impact analysis request */
export interface ImpactAnalysisRequest {
  /** Target file path for impact analysis */
  targetPath: string;
  /** Project identifier */
  projectId: UUID;
  /** Impact analysis scope */
  scope: ImpactScope;
  /** Type of change for impact analysis */
  changeType: 'modify' | 'delete' | 'rename' | 'move';
  /** New file path (for rename/move operations) */
  newPath?: string;
  /** Include reverse dependencies in analysis */
  includeReverseDeps: boolean;
}

/** Impact analysis result */
export interface ImpactAnalysisResult {
  /** Target file path */
  targetPath: string;
  /** Analysis scope used */
  scope: ImpactScope;
  /** Directly impacted files */
  directImpacts: ImpactedFile[];
  /** Transitively impacted files */
  transitiveImpacts: ImpactedFile[];
  /** Total impact count */
  totalImpactCount: number;
  /** Estimated impact severity */
  impactSeverity: 'minimal' | 'moderate' | 'significant' | 'critical';
  /** Impact analysis warnings */
  warnings: string[];
  /** Recommended actions */
  recommendations: string[];
}

/** Information about an impacted file */
export interface ImpactedFile {
  /** File path */
  path: string;
  /** Impact relationship type */
  impactType: DependencyEdge['type'];
  /** Impact strength */
  strength: DependencyStrength;
  /** Specific code locations affected */
  affectedLocations?: CodeLocation[];
  /** Estimated effort to update (low/medium/high) */
  updateEffort: 'low' | 'medium' | 'high';
  /** Whether this file needs regeneration */
  requiresRegeneration: boolean;
}

/** Code location information */
export interface CodeLocation {
  /** Line number */
  line: number;
  /** Column number */
  column: number;
  /** Length of the affected code */
  length: number;
  /** Context around the location */
  context: string;
  /** Type of code construct affected */
  constructType: 'import' | 'function_call' | 'type_reference' | 'inheritance' | 'other';
}

/** Dependency parsing result from Tree-sitter */
export interface DependencyParsingResult {
  /** File path that was parsed */
  filePath: string;
  /** Programming language detected */
  language: SupportedLanguage;
  /** Parsing success status */
  success: boolean;
  /** Extracted dependencies */
  dependencies: ExtractedDependency[];
  /** Exported symbols from this file */
  exports: ExportedSymbol[];
  /** Parsing errors (if any) */
  errors?: string[];
  /** Parse tree depth */
  parseDepth: number;
  /** Parsing execution time */
  parseTime: number;
}

/** Extracted dependency information */
export interface ExtractedDependency {
  /** Dependency identifier */
  id: UUID;
  /** Target file or module path */
  targetPath: string;
  /** Dependency type */
  type: DependencyEdge['type'];
  /** Source location in file */
  location: CodeLocation;
  /** Whether dependency is external (not in project) */
  isExternal: boolean;
  /** Import/reference name */
  importName?: string;
  /** Namespace or module qualifier */
  namespace?: string;
  /** Dependency strength assessment */
  strength: DependencyStrength;
}

/** Exported symbol information */
export interface ExportedSymbol {
  /** Symbol name */
  name: string;
  /** Symbol type */
  type: 'function' | 'class' | 'interface' | 'type' | 'variable' | 'constant' | 'namespace';
  /** Export location */
  location: CodeLocation;
  /** Whether symbol is default export */
  isDefault: boolean;
  /** Symbol visibility */
  visibility: 'public' | 'protected' | 'private' | 'internal';
  /** Symbol documentation/comments */
  documentation?: string;
}

/** Dependency cache entry */
export interface DependencyCache {
  /** Cache entry identifier */
  id: UUID;
  /** Project identifier */
  projectId: UUID;
  /** File path */
  filePath: string;
  /** File content hash for cache invalidation */
  contentHash: string;
  /** Cached dependency parsing result */
  parsingResult: DependencyParsingResult;
  /** Cache creation timestamp */
  cachedAt: string; // ISO 8601 format
  /** Last access timestamp */
  lastAccessedAt: string; // ISO 8601 format
  /** Access count for cache LRU management */
  accessCount: number;
}

/** Generation order optimization request */
export interface GenerationOrderRequest {
  /** Project identifier */
  projectId: UUID;
  /** Target files for generation ordering */
  targetFiles: string[];
  /** Generation constraints */
  constraints: {
    /** Files that must be generated first */
    priorityFiles: string[];
    /** Files that should be generated last */
    deferredFiles: string[];
    /** Maximum parallel generation batches */
    maxParallelBatches: number;
  };
  /** Optimization strategy */
  strategy: 'dependency_first' | 'complexity_first' | 'balanced';
}

/** Generation order optimization result */
export interface GenerationOrderResult {
  /** Optimized generation order */
  generationOrder: string[];
  /** Generation batches for parallel processing */
  generationBatches: string[][];
  /** Optimization statistics */
  optimization: {
    /** Original order length */
    originalLength: number;
    /** Optimized order length */
    optimizedLength: number;
    /** Parallelization factor achieved */
    parallelizationFactor: number;
    /** Estimated generation time savings */
    estimatedTimeSavings: number;
  };
  /** Order validation results */
  validation: {
    /** Whether order satisfies all dependencies */
    satisfiesDependencies: boolean;
    /** Dependency violations (if any) */
    violations: string[];
    /** Order confidence score (0-100) */
    confidenceScore: number;
  };
}
```

## **3. API Endpoint Specification (OpenAPI `paths` block)**

```yaml
paths:
  /api/v1/dependencies/analyze:
    post:
      tags:
        - Dependencies
      summary: Perform dependency analysis
      description: Analyzes project dependencies using Tree-sitter parsers and builds dependency graphs
      security:
        - localAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                projectId:
                  $ref: '#/components/schemas/UUID'
                operation:
                  type: string
                  enum: [full_analysis, incremental_analysis, impact_analysis, circular_detection, order_optimization]
                targetPaths:
                  type: array
                  items:
                    type: string
                options:
                  type: object
                  properties:
                    includeTestFiles:
                      type: boolean
                      default: false
                    includeExternalDeps:
                      type: boolean
                      default: true
                    maxDepth:
                      type: integer
                      minimum: 1
                      maximum: 50
                      default: 10
                    parserOptions:
                      type: object
                    forceRefresh:
                      type: boolean
                      default: false
                  required:
                    - includeTestFiles
                    - includeExternalDeps
                    - maxDepth
                    - forceRefresh
              required:
                - projectId
                - operation
                - options
      responses:
        '200':
          description: Dependency analysis completed successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/DependencyAnalysisResult'
        '400':
          description: Invalid analysis request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'
        '404':
          description: Project not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

  /api/v1/dependencies/{projectId}/graph:
    get:
      tags:
        - Dependencies
      summary: Get project dependency graph
      description: Retrieves the current dependency graph for a project with optional filtering
      security:
        - localAuth: []
      parameters:
        - name: projectId
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
        - name: includeExternal
          in: query
          description: Include external dependencies in the graph
          required: false
          schema:
            type: boolean
            default: false
        - name: maxDepth
          in: query
          description: Maximum dependency depth to include
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 20
            default: 5
        - name: format
          in: query
          description: Response format for the dependency graph
          required: false
          schema:
            type: string
            enum: [json, dot, mermaid]
            default: json
      responses:
        '200':
          description: Dependency graph retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          dependencyGraph:
                            $ref: '#/components/schemas/DependencyGraph'
                          metadata:
                            type: object
                            properties:
                              lastAnalyzed:
                                type: string
                                format: date-time
                              totalNodes:
                                type: integer
                              totalEdges:
                                type: integer
                              analysisVersion:
                                type: string
        '404':
          description: Project not found or no dependency graph available
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

  /api/v1/dependencies/impact:
    post:
      tags:
        - Dependencies
      summary: Analyze dependency impact
      description: Analyzes the impact of changes to specific files on other project dependencies
      security:
        - localAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                targetPath:
                  type: string
                  minLength: 1
                projectId:
                  $ref: '#/components/schemas/UUID'
                scope:
                  type: string
                  enum: [direct, transitive, full_cascade]
                  default: direct
                changeType:
                  type: string
                  enum: [modify, delete, rename, move]
                newPath:
                  type: string
                includeReverseDeps:
                  type: boolean
                  default: true
              required:
                - targetPath
                - projectId
                - changeType
      responses:
        '200':
          description: Impact analysis completed successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/ImpactAnalysisResult'
        '400':
          description: Invalid impact analysis request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'
        '404':
          description: Target file or project not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

  /api/v1/dependencies/{projectId}/circular:
    get:
      tags:
        - Dependencies
      summary: Get circular dependencies
      description: Retrieves detected circular dependencies with resolution suggestions
      security:
        - localAuth: []
      parameters:
        - name: projectId
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
        - name: severity
          in: query
          description: Filter by circular dependency severity
          required: false
          schema:
            type: string
            enum: [low, medium, high, critical]
        - name: includeResolved
          in: query
          description: Include previously resolved circular dependencies
          required: false
          schema:
            type: boolean
            default: false
      responses:
        '200':
          description: Circular dependencies retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          circularDependencies:
                            type: array
                            items:
                              $ref: '#/components/schemas/CircularDependencyChain'
                          summary:
                            type: object
                            properties:
                              totalCount:
                                type: integer
                              severityBreakdown:
                                type: object
                                properties:
                                  low:
                                    type: integer
                                  medium:
                                    type: integer
                                  high:
                                    type: integer
                                  critical:
                                    type: integer
                              blocksGeneration:
                                type: integer
        '404':
          description: Project not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

  /api/v1/dependencies/generation-order:
    post:
      tags:
        - Dependencies
      summary: Optimize generation order
      description: Calculates optimal file generation order based on dependency analysis
      security:
        - localAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                projectId:
                  $ref: '#/components/schemas/UUID'
                targetFiles:
                  type: array
                  items:
                    type: string
                  minItems: 1
                constraints:
                  type: object
                  properties:
                    priorityFiles:
                      type: array
                      items:
                        type: string
                    deferredFiles:
                      type: array
                      items:
                        type: string
                    maxParallelBatches:
                      type: integer
                      minimum: 1
                      maximum: 20
                      default: 5
                strategy:
                  type: string
                  enum: [dependency_first, complexity_first, balanced]
                  default: dependency_first
              required:
                - projectId
                - targetFiles
      responses:
        '200':
          description: Generation order optimized successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/GenerationOrderResult'
        '400':
          description: Invalid generation order request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'
        '409':
          description: Circular dependencies prevent optimal ordering
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiErrorResponse'
                  - type: object
                    properties:
                      error:
                        type: object
                        properties:
                          circularDependencies:
                            type: array
                            items:
                              type: string

  /api/v1/dependencies/{projectId}/cache:
    delete:
      tags:
        - Dependencies
      summary: Clear dependency cache
      description: Clears the dependency analysis cache for a project, forcing fresh analysis
      security:
        - localAuth: []
      parameters:
        - name: projectId
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
        - name: targetPaths
          in: query
          description: Specific file paths to clear from cache (optional)
          required: false
          schema:
            type: string
      responses:
        '200':
          description: Dependency cache cleared successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          clearedEntries:
                            type: integer
                          totalCacheSize:
                            type: integer
        '404':
          description: Project not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

  /api/v1/dependencies/{projectId}/statistics:
    get:
      tags:
        - Dependencies
      summary: Get dependency statistics
      description: Retrieves comprehensive dependency analysis statistics for a project
      security:
        - localAuth: []
      parameters:
        - name: projectId
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
        - name: period
          in: query
          description: Time period for trend analysis
          required: false
          schema:
            type: string
            enum: [day, week, month]
            default: week
      responses:
        '200':
          description: Dependency statistics retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          current:
                            type: object
                            properties:
                              totalFiles:
                                type: integer
                              totalDependencies:
                                type: integer
                              averageDependenciesPerFile:
                                type: number
                              maxDependencyDepth:
                                type: integer
                              circularDependencyCount:
                                type: integer
                              languageDistribution:
                                type: object
                                additionalProperties:
                                  type: integer
                          trends:
                            type: object
                            properties:
                              dependencyGrowth:
                                type: array
                                items:
                                  type: object
                                  properties:
                                    date:
                                      type: string
                                      format: date
                                    count:
                                      type: integer
                              complexityTrend:
                                type: array
                                items:
                                  type: object
                                  properties:
                                    date:
                                      type: string
                                      format: date
                                    avgComplexity:
                                      type: number
                          recommendations:
                            type: array
                            items:
                              type: string

components:
  schemas:
    DependencyAnalysisResult:
      type: object
      required:
        - requestId
        - success
        - executionTime
        - statistics
        - warnings
        - completedAt
      properties:
        requestId:
          $ref: '#/components/schemas/UUID'
        success:
          type: boolean
        executionTime:
          type: number
        dependencyGraph:
          $ref: '#/components/schemas/DependencyGraph'
        statistics:
          type: object
          properties:
            filesAnalyzed:
              type: integer
            totalDependencies:
              type: integer
            circularDependencies:
              type: integer
            languageBreakdown:
              type: object
              additionalProperties:
                type: integer
            parsingErrors:
              type: integer
        circularDependencyDetails:
          type: array
          items:
            $ref: '#/components/schemas/CircularDependencyChain'
        optimizedGenerationOrder:
          type: array
          items:
            type: string
        warnings:
          type: array
          items:
            type: string
        errors:
          type: array
          items:
            type: string
        completedAt:
          type: string
          format: date-time

    CircularDependencyChain:
      type: object
      required:
        - id
        - chain
        - dependencyTypes
        - severity
        - resolutionSuggestions
        - blocksGeneration
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        chain:
          type: array
          items:
            type: string
        dependencyTypes:
          type: array
          items:
            type: string
            enum: [import, extends, implements, uses]
        severity:
          type: string
          enum: [low, medium, high, critical]
        resolutionSuggestions:
          type: array
          items:
            type: string
        blocksGeneration:
          type: boolean

    ImpactAnalysisResult:
      type: object
      required:
        - targetPath
        - scope
        - directImpacts
        - transitiveImpacts
        - totalImpactCount
        - impactSeverity
        - warnings
        - recommendations
      properties:
        targetPath:
          type: string
        scope:
          type: string
          enum: [direct, transitive, full_cascade]
        directImpacts:
          type: array
          items:
            $ref: '#/components/schemas/ImpactedFile'
        transitiveImpacts:
          type: array
          items:
            $ref: '#/components/schemas/ImpactedFile'
        totalImpactCount:
          type: integer
        impactSeverity:
          type: string
          enum: [minimal, moderate, significant, critical]
        warnings:
          type: array
          items:
            type: string
        recommendations:
          type: array
          items:
            type: string

    ImpactedFile:
      type: object
      required:
        - path
        - impactType
        - strength
        - updateEffort
        - requiresRegeneration
      properties:
        path:
          type: string
        impactType:
          type: string
          enum: [import, extends, implements, uses]
        strength:
          type: string
          enum: [strong, medium, weak]
        affectedLocations:
          type: array
          items:
            $ref: '#/components/schemas/CodeLocation'
        updateEffort:
          type: string
          enum: [low, medium, high]
        requiresRegeneration:
          type: boolean

    CodeLocation:
      type: object
      required:
        - line
        - column
        - length
        - context
        - constructType
      properties:
        line:
          type: integer
          minimum: 1
        column:
          type: integer
          minimum: 1
        length:
          type: integer
          minimum: 1
        context:
          type: string
        constructType:
          type: string
          enum: [import, function_call, type_reference, inheritance, other]

    GenerationOrderResult:
      type: object
      required:
        - generationOrder
        - generationBatches
        - optimization
        - validation
      properties:
        generationOrder:
          type: array
          items:
            type: string
        generationBatches:
          type: array
          items:
            type: array
            items:
              type: string
        optimization:
          type: object
          properties:
            originalLength:
              type: integer
            optimizedLength:
              type: integer
            parallelizationFactor:
              type: number
            estimatedTimeSavings:
              type: number
        validation:
          type: object
          properties:
            satisfiesDependencies:
              type: boolean
            violations:
              type: array
              items:
                type: string
            confidenceScore:
              type: number
              minimum: 0
              maximum: 100
```

## **4. Detailed Business Logic & Validation Rules**

| Rule ID | Rule Description | Implementation Location(s) & Notes |
|---------|------------------|-----------------------------------|
| **DEP-01** | Dependency analysis must coordinate with File System Management Module to read source files and verify file accessibility before attempting Tree-sitter parsing operations. | **Backend (Authoritative):** Analysis service must call File System Management to check file permissions, existence, and read file content before passing to Tree-sitter parsers. Handle file access errors gracefully. |
| **DEP-02** | Circular dependencies marked as 'critical' or 'high' severity must block the generation order optimization and require manual resolution before proceeding with AI code generation. | **Backend (Authoritative):** Generation order service must validate dependency graph for critical circular dependencies and return error status if found, preventing Code Generation Engine from proceeding until resolved. |
| **DEP-03** | Impact analysis results must be integrated with Context Management Engine to update context node dependencies and relevance scores based on detected dependency relationships. | **Backend (Authoritative):** Impact analysis service must call Context Management Module to update context nodes with new dependency relationships and recalculate relevance scores for affected files. |
| **DEP-04** | Dependency cache entries must be invalidated when File System Management Module reports file modifications, ensuring analysis results remain consistent with actual file content. | **Backend (Authoritative):** File system watcher integration must detect file changes and invalidate corresponding cache entries. Cache service must verify content hashes before serving cached results. |
| **DEP-05** | Tree-sitter parsing failures must be reported to Logging & Monitoring Service with detailed error context and must not block overall dependency analysis for other files in the project. | **Backend (Authoritative):** Parser service must catch and log parsing exceptions, continue analysis with remaining files, and include parsing error statistics in analysis results. Use circuit breaker pattern for repeated failures. |
| **DEP-06** | Generation order optimization must respect Multi-Phase Development Orchestrator phase dependencies by ensuring phase artifacts are ordered before dependent phases can proceed. | **Backend (Authoritative):** Generation order service must query Multi-Phase Orchestrator for phase dependency constraints and incorporate phase-level dependencies into file-level generation ordering algorithms. |
| **DEP-07** | Dependency analysis performance must meet the <3 second KPI requirement for projects with up to 500 files by utilizing intelligent caching and incremental analysis strategies. | **Backend (Authoritative):** Analysis service must implement LRU cache with configurable size limits, use incremental analysis for file changes, and employ parallel parsing for performance optimization while monitoring execution times. |
| **DEP-08** | External dependency resolution must coordinate with Configuration Management Module to respect project-specific include/exclude patterns and parsing configuration settings. | **Backend (Authoritative):** Analysis service must query Configuration Management for project-specific parser settings, external dependency inclusion rules, and apply configuration-based filtering during analysis. |
| **DEP-09** | Dependency strength assessment must consider Code Analysis Service AST depth, usage frequency, and relationship types to provide accurate impact analysis for architectural consistency KPI tracking. | **Backend (Authoritative):** Strength calculation must integrate with Code Analysis Service for AST metadata, analyze symbol usage patterns, and weight relationships based on architectural importance for quality metrics. |
| **DEP-10** | Impact analysis for file deletions or moves must integrate with Quality Assurance Orchestrator to validate that proposed changes do not violate architectural consistency requirements before execution. | **Backend (Authoritative):** Impact analysis service must call Quality Assurance Module to validate architectural impact, check consistency constraints, and provide warnings for changes that may affect >95% consistency KPI. |

## **5. Developer Task Checklist**

### **Backend Tasks:**
- [ ] Create database migration script for dependency analysis tables (`dependency_graphs`, `dependency_cache`, `circular_dependencies`, `impact_analysis_results`, `dependency_statistics`)
- [ ] Implement the `DependencyAnalysisService` class with Tree-sitter integration, graph construction, and caching capabilities
- [ ] Implement the `TreeSitterParserService` class for multi-language source code parsing with support for TypeScript, JavaScript, Python, and other configured languages
- [ ] Implement the `DependencyGraphBuilder` class for constructing and maintaining dependency graphs from parsed AST information
- [ ] Implement the `CircularDependencyDetector` class for identifying circular dependency chains with severity assessment and resolution suggestions
- [ ] Implement the `ImpactAnalysisService` class for analyzing change impact on dependent files with transitive dependency support
- [ ] Implement the `GenerationOrderOptimizer` class for calculating optimal file generation order based on dependency constraints and parallel processing capabilities
- [ ] Implement the `DependencyCacheManager` class for LRU cache management with content hash validation and intelligent invalidation
- [ ] Implement all dependency analysis API endpoints (`POST /api/v1/dependencies/analyze`, `GET /api/v1/dependencies/{projectId}/graph`) with comprehensive error handling
- [ ] Implement impact analysis endpoint (`POST /api/v1/dependencies/impact`) with support for different change types and scope levels
- [ ] Implement circular dependency management endpoint (`GET /api/v1/dependencies/{projectId}/circular`) with severity filtering and resolution tracking
- [ ] Implement generation order optimization endpoint (`POST /api/v1/dependencies/generation-order`) with constraint support and validation
- [ ] Implement cache management endpoint (`DELETE /api/v1/dependencies/{projectId}/cache`) for manual cache invalidation and debugging
- [ ] Implement dependency statistics endpoint (`GET /api/v1/dependencies/{projectId}/statistics`) with trend analysis and recommendation generation
- [ ] Create `DependencyRepository` class for efficient storage and retrieval of dependency graphs with indexing on project_id, file_path, and dependency relationships
- [ ] Create `CircularDependencyRepository` class for tracking and managing circular dependency chains with resolution status
- [ ] Create `DependencyCacheRepository` class for cache persistence with TTL management and access pattern optimization
- [ ] Implement integration with File System Management Module for file watching, content reading, and change notification handling
- [ ] Implement integration with Context Management Engine for dependency relationship updates and context node relevance score recalculation
- [ ] Implement integration with Code Analysis Service for AST information extraction and symbol resolution
- [ ] Implement integration with Multi-Phase Development Orchestrator for phase-level dependency constraints and artifact ordering
- [ ] Implement integration with Quality Assurance Orchestrator for architectural consistency validation during impact analysis
- [ ] Implement integration with Logging & Monitoring Service for performance metrics tracking and error reporting
- [ ] Create comprehensive unit tests for dependency analysis algorithms with mock Tree-sitter parsers and various code structure scenarios
- [ ] Create integration tests for multi-language parsing with real source files and dependency relationship validation
- [ ] Implement performance optimization tests to validate <3 second analysis time for 500-file projects with proper caching strategies
- [ ] Add background services for incremental dependency analysis when files change and periodic cache cleanup for optimal performance

### **Frontend Tasks:**
- [ ] Create `DependencyProvider` React context for managing dependency analysis state and operations
- [ ] Implement `useDependencyAnalysis` hook for triggering dependency analysis operations with loading states and error handling
- [ ] Create `DependencyGraphVisualization` component for interactive visualization of project dependency graphs with zoom, filter, and navigation capabilities
- [ ] Implement `CircularDependencyAlert` component for displaying circular dependency warnings with resolution suggestions and severity indicators
- [ ] Create `ImpactAnalysisPanel` component for showing impact analysis results with file lists, change recommendations, and effort estimates
- [ ] Implement `GenerationOrderViewer` component for displaying optimized generation order with batch visualization and dependency reasoning
- [ ] Create `DependencyStatistics` component for showing project dependency metrics, trends, and health indicators
- [ ] Implement `DependencySettings` component integrated with Configuration Management for parser options and analysis configuration
- [ ] Create dependency analysis service functions in the API client (`dependencyService.ts`) for all dependency analysis endpoints
- [ ] Implement real-time dependency updates using WebSocket integration for live dependency graph updates during file changes
- [ ] Create dependency search and filtering interface for large projects with advanced query capabilities and performance optimization
- [ ] Implement dependency export functionality for generating documentation and reports in various formats (DOT, Mermaid, JSON)
- [ ] Add dependency analysis integration to the VS Code extension command palette for quick analysis operations
- [ ] Create dependency health monitoring widgets for the main dashboard with KPI tracking and alerts
- [ ] Implement dependency impact preview for Code Generation Engine integration showing generation order and potential conflicts
- [ ] Add dependency validation feedback in project creation workflows with template compatibility checking
- [ ] Create developer debugging tools for dependency analysis including cache inspection and parser diagnostics
- [ ] Implement dependency-aware file navigation with jump-to-dependency and reverse dependency browsing capabilities
- [ ] Add dependency analysis integration to project health monitoring with architectural consistency scoring
- [ ] Create automated dependency analysis scheduling for background maintenance and continuous project health monitoring



========================================================================================


# Code Analysis Service - Technical Specification

## **1. Module Overview**

**Purpose:** The Code Analysis Service serves as the comprehensive source code parsing, analysis, and dependency extraction engine for the ReadyAI application. This module provides multi-language parsing capabilities using Tree-sitter, performs AST (Abstract Syntax Tree) analysis, extracts dependencies and imports, calculates code metrics, and validates syntax across various programming languages. It acts as the foundational code intelligence layer that enables the Dependency Analysis Engine, Context Management Engine, and Quality Assurance Orchestrator to understand and analyze source code structure and relationships.

**Dependencies & Interactions:** This module depends on the File System Management Module to read source code files from the local file system and access project directories. It relies on the Configuration Management Module to obtain parsing preferences, language-specific configurations, analysis thresholds, and performance settings. The module provides code analysis services that are consumed by the Dependency Analysis Engine for building dependency graphs, the Context Management Engine for extracting semantic context from source files, the Quality Assurance Orchestrator for code quality validation, and the Multi-Phase Development Orchestrator for architectural consistency checking. It also integrates with the Logging & Monitoring Service to track parsing performance metrics and error reporting to support the <3 second context retrieval KPI requirement.

## **2. Module-Specific Type Additions (`types.codeAnalysis.ts`)**

```typescript
/**
 * Code Analysis Service Module Types
 * Extends foundational types with code analysis-specific interfaces
 */

/** Supported programming languages for analysis */
export type SupportedLanguage = 
  | 'typescript'
  | 'javascript'
  | 'python'
  | 'java'
  | 'csharp'
  | 'cpp'
  | 'c'
  | 'rust'
  | 'go'
  | 'ruby'
  | 'php'
  | 'swift'
  | 'kotlin'
  | 'scala'
  | 'html'
  | 'css'
  | 'scss'
  | 'json'
  | 'yaml'
  | 'xml'
  | 'sql'
  | 'shell'
  | 'dockerfile'
  | 'makefile';

/** AST node types for code structure analysis */
export type ASTNodeType = 
  | 'module'
  | 'class'
  | 'interface'
  | 'function'
  | 'method'
  | 'variable'
  | 'constant'
  | 'import'
  | 'export'
  | 'type_definition'
  | 'enum'
  | 'namespace'
  | 'comment'
  | 'string_literal'
  | 'number_literal'
  | 'boolean_literal';

/** Dependency types found in source code */
export type DependencyType = 
  | 'import'
  | 'require'
  | 'include'
  | 'using'
  | 'from'
  | 'extends'
  | 'implements'
  | 'inherits'
  | 'calls'
  | 'references'
  | 'instantiates';

/** Code analysis scope levels */
export type AnalysisScope = 'file' | 'directory' | 'project' | 'workspace';

/** Code complexity levels */
export type ComplexityLevel = 'low' | 'moderate' | 'high' | 'very_high';

/** Code analysis request configuration */
export interface CodeAnalysisRequest {
  /** Unique analysis request identifier */
  id: UUID;
  /** Target file or directory path */
  targetPath: string;
  /** Analysis scope */
  scope: AnalysisScope;
  /** Specific language (optional - will auto-detect if not provided) */
  language?: SupportedLanguage;
  /** Analysis options */
  options: {
    /** Include dependency extraction */
    includeDependencies: boolean;
    /** Include code metrics calculation */
    includeMetrics: boolean;
    /** Include AST node extraction */
    includeAST: boolean;
    /** Include syntax validation */
    includeSyntaxValidation: boolean;
    /** Maximum depth for directory traversal */
    maxDepth?: number;
    /** File patterns to include */
    includePatterns?: string[];
    /** File patterns to exclude */
    excludePatterns?: string[];
  };
  /** Project context */
  projectId?: UUID;
  /** Request timestamp */
  createdAt: string; // ISO 8601 format
}

/** AST node representation */
export interface ASTNode {
  /** Node identifier */
  id: UUID;
  /** Node type */
  type: ASTNodeType;
  /** Node name/identifier */
  name: string;
  /** Start position in source code */
  startPosition: {
    line: number;
    column: number;
    offset: number;
  };
  /** End position in source code */
  endPosition: {
    line: number;
    column: number;
    offset: number;
  };
  /** Parent node identifier */
  parentId?: UUID;
  /** Child node identifiers */
  children: UUID[];
  /** Node-specific properties */
  properties: Record<string, any>;
  /** Source code text for this node */
  sourceText: string;
}

/** Extracted dependency information */
export interface CodeDependency {
  /** Dependency identifier */
  id: UUID;
  /** Dependency type */
  type: DependencyType;
  /** Source identifier (what depends) */
  source: string;
  /** Target identifier (what is depended upon) */
  target: string;
  /** Module/package name */
  module?: string;
  /** Import specifiers */
  specifiers?: string[];
  /** Whether this is an external dependency */
  isExternal: boolean;
  /** Resolved file path (for internal dependencies) */
  resolvedPath?: string;
  /** Source location */
  location: {
    file: string;
    line: number;
    column: number;
  };
  /** Additional metadata */
  metadata: Record<string, any>;
}

/** Code metrics for a file or project */
export interface CodeMetrics {
  /** Target identifier */
  target: string;
  /** Target type (file/directory/project) */
  targetType: AnalysisScope;
  /** Language distribution */
  languages: Record<SupportedLanguage, number>;
  /** Lines of code metrics */
  linesOfCode: {
    /** Total lines */
    total: number;
    /** Source lines of code */
    source: number;
    /** Comment lines */
    comments: number;
    /** Blank lines */
    blank: number;
  };
  /** Complexity metrics */
  complexity: {
    /** Cyclomatic complexity */
    cyclomatic: number;
    /** Complexity level */
    level: ComplexityLevel;
    /** Number of functions/methods */
    functions: number;
    /** Number of classes */
    classes: number;
    /** Number of interfaces */
    interfaces: number;
  };
  /** Dependency metrics */
  dependencies: {
    /** Total dependencies found */
    total: number;
    /** External dependencies */
    external: number;
    /** Internal dependencies */
    internal: number;
    /** Circular dependencies detected */
    circular: number;
  };
  /** Quality indicators */
  quality: {
    /** Documentation coverage percentage */
    documentationCoverage: number;
    /** Type annotation coverage (for TypeScript/Python) */
    typeAnnotationCoverage?: number;
    /** Estimated maintainability index */
    maintainabilityIndex: number;
  };
  /** File statistics */
  fileStats: {
    /** Total files analyzed */
    totalFiles: number;
    /** Files by language */
    filesByLanguage: Record<SupportedLanguage, number>;
    /** Average file size in bytes */
    avgFileSize: number;
    /** Largest file size */
    maxFileSize: number;
  };
}

/** Syntax validation result */
export interface SyntaxValidationResult {
  /** File path */
  filePath: string;
  /** Language */
  language: SupportedLanguage;
  /** Whether syntax is valid */
  isValid: boolean;
  /** Syntax errors found */
  errors: SyntaxError[];
  /** Syntax warnings */
  warnings: SyntaxWarning[];
  /** Parse success rate */
  parseSuccessRate: number;
  /** Validation timestamp */
  validatedAt: string; // ISO 8601 format
}

/** Syntax error information */
export interface SyntaxError {
  /** Error type */
  type: string;
  /** Error message */
  message: string;
  /** Error severity */
  severity: 'error' | 'warning' | 'info';
  /** Error location */
  location: {
    line: number;
    column: number;
    offset: number;
  };
  /** Error range */
  range?: {
    start: { line: number; column: number };
    end: { line: number; column: number };
  };
  /** Suggested fixes */
  suggestions?: string[];
}

/** Syntax warning information */
export interface SyntaxWarning {
  /** Warning type */
  type: string;
  /** Warning message */
  message: string;
  /** Warning location */
  location: {
    line: number;
    column: number;
    offset: number;
  };
  /** Recommended action */
  recommendation?: string;
}

/** Code analysis result */
export interface CodeAnalysisResult {
  /** Analysis request identifier */
  requestId: UUID;
  /** Analysis success status */
  success: boolean;
  /** Target path analyzed */
  targetPath: string;
  /** Detected or specified language */
  language?: SupportedLanguage;
  /** Analysis scope */
  scope: AnalysisScope;
  /** Extracted AST nodes */
  astNodes?: ASTNode[];
  /** Extracted dependencies */
  dependencies?: CodeDependency[];
  /** Calculated metrics */
  metrics?: CodeMetrics;
  /** Syntax validation results */
  syntaxValidation?: SyntaxValidationResult[];
  /** Analysis performance metrics */
  performance: {
    /** Total analysis time in milliseconds */
    analysisTime: number;
    /** Parsing time in milliseconds */
    parsingTime: number;
    /** Files processed */
    filesProcessed: number;
    /** Memory used in bytes */
    memoryUsed: number;
  };
  /** Analysis errors */
  errors?: string[];
  /** Analysis warnings */
  warnings?: string[];
  /** Analysis completion timestamp */
  completedAt: string; // ISO 8601 format
}

/** Language configuration for parsing */
export interface LanguageConfig {
  /** Language identifier */
  language: SupportedLanguage;
  /** File extensions associated with this language */
  extensions: string[];
  /** Tree-sitter grammar name */
  grammarName: string;
  /** Language-specific parsing options */
  parsingOptions: {
    /** Include comments in AST */
    includeComments: boolean;
    /** Include string literals in AST */
    includeStringLiterals: boolean;
    /** Maximum parse tree depth */
    maxDepth: number;
    /** Timeout for parsing in milliseconds */
    parseTimeout: number;
  };
  /** Dependency extraction patterns */
  dependencyPatterns: {
    /** Import statement patterns */
    importPatterns: string[];
    /** Export statement patterns */
    exportPatterns: string[];
    /** Reference patterns */
    referencePatterns: string[];
  };
  /** Language-specific features */
  features: {
    /** Supports type annotations */
    supportsTypes: boolean;
    /** Supports classes */
    supportsClasses: boolean;
    /** Supports interfaces */
    supportsInterfaces: boolean;
    /** Supports modules */
    supportsModules: boolean;
    /** Supports namespaces */
    supportsNamespaces: boolean;
  };
}

/** Code analysis cache entry */
export interface AnalysisCacheEntry {
  /** Cache key */
  key: string;
  /** File path */
  filePath: string;
  /** File content hash */
  contentHash: string;
  /** Cached analysis result */
  result: CodeAnalysisResult;
  /** Cache creation timestamp */
  createdAt: string; // ISO 8601 format
  /** Last access timestamp */
  lastAccessed: string; // ISO 8601 format
  /** Access count */
  accessCount: number;
}

/** Parser performance statistics */
export interface ParserPerformanceStats {
  /** Language */
  language: SupportedLanguage;
  /** Total files parsed */
  totalFilesParsed: number;
  /** Average parse time in milliseconds */
  avgParseTime: number;
  /** Success rate percentage */
  successRate: number;
  /** Error count */
  errorCount: number;
  /** Warning count */
  warningCount: number;
  /** Cache hit rate percentage */
  cacheHitRate: number;
  /** Statistics period start */
  periodStart: string; // ISO 8601 format
  /** Statistics period end */
  periodEnd: string; // ISO 8601 format
}
```

## **3. API Endpoint Specification (OpenAPI `paths` block)**

```yaml
paths:
  /api/v1/code-analysis/analyze:
    post:
      tags:
        - Code Analysis
      summary: Analyze source code
      description: Performs comprehensive code analysis on specified file or directory, including AST extraction, dependency analysis, metrics calculation, and syntax validation
      security:
        - localAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                targetPath:
                  type: string
                  minLength: 1
                  description: File or directory path to analyze
                scope:
                  type: string
                  enum: [file, directory, project, workspace]
                  default: file
                language:
                  type: string
                  enum: [typescript, javascript, python, java, csharp, cpp, c, rust, go, ruby, php, swift, kotlin, scala, html, css, scss, json, yaml, xml, sql, shell, dockerfile, makefile]
                  description: Specific language (auto-detected if not provided)
                options:
                  type: object
                  properties:
                    includeDependencies:
                      type: boolean
                      default: true
                    includeMetrics:
                      type: boolean
                      default: true
                    includeAST:
                      type: boolean
                      default: false
                    includeSyntaxValidation:
                      type: boolean
                      default: true
                    maxDepth:
                      type: integer
                      minimum: 1
                      maximum: 10
                      default: 5
                    includePatterns:
                      type: array
                      items:
                        type: string
                      description: File patterns to include (glob patterns)
                    excludePatterns:
                      type: array
                      items:
                        type: string
                      description: File patterns to exclude (glob patterns)
                  required:
                    - includeDependencies
                    - includeMetrics
                    - includeAST
                    - includeSyntaxValidation
                projectId:
                  $ref: '#/components/schemas/UUID'
                  description: Project context for analysis
              required:
                - targetPath
                - scope
                - options
      responses:
        '200':
          description: Code analysis completed successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/CodeAnalysisResult'
        '400':
          description: Invalid analysis request parameters
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'
        '404':
          description: Target path not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'
        '500':
          description: Analysis processing error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

  /api/v1/code-analysis/dependencies:
    get:
      tags:
        - Code Analysis
      summary: Extract dependencies from source code
      description: Extracts dependencies from specified source code files with filtering and grouping options
      security:
        - localAuth: []
      parameters:
        - name: targetPath
          in: query
          required: true
          schema:
            type: string
          description: File or directory path to analyze for dependencies
        - name: scope
          in: query
          required: false
          schema:
            type: string
            enum: [file, directory, project, workspace]
            default: file
        - name: language
          in: query
          required: false
          schema:
            type: string
            enum: [typescript, javascript, python, java, csharp, cpp, c, rust, go, ruby, php, swift, kotlin, scala, html, css, scss, json, yaml, xml, sql, shell, dockerfile, makefile]
        - name: dependencyType
          in: query
          required: false
          schema:
            type: string
            enum: [import, require, include, using, from, extends, implements, inherits, calls, references, instantiates]
          description: Filter by dependency type
        - name: external
          in: query
          required: false
          schema:
            type: boolean
          description: Filter for external dependencies only
        - name: projectId
          in: query
          required: false
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '200':
          description: Dependencies extracted successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          dependencies:
                            type: array
                            items:
                              $ref: '#/components/schemas/CodeDependency'
                          summary:
                            type: object
                            properties:
                              totalDependencies:
                                type: integer
                              externalDependencies:
                                type: integer
                              internalDependencies:
                                type: integer
                              byType:
                                type: object
                                additionalProperties:
                                  type: integer
                              byLanguage:
                                type: object
                                additionalProperties:
                                  type: integer

  /api/v1/code-analysis/metrics:
    get:
      tags:
        - Code Analysis
      summary: Calculate code metrics
      description: Calculates comprehensive code metrics for specified source code including complexity, lines of code, and quality indicators
      security:
        - localAuth: []
      parameters:
        - name: targetPath
          in: query
          required: true
          schema:
            type: string
          description: File or directory path to calculate metrics for
        - name: scope
          in: query
          required: false
          schema:
            type: string
            enum: [file, directory, project, workspace]
            default: file
        - name: includeQuality
          in: query
          required: false
          schema:
            type: boolean
            default: true
          description: Include quality indicators in metrics
        - name: projectId
          in: query
          required: false
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '200':
          description: Code metrics calculated successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/CodeMetrics'

  /api/v1/code-analysis/validate:
    post:
      tags:
        - Code Analysis
      summary: Validate source code syntax
      description: Validates syntax of specified source code files and returns detailed error and warning information
      security:
        - localAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                targetPath:
                  type: string
                  minLength: 1
                scope:
                  type: string
                  enum: [file, directory, project, workspace]
                  default: file
                language:
                  type: string
                  enum: [typescript, javascript, python, java, csharp, cpp, c, rust, go, ruby, php, swift, kotlin, scala, html, css, scss, json, yaml, xml, sql, shell, dockerfile, makefile]
                strictMode:
                  type: boolean
                  default: false
                  description: Enable strict validation mode
                projectId:
                  $ref: '#/components/schemas/UUID'
              required:
                - targetPath
                - scope
      responses:
        '200':
          description: Syntax validation completed
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          results:
                            type: array
                            items:
                              $ref: '#/components/schemas/SyntaxValidationResult'
                          summary:
                            type: object
                            properties:
                              totalFiles:
                                type: integer
                              validFiles:
                                type: integer
                              invalidFiles:
                                type: integer
                              totalErrors:
                                type: integer
                              totalWarnings:
                                type: integer
                              overallValidationRate:
                                type: number

  /api/v1/code-analysis/languages:
    get:
      tags:
        - Code Analysis
      summary: Get supported languages
      description: Retrieves list of supported programming languages and their configuration details
      security:
        - localAuth: []
      responses:
        '200':
          description: Supported languages retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          languages:
                            type: array
                            items:
                              $ref: '#/components/schemas/LanguageConfig'
                          totalLanguages:
                            type: integer

  /api/v1/code-analysis/languages/{language}/config:
    get:
      tags:
        - Code Analysis
      summary: Get language configuration
      description: Retrieves detailed configuration for a specific programming language
      security:
        - localAuth: []
      parameters:
        - name: language
          in: path
          required: true
          schema:
            type: string
            enum: [typescript, javascript, python, java, csharp, cpp, c, rust, go, ruby, php, swift, kotlin, scala, html, css, scss, json, yaml, xml, sql, shell, dockerfile, makefile]
      responses:
        '200':
          description: Language configuration retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/LanguageConfig'
        '404':
          description: Language not supported
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

    put:
      tags:
        - Code Analysis
      summary: Update language configuration
      description: Updates configuration settings for a specific programming language
      security:
        - localAuth: []
      parameters:
        - name: language
          in: path
          required: true
          schema:
            type: string
            enum: [typescript, javascript, python, java, csharp, cpp, c, rust, go, ruby, php, swift, kotlin, scala, html, css, scss, json, yaml, xml, sql, shell, dockerfile, makefile]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                parsingOptions:
                  type: object
                  properties:
                    includeComments:
                      type: boolean
                    includeStringLiterals:
                      type: boolean
                    maxDepth:
                      type: integer
                      minimum: 1
                      maximum: 100
                    parseTimeout:
                      type: integer
                      minimum: 1000
                      maximum: 60000
                dependencyPatterns:
                  type: object
                  properties:
                    importPatterns:
                      type: array
                      items:
                        type: string
                    exportPatterns:
                      type: array
                      items:
                        type: string
                    referencePatterns:
                      type: array
                      items:
                        type: string
      responses:
        '200':
          description: Language configuration updated successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/LanguageConfig'

  /api/v1/code-analysis/performance:
    get:
      tags:
        - Code Analysis
      summary: Get parser performance statistics
      description: Retrieves performance statistics for code parsing operations across different languages
      security:
        - localAuth: []
      parameters:
        - name: language
          in: query
          required: false
          schema:
            type: string
            enum: [typescript, javascript, python, java, csharp, cpp, c, rust, go, ruby, php, swift, kotlin, scala, html, css, scss, json, yaml, xml, sql, shell, dockerfile, makefile]
          description: Filter statistics by language
        - name: startDate
          in: query
          required: false
          schema:
            type: string
            format: date
          description: Start date for statistics period
        - name: endDate
          in: query
          required: false
          schema:
            type: string
            format: date
          description: End date for statistics period
      responses:
        '200':
          description: Performance statistics retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          statistics:
                            type: array
                            items:
                              $ref: '#/components/schemas/ParserPerformanceStats'
                          summary:
                            type: object
                            properties:
                              totalFilesParsed:
                                type: integer
                              overallSuccessRate:
                                type: number
                              avgParseTime:
                                type: number
                              cacheEfficiency:
                                type: number

  /api/v1/code-analysis/cache:
    get:
      tags:
        - Code Analysis
      summary: Get analysis cache statistics
      description: Retrieves statistics about the analysis cache including hit rates and storage usage
      security:
        - localAuth: []
      responses:
        '200':
          description: Cache statistics retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          totalEntries:
                            type: integer
                          cacheSize:
                            type: integer
                          hitRate:
                            type: number
                          missRate:
                            type: number
                          oldestEntry:
                            type: string
                            format: date-time
                          newestEntry:
                            type: string
                            format: date-time

    delete:
      tags:
        - Code Analysis
      summary: Clear analysis cache
      description: Clears the analysis cache partially or completely based on specified criteria
      security:
        - localAuth: []
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              properties:
                language:
                  type: string
                  enum: [typescript, javascript, python, java, csharp, cpp, c, rust, go, ruby, php, swift, kotlin, scala, html, css, scss, json, yaml, xml, sql, shell, dockerfile, makefile]
                  description: Clear cache for specific language only
                olderThan:
                  type: string
                  format: date-time
                  description: Clear entries older than this timestamp
                projectId:
                  $ref: '#/components/schemas/UUID'
                  description: Clear cache for specific project only
      responses:
        '200':
          description: Cache cleared successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          clearedEntries:
                            type: integer
                          remainingEntries:
                            type: integer

components:
  schemas:
    CodeAnalysisResult:
      type: object
      required:
        - requestId
        - success
        - targetPath
        - scope
        - performance
        - completedAt
      properties:
        requestId:
          $ref: '#/components/schemas/UUID'
        success:
          type: boolean
        targetPath:
          type: string
        language:
          type: string
          enum: [typescript, javascript, python, java, csharp, cpp, c, rust, go, ruby, php, swift, kotlin, scala, html, css, scss, json, yaml, xml, sql, shell, dockerfile, makefile]
        scope:
          type: string
          enum: [file, directory, project, workspace]
        astNodes:
          type: array
          items:
            $ref: '#/components/schemas/ASTNode'
        dependencies:
          type: array
          items:
            $ref: '#/components/schemas/CodeDependency'
        metrics:
          $ref: '#/components/schemas/CodeMetrics'
        syntaxValidation:
          type: array
          items:
            $ref: '#/components/schemas/SyntaxValidationResult'
        performance:
          type: object
          properties:
            analysisTime:
              type: number
            parsingTime:
              type: number
            filesProcessed:
              type: integer
            memoryUsed:
              type: number
        errors:
          type: array
          items:
            type: string
        warnings:
          type: array
          items:
            type: string
        completedAt:
          type: string
          format: date-time

    ASTNode:
      type: object
      required:
        - id
        - type
        - name
        - startPosition
        - endPosition
        - children
        - properties
        - sourceText
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        type:
          type: string
          enum: [module, class, interface, function, method, variable, constant, import, export, type_definition, enum, namespace, comment, string_literal, number_literal, boolean_literal]
        name:
          type: string
        startPosition:
          type: object
          properties:
            line:
              type: integer
            column:
              type: integer
            offset:
              type: integer
        endPosition:
          type: object
          properties:
            line:
              type: integer
            column:
              type: integer
            offset:
              type: integer
        parentId:
          $ref: '#/components/schemas/UUID'
        children:
          type: array
          items:
            $ref: '#/components/schemas/UUID'
        properties:
          type: object
        sourceText:
          type: string

    CodeDependency:
      type: object
      required:
        - id
        - type
        - source
        - target
        - isExternal
        - location
        - metadata
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        type:
          type: string
          enum: [import, require, include, using, from, extends, implements, inherits, calls, references, instantiates]
        source:
          type: string
        target:
          type: string
        module:
          type: string
        specifiers:
          type: array
          items:
            type: string
        isExternal:
          type: boolean
        resolvedPath:
          type: string
        location:
          type: object
          properties:
            file:
              type: string
            line:
              type: integer
            column:
              type: integer
        metadata:
          type: object

    CodeMetrics:
      type: object
      required:
        - target
        - targetType
        - languages
        - linesOfCode
        - complexity
        - dependencies
        - quality
        - fileStats
      properties:
        target:
          type: string
        targetType:
          type: string
          enum: [file, directory, project, workspace]
        languages:
          type: object
          additionalProperties:
            type: integer
        linesOfCode:
          type: object
          properties:
            total:
              type: integer
            source:
              type: integer
            comments:
              type: integer
            blank:
              type: integer
        complexity:
          type: object
          properties:
            cyclomatic:
              type: integer
            level:
              type: string
              enum: [low, moderate, high, very_high]
            functions:
              type: integer
            classes:
              type: integer
            interfaces:
              type: integer
        dependencies:
          type: object
          properties:
            total:
              type: integer
            external:
              type: integer
            internal:
              type: integer
            circular:
              type: integer
        quality:
          type: object
          properties:
            documentationCoverage:
              type: number
            typeAnnotationCoverage:
              type: number
            maintainabilityIndex:
              type: number
        fileStats:
          type: object
          properties:
            totalFiles:
              type: integer
            filesByLanguage:
              type: object
              additionalProperties:
                type: integer
            avgFileSize:
              type: number
            maxFileSize:
              type: number

    SyntaxValidationResult:
      type: object
      required:
        - filePath
        - language
        - isValid
        - errors
        - warnings
        - parseSuccessRate
        - validatedAt
      properties:
        filePath:
          type: string
        language:
          type: string
          enum: [typescript, javascript, python, java, csharp, cpp, c, rust, go, ruby, php, swift, kotlin, scala, html, css, scss, json, yaml, xml, sql, shell, dockerfile, makefile]
        isValid:
          type: boolean
        errors:
          type: array
          items:
            $ref: '#/components/schemas/SyntaxError'
        warnings:
          type: array
          items:
            $ref: '#/components/schemas/SyntaxWarning'
        parseSuccessRate:
          type: number
        validatedAt:
          type: string
          format: date-time

    SyntaxError:
      type: object
      required:
        - type
        - message
        - severity
        - location
      properties:
        type:
          type: string
        message:
          type: string
        severity:
          type: string
          enum: [error, warning, info]
        location:
          type: object
          properties:
            line:
              type: integer
            column:
              type: integer
            offset:
              type: integer
        range:
          type: object
          properties:
            start:
              type: object
              properties:
                line:
                  type: integer
                column:
                  type: integer
            end:
              type: object
              properties:
                line:
                  type: integer
                column:
                  type: integer
        suggestions:
          type: array
          items:
            type: string

    SyntaxWarning:
      type: object
      required:
        - type
        - message
        - location
      properties:
        type:
          type: string
        message:
          type: string
        location:
          type: object
          properties:
            line:
              type: integer
            column:
              type: integer
            offset:
              type: integer
        recommendation:
          type: string

    LanguageConfig:
      type: object
      required:
        - language
        - extensions
        - grammarName
        - parsingOptions
        - dependencyPatterns
        - features
      properties:
        language:
          type: string
          enum: [typescript, javascript, python, java, csharp, cpp, c, rust, go, ruby, php, swift, kotlin, scala, html, css, scss, json, yaml, xml, sql, shell, dockerfile, makefile]
        extensions:
          type: array
          items:
            type: string
        grammarName:
          type: string
        parsingOptions:
          type: object
          properties:
            includeComments:
              type: boolean
            includeStringLiterals:
              type: boolean
            maxDepth:
              type: integer
            parseTimeout:
              type: integer
        dependencyPatterns:
          type: object
          properties:
            importPatterns:
              type: array
              items:
                type: string
            exportPatterns:
              type: array
              items:
                type: string
            referencePatterns:
              type: array
              items:
                type: string
        features:
          type: object
          properties:
            supportsTypes:
              type: boolean
            supportsClasses:
              type: boolean
            supportsInterfaces:
              type: boolean
            supportsModules:
              type: boolean
            supportsNamespaces:
              type: boolean

    ParserPerformanceStats:
      type: object
      required:
        - language
        - totalFilesParsed
        - avgParseTime
        - successRate
        - errorCount
        - warningCount
        - cacheHitRate
        - periodStart
        - periodEnd
      properties:
        language:
          type: string
          enum: [typescript, javascript, python, java, csharp, cpp, c, rust, go, ruby, php, swift, kotlin, scala, html, css, scss, json, yaml, xml, sql, shell, dockerfile, makefile]
        totalFilesParsed:
          type: integer
        avgParseTime:
          type: number
        successRate:
          type: number
        errorCount:
          type: integer
        warningCount:
          type: integer
        cacheHitRate:
          type: number
        periodStart:
          type: string
          format: date-time
        periodEnd:
          type: string
          format: date-time
```

## **4. Detailed Business Logic & Validation Rules**

| Rule ID | Rule Description | Implementation Location(s) & Notes |
|---------|------------------|-----------------------------------|
| **CAS-01** | File paths provided for analysis must be validated through File System Management Module to ensure accessibility and prevent security vulnerabilities from path traversal attacks. | **Backend (Authoritative):** Analysis service must validate all file paths through File System Management Module before processing, ensuring files exist within allowed workspace boundaries and user has read permissions. |
| **CAS-02** | Language detection must be performed when language is not explicitly specified, using file extensions and content analysis to determine the appropriate Tree-sitter parser to use. | **Backend (Authoritative):** Language detection service must map file extensions to supported languages using LanguageConfig definitions and fallback to content-based detection for ambiguous cases. |
| **CAS-03** | Analysis cache entries must be invalidated when source files are modified, using file content hashes to detect changes and ensure analysis results remain accurate. | **Backend (Authoritative):** Cache service must integrate with File System Management Module file watching to detect file changes and invalidate cache entries based on content hash mismatches. |
| **CAS-04** | Parser timeouts must be enforced according to Configuration Management Module settings to prevent infinite parsing loops and ensure system responsiveness per the <3 second KPI requirement. | **Backend (Authoritative):** Parser service must respect timeout configurations from Configuration Management Module and terminate parsing operations that exceed configured limits, logging timeout events. |
| **CAS-05** | Dependency extraction must follow language-specific patterns and validate resolved dependencies through File System Management Module to ensure dependency paths are accurate. | **Backend (Authoritative):** Dependency extraction service must use language-specific patterns from LanguageConfig and resolve internal dependencies by calling File System Management to verify file existence and accessibility. |
| **CAS-06** | Analysis operations must be logged through Logging & Monitoring Service with performance metrics to support KPI tracking and system optimization. | **Backend (Authoritative):** All analysis operations must log start/end times, file counts, success/failure status, and performance metrics through Logging Service for monitoring and alerting purposes. |
| **CAS-07** | Large directory analysis operations must implement progress tracking and may be performed asynchronously to prevent API timeout issues while maintaining user experience. | **Backend (Authoritative):** Directory analysis service must provide progress tracking for operations exceeding configured thresholds and support asynchronous processing with status polling capabilities. |
| **CAS-08** | Code metrics calculations must be consistent and repeatable, using standardized algorithms for complexity and quality indicators that align with industry best practices. | **Backend (Authoritative):** Metrics calculation service must implement standardized algorithms (McCabe complexity, maintainability index) with consistent results for identical code inputs and proper handling of edge cases. |
| **CAS-09** | Syntax validation results must differentiate between critical errors that prevent parsing and warnings that indicate potential issues but allow continued analysis. | **Backend (Authoritative):** Validation service must categorize syntax issues by severity and allow analysis to continue for warnings while stopping for critical errors that prevent AST generation. |
| **CAS-10** | Analysis cache must implement size limits and LRU eviction policies configured through Configuration Management Module to prevent unbounded memory growth. | **Backend (Authoritative):** Cache management service must respect cache size limits from Configuration Management and implement LRU eviction with proper cleanup of evicted entries and memory management. |

## **5. Developer Task Checklist**

### **Backend Tasks:**
- [ ] Create database migration script for code analysis tables (`analysis_cache`, `language_configs`, `parser_stats`, `dependency_cache`)
- [ ] Implement the `CodeAnalysisService` class with Tree-sitter integration for multi-language parsing and AST generation
- [ ] Implement the `DependencyExtractionService` class for language-specific dependency pattern matching and resolution
- [ ] Implement the `CodeMetricsService` class for calculating complexity, LOC, and quality indicators using standardized algorithms
- [ ] Implement the `SyntaxValidationService` class for parsing error detection and categorization with detailed reporting
- [ ] Implement the `LanguageDetectionService` class for automatic language identification using file extensions and content analysis
- [ ] Implement the `AnalysisCacheService` class with LRU eviction, content hash validation, and performance optimization
- [ ] Implement the `ParserPerformanceService` class for tracking parsing statistics and performance metrics across languages
- [ ] Implement the main analysis endpoint (`POST /api/v1/code-analysis/analyze`) with comprehensive analysis orchestration and error handling
- [ ] Implement dependency extraction endpoint (`GET /api/v1/code-analysis/dependencies`) with filtering and grouping capabilities
- [ ] Implement metrics calculation endpoint (`GET /api/v1/code-analysis/metrics`) with configurable metric inclusion and performance optimization
- [ ] Implement syntax validation endpoint (`POST /api/v1/code-analysis/validate`) with detailed error reporting and batch processing
- [ ] Implement language management endpoints (`GET`, `PUT /api/v1/code-analysis/languages/{language}/config`) for runtime configuration
- [ ] Implement performance monitoring endpoints (`GET /api/v1/code-analysis/performance`) for parser statistics and optimization
- [ ] Implement cache management endpoints (`GET`, `DELETE /api/v1/code-analysis/cache`) for cache monitoring and cleanup
- [ ] Create `CodeAnalysisRepository` class for result persistence with proper indexing on targetPath, language, and timestamp
- [ ] Create `LanguageConfigRepository` class for language configuration storage and runtime updates
- [ ] Create `DependencyRepository` class for caching dependency resolution results and circular dependency tracking
- [ ] Install and configure Tree-sitter language parsers for all supported languages (TypeScript, JavaScript, Python, Java, etc.)
- [ ] Implement integration with File System Management Module for secure file access and change detection
- [ ] Implement integration with Configuration Management Module for parser settings and performance thresholds
- [ ] Implement integration with Logging & Monitoring Service for operation logging and performance tracking
- [ ] Create comprehensive unit tests for all service classes with mock Tree-sitter parsers and file system operations
- [ ] Create integration tests for multi-language analysis workflows with real source code samples
- [ ] Implement performance tests for large codebases to ensure <3 second analysis time for typical use cases
- [ ] Add error handling for corrupted files, unsupported encodings, and parser crashes with graceful degradation

### **Frontend Tasks:**
- [ ] Create `CodeAnalysisProvider` React context for managing analysis state and progress tracking
- [ ] Implement `useCodeAnalysis` hook for triggering analysis operations and accessing results
- [ ] Create `CodeAnalysisPanel` component for displaying comprehensive analysis results with tabbed interface
- [ ] Implement `DependencyGraph` component for visualizing code dependencies with interactive graph display
- [ ] Create `CodeMetricsDisplay` component for presenting code metrics with charts and trend analysis
- [ ] Implement `SyntaxErrorList` component for displaying validation errors with jump-to-source functionality
- [ ] Create `LanguageConfigEditor` component for managing language parsing configurations
- [ ] Implement `AnalysisProgressIndicator` component for showing real-time analysis progress
- [ ] Create code analysis service functions in the API client (`codeAnalysisService.ts`) for all analysis endpoints
- [ ] Implement file tree integration for right-click "Analyze File" and "Analyze Directory" context menu options
- [ ] Create analysis history tracking for comparing metrics over time and identifying code quality trends
- [ ] Implement export functionality for analysis results in JSON, CSV, and PDF formats
- [ ] Add real-time analysis capabilities that trigger on file save events in the VS Code extension
- [ ] Create code quality dashboard showing project-wide metrics with drill-down capabilities
- [ ] Implement syntax error highlighting in code editor with hover details and suggested fixes
- [ ] Add dependency visualization with filtering by type, external/internal, and language
- [ ] Create analysis caching interface for managing cache size and performance optimization
- [ ] Implement analysis comparison tools for before/after code refactoring analysis
- [ ] Add integration with VS Code problems panel for displaying syntax validation results
- [ ] Create batch analysis interface for analyzing multiple projects or directories simultaneously



========================================================================================


# Quality Assurance Orchestrator - Technical Specification

## **1. Module Overview**

**Purpose:** The Quality Assurance Orchestrator serves as the centralized quality assurance and validation system for the entire ReadyAI application, responsible for automated code validation, test generation, error detection and correction loops, and architectural consistency checking. This module ensures that all AI-generated code meets the >95% architectural consistency KPI defined in the charter while providing comprehensive quality metrics tracking and AI-powered debugging assistance throughout the 7-phase development methodology.

**Dependencies & Interactions:** This module depends on the Configuration Management Module to obtain quality assurance settings, validation rules, and quality thresholds. It integrates extensively with the Claude Integration Service to leverage AI for test generation, code analysis, and debugging assistance. The module depends on the File System Management Module for reading source files, writing test files, and managing validation artifacts. It interacts with the Logging & Monitoring Service to track quality metrics, validation results, and performance data. The module also integrates with the Project Management Module to access project configuration and quality preferences, and coordinates with the Multi-Phase Development Orchestrator to provide quality gates and validation checkpoints throughout the development phases.

## **2. Module-Specific Type Additions (`types.qualityAssurance.ts`)**

```typescript
/**
 * Quality Assurance Orchestrator Module Types
 * Extends foundational types with quality assurance-specific interfaces
 */

/** Code validation types */
export type ValidationRuleType = 
  | 'syntax'
  | 'type_checking'
  | 'linting'
  | 'security'
  | 'performance'
  | 'architectural_consistency'
  | 'dependency_validation'
  | 'custom';

/** Test generation strategies */
export type TestGenerationStrategy = 
  | 'unit_tests'
  | 'integration_tests'
  | 'end_to_end_tests'
  | 'api_tests'
  | 'component_tests'
  | 'performance_tests';

/** Quality gate statuses */
export type QualityGateStatus = 'passed' | 'failed' | 'warning' | 'pending' | 'skipped';

/** Error correction strategies */
export type CorrectionStrategy = 'auto_fix' | 'suggestion' | 'manual_review' | 'ignore';

/** Code quality assessment levels */
export type QualityAssessmentLevel = 'excellent' | 'good' | 'acceptable' | 'needs_improvement' | 'critical';

/** Validation rule configuration */
export interface ValidationRule {
  /** Unique rule identifier */
  id: UUID;
  /** Rule name */
  name: string;
  /** Rule description */
  description: string;
  /** Rule type */
  type: ValidationRuleType;
  /** Whether rule is enabled */
  enabled: boolean;
  /** Rule severity level */
  severity: 'error' | 'warning' | 'info';
  /** Rule configuration parameters */
  config: Record<string, any>;
  /** File patterns this rule applies to */
  filePatterns: string[];
  /** Programming languages this rule applies to */
  languages: string[];
  /** Rule creation timestamp */
  createdAt: string; // ISO 8601 format
  /** Rule last modified timestamp */
  lastModified: string; // ISO 8601 format
}

/** Code validation request */
export interface CodeValidationRequest {
  /** Unique validation request identifier */
  id: UUID;
  /** Project context */
  projectId: UUID;
  /** Files to validate */
  filePaths: string[];
  /** Validation rules to apply */
  ruleIds?: UUID[];
  /** Validation scope */
  scope: 'file' | 'module' | 'project' | 'changes_only';
  /** Phase context */
  phaseType?: PhaseType;
  /** Request options */
  options: {
    /** Include auto-fix suggestions */
    includeAutoFix: boolean;
    /** Maximum issues to report per file */
    maxIssuesPerFile: number;
    /** Include performance analysis */
    includePerformanceAnalysis: boolean;
  };
  /** Request timestamp */
  createdAt: string; // ISO 8601 format
}

/** Code validation result */
export interface CodeValidationResult {
  /** Validation request identifier */
  requestId: UUID;
  /** Overall validation status */
  overallStatus: QualityGateStatus;
  /** Validation results by file */
  fileResults: FileValidationResult[];
  /** Overall quality metrics */
  qualityMetrics: {
    /** Overall quality score (0-100) */
    overallScore: number;
    /** Architectural consistency score */
    architecturalConsistency: number;
    /** Code maintainability score */
    maintainability: number;
    /** Security score */
    security: number;
    /** Performance score */
    performance: number;
  };
  /** Summary statistics */
  summary: {
    /** Total files validated */
    totalFiles: number;
    /** Total issues found */
    totalIssues: number;
    /** Issues by severity */
    issuesBySeverity: Record<'error' | 'warning' | 'info', number>;
    /** Auto-fixable issues */
    autoFixableIssues: number;
  };
  /** Validation execution time */
  executionTimeMs: number;
  /** Validation completion timestamp */
  completedAt: string; // ISO 8601 format
}

/** File-level validation result */
export interface FileValidationResult {
  /** File path */
  filePath: string;
  /** File validation status */
  status: QualityGateStatus;
  /** Quality assessment for this file */
  qualityLevel: QualityAssessmentLevel;
  /** File-specific quality score */
  qualityScore: number;
  /** Validation issues found */
  issues: ValidationIssue[];
  /** Auto-fix suggestions */
  autoFixSuggestions: AutoFixSuggestion[];
  /** File metrics */
  metrics: {
    /** Lines of code */
    linesOfCode: number;
    /** Cyclomatic complexity */
    complexity: number;
    /** Code duplication percentage */
    duplication: number;
    /** Test coverage percentage */
    testCoverage: number;
  };
}

/** Validation issue */
export interface ValidationIssue {
  /** Unique issue identifier */
  id: UUID;
  /** Validation rule that triggered this issue */
  ruleId: UUID;
  /** Issue severity */
  severity: 'error' | 'warning' | 'info';
  /** Issue message */
  message: string;
  /** File location */
  location: {
    /** File path */
    filePath: string;
    /** Line number */
    line: number;
    /** Column number */
    column: number;
    /** End line number */
    endLine?: number;
    /** End column number */
    endColumn?: number;
  };
  /** Issue category */
  category: string;
  /** Suggested correction strategy */
  correctionStrategy: CorrectionStrategy;
  /** Whether issue can be auto-fixed */
  autoFixable: boolean;
  /** Issue context code */
  codeContext?: string;
}

/** Auto-fix suggestion */
export interface AutoFixSuggestion {
  /** Unique suggestion identifier */
  id: UUID;
  /** Related validation issue */
  issueId: UUID;
  /** Fix description */
  description: string;
  /** Fix confidence score (0-100) */
  confidence: number;
  /** Code changes */
  changes: CodeChange[];
  /** Whether fix is safe to apply automatically */
  safeAutoApply: boolean;
}

/** Code change for auto-fix */
export interface CodeChange {
  /** File path */
  filePath: string;
  /** Change type */
  type: 'replace' | 'insert' | 'delete';
  /** Start position */
  startPosition: {
    line: number;
    column: number;
  };
  /** End position (for replace/delete) */
  endPosition?: {
    line: number;
    column: number;
  };
  /** New content */
  newContent: string;
  /** Original content being replaced */
  originalContent?: string;
}

/** Test generation request */
export interface TestGenerationRequest {
  /** Unique request identifier */
  id: UUID;
  /** Project context */
  projectId: UUID;
  /** Source files to generate tests for */
  sourceFiles: string[];
  /** Test generation strategies */
  strategies: TestGenerationStrategy[];
  /** Test framework preferences */
  testFramework: string;
  /** Generation options */
  options: {
    /** Target test coverage percentage */
    targetCoverage: number;
    /** Include edge cases */
    includeEdgeCases: boolean;
    /** Include error scenarios */
    includeErrorScenarios: boolean;
    /** Include performance tests */
    includePerformanceTests: boolean;
  };
  /** Request timestamp */
  createdAt: string; // ISO 8601 format
}

/** Test generation result */
export interface TestGenerationResult {
  /** Request identifier */
  requestId: UUID;
  /** Generation status */
  status: 'completed' | 'partial' | 'failed';
  /** Generated test files */
  testFiles: GeneratedTestFile[];
  /** Test coverage analysis */
  coverageAnalysis: {
    /** Estimated coverage percentage */
    estimatedCoverage: number;
    /** Coverage by file */
    filesCoverage: Record<string, number>;
    /** Uncovered functions/methods */
    uncoveredElements: string[];
  };
  /** Generation statistics */
  statistics: {
    /** Total test cases generated */
    totalTestCases: number;
    /** Test cases by type */
    testCasesByType: Record<TestGenerationStrategy, number>;
    /** Generation time */
    generationTimeMs: number;
  };
  /** AI generation metadata */
  aiMetadata: {
    /** Tokens used for generation */
    tokensUsed: number;
    /** AI confidence score */
    confidence: number;
    /** Generation quality assessment */
    qualityAssessment: QualityAssessmentLevel;
  };
  /** Generation completion timestamp */
  completedAt: string; // ISO 8601 format
}

/** Generated test file */
export interface GeneratedTestFile {
  /** Test file path */
  filePath: string;
  /** Test file content */
  content: string;
  /** Source file being tested */
  sourceFile: string;
  /** Test strategies used */
  strategies: TestGenerationStrategy[];
  /** Test cases in this file */
  testCases: TestCase[];
  /** File-specific metadata */
  metadata: {
    /** Framework used */
    framework: string;
    /** Dependencies required */
    dependencies: string[];
    /** Setup/teardown requirements */
    setupRequirements: string[];
  };
}

/** Individual test case */
export interface TestCase {
  /** Test case name */
  name: string;
  /** Test case description */
  description: string;
  /** Test strategy */
  strategy: TestGenerationStrategy;
  /** Function/method being tested */
  targetFunction: string;
  /** Test scenario type */
  scenarioType: 'happy_path' | 'edge_case' | 'error_case' | 'performance' | 'integration';
  /** Expected outcome */
  expectedOutcome: string;
}

/** Quality gate configuration */
export interface QualityGate {
  /** Unique gate identifier */
  id: UUID;
  /** Gate name */
  name: string;
  /** Gate description */
  description: string;
  /** Phase this gate applies to */
  applicablePhases: PhaseType[];
  /** Quality conditions that must be met */
  conditions: QualityCondition[];
  /** Whether gate is enforced */
  enforced: boolean;
  /** Gate creation timestamp */
  createdAt: string; // ISO 8601 format
}

/** Quality condition */
export interface QualityCondition {
  /** Condition identifier */
  id: UUID;
  /** Condition name */
  name: string;
  /** Metric being evaluated */
  metric: string;
  /** Comparison operator */
  operator: 'gt' | 'gte' | 'lt' | 'lte' | 'eq' | 'neq';
  /** Threshold value */
  threshold: number;
  /** Condition weight in overall assessment */
  weight: number;
  /** Whether condition is required */
  required: boolean;
}

/** Quality assessment summary */
export interface QualityAssessment {
  /** Assessment identifier */
  id: UUID;
  /** Project identifier */
  projectId: UUID;
  /** Assessment timestamp */
  timestamp: string; // ISO 8601 format
  /** Overall quality level */
  overallQuality: QualityAssessmentLevel;
  /** Overall quality score (0-100) */
  overallScore: number;
  /** Quality metrics breakdown */
  metrics: {
    /** Architectural consistency */
    architecturalConsistency: number;
    /** Code maintainability */
    maintainability: number;
    /** Test coverage */
    testCoverage: number;
    /** Security compliance */
    security: number;
    /** Performance quality */
    performance: number;
    /** Documentation completeness */
    documentation: number;
  };
  /** Quality trends */
  trends: {
    /** Score change from previous assessment */
    scoreChange: number;
    /** Trend direction */
    direction: 'improving' | 'stable' | 'declining';
    /** Assessment frequency */
    assessmentInterval: string;
  };
  /** Improvement recommendations */
  recommendations: QualityRecommendation[];
}

/** Quality improvement recommendation */
export interface QualityRecommendation {
  /** Recommendation identifier */
  id: UUID;
  /** Recommendation priority */
  priority: 'high' | 'medium' | 'low';
  /** Recommendation category */
  category: string;
  /** Recommendation title */
  title: string;
  /** Detailed description */
  description: string;
  /** Estimated impact on quality score */
  estimatedImpact: number;
  /** Estimated effort required */
  estimatedEffort: 'low' | 'medium' | 'high';
  /** Specific actions to take */
  actionItems: string[];
  /** Related files or components */
  relatedFiles: string[];
}
```

## **3. API Endpoint Specification (OpenAPI `paths` block)**

```yaml
paths:
  /api/v1/quality/validation/rules:
    get:
      tags:
        - Quality Assurance
      summary: Get validation rules
      description: Retrieves configured validation rules with filtering options
      security:
        - localAuth: []
      parameters:
        - name: type
          in: query
          description: Filter by validation rule type
          required: false
          schema:
            type: string
            enum: [syntax, type_checking, linting, security, performance, architectural_consistency, dependency_validation, custom]
        - name: enabled
          in: query
          description: Filter by enabled status
          required: false
          schema:
            type: boolean
        - name: language
          in: query
          description: Filter by programming language
          required: false
          schema:
            type: string
        - name: severity
          in: query
          description: Filter by severity level
          required: false
          schema:
            type: string
            enum: [error, warning, info]
      responses:
        '200':
          description: Validation rules retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          rules:
                            type: array
                            items:
                              $ref: '#/components/schemas/ValidationRule'
                          totalCount:
                            type: integer

    post:
      tags:
        - Quality Assurance
      summary: Create validation rule
      description: Creates a new custom validation rule
      security:
        - localAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  minLength: 1
                  maxLength: 100
                description:
                  type: string
                  maxLength: 500
                type:
                  type: string
                  enum: [syntax, type_checking, linting, security, performance, architectural_consistency, dependency_validation, custom]
                enabled:
                  type: boolean
                  default: true
                severity:
                  type: string
                  enum: [error, warning, info]
                config:
                  type: object
                filePatterns:
                  type: array
                  items:
                    type: string
                languages:
                  type: array
                  items:
                    type: string
              required:
                - name
                - type
                - severity
                - filePatterns
                - languages
      responses:
        '201':
          description: Validation rule created successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/ValidationRule'

  /api/v1/quality/validation/rules/{ruleId}:
    put:
      tags:
        - Quality Assurance
      summary: Update validation rule
      description: Updates an existing validation rule
      security:
        - localAuth: []
      parameters:
        - name: ruleId
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  minLength: 1
                  maxLength: 100
                description:
                  type: string
                  maxLength: 500
                enabled:
                  type: boolean
                severity:
                  type: string
                  enum: [error, warning, info]
                config:
                  type: object
                filePatterns:
                  type: array
                  items:
                    type: string
                languages:
                  type: array
                  items:
                    type: string
      responses:
        '200':
          description: Validation rule updated successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/ValidationRule'
        '404':
          description: Validation rule not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

    delete:
      tags:
        - Quality Assurance
      summary: Delete validation rule
      description: Deletes a custom validation rule
      security:
        - localAuth: []
      parameters:
        - name: ruleId
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '200':
          description: Validation rule deleted successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '404':
          description: Validation rule not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

  /api/v1/quality/validation/validate:
    post:
      tags:
        - Quality Assurance
      summary: Validate code
      description: Performs comprehensive code validation using configured rules
      security:
        - localAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                projectId:
                  $ref: '#/components/schemas/UUID'
                filePaths:
                  type: array
                  items:
                    type: string
                  minItems: 1
                ruleIds:
                  type: array
                  items:
                    $ref: '#/components/schemas/UUID'
                scope:
                  type: string
                  enum: [file, module, project, changes_only]
                  default: file
                phaseType:
                  $ref: '#/components/schemas/PhaseType'
                options:
                  type: object
                  properties:
                    includeAutoFix:
                      type: boolean
                      default: true
                    maxIssuesPerFile:
                      type: integer
                      minimum: 1
                      default: 50
                    includePerformanceAnalysis:
                      type: boolean
                      default: false
                  required:
                    - includeAutoFix
                    - maxIssuesPerFile
                    - includePerformanceAnalysis
              required:
                - projectId
                - filePaths
                - scope
                - options
      responses:
        '200':
          description: Code validation completed successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/CodeValidationResult'
        '400':
          description: Invalid validation request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

  /api/v1/quality/validation/{requestId}/fixes:
    post:
      tags:
        - Quality Assurance
      summary: Apply auto-fixes
      description: Applies selected auto-fix suggestions from a validation result
      security:
        - localAuth: []
      parameters:
        - name: requestId
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                suggestionIds:
                  type: array
                  items:
                    $ref: '#/components/schemas/UUID'
                  minItems: 1
                applyOnlyIf:
                  type: object
                  properties:
                    minimumConfidence:
                      type: number
                      minimum: 0
                      maximum: 100
                    safeAutoApplyOnly:
                      type: boolean
                      default: true
                backup:
                  type: boolean
                  default: true
                  description: Create backup before applying fixes
              required:
                - suggestionIds
      responses:
        '200':
          description: Auto-fixes applied successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          appliedFixes:
                            type: array
                            items:
                              $ref: '#/components/schemas/UUID'
                          skippedFixes:
                            type: array
                            items:
                              type: object
                              properties:
                                suggestionId:
                                  $ref: '#/components/schemas/UUID'
                                reason:
                                  type: string
                          backupId:
                            $ref: '#/components/schemas/UUID'
                          modifiedFiles:
                            type: array
                            items:
                              type: string

  /api/v1/quality/tests/generate:
    post:
      tags:
        - Quality Assurance
      summary: Generate tests
      description: Generates comprehensive tests for specified source files using AI
      security:
        - localAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                projectId:
                  $ref: '#/components/schemas/UUID'
                sourceFiles:
                  type: array
                  items:
                    type: string
                  minItems: 1
                strategies:
                  type: array
                  items:
                    type: string
                    enum: [unit_tests, integration_tests, end_to_end_tests, api_tests, component_tests, performance_tests]
                  minItems: 1
                testFramework:
                  type: string
                options:
                  type: object
                  properties:
                    targetCoverage:
                      type: number
                      minimum: 0
                      maximum: 100
                      default: 80
                    includeEdgeCases:
                      type: boolean
                      default: true
                    includeErrorScenarios:
                      type: boolean
                      default: true
                    includePerformanceTests:
                      type: boolean
                      default: false
                  required:
                    - targetCoverage
                    - includeEdgeCases
                    - includeErrorScenarios
                    - includePerformanceTests
              required:
                - projectId
                - sourceFiles
                - strategies
                - testFramework
                - options
      responses:
        '200':
          description: Test generation completed successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/TestGenerationResult'
        '400':
          description: Invalid test generation request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

  /api/v1/quality/gates:
    get:
      tags:
        - Quality Assurance
      summary: Get quality gates
      description: Retrieves configured quality gates with optional phase filtering
      security:
        - localAuth: []
      parameters:
        - name: phase
          in: query
          description: Filter by applicable phase
          required: false
          schema:
            $ref: '#/components/schemas/PhaseType'
        - name: enforced
          in: query
          description: Filter by enforcement status
          required: false
          schema:
            type: boolean
      responses:
        '200':
          description: Quality gates retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          gates:
                            type: array
                            items:
                              $ref: '#/components/schemas/QualityGate'
                          totalCount:
                            type: integer

    post:
      tags:
        - Quality Assurance
      summary: Create quality gate
      description: Creates a new quality gate configuration
      security:
        - localAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  minLength: 1
                  maxLength: 100
                description:
                  type: string
                  maxLength: 500
                applicablePhases:
                  type: array
                  items:
                    $ref: '#/components/schemas/PhaseType'
                  minItems: 1
                conditions:
                  type: array
                  items:
                    $ref: '#/components/schemas/QualityCondition'
                  minItems: 1
                enforced:
                  type: boolean
                  default: true
              required:
                - name
                - applicablePhases
                - conditions
      responses:
        '201':
          description: Quality gate created successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/QualityGate'

  /api/v1/quality/gates/{gateId}/evaluate:
    post:
      tags:
        - Quality Assurance
      summary: Evaluate quality gate
      description: Evaluates a quality gate against current project metrics
      security:
        - localAuth: []
      parameters:
        - name: gateId
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                projectId:
                  $ref: '#/components/schemas/UUID'
                phaseType:
                  $ref: '#/components/schemas/PhaseType'
                metricsSnapshot:
                  type: object
                  description: Optional current metrics override
              required:
                - projectId
      responses:
        '200':
          description: Quality gate evaluation completed
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          gateId:
                            $ref: '#/components/schemas/UUID'
                          status:
                            type: string
                            enum: [passed, failed, warning, pending, skipped]
                          overallScore:
                            type: number
                            minimum: 0
                            maximum: 100
                          conditionResults:
                            type: array
                            items:
                              type: object
                              properties:
                                conditionId:
                                  $ref: '#/components/schemas/UUID'
                                status:
                                  type: string
                                  enum: [passed, failed, warning]
                                actualValue:
                                  type: number
                                threshold:
                                  type: number
                                impact:
                                  type: string
                          evaluationTimestamp:
                            type: string
                            format: date-time

  /api/v1/quality/assessment/{projectId}:
    get:
      tags:
        - Quality Assurance
      summary: Get project quality assessment
      description: Retrieves comprehensive quality assessment for a project
      security:
        - localAuth: []
      parameters:
        - name: projectId
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
        - name: includeTrends
          in: query
          description: Include historical trend analysis
          required: false
          schema:
            type: boolean
            default: true
        - name: includeRecommendations
          in: query
          description: Include improvement recommendations
          required: false
          schema:
            type: boolean
            default: true
      responses:
        '200':
          description: Quality assessment retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/QualityAssessment'
        '404':
          description: Project not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

    post:
      tags:
        - Quality Assurance
      summary: Generate quality assessment
      description: Generates a comprehensive quality assessment for a project
      security:
        - localAuth: []
      parameters:
        - name: projectId
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              properties:
                scope:
                  type: string
                  enum: [full, changes_only, specific_files]
                  default: full
                filePaths:
                  type: array
                  items:
                    type: string
                includeAiAnalysis:
                  type: boolean
                  default: true
                generateRecommendations:
                  type: boolean
                  default: true
      responses:
        '200':
          description: Quality assessment generated successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/QualityAssessment'

components:
  schemas:
    ValidationRule:
      type: object
      required:
        - id
        - name
        - description
        - type
        - enabled
        - severity
        - config
        - filePatterns
        - languages
        - createdAt
        - lastModified
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        name:
          type: string
        description:
          type: string
        type:
          type: string
          enum: [syntax, type_checking, linting, security, performance, architectural_consistency, dependency_validation, custom]
        enabled:
          type: boolean
        severity:
          type: string
          enum: [error, warning, info]
        config:
          type: object
        filePatterns:
          type: array
          items:
            type: string
        languages:
          type: array
          items:
            type: string
        createdAt:
          type: string
          format: date-time
        lastModified:
          type: string
          format: date-time

    CodeValidationResult:
      type: object
      required:
        - requestId
        - overallStatus
        - fileResults
        - qualityMetrics
        - summary
        - executionTimeMs
        - completedAt
      properties:
        requestId:
          $ref: '#/components/schemas/UUID'
        overallStatus:
          type: string
          enum: [passed, failed, warning, pending, skipped]
        fileResults:
          type: array
          items:
            $ref: '#/components/schemas/FileValidationResult'
        qualityMetrics:
          type: object
          properties:
            overallScore:
              type: number
            architecturalConsistency:
              type: number
            maintainability:
              type: number
            security:
              type: number
            performance:
              type: number
        summary:
          type: object
          properties:
            totalFiles:
              type: integer
            totalIssues:
              type: integer
            issuesBySeverity:
              type: object
              properties:
                error:
                  type: integer
                warning:
                  type: integer
                info:
                  type: integer
            autoFixableIssues:
              type: integer
        executionTimeMs:
          type: number
        completedAt:
          type: string
          format: date-time

    FileValidationResult:
      type: object
      required:
        - filePath
        - status
        - qualityLevel
        - qualityScore
        - issues
        - autoFixSuggestions
        - metrics
      properties:
        filePath:
          type: string
        status:
          type: string
          enum: [passed, failed, warning, pending, skipped]
        qualityLevel:
          type: string
          enum: [excellent, good, acceptable, needs_improvement, critical]
        qualityScore:
          type: number
        issues:
          type: array
          items:
            $ref: '#/components/schemas/ValidationIssue'
        autoFixSuggestions:
          type: array
          items:
            $ref: '#/components/schemas/AutoFixSuggestion'
        metrics:
          type: object
          properties:
            linesOfCode:
              type: integer
            complexity:
              type: number
            duplication:
              type: number
            testCoverage:
              type: number

    ValidationIssue:
      type: object
      required:
        - id
        - ruleId
        - severity
        - message
        - location
        - category
        - correctionStrategy
        - autoFixable
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        ruleId:
          $ref: '#/components/schemas/UUID'
        severity:
          type: string
          enum: [error, warning, info]
        message:
          type: string
        location:
          type: object
          properties:
            filePath:
              type: string
            line:
              type: integer
            column:
              type: integer
            endLine:
              type: integer
            endColumn:
              type: integer
        category:
          type: string
        correctionStrategy:
          type: string
          enum: [auto_fix, suggestion, manual_review, ignore]
        autoFixable:
          type: boolean
        codeContext:
          type: string

    AutoFixSuggestion:
      type: object
      required:
        - id
        - issueId
        - description
        - confidence
        - changes
        - safeAutoApply
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        issueId:
          $ref: '#/components/schemas/UUID'
        description:
          type: string
        confidence:
          type: number
          minimum: 0
          maximum: 100
        changes:
          type: array
          items:
            $ref: '#/components/schemas/CodeChange'
        safeAutoApply:
          type: boolean

    CodeChange:
      type: object
      required:
        - filePath
        - type
        - startPosition
        - newContent
      properties:
        filePath:
          type: string
        type:
          type: string
          enum: [replace, insert, delete]
        startPosition:
          type: object
          properties:
            line:
              type: integer
            column:
              type: integer
        endPosition:
          type: object
          properties:
            line:
              type: integer
            column:
              type: integer
        newContent:
          type: string
        originalContent:
          type: string

    TestGenerationResult:
      type: object
      required:
        - requestId
        - status
        - testFiles
        - coverageAnalysis
        - statistics
        - aiMetadata
        - completedAt
      properties:
        requestId:
          $ref: '#/components/schemas/UUID'
        status:
          type: string
          enum: [completed, partial, failed]
        testFiles:
          type: array
          items:
            $ref: '#/components/schemas/GeneratedTestFile'
        coverageAnalysis:
          type: object
          properties:
            estimatedCoverage:
              type: number
            filesCoverage:
              type: object
              additionalProperties:
                type: number
            uncoveredElements:
              type: array
              items:
                type: string
        statistics:
          type: object
          properties:
            totalTestCases:
              type: integer
            testCasesByType:
              type: object
              additionalProperties:
                type: integer
            generationTimeMs:
              type: number
        aiMetadata:
          type: object
          properties:
            tokensUsed:
              type: integer
            confidence:
              type: number
            qualityAssessment:
              type: string
              enum: [excellent, good, acceptable, needs_improvement, critical]
        completedAt:
          type: string
          format: date-time

    GeneratedTestFile:
      type: object
      required:
        - filePath
        - content
        - sourceFile
        - strategies
        - testCases
        - metadata
      properties:
        filePath:
          type: string
        content:
          type: string
        sourceFile:
          type: string
        strategies:
          type: array
          items:
            type: string
            enum: [unit_tests, integration_tests, end_to_end_tests, api_tests, component_tests, performance_tests]
        testCases:
          type: array
          items:
            $ref: '#/components/schemas/TestCase'
        metadata:
          type: object
          properties:
            framework:
              type: string
            dependencies:
              type: array
              items:
                type: string
            setupRequirements:
              type: array
              items:
                type: string

    TestCase:
      type: object
      required:
        - name
        - description
        - strategy
        - targetFunction
        - scenarioType
        - expectedOutcome
      properties:
        name:
          type: string
        description:
          type: string
        strategy:
          type: string
          enum: [unit_tests, integration_tests, end_to_end_tests, api_tests, component_tests, performance_tests]
        targetFunction:
          type: string
        scenarioType:
          type: string
          enum: [happy_path, edge_case, error_case, performance, integration]
        expectedOutcome:
          type: string

    QualityGate:
      type: object
      required:
        - id
        - name
        - description
        - applicablePhases
        - conditions
        - enforced
        - createdAt
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        name:
          type: string
        description:
          type: string
        applicablePhases:
          type: array
          items:
            $ref: '#/components/schemas/PhaseType'
        conditions:
          type: array
          items:
            $ref: '#/components/schemas/QualityCondition'
        enforced:
          type: boolean
        createdAt:
          type: string
          format: date-time

    QualityCondition:
      type: object
      required:
        - id
        - name
        - metric
        - operator
        - threshold
        - weight
        - required
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        name:
          type: string
        metric:
          type: string
        operator:
          type: string
          enum: [gt, gte, lt, lte, eq, neq]
        threshold:
          type: number
        weight:
          type: number
        required:
          type: boolean

    QualityAssessment:
      type: object
      required:
        - id
        - projectId
        - timestamp
        - overallQuality
        - overallScore
        - metrics
        - trends
        - recommendations
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        projectId:
          $ref: '#/components/schemas/UUID'
        timestamp:
          type: string
          format: date-time
        overallQuality:
          type: string
          enum: [excellent, good, acceptable, needs_improvement, critical]
        overallScore:
          type: number
          minimum: 0
          maximum: 100
        metrics:
          type: object
          properties:
            architecturalConsistency:
              type: number
            maintainability:
              type: number
            testCoverage:
              type: number
            security:
              type: number
            performance:
              type: number
            documentation:
              type: number
        trends:
          type: object
          properties:
            scoreChange:
              type: number
            direction:
              type: string
              enum: [improving, stable, declining]
            assessmentInterval:
              type: string
        recommendations:
          type: array
          items:
            $ref: '#/components/schemas/QualityRecommendation'

    QualityRecommendation:
      type: object
      required:
        - id
        - priority
        - category
        - title
        - description
        - estimatedImpact
        - estimatedEffort
        - actionItems
        - relatedFiles
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        priority:
          type: string
          enum: [high, medium, low]
        category:
          type: string
        title:
          type: string
        description:
          type: string
        estimatedImpact:
          type: number
        estimatedEffort:
          type: string
          enum: [low, medium, high]
        actionItems:
          type: array
          items:
            type: string
        relatedFiles:
          type: array
          items:
            type: string
```

## **4. Detailed Business Logic & Validation Rules**

| Rule ID | Rule Description | Implementation Location(s) & Notes |
|---------|------------------|-----------------------------------|
| **QA-01** | Validation rules must be applied based on file patterns and programming languages to ensure appropriate quality checks for different file types. | **Backend (Authoritative):** Validation service must match file extensions and paths against configured patterns before applying rules. Integration with File System Management Module for file type detection. |
| **QA-02** | Code validation results must achieve the >95% architectural consistency KPI defined in the charter, with automatic alerts triggered when consistency drops below threshold. | **Backend (Authoritative):** Quality assessment service must calculate architectural consistency and integrate with Logging & Monitoring Service to trigger alerts when KPI thresholds are breached. |
| **QA-03** | AI-generated auto-fix suggestions must be validated by the Claude Integration Service for correctness and safety before being marked as safe for automatic application. | **Backend (Authoritative):** Auto-fix service must call Claude Integration Service to validate suggested fixes and assess safety confidence scores before setting safeAutoApply flag. |
| **QA-04** | Test generation must coordinate with the File System Management Module to read source files and write generated test files while maintaining proper project structure. | **Backend (Authoritative):** Test generation service must use File System Management for file operations and ensure test files follow project conventions and directory structure. |
| **QA-05** | Quality gates must be evaluated against current project metrics from multiple modules including Context Management efficiency and phase progression status. | **Backend (Authoritative):** Quality gate evaluation must query Project Management Module for metrics, Context Management for efficiency data, and Multi-Phase Orchestrator for phase status. |
| **QA-06** | Quality assessments must integrate with the Configuration Management Module to respect project-specific quality preferences and thresholds. | **Backend (Authoritative):** Assessment service must query Configuration Management for project quality settings and apply custom thresholds and preferences in quality calculations. |
| **QA-07** | Validation operations must be logged to the Logging & Monitoring Service with performance metrics to support the <3 second context retrieval KPI monitoring. | **Backend (Authoritative):** All quality operations must log execution times, issue counts, and performance metrics to Logging Service for KPI tracking and system monitoring. |
| **QA-08** | Auto-fix applications must create backups through the File System Management Module before modifying files to enable rollback capabilities. | **Backend (Authoritative):** Auto-fix service must call File System Management backup functions before applying changes and track backup IDs for potential rollback operations. |
| **QA-09** | Test coverage analysis must integrate with existing project test frameworks and calculate coverage against the project's target coverage percentage from project configuration. | **Backend (Authoritative):** Coverage analysis must read project configuration for target coverage and integrate with project test frameworks to calculate actual vs. target coverage metrics. |
| **QA-10** | Quality recommendations must be generated using AI analysis through Claude Integration Service while respecting local-first privacy constraints. | **Backend (Authoritative):** Recommendation service must send anonymized code patterns to Claude Integration Service for analysis while ensuring no project-specific details are exposed externally. |

## **5. Developer Task Checklist**

### **Backend Tasks:**
- [ ] Create database migration script for quality assurance tables (`validation_rules`, `quality_gates`, `quality_conditions`, `validation_results`, `quality_assessments`, `test_generation_history`)
- [ ] Implement the `QualityAssuranceService` class with comprehensive validation pipeline orchestration and quality metric calculation
- [ ] Implement the `CodeValidationService` class for applying validation rules, detecting issues, and generating validation results
- [ ] Implement the `AutoFixService` class for generating and applying AI-powered code fixes with safety validation
- [ ] Implement the `TestGenerationService` class for AI-powered test generation with multiple strategy support
- [ ] Implement the `QualityGateService` class for defining, evaluating, and managing quality gates across development phases
- [ ] Implement the `QualityAssessmentService` class for comprehensive project quality analysis and recommendation generation
- [ ] Implement all validation rule management endpoints (`GET`, `POST /api/v1/quality/validation/rules`, `PUT`, `DELETE /api/v1/quality/validation/rules/{id}`)
- [ ] Implement code validation endpoint (`POST /api/v1/quality/validation/validate`) with comprehensive rule application and result generation
- [ ] Implement auto-fix management endpoints (`POST /api/v1/quality/validation/{requestId}/fixes`) with backup creation and selective fix application
- [ ] Implement test generation endpoint (`POST /api/v1/quality/tests/generate`) with AI integration and coverage analysis
- [ ] Implement quality gate management endpoints (`GET`, `POST /api/v1/quality/gates`, `POST /api/v1/quality/gates/{id}/evaluate`)
- [ ] Implement quality assessment endpoints (`GET`, `POST /api/v1/quality/assessment/{projectId}`) with trend analysis and recommendation generation
- [ ] Create `ValidationRuleRepository` class for storing and retrieving validation rule configurations with language and pattern matching
- [ ] Create `QualityGateRepository` class for managing quality gate definitions and evaluation history
- [ ] Create `QualityAssessmentRepository` class for storing quality metrics and historical trend data
- [ ] Implement integration with Claude Integration Service for AI-powered code analysis, test generation, and fix suggestions
- [ ] Implement integration with File System Management Module for reading source files, writing test files, and managing backups
- [ ] Implement integration with Configuration Management Module for quality settings, thresholds, and project-specific preferences
- [ ] Implement integration with Logging & Monitoring Service for tracking quality operations, performance metrics, and KPI monitoring
- [ ] Implement integration with Project Management Module for accessing project configurations and quality preferences
- [ ] Create built-in validation rules for common code quality issues (syntax, style, security, performance)
- [ ] Implement architectural consistency checking algorithms that analyze code patterns and project structure
- [ ] Create comprehensive unit tests for all service classes with mock implementations of dependent modules
- [ ] Create integration tests for quality workflows including validation, test generation, and quality assessment scenarios
- [ ] Implement performance optimizations for large codebase validation with parallel processing and caching
- [ ] Add quality monitoring background services for continuous assessment and alerting

### **Frontend Tasks:**
- [ ] Create `QualityAssuranceProvider` React context for accessing quality assurance functionality and managing quality state
- [ ] Implement `useQualityAssurance` hook for quality operations including validation, test generation, and assessment
- [ ] Create `ValidationRuleManager` component for configuring and managing validation rules with rule type filtering
- [ ] Implement `CodeValidationPanel` component for displaying validation results with issue grouping and filtering capabilities
- [ ] Create `AutoFixInterface` component for reviewing and applying auto-fix suggestions with confidence scoring
- [ ] Implement `TestGenerationWizard` component for configuring and initiating test generation with strategy selection
- [ ] Create `QualityGateManager` component for defining and managing quality gates with phase-specific configurations
- [ ] Implement `QualityDashboard` component for displaying comprehensive quality metrics, trends, and assessments
- [ ] Create `QualityRecommendations` component for displaying AI-generated improvement recommendations with action tracking
- [ ] Implement `ArchitecturalConsistencyTracker` component for monitoring and displaying architectural consistency metrics
- [ ] Create quality assurance service functions in the API client (`qualityService.ts`) for all QA endpoints
- [ ] Implement real-time validation capabilities with file watcher integration for live code quality feedback
- [ ] Create validation result visualization with syntax highlighting, issue markers, and code context display
- [ ] Implement test coverage visualization with file-level and function-level coverage reporting
- [ ] Add quality gate status indicators in project navigation and phase progression displays
- [ ] Create quality trend analysis charts showing historical quality metrics and improvement trajectories
- [ ] Implement batch validation operations for project-wide quality assessment with progress tracking
- [ ] Add integration with VS Code extension for inline quality feedback and quick fix suggestions
- [ ] Create quality export functionality for generating quality reports and sharing assessment results
- [ ] Implement quality comparison features for comparing quality metrics across different time periods or projects



========================================================================================


# Testing Framework Module - Technical Specification

## **1. Module Overview**

**Purpose:** The Testing Framework Module serves as the automated testing infrastructure for ReadyAI, providing comprehensive test generation, execution, and analysis capabilities. This module leverages AI-powered test generation to create unit tests, integration tests, and end-to-end tests for all generated code, ensuring that ReadyAI maintains its >95% architectural consistency KPI and supports quality-driven development. The module integrates seamlessly with the multi-phase development methodology to provide continuous testing throughout the development lifecycle.

**Dependencies & Interactions:** This module depends on the Code Generation Engine to identify generated code that requires testing and to access the context used during code generation. It interacts with the AI Provider Management module to leverage Claude Sonnet 4 for intelligent test generation based on code analysis and project context. The module relies on the File System Management module for reading source code files, writing generated test files, and managing test artifacts. It integrates with the Logging & Monitoring Service to track test execution metrics, coverage statistics, and quality assurance KPIs. The module also interacts with the Configuration Management Module to obtain testing preferences, coverage targets, and test framework configurations. Additionally, it coordinates with the Multi-Phase Development Orchestrator during Phase 5 (Test Generation) and Phase 4 (Validation & Correction) to ensure proper test coverage validation.

## **2. Module-Specific Type Additions (`types.testing.ts`)**

```typescript
/**
 * Testing Framework Module Types
 * Extends foundational types with testing-specific interfaces
 */

/** Test types supported by the framework */
export type TestType = 'unit' | 'integration' | 'e2e' | 'performance' | 'security';

/** Test execution status */
export type TestExecutionStatus = 'pending' | 'running' | 'passed' | 'failed' | 'skipped' | 'timeout';

/** Test frameworks supported */
export type TestFramework = 'jest' | 'mocha' | 'vitest' | 'cypress' | 'playwright' | 'junit' | 'pytest';

/** Test generation strategies */
export type TestGenerationStrategy = 'ai_powered' | 'template_based' | 'property_based' | 'mutation_based';

/** Coverage types */
export type CoverageType = 'line' | 'branch' | 'function' | 'statement';

/** Test case definition */
export interface TestCase {
  /** Unique test case identifier */
  id: UUID;
  /** Test case name */
  name: string;
  /** Test case description */
  description?: string;
  /** Test type */
  type: TestType;
  /** Target file or module being tested */
  targetFile: string;
  /** Test file path */
  testFile: string;
  /** Test framework used */
  framework: TestFramework;
  /** Test code content */
  content: string;
  /** Test case tags */
  tags: string[];
  /** Expected test duration in milliseconds */
  expectedDuration?: number;
  /** Test case priority */
  priority: 'low' | 'medium' | 'high' | 'critical';
  /** Test case creation timestamp */
  createdAt: string; // ISO 8601 format
  /** Test case last updated timestamp */
  updatedAt: string; // ISO 8601 format
  /** Project context */
  projectId: UUID;
  /** Phase context when test was generated */
  phaseId?: PhaseType;
  /** Generation metadata */
  generationMetadata?: {
    strategy: TestGenerationStrategy;
    aiProvider?: AIProviderType;
    generationTime?: number;
    confidence?: number;
  };
}

/** Test suite grouping multiple test cases */
export interface TestSuite {
  /** Unique test suite identifier */
  id: UUID;
  /** Test suite name */
  name: string;
  /** Test suite description */
  description?: string;
  /** Project identifier */
  projectId: UUID;
  /** Test cases in this suite */
  testCases: UUID[];
  /** Suite configuration */
  configuration: TestSuiteConfiguration;
  /** Suite creation timestamp */
  createdAt: string; // ISO 8601 format
  /** Suite last execution timestamp */
  lastExecuted?: string; // ISO 8601 format
  /** Suite statistics */
  statistics: {
    totalTests: number;
    passedTests: number;
    failedTests: number;
    skippedTests: number;
    avgExecutionTime: number;
    successRate: number;
  };
}

/** Test suite configuration */
export interface TestSuiteConfiguration {
  /** Test framework to use */
  framework: TestFramework;
  /** Test timeout in milliseconds */
  timeout: number;
  /** Retry count for failed tests */
  retryCount: number;
  /** Parallel execution settings */
  parallel: {
    enabled: boolean;
    maxWorkers?: number;
  };
  /** Coverage requirements */
  coverage: {
    enabled: boolean;
    threshold: {
      line: number;
      branch: number;
      function: number;
      statement: number;
    };
  };
  /** Environment variables for tests */
  environment?: Record<string, string>;
  /** Setup and teardown hooks */
  hooks: {
    beforeAll?: string;
    afterAll?: string;
    beforeEach?: string;
    afterEach?: string;
  };
}

/** Test execution result */
export interface TestExecutionResult {
  /** Unique execution result identifier */
  id: UUID;
  /** Test case or suite identifier */
  testId: UUID;
  /** Test execution status */
  status: TestExecutionStatus;
  /** Start time of execution */
  startTime: string; // ISO 8601 format
  /** End time of execution */
  endTime?: string; // ISO 8601 format
  /** Execution duration in milliseconds */
  duration: number;
  /** Test output/logs */
  output: string;
  /** Error message if failed */
  errorMessage?: string;
  /** Stack trace if failed */
  stackTrace?: string;
  /** Coverage data */
  coverage?: TestCoverage;
  /** Performance metrics */
  performance?: {
    memoryUsage: number;
    cpuUsage: number;
    assertionsCount: number;
  };
  /** Test execution metadata */
  metadata: {
    executor: string;
    environment: string;
    framework: TestFramework;
    retryAttempt: number;
  };
}

/** Code coverage information */
export interface TestCoverage {
  /** Coverage identifier */
  id: UUID;
  /** Associated test execution */
  testExecutionId: UUID;
  /** File path being covered */
  filePath: string;
  /** Project identifier */
  projectId: UUID;
  /** Coverage by type */
  coverage: {
    line: CoverageMetric;
    branch: CoverageMetric;
    function: CoverageMetric;
    statement: CoverageMetric;
  };
  /** Detailed coverage map */
  coverageMap: {
    lines: Record<number, number>; // line number -> hit count
    branches: Record<string, boolean>; // branch id -> covered
    functions: Record<string, number>; // function name -> hit count
  };
  /** Coverage timestamp */
  timestamp: string; // ISO 8601 format
}

/** Coverage metric details */
export interface CoverageMetric {
  /** Total items (lines, branches, functions, statements) */
  total: number;
  /** Covered items */
  covered: number;
  /** Coverage percentage */
  percentage: number;
  /** Uncovered items details */
  uncovered: Array<{
    line?: number;
    range?: [number, number];
    reason?: string;
  }>;
}

/** Test generation request */
export interface TestGenerationRequest {
  /** Unique generation request identifier */
  id: UUID;
  /** Project identifier */
  projectId: UUID;
  /** Target files to generate tests for */
  targetFiles: string[];
  /** Test generation strategy */
  strategy: TestGenerationStrategy;
  /** Test type to generate */
  testType: TestType;
  /** Preferred test framework */
  framework: TestFramework;
  /** Generation configuration */
  configuration: {
    coverageTarget: number;
    includeEdgeCases: boolean;
    includePerformanceTests: boolean;
    mockExternalDependencies: boolean;
    generateDataFixtures: boolean;
  };
  /** AI generation settings */
  aiSettings?: {
    provider: AIProviderType;
    extendedThinking: boolean;
    contextDepth: 'minimal' | 'standard' | 'comprehensive';
  };
  /** Request status */
  status: 'pending' | 'in_progress' | 'completed' | 'failed';
  /** Generated test cases */
  generatedTests: UUID[];
  /** Generation timestamp */
  createdAt: string; // ISO 8601 format
  /** Completion timestamp */
  completedAt?: string; // ISO 8601 format
  /** Generation result summary */
  result?: {
    testsGenerated: number;
    estimatedCoverage: number;
    generationTime: number;
    issues: string[];
  };
}

/** Test quality metrics */
export interface TestQualityMetrics {
  /** Metrics identifier */
  id: UUID;
  /** Project identifier */
  projectId: UUID;
  /** Metrics timestamp */
  timestamp: string; // ISO 8601 format
  /** Overall test suite health */
  overallHealth: 'excellent' | 'good' | 'fair' | 'poor';
  /** Test coverage metrics */
  coverage: {
    overall: number;
    byType: Record<CoverageType, number>;
    byModule: Record<string, number>;
    trend: 'improving' | 'stable' | 'declining';
  };
  /** Test reliability metrics */
  reliability: {
    successRate: number;
    flakinessScore: number;
    avgExecutionTime: number;
    failureRate: number;
  };
  /** Test maintenance metrics */
  maintenance: {
    testDebt: number; // percentage of outdated tests
    duplicateTests: number;
    unusedTests: number;
    testComplexity: number;
  };
  /** Quality recommendations */
  recommendations: Array<{
    type: 'coverage' | 'reliability' | 'performance' | 'maintenance';
    priority: 'low' | 'medium' | 'high';
    description: string;
    actionItems: string[];
  }>;
}

/** Test execution batch for running multiple tests */
export interface TestExecutionBatch {
  /** Batch identifier */
  id: UUID;
  /** Batch name */
  name: string;
  /** Project identifier */
  projectId: UUID;
  /** Test suites to execute */
  testSuites: UUID[];
  /** Individual test cases to execute */
  testCases: UUID[];
  /** Batch execution configuration */
  configuration: {
    parallel: boolean;
    maxWorkers: number;
    timeout: number;
    stopOnFailure: boolean;
    retryFailedTests: boolean;
    generateCoverage: boolean;
  };
  /** Batch execution status */
  status: 'pending' | 'running' | 'completed' | 'failed' | 'cancelled';
  /** Execution start time */
  startTime?: string; // ISO 8601 format
  /** Execution end time */
  endTime?: string; // ISO 8601 format
  /** Execution results */
  results: UUID[]; // TestExecutionResult IDs
  /** Batch summary */
  summary?: {
    totalTests: number;
    passedTests: number;
    failedTests: number;
    skippedTests: number;
    totalDuration: number;
    overallSuccessRate: number;
    coverageAchieved: number;
  };
}

/** Test automation configuration */
export interface TestAutomationConfig {
  /** Configuration identifier */
  id: UUID;
  /** Project identifier */
  projectId: UUID;
  /** Automation triggers */
  triggers: {
    onCodeGeneration: boolean;
    onFileChange: boolean;
    onPhaseCompletion: boolean;
    scheduled: boolean;
    scheduleCron?: string;
  };
  /** Automation rules */
  rules: {
    minCoverageThreshold: number;
    autoFixFailingTests: boolean;
    autoGenerateForNewCode: boolean;
    autoUpdateOutdatedTests: boolean;
  };
  /** Notification settings */
  notifications: {
    onTestFailure: boolean;
    onCoverageDecrease: boolean;
    onQualityRegression: boolean;
    channels: Array<'log' | 'email' | 'webhook'>;
  };
  /** Configuration status */
  enabled: boolean;
  /** Configuration timestamps */
  createdAt: string; // ISO 8601 format
  updatedAt: string; // ISO 8601 format
}
```

## **3. API Endpoint Specification (OpenAPI `paths` block)**

```yaml
paths:
  /api/v1/testing/generate:
    post:
      tags:
        - Testing
      summary: Generate tests for code
      description: Generates automated tests for specified code files using AI-powered analysis and generation strategies. Integrates with Code Generation Engine and AI Provider Management for intelligent test creation.
      security:
        - localAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                projectId:
                  $ref: '#/components/schemas/UUID'
                targetFiles:
                  type: array
                  items:
                    type: string
                  minItems: 1
                strategy:
                  type: string
                  enum: [ai_powered, template_based, property_based, mutation_based]
                  default: ai_powered
                testType:
                  type: string
                  enum: [unit, integration, e2e, performance, security]
                  default: unit
                framework:
                  type: string
                  enum: [jest, mocha, vitest, cypress, playwright, junit, pytest]
                configuration:
                  type: object
                  properties:
                    coverageTarget:
                      type: number
                      minimum: 0
                      maximum: 100
                      default: 80
                    includeEdgeCases:
                      type: boolean
                      default: true
                    includePerformanceTests:
                      type: boolean
                      default: false
                    mockExternalDependencies:
                      type: boolean
                      default: true
                    generateDataFixtures:
                      type: boolean
                      default: true
                aiSettings:
                  type: object
                  properties:
                    provider:
                      $ref: '#/components/schemas/AIProviderType'
                    extendedThinking:
                      type: boolean
                      default: true
                    contextDepth:
                      type: string
                      enum: [minimal, standard, comprehensive]
                      default: standard
              required:
                - projectId
                - targetFiles
      responses:
        '201':
          description: Test generation request created successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/TestGenerationRequest'
        '400':
          description: Invalid generation request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

  /api/v1/testing/generate/{requestId}:
    get:
      tags:
        - Testing
      summary: Get test generation status
      description: Retrieves the status and results of a test generation request
      security:
        - localAuth: []
      parameters:
        - name: requestId
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '200':
          description: Test generation request retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/TestGenerationRequest'
        '404':
          description: Generation request not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

  /api/v1/testing/suites:
    get:
      tags:
        - Testing
      summary: List test suites
      description: Retrieves test suites for a project with filtering options
      security:
        - localAuth: []
      parameters:
        - name: projectId
          in: query
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
        - name: framework
          in: query
          description: Filter by test framework
          required: false
          schema:
            type: string
            enum: [jest, mocha, vitest, cypress, playwright, junit, pytest]
        - name: includeStatistics
          in: query
          description: Include suite statistics
          required: false
          schema:
            type: boolean
            default: true
      responses:
        '200':
          description: Test suites retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          suites:
                            type: array
                            items:
                              $ref: '#/components/schemas/TestSuite'
                          totalCount:
                            type: integer

    post:
      tags:
        - Testing
      summary: Create test suite
      description: Creates a new test suite with specified configuration
      security:
        - localAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  minLength: 1
                  maxLength: 200
                description:
                  type: string
                  maxLength: 1000
                projectId:
                  $ref: '#/components/schemas/UUID'
                configuration:
                  $ref: '#/components/schemas/TestSuiteConfiguration'
                testCases:
                  type: array
                  items:
                    $ref: '#/components/schemas/UUID'
              required:
                - name
                - projectId
                - configuration
      responses:
        '201':
          description: Test suite created successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/TestSuite'

  /api/v1/testing/suites/{suiteId}:
    get:
      tags:
        - Testing
      summary: Get test suite details
      description: Retrieves detailed information about a specific test suite
      security:
        - localAuth: []
      parameters:
        - name: suiteId
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '200':
          description: Test suite retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/TestSuite'
        '404':
          description: Test suite not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

    put:
      tags:
        - Testing
      summary: Update test suite
      description: Updates an existing test suite configuration and test cases
      security:
        - localAuth: []
      parameters:
        - name: suiteId
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  minLength: 1
                  maxLength: 200
                description:
                  type: string
                  maxLength: 1000
                configuration:
                  $ref: '#/components/schemas/TestSuiteConfiguration'
                testCases:
                  type: array
                  items:
                    $ref: '#/components/schemas/UUID'
      responses:
        '200':
          description: Test suite updated successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/TestSuite'

    delete:
      tags:
        - Testing
      summary: Delete test suite
      description: Deletes a test suite and optionally its associated test cases
      security:
        - localAuth: []
      parameters:
        - name: suiteId
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
        - name: deleteTests
          in: query
          description: Whether to delete associated test cases
          required: false
          schema:
            type: boolean
            default: false
      responses:
        '200':
          description: Test suite deleted successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '404':
          description: Test suite not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

  /api/v1/testing/cases:
    get:
      tags:
        - Testing
      summary: List test cases
      description: Retrieves test cases with filtering and pagination
      security:
        - localAuth: []
      parameters:
        - name: projectId
          in: query
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
        - name: type
          in: query
          description: Filter by test type
          required: false
          schema:
            type: string
            enum: [unit, integration, e2e, performance, security]
        - name: framework
          in: query
          description: Filter by test framework
          required: false
          schema:
            type: string
            enum: [jest, mocha, vitest, cypress, playwright, junit, pytest]
        - name: targetFile
          in: query
          description: Filter by target file
          required: false
          schema:
            type: string
        - name: priority
          in: query
          description: Filter by priority
          required: false
          schema:
            type: string
            enum: [low, medium, high, critical]
        - name: limit
          in: query
          description: Maximum number of results
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 500
            default: 100
        - name: offset
          in: query
          description: Pagination offset
          required: false
          schema:
            type: integer
            minimum: 0
            default: 0
      responses:
        '200':
          description: Test cases retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          testCases:
                            type: array
                            items:
                              $ref: '#/components/schemas/TestCase'
                          totalCount:
                            type: integer
                          hasMore:
                            type: boolean

    post:
      tags:
        - Testing
      summary: Create test case
      description: Creates a new individual test case
      security:
        - localAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  minLength: 1
                  maxLength: 200
                description:
                  type: string
                  maxLength: 1000
                type:
                  type: string
                  enum: [unit, integration, e2e, performance, security]
                targetFile:
                  type: string
                  minLength: 1
                testFile:
                  type: string
                  minLength: 1
                framework:
                  type: string
                  enum: [jest, mocha, vitest, cypress, playwright, junit, pytest]
                content:
                  type: string
                  minLength: 1
                tags:
                  type: array
                  items:
                    type: string
                expectedDuration:
                  type: integer
                  minimum: 0
                priority:
                  type: string
                  enum: [low, medium, high, critical]
                  default: medium
                projectId:
                  $ref: '#/components/schemas/UUID'
                phaseId:
                  $ref: '#/components/schemas/PhaseType'
              required:
                - name
                - type
                - targetFile
                - testFile
                - framework
                - content
                - projectId
      responses:
        '201':
          description: Test case created successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/TestCase'

  /api/v1/testing/cases/{caseId}:
    get:
      tags:
        - Testing
      summary: Get test case details
      description: Retrieves detailed information about a specific test case
      security:
        - localAuth: []
      parameters:
        - name: caseId
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '200':
          description: Test case retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/TestCase'
        '404':
          description: Test case not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

    put:
      tags:
        - Testing
      summary: Update test case
      description: Updates an existing test case
      security:
        - localAuth: []
      parameters:
        - name: caseId
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  minLength: 1
                  maxLength: 200
                description:
                  type: string
                  maxLength: 1000
                content:
                  type: string
                  minLength: 1
                tags:
                  type: array
                  items:
                    type: string
                expectedDuration:
                  type: integer
                  minimum: 0
                priority:
                  type: string
                  enum: [low, medium, high, critical]
      responses:
        '200':
          description: Test case updated successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/TestCase'

    delete:
      tags:
        - Testing
      summary: Delete test case
      description: Deletes a test case and its associated test file
      security:
        - localAuth: []
      parameters:
        - name: caseId
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
        - name: deleteFile
          in: query
          description: Whether to delete the associated test file
          required: false
          schema:
            type: boolean
            default: true
      responses:
        '200':
          description: Test case deleted successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '404':
          description: Test case not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

  /api/v1/testing/execute:
    post:
      tags:
        - Testing
      summary: Execute tests
      description: Executes specified test suites or individual test cases with configurable options
      security:
        - localAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  minLength: 1
                  maxLength: 200
                projectId:
                  $ref: '#/components/schemas/UUID'
                testSuites:
                  type: array
                  items:
                    $ref: '#/components/schemas/UUID'
                testCases:
                  type: array
                  items:
                    $ref: '#/components/schemas/UUID'
                configuration:
                  type: object
                  properties:
                    parallel:
                      type: boolean
                      default: true
                    maxWorkers:
                      type: integer
                      minimum: 1
                      maximum: 10
                      default: 4
                    timeout:
                      type: integer
                      minimum: 1000
                      default: 30000
                    stopOnFailure:
                      type: boolean
                      default: false
                    retryFailedTests:
                      type: boolean
                      default: false
                    generateCoverage:
                      type: boolean
                      default: true
              required:
                - projectId
      responses:
        '201':
          description: Test execution batch created successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/TestExecutionBatch'
        '400':
          description: Invalid execution request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

  /api/v1/testing/execute/{batchId}:
    get:
      tags:
        - Testing
      summary: Get test execution status
      description: Retrieves the status and results of a test execution batch
      security:
        - localAuth: []
      parameters:
        - name: batchId
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
        - name: includeResults
          in: query
          description: Include detailed execution results
          required: false
          schema:
            type: boolean
            default: true
      responses:
        '200':
          description: Test execution batch retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/TestExecutionBatch'
        '404':
          description: Execution batch not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

    delete:
      tags:
        - Testing
      summary: Cancel test execution
      description: Cancels a running test execution batch
      security:
        - localAuth: []
      parameters:
        - name: batchId
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '200':
          description: Test execution cancelled successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '400':
          description: Cannot cancel execution (not running)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

  /api/v1/testing/results/{resultId}:
    get:
      tags:
        - Testing
      summary: Get test execution result
      description: Retrieves detailed test execution result information
      security:
        - localAuth: []
      parameters:
        - name: resultId
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '200':
          description: Test execution result retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/TestExecutionResult'
        '404':
          description: Execution result not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

  /api/v1/testing/coverage:
    get:
      tags:
        - Testing
      summary: Get coverage reports
      description: Retrieves code coverage reports for a project with filtering options
      security:
        - localAuth: []
      parameters:
        - name: projectId
          in: query
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
        - name: filePath
          in: query
          description: Filter by specific file path
          required: false
          schema:
            type: string
        - name: startDate
          in: query
          description: Start date for coverage reports
          required: false
          schema:
            type: string
            format: date
        - name: endDate
          in: query
          description: End date for coverage reports
          required: false
          schema:
            type: string
            format: date
        - name: aggregated
          in: query
          description: Return aggregated coverage data
          required: false
          schema:
            type: boolean
            default: false
      responses:
        '200':
          description: Coverage reports retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          coverageReports:
                            type: array
                            items:
                              $ref: '#/components/schemas/TestCoverage'
                          aggregatedCoverage:
                            type: object
                            properties:
                              overallCoverage:
                                type: number
                              coverageByType:
                                type: object
                                additionalProperties:
                                  type: number
                              coverageByFile:
                                type: object
                                additionalProperties:
                                  type: number

  /api/v1/testing/quality:
    get:
      tags:
        - Testing
      summary: Get test quality metrics
      description: Retrieves comprehensive test quality metrics and recommendations for a project
      security:
        - localAuth: []
      parameters:
        - name: projectId
          in: query
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
        - name: includeRecommendations
          in: query
          description: Include quality improvement recommendations
          required: false
          schema:
            type: boolean
            default: true
      responses:
        '200':
          description: Test quality metrics retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/TestQualityMetrics'

  /api/v1/testing/automation:
    get:
      tags:
        - Testing
      summary: Get test automation configuration
      description: Retrieves test automation settings for a project
      security:
        - localAuth: []
      parameters:
        - name: projectId
          in: query
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '200':
          description: Test automation configuration retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/TestAutomationConfig'

    put:
      tags:
        - Testing
      summary: Update test automation configuration
      description: Updates test automation settings for a project
      security:
        - localAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                projectId:
                  $ref: '#/components/schemas/UUID'
                triggers:
                  type: object
                  properties:
                    onCodeGeneration:
                      type: boolean
                    onFileChange:
                      type: boolean
                    onPhaseCompletion:
                      type: boolean
                    scheduled:
                      type: boolean
                    scheduleCron:
                      type: string
                rules:
                  type: object
                  properties:
                    minCoverageThreshold:
                      type: number
                      minimum: 0
                      maximum: 100
                    autoFixFailingTests:
                      type: boolean
                    autoGenerateForNewCode:
                      type: boolean
                    autoUpdateOutdatedTests:
                      type: boolean
                notifications:
                  type: object
                  properties:
                    onTestFailure:
                      type: boolean
                    onCoverageDecrease:
                      type: boolean
                    onQualityRegression:
                      type: boolean
                    channels:
                      type: array
                      items:
                        type: string
                        enum: [log, email, webhook]
                enabled:
                  type: boolean
              required:
                - projectId
      responses:
        '200':
          description: Test automation configuration updated successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/TestAutomationConfig'

components:
  schemas:
    TestCase:
      type: object
      required:
        - id
        - name
        - type
        - targetFile
        - testFile
        - framework
        - content
        - tags
        - priority
        - createdAt
        - updatedAt
        - projectId
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        name:
          type: string
        description:
          type: string
        type:
          type: string
          enum: [unit, integration, e2e, performance, security]
        targetFile:
          type: string
        testFile:
          type: string
        framework:
          type: string
          enum: [jest, mocha, vitest, cypress, playwright, junit, pytest]
        content:
          type: string
        tags:
          type: array
          items:
            type: string
        expectedDuration:
          type: integer
        priority:
          type: string
          enum: [low, medium, high, critical]
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
        projectId:
          $ref: '#/components/schemas/UUID'
        phaseId:
          $ref: '#/components/schemas/PhaseType'
        generationMetadata:
          type: object
          properties:
            strategy:
              type: string
              enum: [ai_powered, template_based, property_based, mutation_based]
            aiProvider:
              $ref: '#/components/schemas/AIProviderType'
            generationTime:
              type: number
            confidence:
              type: number

    TestSuite:
      type: object
      required:
        - id
        - name
        - projectId
        - testCases
        - configuration
        - createdAt
        - statistics
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        name:
          type: string
        description:
          type: string
        projectId:
          $ref: '#/components/schemas/UUID'
        testCases:
          type: array
          items:
            $ref: '#/components/schemas/UUID'
        configuration:
          $ref: '#/components/schemas/TestSuiteConfiguration'
        createdAt:
          type: string
          format: date-time
        lastExecuted:
          type: string
          format: date-time
        statistics:
          type: object
          properties:
            totalTests:
              type: integer
            passedTests:
              type: integer
            failedTests:
              type: integer
            skippedTests:
              type: integer
            avgExecutionTime:
              type: number
            successRate:
              type: number

    TestSuiteConfiguration:
      type: object
      required:
        - framework
        - timeout
        - retryCount
        - parallel
        - coverage
        - hooks
      properties:
        framework:
          type: string
          enum: [jest, mocha, vitest, cypress, playwright, junit, pytest]
        timeout:
          type: integer
        retryCount:
          type: integer
        parallel:
          type: object
          properties:
            enabled:
              type: boolean
            maxWorkers:
              type: integer
        coverage:
          type: object
          properties:
            enabled:
              type: boolean
            threshold:
              type: object
              properties:
                line:
                  type: number
                branch:
                  type: number
                function:
                  type: number
                statement:
                  type: number
        environment:
          type: object
          additionalProperties:
            type: string
        hooks:
          type: object
          properties:
            beforeAll:
              type: string
            afterAll:
              type: string
            beforeEach:
              type: string
            afterEach:
              type: string

    TestGenerationRequest:
      type: object
      required:
        - id
        - projectId
        - targetFiles
        - strategy
        - testType
        - framework
        - configuration
        - status
        - generatedTests
        - createdAt
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        projectId:
          $ref: '#/components/schemas/UUID'
        targetFiles:
          type: array
          items:
            type: string
        strategy:
          type: string
          enum: [ai_powered, template_based, property_based, mutation_based]
        testType:
          type: string
          enum: [unit, integration, e2e, performance, security]
        framework:
          type: string
          enum: [jest, mocha, vitest, cypress, playwright, junit, pytest]
        configuration:
          type: object
          properties:
            coverageTarget:
              type: number
            includeEdgeCases:
              type: boolean
            includePerformanceTests:
              type: boolean
            mockExternalDependencies:
              type: boolean
            generateDataFixtures:
              type: boolean
        aiSettings:
          type: object
          properties:
            provider:
              $ref: '#/components/schemas/AIProviderType'
            extendedThinking:
              type: boolean
            contextDepth:
              type: string
              enum: [minimal, standard, comprehensive]
        status:
          type: string
          enum: [pending, in_progress, completed, failed]
        generatedTests:
          type: array
          items:
            $ref: '#/components/schemas/UUID'
        createdAt:
          type: string
          format: date-time
        completedAt:
          type: string
          format: date-time
        result:
          type: object
          properties:
            testsGenerated:
              type: integer
            estimatedCoverage:
              type: number
            generationTime:
              type: number
            issues:
              type: array
              items:
                type: string

    TestExecutionResult:
      type: object
      required:
        - id
        - testId
        - status
        - startTime
        - duration
        - output
        - metadata
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        testId:
          $ref: '#/components/schemas/UUID'
        status:
          type: string
          enum: [pending, running, passed, failed, skipped, timeout]
        startTime:
          type: string
          format: date-time
        endTime:
          type: string
          format: date-time
        duration:
          type: number
        output:
          type: string
        errorMessage:
          type: string
        stackTrace:
          type: string
        coverage:
          $ref: '#/components/schemas/TestCoverage'
        performance:
          type: object
          properties:
            memoryUsage:
              type: number
            cpuUsage:
              type: number
            assertionsCount:
              type: integer
        metadata:
          type: object
          properties:
            executor:
              type: string
            environment:
              type: string
            framework:
              type: string
              enum: [jest, mocha, vitest, cypress, playwright, junit, pytest]
            retryAttempt:
              type: integer

    TestCoverage:
      type: object
      required:
        - id
        - testExecutionId
        - filePath
        - projectId
        - coverage
        - coverageMap
        - timestamp
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        testExecutionId:
          $ref: '#/components/schemas/UUID'
        filePath:
          type: string
        projectId:
          $ref: '#/components/schemas/UUID'
        coverage:
          type: object
          properties:
            line:
              $ref: '#/components/schemas/CoverageMetric'
            branch:
              $ref: '#/components/schemas/CoverageMetric'
            function:
              $ref: '#/components/schemas/CoverageMetric'
            statement:
              $ref: '#/components/schemas/CoverageMetric'
        coverageMap:
          type: object
          properties:
            lines:
              type: object
              additionalProperties:
                type: integer
            branches:
              type: object
              additionalProperties:
                type: boolean
            functions:
              type: object
              additionalProperties:
                type: integer
        timestamp:
          type: string
          format: date-time

    CoverageMetric:
      type: object
      required:
        - total
        - covered
        - percentage
        - uncovered
      properties:
        total:
          type: integer
        covered:
          type: integer
        percentage:
          type: number
        uncovered:
          type: array
          items:
            type: object
            properties:
              line:
                type: integer
              range:
                type: array
                items:
                  type: integer
                minItems: 2
                maxItems: 2
              reason:
                type: string

    TestExecutionBatch:
      type: object
      required:
        - id
        - name
        - projectId
        - testSuites
        - testCases
        - configuration
        - status
        - results
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        name:
          type: string
        projectId:
          $ref: '#/components/schemas/UUID'
        testSuites:
          type: array
          items:
            $ref: '#/components/schemas/UUID'
        testCases:
          type: array
          items:
            $ref: '#/components/schemas/UUID'
        configuration:
          type: object
          properties:
            parallel:
              type: boolean
            maxWorkers:
              type: integer
            timeout:
              type: integer
            stopOnFailure:
              type: boolean
            retryFailedTests:
              type: boolean
            generateCoverage:
              type: boolean
        status:
          type: string
          enum: [pending, running, completed, failed, cancelled]
        startTime:
          type: string
          format: date-time
        endTime:
          type: string
          format: date-time
        results:
          type: array
          items:
            $ref: '#/components/schemas/UUID'
        summary:
          type: object
          properties:
            totalTests:
              type: integer
            passedTests:
              type: integer
            failedTests:
              type: integer
            skippedTests:
              type: integer
            totalDuration:
              type: number
            overallSuccessRate:
              type: number
            coverageAchieved:
              type: number

    TestQualityMetrics:
      type: object
      required:
        - id
        - projectId
        - timestamp
        - overallHealth
        - coverage
        - reliability
        - maintenance
        - recommendations
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        projectId:
          $ref: '#/components/schemas/UUID'
        timestamp:
          type: string
          format: date-time
        overallHealth:
          type: string
          enum: [excellent, good, fair, poor]
        coverage:
          type: object
          properties:
            overall:
              type: number
            byType:
              type: object
              additionalProperties:
                type: number
            byModule:
              type: object
              additionalProperties:
                type: number
            trend:
              type: string
              enum: [improving, stable, declining]
        reliability:
          type: object
          properties:
            successRate:
              type: number
            flakinessScore:
              type: number
            avgExecutionTime:
              type: number
            failureRate:
              type: number
        maintenance:
          type: object
          properties:
            testDebt:
              type: number
            duplicateTests:
              type: integer
            unusedTests:
              type: integer
            testComplexity:
              type: number
        recommendations:
          type: array
          items:
            type: object
            properties:
              type:
                type: string
                enum: [coverage, reliability, performance, maintenance]
              priority:
                type: string
                enum: [low, medium, high]
              description:
                type: string
              actionItems:
                type: array
                items:
                  type: string

    TestAutomationConfig:
      type: object
      required:
        - id
        - projectId
        - triggers
        - rules
        - notifications
        - enabled
        - createdAt
        - updatedAt
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        projectId:
          $ref: '#/components/schemas/UUID'
        triggers:
          type: object
          properties:
            onCodeGeneration:
              type: boolean
            onFileChange:
              type: boolean
            onPhaseCompletion:
              type: boolean
            scheduled:
              type: boolean
            scheduleCron:
              type: string
        rules:
          type: object
          properties:
            minCoverageThreshold:
              type: number
            autoFixFailingTests:
              type: boolean
            autoGenerateForNewCode:
              type: boolean
            autoUpdateOutdatedTests:
              type: boolean
        notifications:
          type: object
          properties:
            onTestFailure:
              type: boolean
            onCoverageDecrease:
              type: boolean
            onQualityRegression:
              type: boolean
            channels:
              type: array
              items:
                type: string
                enum: [log, email, webhook]
        enabled:
          type: boolean
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
```

## **4. Detailed Business Logic & Validation Rules**

| Rule ID | Rule Description | Implementation Location(s) & Notes |
|---------|------------------|-----------------------------------|
| **TST-01** | Tests can only be generated for files that have been created by the Code Generation Engine to ensure proper context and dependency understanding. | **Backend (Authoritative):** Test generation service must query the Code Generation Engine to verify that target files exist and have generation metadata. Cannot generate tests for manually created files without explicit override. |
| **TST-02** | Test coverage must meet or exceed the project's quality configuration threshold before a phase can be marked as completed in the Multi-Phase Development Orchestrator. | **Backend (Authoritative):** Test execution service must validate coverage against ProjectConfig.quality.testCoverage threshold and report results to Phase Management Module. Phase completion blocked until coverage requirements met. |
| **TST-03** | AI-powered test generation must use the same context package and AI provider settings that were used to generate the original code to ensure test relevance and accuracy. | **Backend (Authoritative):** Test generation service must retrieve original GenerationRequest context from Code Generation Engine and use matching AI provider configuration for test generation consistency. |
| **TST-04** | Test suites must be automatically executed after any code regeneration or modification to detect regressions and maintain quality assurance. | **Backend (Authoritative):** Test automation service must register with File System Management module for file change notifications and automatically trigger test execution for affected test suites when source files are modified. |
| **TST-05** | Critical priority test cases that fail must immediately create error entries in the Logging & Monitoring Service and prevent deployment or phase progression. | **Backend (Authoritative):** Test execution service must report critical test failures to Logging & Monitoring Service with 'critical' severity and block Multi-Phase Development Orchestrator progression until resolved. |
| **TST-06** | Test execution results must be automatically logged with performance metrics and integrated with the project's usage analytics for KPI tracking. | **Backend (Authoritative):** Test execution service must send performance metrics (execution time, memory usage, success rates) to Logging & Monitoring Service for integration with ReadyAI KPI dashboard and analytics. |
| **TST-07** | Test files must be organized using the same directory structure and naming conventions as their target source files to maintain project organization. | **Backend (Authoritative):** Test generation service must interact with File System Management module to create test files in parallel directory structures (e.g., `src/components/Button.tsx`  `tests/components/Button.test.tsx`). |
| **TST-08** | Test generation requests must validate that all dependencies of the target file are available and tested before generating tests to prevent incomplete test coverage. | **Backend (Authoritative):** Test generation service must query the dependency graph from Advanced Context Management Engine to ensure all dependencies have existing tests before generating new test cases. |
| **TST-09** | Test automation configuration changes must be validated against Configuration Management Module settings and cannot exceed resource limits or timeout thresholds. | **Backend (Authoritative):** Test automation service must validate configuration changes against Configuration Management Module constraints (max workers, timeout limits, resource quotas) before applying changes. |
| **TST-10** | Test results and coverage data must be retained according to the backup retention policy from Configuration Management Module and support project continuity requirements. | **Backend (Authoritative):** Test result storage must query Configuration Management Module for retention policies and implement automated cleanup of old test results while preserving coverage trend data for analytics. |

## **5. Developer Task Checklist**

### **Backend Tasks:**
- [ ] Create database migration script for testing tables (`test_cases`, `test_suites`, `test_execution_batches`, `test_execution_results`, `test_coverage`, `test_quality_metrics`, `test_automation_configs`, `test_generation_requests`)
- [ ] Implement the `TestGenerationService` class with AI-powered test generation, context integration, and multiple generation strategies
- [ ] Implement the `TestExecutionService` class for running tests across multiple frameworks with parallel execution and timeout management
- [ ] Implement the `TestCoverageService` class for collecting, analyzing, and reporting code coverage data with multiple coverage types
- [ ] Implement the `TestQualityService` class for calculating quality metrics, health scores, and generating improvement recommendations
- [ ] Implement the `TestAutomationService` class for automated test triggers, scheduling, and integration with other ReadyAI modules
- [ ] Implement the `TestSuiteService` class for managing test suite lifecycle, configuration, and organization
- [ ] Implement all test generation endpoints (`POST /api/v1/testing/generate`, `GET /api/v1/testing/generate/{requestId}`)
- [ ] Implement test suite management endpoints (`GET`, `POST`, `PUT`, `DELETE /api/v1/testing/suites/*`)
- [ ] Implement test case management endpoints (`GET`, `POST`, `PUT`, `DELETE /api/v1/testing/cases/*`)
- [ ] Implement test execution endpoints (`POST /api/v1/testing/execute`, `GET`, `DELETE /api/v1/testing/execute/{batchId}`)
- [ ] Implement test result and coverage endpoints (`GET /api/v1/testing/results/{resultId}`, `GET /api/v1/testing/coverage`)
- [ ] Implement test quality and automation endpoints (`GET /api/v1/testing/quality`, `GET`, `PUT /api/v1/testing/automation`)
- [ ] Create `TestRepository` class for efficient test data storage and retrieval with indexing on project, type, framework, and execution status
- [ ] Create `TestExecutionRepository` class for storing execution results with time-series optimization for performance analytics
- [ ] Create `TestCoverageRepository` class for coverage data storage with aggregation capabilities and historical tracking
- [ ] Implement integration with Code Generation Engine for retrieving generation context and identifying target files for testing
- [ ] Implement integration with AI Provider Management for test generation using Claude Sonnet 4 with extended thinking mode
- [ ] Implement integration with File System Management for test file creation, organization, and file system monitoring
- [ ] Implement integration with Logging & Monitoring Service for test metrics reporting and error tracking
- [ ] Implement integration with Configuration Management Module for test configuration validation and retention policies
- [ ] Implement test framework adapters for Jest, Mocha, Vitest, Cypress, and Playwright with unified execution interface
- [ ] Create test execution orchestrator for parallel test running with resource management and failure handling
- [ ] Implement coverage collection and analysis engine with support for line, branch, function, and statement coverage
- [ ] Implement test result analysis and quality scoring algorithms with trend detection and health assessment
- [ ] Create comprehensive unit tests for all service classes with mock dependencies on other ReadyAI modules
- [ ] Create integration tests for test execution workflows with real test framework integration
- [ ] Implement performance tests for test generation and execution under various load conditions
- [ ] Add test automation hooks into Multi-Phase Development Orchestrator for automatic test generation during Phase 5

### **Frontend Tasks:**
- [ ] Create `TestingProvider` React context for managing testing state and operations
- [ ] Implement `useTesting` hook for accessing testing functionality with test execution status tracking
- [ ] Create `TestGenerationWizard` component for guided test generation with configuration options
- [ ] Implement `TestSuiteManager` component for creating, editing, and organizing test suites
- [ ] Create `TestCaseEditor` component for editing individual test cases with syntax highlighting and validation
- [ ] Implement `TestExecutionDashboard` component for monitoring test runs with real-time status updates
- [ ] Create `TestResultsViewer` component for displaying test results with filtering, grouping, and detailed error views
- [ ] Implement `CoverageReport` component for visualizing code coverage with file-level drill-down and trend analysis
- [ ] Create `TestQualityDashboard` component for displaying quality metrics, health scores, and improvement recommendations
- [ ] Implement `TestAutomationConfig` component for configuring automated testing triggers and rules
- [ ] Create testing service functions in the API client (`testingService.ts`) for all testing endpoints
- [ ] Implement real-time test execution monitoring using WebSockets for live status updates
- [ ] Create test result export functionality for downloading test reports and coverage data
- [ ] Implement test case search and filtering interface with advanced query capabilities
- [ ] Add test execution progress indicators and cancellation controls for long-running test suites
- [ ] Create test coverage visualization with interactive coverage maps and uncovered code highlighting
- [ ] Implement test quality trend charts showing coverage and reliability metrics over time
- [ ] Add test automation status indicators integrated with the main ReadyAI dashboard
- [ ] Create test configuration templates for common testing scenarios and frameworks
- [ ] Implement test case validation with framework-specific syntax checking and best practice recommendations
- [ ] Add integration with ReadyAI project navigator for test-related file navigation and organization
- [ ] Create test performance analytics with execution time trends and resource usage monitoring


========================================================================================


# Project Navigator Module - Technical Specification

## **1. Module Overview**

**Purpose:** The Project Navigator Module serves as the primary visual project management interface for ReadyAI, providing comprehensive visualization of phase progression, project health monitoring, dependency relationships, and file generation tracking. This module transforms complex project data into intuitive visual dashboards, enabling Solo Developer Sam to quickly understand project status, identify bottlenecks, and track progress through the 7-phase development methodology while maintaining real-time awareness of project health and generation activities.

**Dependencies & Interactions:** This module depends on the Frontend Application Module for React infrastructure, routing, and state management capabilities. It extensively consumes data from the Project Management Module to display project health metrics, analytics, and project metadata. It integrates with the Phase Management Module to visualize phase progression, track phase artifacts, and display phase dependencies. The module also interacts with the Multi-Phase Development Orchestrator to show the current workflow state and upcoming phases. Additionally, it leverages the File System Management Module to display file generation queues and workspace structure, and integrates with the Logging & Monitoring Service to show real-time performance metrics and system health indicators within the project context.

## **2. Module-Specific Type Additions (`types.projectNavigator.ts`)**

```typescript
/**
 * Project Navigator Module Types
 * Extends foundational types with project navigation and visualization interfaces
 */

/** Dashboard layout types for different project views */
export type DashboardLayoutType = 
  | 'overview' 
  | 'phases' 
  | 'dependencies' 
  | 'health' 
  | 'files' 
  | 'analytics'
  | 'custom';

/** Chart and visualization types */
export type VisualizationType = 
  | 'phase_progress_bar'
  | 'dependency_graph'
  | 'health_gauge'
  | 'timeline_chart'
  | 'file_tree'
  | 'metrics_chart'
  | 'pie_chart'
  | 'line_chart';

/** Dashboard widget sizes */
export type WidgetSize = 'small' | 'medium' | 'large' | 'full';

/** Refresh interval options for real-time data */
export type RefreshInterval = 'manual' | '5s' | '15s' | '30s' | '1m' | '5m';

/** File generation queue status */
export type GenerationQueueStatus = 'pending' | 'in_progress' | 'completed' | 'failed' | 'cancelled';

/** Dashboard layout configuration */
export interface DashboardLayout {
  /** Layout identifier */
  id: UUID;
  /** Layout name */
  name: string;
  /** Layout type */
  type: DashboardLayoutType;
  /** Associated project ID */
  projectId: UUID;
  /** Widget configurations */
  widgets: DashboardWidget[];
  /** Layout grid configuration */
  gridConfig: {
    columns: number;
    rows: number;
    gap: number;
  };
  /** Whether this is the default layout */
  isDefault: boolean;
  /** Layout creation timestamp */
  createdAt: string; // ISO 8601 format
  /** Last modification timestamp */
  lastModified: string; // ISO 8601 format
}

/** Dashboard widget configuration */
export interface DashboardWidget {
  /** Widget identifier */
  id: UUID;
  /** Widget title */
  title: string;
  /** Widget type */
  type: VisualizationType;
  /** Widget size */
  size: WidgetSize;
  /** Widget position in grid */
  position: {
    x: number;
    y: number;
    width: number;
    height: number;
  };
  /** Widget configuration options */
  config: WidgetConfig;
  /** Data refresh interval */
  refreshInterval: RefreshInterval;
  /** Whether widget is visible */
  visible: boolean;
}

/** Widget-specific configuration */
export interface WidgetConfig {
  /** Data source configuration */
  dataSource?: {
    /** Source module */
    module: string;
    /** Specific endpoint or data type */
    endpoint: string;
    /** Query parameters */
    parameters?: Record<string, any>;
  };
  /** Visualization options */
  visualization?: {
    /** Color scheme */
    colorScheme?: string[];
    /** Chart options */
    chartOptions?: Record<string, any>;
    /** Display options */
    displayOptions?: {
      showLegend?: boolean;
      showTooltips?: boolean;
      showGrid?: boolean;
      showLabels?: boolean;
    };
  };
  /** Filter and query options */
  filters?: {
    /** Time range filter */
    timeRange?: {
      start: string;
      end: string;
    };
    /** Phase filter */
    phases?: PhaseType[];
    /** Status filter */
    statuses?: string[];
    /** Custom filters */
    custom?: Record<string, any>;
  };
}

/** Phase progress visualization data */
export interface PhaseProgressData {
  /** Current phase */
  currentPhase: PhaseType;
  /** Phase progression timeline */
  phases: Array<{
    phase: PhaseType;
    status: PhaseStatus;
    startedAt?: string;
    completedAt?: string;
    duration?: number;
    artifacts: number;
    progress: number; // 0-100
  }>;
  /** Overall project progress */
  overallProgress: number; // 0-100
  /** Estimated completion date */
  estimatedCompletion?: string;
  /** Time spent by phase */
  timeSpentByPhase: Record<PhaseType, number>;
}

/** Dependency graph visualization data */
export interface DependencyGraphData {
  /** Graph nodes representing files/modules */
  nodes: Array<{
    id: string;
    label: string;
    type: 'file' | 'module' | 'component';
    status: 'pending' | 'in_progress' | 'completed' | 'error';
    phase: PhaseType;
    size: number;
    metadata: Record<string, any>;
  }>;
  /** Graph edges representing dependencies */
  edges: Array<{
    source: string;
    target: string;
    type: 'import' | 'extends' | 'implements' | 'uses';
    weight: number;
  }>;
  /** Graph layout configuration */
  layout: {
    algorithm: 'force' | 'hierarchy' | 'circular' | 'grid';
    options: Record<string, any>;
  };
  /** Critical path analysis */
  criticalPath: string[];
  /** Circular dependencies */
  circularDependencies: string[][];
}

/** File generation queue item */
export interface GenerationQueueItem {
  /** Queue item identifier */
  id: UUID;
  /** File path to generate */
  filePath: string;
  /** Generation phase */
  phase: PhaseType;
  /** Queue status */
  status: GenerationQueueStatus;
  /** Queue position */
  position: number;
  /** Priority level */
  priority: 'low' | 'medium' | 'high' | 'critical';
  /** Estimated generation time */
  estimatedTime?: number;
  /** Actual generation time (when completed) */
  actualTime?: number;
  /** Dependencies that must be completed first */
  dependencies: string[];
  /** Error information (if failed) */
  error?: {
    message: string;
    details?: Record<string, any>;
  };
  /** Queue timestamps */
  queuedAt: string; // ISO 8601 format
  startedAt?: string; // ISO 8601 format
  completedAt?: string; // ISO 8601 format
}

/** Project health dashboard data */
export interface ProjectHealthDashboard {
  /** Overall health summary */
  healthSummary: ProjectHealth;
  /** Health trend data */
  healthTrend: Array<{
    timestamp: string;
    score: number;
    status: ProjectHealthStatus;
  }>;
  /** Component health details */
  componentHealth: Array<{
    component: string;
    status: 'healthy' | 'degraded' | 'unhealthy';
    score: number;
    lastChecked: string;
    issues: string[];
  }>;
  /** Performance metrics */
  performanceMetrics: {
    avgContextRetrievalTime: number;
    avgGenerationTime: number;
    errorRate: number;
    successRate: number;
    throughput: number;
  };
  /** Recommendations */
  recommendations: Array<{
    type: 'performance' | 'quality' | 'process' | 'configuration';
    priority: 'low' | 'medium' | 'high' | 'critical';
    title: string;
    description: string;
    action?: string;
  }>;
}

/** Navigation preferences for user customization */
export interface NavigationPreferences {
  /** User/project identifier */
  projectId: UUID;
  /** Default dashboard layout */
  defaultLayout: UUID;
  /** Custom layouts */
  customLayouts: UUID[];
  /** Preferred refresh intervals by widget type */
  refreshIntervals: Record<VisualizationType, RefreshInterval>;
  /** Notification preferences */
  notifications: {
    phaseCompletion: boolean;
    healthAlerts: boolean;
    generationErrors: boolean;
    dependencyIssues: boolean;
  };
  /** Theme and display preferences */
  display: {
    theme: 'light' | 'dark' | 'auto';
    density: 'compact' | 'standard' | 'comfortable';
    animations: boolean;
    tooltips: boolean;
  };
  /** Last updated timestamp */
  lastUpdated: string; // ISO 8601 format
}

/** Real-time update event for dashboard */
export interface DashboardUpdateEvent {
  /** Event identifier */
  id: UUID;
  /** Event type */
  type: 'phase_update' | 'health_change' | 'generation_complete' | 'dependency_change' | 'file_update';
  /** Project identifier */
  projectId: UUID;
  /** Event data payload */
  data: Record<string, any>;
  /** Event timestamp */
  timestamp: string; // ISO 8601 format
}

/** Export configuration for dashboard data */
export interface DashboardExportConfig {
  /** Export format */
  format: 'json' | 'csv' | 'pdf' | 'png' | 'svg';
  /** Data to include */
  includeData: {
    phaseProgress: boolean;
    healthMetrics: boolean;
    dependencyGraph: boolean;
    generationQueue: boolean;
    analytics: boolean;
  };
  /** Time range for data export */
  timeRange?: {
    start: string;
    end: string;
  };
  /** Export options */
  options?: {
    includeImages: boolean;
    includeRawData: boolean;
    compressionLevel?: number;
  };
}
```

## **3. API Endpoint Specification (OpenAPI `paths` block)**

```yaml
paths:
  /api/v1/navigator/dashboards:
    get:
      tags:
        - ProjectNavigator
      summary: Get dashboard layouts for project
      description: Retrieves all dashboard layout configurations for a specific project
      security:
        - localAuth: []
      parameters:
        - name: projectId
          in: query
          description: Project ID to get dashboards for
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
        - name: layoutType
          in: query
          description: Filter by layout type
          required: false
          schema:
            type: string
            enum: [overview, phases, dependencies, health, files, analytics, custom]
      responses:
        '200':
          description: Dashboard layouts retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          layouts:
                            type: array
                            items:
                              $ref: '#/components/schemas/DashboardLayout'
                          defaultLayoutId:
                            $ref: '#/components/schemas/UUID'

    post:
      tags:
        - ProjectNavigator
      summary: Create custom dashboard layout
      description: Creates a new custom dashboard layout configuration
      security:
        - localAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  minLength: 1
                  maxLength: 100
                type:
                  type: string
                  enum: [overview, phases, dependencies, health, files, analytics, custom]
                projectId:
                  $ref: '#/components/schemas/UUID'
                widgets:
                  type: array
                  items:
                    $ref: '#/components/schemas/DashboardWidget'
                gridConfig:
                  type: object
                  properties:
                    columns:
                      type: integer
                      minimum: 1
                      maximum: 12
                    rows:
                      type: integer
                      minimum: 1
                    gap:
                      type: integer
                      minimum: 0
                isDefault:
                  type: boolean
                  default: false
              required:
                - name
                - type
                - projectId
                - widgets
      responses:
        '201':
          description: Dashboard layout created successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/DashboardLayout'

  /api/v1/navigator/dashboards/{layoutId}:
    get:
      tags:
        - ProjectNavigator
      summary: Get specific dashboard layout
      description: Retrieves a specific dashboard layout configuration
      security:
        - localAuth: []
      parameters:
        - name: layoutId
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '200':
          description: Dashboard layout retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/DashboardLayout'

    put:
      tags:
        - ProjectNavigator
      summary: Update dashboard layout
      description: Updates an existing dashboard layout configuration
      security:
        - localAuth: []
      parameters:
        - name: layoutId
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  minLength: 1
                  maxLength: 100
                widgets:
                  type: array
                  items:
                    $ref: '#/components/schemas/DashboardWidget'
                gridConfig:
                  type: object
                  properties:
                    columns:
                      type: integer
                    rows:
                      type: integer
                    gap:
                      type: integer
                isDefault:
                  type: boolean
      responses:
        '200':
          description: Dashboard layout updated successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/DashboardLayout'

    delete:
      tags:
        - ProjectNavigator
      summary: Delete dashboard layout
      description: Deletes a custom dashboard layout
      security:
        - localAuth: []
      parameters:
        - name: layoutId
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '200':
          description: Dashboard layout deleted successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'

  /api/v1/navigator/data/phase-progress:
    get:
      tags:
        - ProjectNavigator
      summary: Get phase progress visualization data
      description: Retrieves phase progression data optimized for visualization
      security:
        - localAuth: []
      parameters:
        - name: projectId
          in: query
          description: Project ID to get phase progress for
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '200':
          description: Phase progress data retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/PhaseProgressData'

  /api/v1/navigator/data/dependency-graph:
    get:
      tags:
        - ProjectNavigator
      summary: Get dependency graph visualization data
      description: Retrieves project dependency graph data optimized for visualization
      security:
        - localAuth: []
      parameters:
        - name: projectId
          in: query
          description: Project ID to get dependency graph for
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
        - name: layout
          in: query
          description: Graph layout algorithm to use
          required: false
          schema:
            type: string
            enum: [force, hierarchy, circular, grid]
            default: force
      responses:
        '200':
          description: Dependency graph data retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/DependencyGraphData'

  /api/v1/navigator/data/generation-queue:
    get:
      tags:
        - ProjectNavigator
      summary: Get file generation queue status
      description: Retrieves current file generation queue with status and progress
      security:
        - localAuth: []
      parameters:
        - name: projectId
          in: query
          description: Project ID to get generation queue for
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
        - name: status
          in: query
          description: Filter by generation status
          required: false
          schema:
            type: string
            enum: [pending, in_progress, completed, failed, cancelled]
      responses:
        '200':
          description: Generation queue data retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          queue:
                            type: array
                            items:
                              $ref: '#/components/schemas/GenerationQueueItem'
                          summary:
                            type: object
                            properties:
                              totalItems:
                                type: integer
                              pendingItems:
                                type: integer
                              inProgressItems:
                                type: integer
                              completedItems:
                                type: integer
                              failedItems:
                                type: integer
                              estimatedTimeRemaining:
                                type: number

  /api/v1/navigator/data/health-dashboard:
    get:
      tags:
        - ProjectNavigator
      summary: Get project health dashboard data
      description: Retrieves comprehensive project health data for dashboard visualization
      security:
        - localAuth: []
      parameters:
        - name: projectId
          in: query
          description: Project ID to get health data for
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
        - name: timeRange
          in: query
          description: Time range for health trend data
          required: false
          schema:
            type: string
            enum: [24h, 7d, 30d, 90d]
            default: 7d
      responses:
        '200':
          description: Health dashboard data retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/ProjectHealthDashboard'

  /api/v1/navigator/preferences:
    get:
      tags:
        - ProjectNavigator
      summary: Get navigation preferences
      description: Retrieves user navigation preferences for a project
      security:
        - localAuth: []
      parameters:
        - name: projectId
          in: query
          description: Project ID to get preferences for
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '200':
          description: Navigation preferences retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/NavigationPreferences'

    put:
      tags:
        - ProjectNavigator
      summary: Update navigation preferences
      description: Updates user navigation preferences for a project
      security:
        - localAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                projectId:
                  $ref: '#/components/schemas/UUID'
                defaultLayout:
                  $ref: '#/components/schemas/UUID'
                customLayouts:
                  type: array
                  items:
                    $ref: '#/components/schemas/UUID'
                refreshIntervals:
                  type: object
                  additionalProperties:
                    type: string
                    enum: [manual, 5s, 15s, 30s, 1m, 5m]
                notifications:
                  type: object
                  properties:
                    phaseCompletion:
                      type: boolean
                    healthAlerts:
                      type: boolean
                    generationErrors:
                      type: boolean
                    dependencyIssues:
                      type: boolean
                display:
                  type: object
                  properties:
                    theme:
                      type: string
                      enum: [light, dark, auto]
                    density:
                      type: string
                      enum: [compact, standard, comfortable]
                    animations:
                      type: boolean
                    tooltips:
                      type: boolean
              required:
                - projectId
      responses:
        '200':
          description: Navigation preferences updated successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/NavigationPreferences'

  /api/v1/navigator/export:
    post:
      tags:
        - ProjectNavigator
      summary: Export dashboard data
      description: Exports dashboard data in various formats for reporting or backup
      security:
        - localAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                projectId:
                  $ref: '#/components/schemas/UUID'
                config:
                  $ref: '#/components/schemas/DashboardExportConfig'
              required:
                - projectId
                - config
      responses:
        '200':
          description: Dashboard data exported successfully
          content:
            application/octet-stream:
              schema:
                type: string
                format: binary

components:
  schemas:
    DashboardLayout:
      type: object
      required:
        - id
        - name
        - type
        - projectId
        - widgets
        - gridConfig
        - isDefault
        - createdAt
        - lastModified
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        name:
          type: string
        type:
          type: string
          enum: [overview, phases, dependencies, health, files, analytics, custom]
        projectId:
          $ref: '#/components/schemas/UUID'
        widgets:
          type: array
          items:
            $ref: '#/components/schemas/DashboardWidget'
        gridConfig:
          type: object
          properties:
            columns:
              type: integer
            rows:
              type: integer
            gap:
              type: integer
        isDefault:
          type: boolean
        createdAt:
          type: string
          format: date-time
        lastModified:
          type: string
          format: date-time

    DashboardWidget:
      type: object
      required:
        - id
        - title
        - type
        - size
        - position
        - config
        - refreshInterval
        - visible
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        title:
          type: string
        type:
          type: string
          enum: [phase_progress_bar, dependency_graph, health_gauge, timeline_chart, file_tree, metrics_chart, pie_chart, line_chart]
        size:
          type: string
          enum: [small, medium, large, full]
        position:
          type: object
          properties:
            x:
              type: integer
            y:
              type: integer
            width:
              type: integer
            height:
              type: integer
        config:
          type: object
          properties:
            dataSource:
              type: object
              properties:
                module:
                  type: string
                endpoint:
                  type: string
                parameters:
                  type: object
            visualization:
              type: object
            filters:
              type: object
        refreshInterval:
          type: string
          enum: [manual, 5s, 15s, 30s, 1m, 5m]
        visible:
          type: boolean

    PhaseProgressData:
      type: object
      required:
        - currentPhase
        - phases
        - overallProgress
        - timeSpentByPhase
      properties:
        currentPhase:
          $ref: '#/components/schemas/PhaseType'
        phases:
          type: array
          items:
            type: object
            properties:
              phase:
                $ref: '#/components/schemas/PhaseType'
              status:
                $ref: '#/components/schemas/PhaseStatus'
              startedAt:
                type: string
                format: date-time
              completedAt:
                type: string
                format: date-time
              duration:
                type: number
              artifacts:
                type: integer
              progress:
                type: number
                minimum: 0
                maximum: 100
        overallProgress:
          type: number
          minimum: 0
          maximum: 100
        estimatedCompletion:
          type: string
          format: date-time
        timeSpentByPhase:
          type: object
          additionalProperties:
            type: number

    DependencyGraphData:
      type: object
      required:
        - nodes
        - edges
        - layout
        - criticalPath
        - circularDependencies
      properties:
        nodes:
          type: array
          items:
            type: object
            properties:
              id:
                type: string
              label:
                type: string
              type:
                type: string
                enum: [file, module, component]
              status:
                type: string
                enum: [pending, in_progress, completed, error]
              phase:
                $ref: '#/components/schemas/PhaseType'
              size:
                type: number
              metadata:
                type: object
        edges:
          type: array
          items:
            type: object
            properties:
              source:
                type: string
              target:
                type: string
              type:
                type: string
                enum: [import, extends, implements, uses]
              weight:
                type: number
        layout:
          type: object
          properties:
            algorithm:
              type: string
              enum: [force, hierarchy, circular, grid]
            options:
              type: object
        criticalPath:
          type: array
          items:
            type: string
        circularDependencies:
          type: array
          items:
            type: array
            items:
              type: string

    GenerationQueueItem:
      type: object
      required:
        - id
        - filePath
        - phase
        - status
        - position
        - priority
        - dependencies
        - queuedAt
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        filePath:
          type: string
        phase:
          $ref: '#/components/schemas/PhaseType'
        status:
          type: string
          enum: [pending, in_progress, completed, failed, cancelled]
        position:
          type: integer
        priority:
          type: string
          enum: [low, medium, high, critical]
        estimatedTime:
          type: number
        actualTime:
          type: number
        dependencies:
          type: array
          items:
            type: string
        error:
          type: object
          properties:
            message:
              type: string
            details:
              type: object
        queuedAt:
          type: string
          format: date-time
        startedAt:
          type: string
          format: date-time
        completedAt:
          type: string
          format: date-time

    ProjectHealthDashboard:
      type: object
      required:
        - healthSummary
        - healthTrend
        - componentHealth
        - performanceMetrics
        - recommendations
      properties:
        healthSummary:
          $ref: '#/components/schemas/ProjectHealth'
        healthTrend:
          type: array
          items:
            type: object
            properties:
              timestamp:
                type: string
                format: date-time
              score:
                type: number
              status:
                type: string
                enum: [excellent, good, fair, poor, critical]
        componentHealth:
          type: array
          items:
            type: object
            properties:
              component:
                type: string
              status:
                type: string
                enum: [healthy, degraded, unhealthy]
              score:
                type: number
              lastChecked:
                type: string
                format: date-time
              issues:
                type: array
                items:
                  type: string
        performanceMetrics:
          type: object
          properties:
            avgContextRetrievalTime:
              type: number
            avgGenerationTime:
              type: number
            errorRate:
              type: number
            successRate:
              type: number
            throughput:
              type: number
        recommendations:
          type: array
          items:
            type: object
            properties:
              type:
                type: string
                enum: [performance, quality, process, configuration]
              priority:
                type: string
                enum: [low, medium, high, critical]
              title:
                type: string
              description:
                type: string
              action:
                type: string

    NavigationPreferences:
      type: object
      required:
        - projectId
        - defaultLayout
        - customLayouts
        - refreshIntervals
        - notifications
        - display
        - lastUpdated
      properties:
        projectId:
          $ref: '#/components/schemas/UUID'
        defaultLayout:
          $ref: '#/components/schemas/UUID'
        customLayouts:
          type: array
          items:
            $ref: '#/components/schemas/UUID'
        refreshIntervals:
          type: object
          additionalProperties:
            type: string
        notifications:
          type: object
          properties:
            phaseCompletion:
              type: boolean
            healthAlerts:
              type: boolean
            generationErrors:
              type: boolean
            dependencyIssues:
              type: boolean
        display:
          type: object
          properties:
            theme:
              type: string
              enum: [light, dark, auto]
            density:
              type: string
              enum: [compact, standard, comfortable]
            animations:
              type: boolean
            tooltips:
              type: boolean
        lastUpdated:
          type: string
          format: date-time

    DashboardExportConfig:
      type: object
      required:
        - format
        - includeData
      properties:
        format:
          type: string
          enum: [json, csv, pdf, png, svg]
        includeData:
          type: object
          properties:
            phaseProgress:
              type: boolean
            healthMetrics:
              type: boolean
            dependencyGraph:
              type: boolean
            generationQueue:
              type: boolean
            analytics:
              type: boolean
        timeRange:
          type: object
          properties:
            start:
              type: string
              format: date-time
            end:
              type: string
              format: date-time
        options:
          type: object
          properties:
            includeImages:
              type: boolean
            includeRawData:
              type: boolean
            compressionLevel:
              type: integer
```

## **4. Detailed Business Logic & Validation Rules**

| Rule ID | Rule Description | Implementation Location(s) & Notes |
|---------|------------------|-----------------------------------|
| **PN-01** | Dashboard layouts must be project-specific and cannot be shared between different projects to maintain workspace isolation. | **Frontend (Authoritative):** Dashboard service must validate projectId before creating/updating layouts. Backend must enforce project-specific layout access through API security and data filtering. |
| **PN-02** | Widget data refresh intervals must respect system performance constraints and cannot be set lower than 5 seconds to prevent overwhelming the backend services. | **Backend (Authoritative):** API endpoints must validate refresh interval minimums and reject invalid configurations. Frontend must respect configured intervals and implement intelligent batching for multiple widgets. |
| **PN-03** | Phase progress visualization must reflect real-time data from Phase Management Module and automatically update when phase transitions occur. | **Frontend (Authoritative):** Phase progress widgets must subscribe to phase update events from Phase Management Module and update visualizations without full page refresh. Backend provides WebSocket/SSE for real-time updates. |
| **PN-04** | Dependency graph visualization must coordinate with Dependency Analysis Engine to show accurate file dependencies and highlight circular dependencies or critical path issues. | **Backend (Authoritative):** Dependency graph endpoints must query Dependency Analysis Engine for current graph state and apply graph algorithms for layout optimization. Frontend must handle large graphs with virtualization for performance. |
| **PN-05** | File generation queue display must integrate with Code Generation Engine and Multi-Phase Development Orchestrator to show real-time generation progress and queue priorities. | **Backend (Authoritative):** Queue endpoints must query Code Generation Engine for active generation tasks and Multi-Phase Orchestrator for phase-based priorities. Updates must be pushed to frontend in real-time. |
| **PN-06** | Project health dashboard must aggregate data from Project Management Module health metrics, Logging & Monitoring Service performance data, and Context Management efficiency metrics. | **Backend (Authoritative):** Health dashboard service must query Project Management for health scores, Logging Service for performance metrics, and implement caching to meet <3 second KPI for dashboard loading. |
| **PN-07** | Dashboard export functionality must respect data privacy constraints and only include project-specific data without exposing sensitive configuration or authentication information. | **Backend (Authoritative):** Export service must filter out sensitive data (API keys, session tokens) and implement proper data sanitization before export. All exports must be project-scoped and authenticated. |
| **PN-08** | Widget configuration changes must be validated against available data sources and widget type capabilities before being persisted to prevent invalid dashboard states. | **Frontend (Authoritative):** Widget configuration validation must check data source availability, parameter compatibility, and widget type constraints. Backend must validate configuration schema on save. |
| **PN-09** | Real-time dashboard updates must be throttled and batched to prevent UI performance degradation while maintaining data freshness for critical project events. | **Frontend (Authoritative):** Update handling must implement intelligent throttling (max 1 update per second per widget), batch non-critical updates, and prioritize critical events (errors, phase transitions). |
| **PN-10** | Dashboard preferences must be persisted locally and synchronized with Configuration Management Module to maintain user experience consistency across sessions. | **Backend (Authoritative):** Preferences service must integrate with Configuration Management Module for centralized preference storage and implement conflict resolution for concurrent updates. |

## **5. Developer Task Checklist**

### **Backend Tasks:**
- [ ] Create database migration script for navigator tables (`dashboard_layouts`, `dashboard_widgets`, `navigation_preferences`, `widget_data_cache`)
- [ ] Implement the `ProjectNavigatorService` class for dashboard layout management, widget configuration, and preference handling
- [ ] Implement the `DashboardDataService` class for aggregating and formatting data from Project Management, Phase Management, and other modules for visualization
- [ ] Implement dashboard layout CRUD endpoints (`GET`, `POST`, `PUT`, `DELETE /api/v1/navigator/dashboards/{id}`) with project-scoped access control
- [ ] Implement visualization data endpoints (`GET /api/v1/navigator/data/phase-progress`, `/dependency-graph`, `/generation-queue`, `/health-dashboard`)
- [ ] Implement navigation preferences endpoints (`GET`, `PUT /api/v1/navigator/preferences`) with Configuration Management Module integration
- [ ] Implement dashboard export endpoint (`POST /api/v1/navigator/export`) with multiple format support and data sanitization
- [ ] Create `NavigatorRepository` class for dashboard configuration persistence with project-based data isolation
- [ ] Create `WidgetDataCache` service for caching frequently accessed visualization data with configurable TTL
- [ ] Implement real-time update service using WebSockets or Server-Sent Events for dashboard data streaming
- [ ] Implement data aggregation services that query Project Management Module for project health and analytics data
- [ ] Implement integration with Phase Management Module for real-time phase progress updates and phase transition notifications
- [ ] Implement integration with File System Management Module for file tree visualization and generation queue status
- [ ] Implement integration with Dependency Analysis Engine for dependency graph data and critical path analysis
- [ ] Create background services for periodic data refresh and cache warming for performance optimization
- [ ] Implement comprehensive input validation for dashboard configurations with schema validation
- [ ] Create unit tests for all service classes with proper mocking of dependent module integrations
- [ ] Create integration tests for real-time update functionality and dashboard data aggregation accuracy
- [ ] Implement performance optimizations for large dependency graphs and project data visualization
- [ ] Add monitoring and logging for dashboard performance metrics and user interaction analytics

### **Frontend Tasks:**
- [ ] Create `ProjectNavigatorProvider` React context for managing dashboard state, layouts, and real-time updates
- [ ] Implement `useDashboard` hook for accessing dashboard data, managing layouts, and handling widget interactions
- [ ] Create `DashboardCanvas` component as the main dashboard container with grid layout management and drag-and-drop widget positioning
- [ ] Implement `WidgetRenderer` component factory for rendering different widget types (phase progress, dependency graph, health gauges, etc.)
- [ ] Create `PhaseProgressWidget` component with animated progress bars, timeline visualization, and phase status indicators
- [ ] Implement `DependencyGraphWidget` component using D3.js or similar library for interactive graph visualization with zoom, pan, and node selection
- [ ] Create `ProjectHealthWidget` component with health score gauges, trend charts, and component status indicators
- [ ] Implement `GenerationQueueWidget` component with real-time queue status, progress indicators, and error highlighting
- [ ] Create `FileTreeWidget` component for hierarchical project structure visualization with file status indicators
- [ ] Implement `MetricsChartWidget` component with configurable chart types (line, bar, pie) for analytics visualization
- [ ] Create `DashboardLayoutManager` component for creating, editing, and managing custom dashboard layouts
- [ ] Implement `WidgetConfigurationPanel` component for configuring widget properties, data sources, and visualization options
- [ ] Create `NavigationPreferences` component for managing user preferences, themes, and notification settings
- [ ] Implement `DashboardExport` component for exporting dashboard data and visualizations in various formats
- [ ] Create dashboard service functions in the API client (`navigatorService.ts`) for all dashboard and data endpoints
- [ ] Implement real-time data subscription service using WebSocket connections for live dashboard updates
- [ ] Create responsive design system for dashboard widgets that adapts to different screen sizes and layouts
- [ ] Implement keyboard navigation and accessibility features for dashboard interaction and widget management
- [ ] Add performance optimizations for large datasets including virtualization for file trees and dependency graphs
- [ ] Create comprehensive error boundaries and fallback UI for widget failures and data loading errors
- [ ] Implement intelligent data refresh strategies with configurable intervals and user activity-based updates
- [ ] Add drag-and-drop functionality for widget repositioning and dashboard layout customization
- [ ] Create dashboard templates and quick-start layouts for common project types and user preferences
- [ ] Implement search and filtering capabilities for project data across all dashboard widgets
- [ ] Add animation and transition effects for data updates and widget state changes while maintaining performance



========================================================================================


# Performance Optimization Module - Technical Specification

## **1. Module Overview**

**Purpose:** The Performance Optimization Module serves as the comprehensive performance monitoring and optimization system for the entire ReadyAI application, ensuring strict compliance with the defined KPIs including <3 second context retrieval times, <30 second project resume times, and optimal system resource utilization. This module proactively monitors system performance, implements intelligent caching strategies, detects bottlenecks, optimizes resource allocation, and provides automated performance tuning to maintain the local-first architecture's responsiveness while supporting the development velocity and code quality consistency targets.

**Dependencies & Interactions:** This module depends on the Context Management Engine to monitor context retrieval performance against the <3 second KPI requirement and implement context-specific optimizations. It integrates with the Vector Database Service to optimize vector operations, query performance, and embedding storage efficiency for large-scale context management (500+ files). The module interacts with the Analytics Service to collect performance metrics, trend analysis, and KPI tracking data. It also coordinates with the Configuration Management Module to apply performance-related configuration changes, with the Logging & Monitoring Service to receive performance alerts and system health data, and with the Database Management Module to optimize query performance and resource usage. The module provides performance optimization services consumed by all other ReadyAI modules to ensure system-wide performance compliance.

## **2. Module-Specific Type Additions (`types.performanceOptimization.ts`)**

```typescript
/**
 * Performance Optimization Module Types
 * Extends foundational types with performance monitoring and optimization interfaces
 */

/** Performance optimization strategies */
export type OptimizationStrategy = 
  | 'caching'
  | 'indexing'
  | 'query_optimization'
  | 'resource_pooling'
  | 'memory_management'
  | 'cpu_optimization'
  | 'io_optimization'
  | 'network_optimization';

/** Performance metric categories */
export type PerformanceMetricCategory = 
  | 'context_retrieval'
  | 'ai_generation'
  | 'database_query'
  | 'file_system'
  | 'memory_usage'
  | 'cpu_usage'
  | 'network_latency'
  | 'cache_performance';

/** Cache types used across the system */
export type CacheType = 
  | 'context_cache'
  | 'query_result_cache'
  | 'file_content_cache'
  | 'embedding_cache'
  | 'metadata_cache'
  | 'session_cache';

/** Performance bottleneck severity levels */
export type BottleneckSeverity = 'low' | 'medium' | 'high' | 'critical';

/** Performance optimization status */
export type OptimizationStatus = 'pending' | 'in_progress' | 'completed' | 'failed' | 'skipped';

/** Comprehensive performance profile for the system */
export interface PerformanceProfile {
  /** Profile identifier */
  id: UUID;
  /** Profile name */
  name: string;
  /** Profile description */
  description?: string;
  /** Creation timestamp */
  createdAt: string; // ISO 8601 format
  /** Last updated timestamp */
  lastUpdated: string; // ISO 8601 format
  /** Current performance metrics */
  metrics: {
    /** Context retrieval performance */
    contextRetrieval: {
      avgRetrievalTime: number; // milliseconds
      p95RetrievalTime: number; // milliseconds
      cacheHitRate: number; // percentage
      totalRetrievals: number;
    };
    /** AI generation performance */
    aiGeneration: {
      avgGenerationTime: number; // milliseconds
      tokenThroughput: number; // tokens per second
      errorRate: number; // percentage
      totalGenerations: number;
    };
    /** Database performance */
    database: {
      avgQueryTime: number; // milliseconds
      connectionPoolUtilization: number; // percentage
      slowQueryCount: number;
      totalQueries: number;
    };
    /** System resource utilization */
    systemResources: {
      cpuUsage: number; // percentage
      memoryUsage: number; // percentage
      diskUsage: number; // percentage
      networkUtilization: number; // percentage
    };
  };
  /** KPI compliance status */
  kpiCompliance: {
    contextRetrievalKPI: {
      target: number; // 3000ms
      current: number;
      compliant: boolean;
    };
    projectResumeKPI: {
      target: number; // 30000ms
      current: number;
      compliant: boolean;
    };
    developmentVelocityKPI: {
      target: number; // 70-90% improvement
      current: number;
      compliant: boolean;
    };
  };
  /** Active optimizations */
  activeOptimizations: OptimizationRule[];
  /** Performance recommendations */
  recommendations: PerformanceRecommendation[];
}

/** Performance bottleneck detection result */
export interface PerformanceBottleneck {
  /** Bottleneck identifier */
  id: UUID;
  /** Bottleneck name */
  name: string;
  /** Bottleneck description */
  description: string;
  /** Severity level */
  severity: BottleneckSeverity;
  /** Affected component or module */
  affectedComponent: string;
  /** Performance impact metrics */
  impact: {
    /** Performance degradation percentage */
    performanceDegradation: number;
    /** Affected operations count */
    affectedOperations: number;
    /** Estimated user impact */
    userImpact: 'low' | 'medium' | 'high' | 'critical';
  };
  /** Detection timestamp */
  detectedAt: string; // ISO 8601 format
  /** Root cause analysis */
  rootCause?: string;
  /** Suggested optimizations */
  suggestedOptimizations: OptimizationStrategy[];
  /** Resolution status */
  resolved: boolean;
  /** Resolution timestamp */
  resolvedAt?: string; // ISO 8601 format
}

/** Cache performance metrics and configuration */
export interface CachePerformanceMetrics {
  /** Cache identifier */
  cacheId: string;
  /** Cache type */
  type: CacheType;
  /** Cache hit rate percentage */
  hitRate: number;
  /** Cache miss rate percentage */
  missRate: number;
  /** Total cache requests */
  totalRequests: number;
  /** Cache size in bytes */
  size: number;
  /** Maximum cache size */
  maxSize: number;
  /** Cache utilization percentage */
  utilization: number;
  /** Average retrieval time from cache */
  avgRetrievalTime: number;
  /** Cache eviction count */
  evictionCount: number;
  /** Last updated timestamp */
  lastUpdated: string; // ISO 8601 format
  /** Cache configuration */
  configuration: {
    ttl: number; // Time to live in seconds
    maxEntries: number;
    evictionPolicy: 'lru' | 'lfu' | 'ttl' | 'random';
    compressionEnabled: boolean;
  };
}

/** Optimization rule definition */
export interface OptimizationRule {
  /** Rule identifier */
  id: UUID;
  /** Rule name */
  name: string;
  /** Rule description */
  description: string;
  /** Optimization strategy */
  strategy: OptimizationStrategy;
  /** Rule conditions */
  conditions: {
    /** Metric thresholds that trigger the rule */
    metricThresholds: Array<{
      metric: string;
      operator: 'gt' | 'lt' | 'eq' | 'gte' | 'lte';
      value: number;
    }>;
    /** Time-based conditions */
    timeConditions?: {
      minDuration: number; // seconds
      evaluationWindow: number; // seconds
    };
  };
  /** Optimization actions */
  actions: Array<{
    type: 'cache_optimization' | 'query_optimization' | 'resource_scaling' | 'configuration_change';
    parameters: Record<string, any>;
  }>;
  /** Rule priority */
  priority: number;
  /** Whether rule is enabled */
  enabled: boolean;
  /** Rule creation timestamp */
  createdAt: string; // ISO 8601 format
  /** Last execution timestamp */
  lastExecuted?: string; // ISO 8601 format
  /** Execution count */
  executionCount: number;
  /** Success rate */
  successRate: number;
}

/** Performance recommendation */
export interface PerformanceRecommendation {
  /** Recommendation identifier */
  id: UUID;
  /** Recommendation title */
  title: string;
  /** Recommendation description */
  description: string;
  /** Recommendation category */
  category: PerformanceMetricCategory;
  /** Recommendation priority */
  priority: 'low' | 'medium' | 'high' | 'critical';
  /** Estimated performance improvement */
  estimatedImprovement: {
    /** Performance gain percentage */
    performanceGain: number;
    /** Affected KPIs */
    affectedKPIs: string[];
    /** Implementation effort */
    implementationEffort: 'low' | 'medium' | 'high';
  };
  /** Implementation steps */
  implementationSteps: string[];
  /** Required resources */
  requiredResources?: string[];
  /** Risk assessment */
  riskAssessment: {
    /** Risk level */
    level: 'low' | 'medium' | 'high';
    /** Risk description */
    description: string;
    /** Mitigation strategies */
    mitigations: string[];
  };
  /** Recommendation status */
  status: 'new' | 'reviewed' | 'approved' | 'implemented' | 'rejected';
  /** Creation timestamp */
  createdAt: string; // ISO 8601 format
  /** Last updated timestamp */
  lastUpdated: string; // ISO 8601 format
}

/** Performance optimization execution result */
export interface OptimizationExecution {
  /** Execution identifier */
  id: UUID;
  /** Rule that was executed */
  ruleId: UUID;
  /** Execution status */
  status: OptimizationStatus;
  /** Execution start time */
  startedAt: string; // ISO 8601 format
  /** Execution completion time */
  completedAt?: string; // ISO 8601 format
  /** Execution duration in milliseconds */
  duration?: number;
  /** Performance before optimization */
  beforeMetrics: Record<string, number>;
  /** Performance after optimization */
  afterMetrics?: Record<string, number>;
  /** Performance improvement achieved */
  improvement?: {
    /** Percentage improvement */
    percentageImprovement: number;
    /** Specific metrics improved */
    improvedMetrics: Record<string, number>;
  };
  /** Execution logs */
  logs: string[];
  /** Error information if execution failed */
  error?: {
    /** Error code */
    code: string;
    /** Error message */
    message: string;
    /** Error stack trace */
    stackTrace?: string;
  };
}

/** Performance monitoring configuration */
export interface PerformanceMonitoringConfig {
  /** Configuration identifier */
  id: UUID;
  /** Monitoring intervals */
  intervals: {
    /** Real-time monitoring interval in seconds */
    realTime: number;
    /** Detailed analysis interval in seconds */
    detailed: number;
    /** Historical analysis interval in seconds */
    historical: number;
  };
  /** Performance thresholds */
  thresholds: {
    /** Context retrieval time threshold */
    contextRetrievalTime: number; // 3000ms
    /** Project resume time threshold */
    projectResumeTime: number; // 30000ms
    /** Memory usage threshold percentage */
    memoryUsage: number; // 80%
    /** CPU usage threshold percentage */
    cpuUsage: number; // 85%
    /** Disk usage threshold percentage */
    diskUsage: number; // 90%
  };
  /** Alert configurations */
  alerting: {
    /** Enable performance alerts */
    enabled: boolean;
    /** Alert channels */
    channels: Array<{
      type: 'log' | 'notification' | 'webhook';
      configuration: Record<string, any>;
    }>;
  };
  /** Data retention policies */
  retention: {
    /** Real-time data retention in hours */
    realTimeData: number; // 24 hours
    /** Historical data retention in days */
    historicalData: number; // 90 days
    /** Optimization logs retention in days */
    optimizationLogs: number; // 30 days
  };
  /** Auto-optimization settings */
  autoOptimization: {
    /** Enable automatic optimizations */
    enabled: boolean;
    /** Safe mode - only non-disruptive optimizations */
    safeMode: boolean;
    /** Maximum optimizations per hour */
    maxOptimizationsPerHour: number;
  };
}

/** Resource utilization snapshot */
export interface ResourceUtilization {
  /** Snapshot identifier */
  id: UUID;
  /** Snapshot timestamp */
  timestamp: string; // ISO 8601 format
  /** CPU utilization metrics */
  cpu: {
    /** Overall CPU usage percentage */
    usage: number;
    /** CPU usage by process */
    processBreakdown: Array<{
      processName: string;
      usage: number;
    }>;
    /** CPU load average */
    loadAverage: number[];
  };
  /** Memory utilization metrics */
  memory: {
    /** Total memory in bytes */
    total: number;
    /** Used memory in bytes */
    used: number;
    /** Available memory in bytes */
    available: number;
    /** Usage percentage */
    usage: number;
    /** Memory usage by module */
    moduleBreakdown: Array<{
      moduleName: string;
      usage: number; // bytes
    }>;
  };
  /** Disk utilization metrics */
  disk: {
    /** Total disk space in bytes */
    total: number;
    /** Used disk space in bytes */
    used: number;
    /** Available disk space in bytes */
    available: number;
    /** Usage percentage */
    usage: number;
    /** Disk I/O operations per second */
    iops: number;
  };
  /** Network utilization metrics */
  network: {
    /** Bytes sent per second */
    bytesSent: number;
    /** Bytes received per second */
    bytesReceived: number;
    /** Network latency in milliseconds */
    latency: number;
    /** Connection count */
    connections: number;
  };
}
```

## **3. API Endpoint Specification (OpenAPI `paths` block)**

```yaml
paths:
  /api/v1/performance/profile:
    get:
      tags:
        - Performance
      summary: Get current performance profile
      description: Retrieves comprehensive performance metrics, KPI compliance status, and active optimizations
      security:
        - localAuth: []
      responses:
        '200':
          description: Performance profile retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/PerformanceProfile'

  /api/v1/performance/bottlenecks:
    get:
      tags:
        - Performance
      summary: Get detected performance bottlenecks
      description: Retrieves list of detected performance bottlenecks with severity and resolution status
      security:
        - localAuth: []
      parameters:
        - name: severity
          in: query
          description: Filter by bottleneck severity
          required: false
          schema:
            type: string
            enum: [low, medium, high, critical]
        - name: resolved
          in: query
          description: Filter by resolution status
          required: false
          schema:
            type: boolean
        - name: component
          in: query
          description: Filter by affected component
          required: false
          schema:
            type: string
      responses:
        '200':
          description: Performance bottlenecks retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          bottlenecks:
                            type: array
                            items:
                              $ref: '#/components/schemas/PerformanceBottleneck'
                          summary:
                            type: object
                            properties:
                              totalCount:
                                type: integer
                              criticalCount:
                                type: integer
                              unresolvedCount:
                                type: integer

    post:
      tags:
        - Performance
      summary: Run bottleneck detection analysis
      description: Triggers comprehensive performance bottleneck detection analysis
      security:
        - localAuth: []
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              properties:
                analysisScope:
                  type: array
                  items:
                    type: string
                    enum: [context_management, ai_generation, database, file_system, vector_database]
                  description: Specific components to analyze (all if not specified)
                deepAnalysis:
                  type: boolean
                  default: false
                  description: Enable deep performance analysis (may take longer)
      responses:
        '202':
          description: Bottleneck detection analysis started
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          analysisId:
                            $ref: '#/components/schemas/UUID'
                          estimatedDuration:
                            type: integer
                            description: Estimated analysis duration in seconds

  /api/v1/performance/cache:
    get:
      tags:
        - Performance
      summary: Get cache performance metrics
      description: Retrieves performance metrics for all system caches
      security:
        - localAuth: []
      parameters:
        - name: cacheType
          in: query
          description: Filter by cache type
          required: false
          schema:
            type: string
            enum: [context_cache, query_result_cache, file_content_cache, embedding_cache, metadata_cache, session_cache]
      responses:
        '200':
          description: Cache performance metrics retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          caches:
                            type: array
                            items:
                              $ref: '#/components/schemas/CachePerformanceMetrics'
                          overallStats:
                            type: object
                            properties:
                              totalHitRate:
                                type: number
                              totalSize:
                                type: number
                              totalUtilization:
                                type: number

    post:
      tags:
        - Performance
      summary: Optimize cache configuration
      description: Triggers cache optimization based on current usage patterns and performance metrics
      security:
        - localAuth: []
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              properties:
                targetCaches:
                  type: array
                  items:
                    type: string
                  description: Specific caches to optimize (all if not specified)
                optimizationGoal:
                  type: string
                  enum: [hit_rate, memory_usage, response_time, balanced]
                  default: balanced
                  description: Primary optimization goal
      responses:
        '202':
          description: Cache optimization started
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          optimizationId:
                            $ref: '#/components/schemas/UUID'
                          affectedCaches:
                            type: array
                            items:
                              type: string

  /api/v1/performance/optimization/rules:
    get:
      tags:
        - Performance
      summary: Get optimization rules
      description: Retrieves configured performance optimization rules
      security:
        - localAuth: []
      parameters:
        - name: enabled
          in: query
          description: Filter by enabled status
          required: false
          schema:
            type: boolean
        - name: strategy
          in: query
          description: Filter by optimization strategy
          required: false
          schema:
            type: string
            enum: [caching, indexing, query_optimization, resource_pooling, memory_management, cpu_optimization, io_optimization, network_optimization]
      responses:
        '200':
          description: Optimization rules retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          rules:
                            type: array
                            items:
                              $ref: '#/components/schemas/OptimizationRule'
                          executionStats:
                            type: object
                            properties:
                              totalExecutions:
                                type: integer
                              successfulExecutions:
                                type: integer
                              averageImprovement:
                                type: number

    post:
      tags:
        - Performance
      summary: Create optimization rule
      description: Creates a new performance optimization rule
      security:
        - localAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  minLength: 1
                  maxLength: 100
                description:
                  type: string
                  maxLength: 500
                strategy:
                  type: string
                  enum: [caching, indexing, query_optimization, resource_pooling, memory_management, cpu_optimization, io_optimization, network_optimization]
                conditions:
                  type: object
                  properties:
                    metricThresholds:
                      type: array
                      items:
                        type: object
                        properties:
                          metric:
                            type: string
                          operator:
                            type: string
                            enum: [gt, lt, eq, gte, lte]
                          value:
                            type: number
                        required:
                          - metric
                          - operator
                          - value
                    timeConditions:
                      type: object
                      properties:
                        minDuration:
                          type: integer
                          minimum: 1
                        evaluationWindow:
                          type: integer
                          minimum: 60
                  required:
                    - metricThresholds
                actions:
                  type: array
                  items:
                    type: object
                    properties:
                      type:
                        type: string
                        enum: [cache_optimization, query_optimization, resource_scaling, configuration_change]
                      parameters:
                        type: object
                    required:
                      - type
                      - parameters
                priority:
                  type: integer
                  minimum: 1
                  maximum: 10
                  default: 5
                enabled:
                  type: boolean
                  default: true
              required:
                - name
                - strategy
                - conditions
                - actions
      responses:
        '201':
          description: Optimization rule created successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/OptimizationRule'

  /api/v1/performance/optimization/rules/{ruleId}:
    put:
      tags:
        - Performance
      summary: Update optimization rule
      description: Updates an existing performance optimization rule
      security:
        - localAuth: []
      parameters:
        - name: ruleId
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  minLength: 1
                  maxLength: 100
                description:
                  type: string
                  maxLength: 500
                conditions:
                  type: object
                actions:
                  type: array
                priority:
                  type: integer
                  minimum: 1
                  maximum: 10
                enabled:
                  type: boolean
      responses:
        '200':
          description: Optimization rule updated successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/OptimizationRule'
        '404':
          description: Optimization rule not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

    delete:
      tags:
        - Performance
      summary: Delete optimization rule
      description: Deletes a performance optimization rule
      security:
        - localAuth: []
      parameters:
        - name: ruleId
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '200':
          description: Optimization rule deleted successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '404':
          description: Optimization rule not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

  /api/v1/performance/optimization/execute/{ruleId}:
    post:
      tags:
        - Performance
      summary: Execute optimization rule
      description: Manually executes a specific performance optimization rule
      security:
        - localAuth: []
      parameters:
        - name: ruleId
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              properties:
                dryRun:
                  type: boolean
                  default: false
                  description: Execute in dry-run mode to preview changes
                force:
                  type: boolean
                  default: false
                  description: Force execution even if conditions are not fully met
      responses:
        '202':
          description: Optimization rule execution started
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          executionId:
                            $ref: '#/components/schemas/UUID'
                          estimatedDuration:
                            type: integer
        '400':
          description: Rule execution conditions not met
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'
        '404':
          description: Optimization rule not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

  /api/v1/performance/recommendations:
    get:
      tags:
        - Performance
      summary: Get performance recommendations
      description: Retrieves AI-generated performance optimization recommendations based on current system analysis
      security:
        - localAuth: []
      parameters:
        - name: category
          in: query
          description: Filter by recommendation category
          required: false
          schema:
            type: string
            enum: [context_retrieval, ai_generation, database_query, file_system, memory_usage, cpu_usage, network_latency, cache_performance]
        - name: priority
          in: query
          description: Filter by recommendation priority
          required: false
          schema:
            type: string
            enum: [low, medium, high, critical]
        - name: status
          in: query
          description: Filter by recommendation status
          required: false
          schema:
            type: string
            enum: [new, reviewed, approved, implemented, rejected]
      responses:
        '200':
          description: Performance recommendations retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          recommendations:
                            type: array
                            items:
                              $ref: '#/components/schemas/PerformanceRecommendation'
                          priorityBreakdown:
                            type: object
                            properties:
                              critical:
                                type: integer
                              high:
                                type: integer
                              medium:
                                type: integer
                              low:
                                type: integer

    post:
      tags:
        - Performance
      summary: Generate new performance recommendations
      description: Triggers AI analysis to generate new performance optimization recommendations
      security:
        - localAuth: []
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              properties:
                analysisScope:
                  type: array
                  items:
                    type: string
                  description: Specific areas to analyze for recommendations
                includeImplemented:
                  type: boolean
                  default: false
                  description: Include recommendations for already optimized areas
                riskTolerance:
                  type: string
                  enum: [low, medium, high]
                  default: medium
                  description: Risk tolerance for recommendations
      responses:
        '202':
          description: Recommendation generation started
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          analysisId:
                            $ref: '#/components/schemas/UUID'
                          estimatedDuration:
                            type: integer

  /api/v1/performance/recommendations/{recommendationId}/status:
    patch:
      tags:
        - Performance
      summary: Update recommendation status
      description: Updates the status of a performance recommendation (reviewed, approved, implemented, etc.)
      security:
        - localAuth: []
      parameters:
        - name: recommendationId
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                status:
                  type: string
                  enum: [new, reviewed, approved, implemented, rejected]
                notes:
                  type: string
                  maxLength: 1000
                  description: Optional notes about the status change
              required:
                - status
      responses:
        '200':
          description: Recommendation status updated successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/PerformanceRecommendation'
        '404':
          description: Recommendation not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

  /api/v1/performance/resources:
    get:
      tags:
        - Performance
      summary: Get real-time resource utilization
      description: Retrieves current system resource utilization metrics
      security:
        - localAuth: []
      responses:
        '200':
          description: Resource utilization retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/ResourceUtilization'

  /api/v1/performance/kpi-compliance:
    get:
      tags:
        - Performance
      summary: Get KPI compliance status
      description: Retrieves detailed KPI compliance status including context retrieval times, project resume times, and development velocity metrics
      security:
        - localAuth: []
      parameters:
        - name: period
          in: query
          description: Time period for KPI analysis
          required: false
          schema:
            type: string
            enum: [hour, day, week, month]
            default: day
      responses:
        '200':
          description: KPI compliance status retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          contextRetrievalKPI:
                            type: object
                            properties:
                              target:
                                type: number
                                description: Target time in milliseconds (3000ms)
                              current:
                                type: number
                                description: Current average time in milliseconds
                              p95:
                                type: number
                                description: 95th percentile time
                              compliant:
                                type: boolean
                              trend:
                                type: string
                                enum: [improving, stable, degrading]
                              violationCount:
                                type: integer
                          projectResumeKPI:
                            type: object
                            properties:
                              target:
                                type: number
                                description: Target time in milliseconds (30000ms)
                              current:
                                type: number
                                description: Current average time in milliseconds
                              compliant:
                                type: boolean
                              trend:
                                type: string
                                enum: [improving, stable, degrading]
                          developmentVelocityKPI:
                            type: object
                            properties:
                              target:
                                type: number
                                description: Target improvement percentage (70-90%)
                              current:
                                type: number
                                description: Current improvement percentage
                              compliant:
                                type: boolean
                              trend:
                                type: string
                                enum: [improving, stable, degrading]
                          overallCompliance:
                            type: object
                            properties:
                              score:
                                type: number
                                description: Overall compliance score (0-100)
                              status:
                                type: string
                                enum: [excellent, good, fair, poor, critical]

  /api/v1/performance/config:
    get:
      tags:
        - Performance
      summary: Get performance monitoring configuration
      description: Retrieves current performance monitoring configuration settings
      security:
        - localAuth: []
      responses:
        '200':
          description: Performance monitoring configuration retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/PerformanceMonitoringConfig'

    put:
      tags:
        - Performance
      summary: Update performance monitoring configuration
      description: Updates performance monitoring configuration settings
      security:
        - localAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                intervals:
                  type: object
                  properties:
                    realTime:
                      type: integer
                      minimum: 1
                      maximum: 60
                    detailed:
                      type: integer
                      minimum: 60
                      maximum: 3600
                    historical:
                      type: integer
                      minimum: 3600
                      maximum: 86400
                thresholds:
                  type: object
                  properties:
                    contextRetrievalTime:
                      type: integer
                      minimum: 1000
                      maximum: 10000
                    projectResumeTime:
                      type: integer
                      minimum: 10000
                      maximum: 120000
                    memoryUsage:
                      type: integer
                      minimum: 50
                      maximum: 95
                    cpuUsage:
                      type: integer
                      minimum: 50
                      maximum: 95
                    diskUsage:
                      type: integer
                      minimum: 70
                      maximum: 98
                alerting:
                  type: object
                  properties:
                    enabled:
                      type: boolean
                    channels:
                      type: array
                      items:
                        type: object
                        properties:
                          type:
                            type: string
                            enum: [log, notification, webhook]
                          configuration:
                            type: object
                retention:
                  type: object
                  properties:
                    realTimeData:
                      type: integer
                      minimum: 1
                      maximum: 168
                    historicalData:
                      type: integer
                      minimum: 1
                      maximum: 365
                    optimizationLogs:
                      type: integer
                      minimum: 1
                      maximum: 90
                autoOptimization:
                  type: object
                  properties:
                    enabled:
                      type: boolean
                    safeMode:
                      type: boolean
                    maxOptimizationsPerHour:
                      type: integer
                      minimum: 1
                      maximum: 100
      responses:
        '200':
          description: Performance monitoring configuration updated successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/PerformanceMonitoringConfig'

components:
  schemas:
    PerformanceProfile:
      type: object
      required:
        - id
        - name
        - createdAt
        - lastUpdated
        - metrics
        - kpiCompliance
        - activeOptimizations
        - recommendations
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        name:
          type: string
        description:
          type: string
        createdAt:
          type: string
          format: date-time
        lastUpdated:
          type: string
          format: date-time
        metrics:
          type: object
        kpiCompliance:
          type: object
        activeOptimizations:
          type: array
          items:
            $ref: '#/components/schemas/OptimizationRule'
        recommendations:
          type: array
          items:
            $ref: '#/components/schemas/PerformanceRecommendation'

    PerformanceBottleneck:
      type: object
      required:
        - id
        - name
        - description
        - severity
        - affectedComponent
        - impact
        - detectedAt
        - suggestedOptimizations
        - resolved
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        name:
          type: string
        description:
          type: string
        severity:
          type: string
          enum: [low, medium, high, critical]
        affectedComponent:
          type: string
        impact:
          type: object
          properties:
            performanceDegradation:
              type: number
            affectedOperations:
              type: integer
            userImpact:
              type: string
              enum: [low, medium, high, critical]
        detectedAt:
          type: string
          format: date-time
        rootCause:
          type: string
        suggestedOptimizations:
          type: array
          items:
            type: string
        resolved:
          type: boolean
        resolvedAt:
          type: string
          format: date-time

    CachePerformanceMetrics:
      type: object
      required:
        - cacheId
        - type
        - hitRate
        - missRate
        - totalRequests
        - size
        - maxSize
        - utilization
        - avgRetrievalTime
        - evictionCount
        - lastUpdated
        - configuration
      properties:
        cacheId:
          type: string
        type:
          type: string
          enum: [context_cache, query_result_cache, file_content_cache, embedding_cache, metadata_cache, session_cache]
        hitRate:
          type: number
        missRate:
          type: number
        totalRequests:
          type: integer
        size:
          type: number
        maxSize:
          type: number
        utilization:
          type: number
        avgRetrievalTime:
          type: number
        evictionCount:
          type: integer
        lastUpdated:
          type: string
          format: date-time
        configuration:
          type: object
          properties:
            ttl:
              type: integer
            maxEntries:
              type: integer
            evictionPolicy:
              type: string
              enum: [lru, lfu, ttl, random]
            compressionEnabled:
              type: boolean

    OptimizationRule:
      type: object
      required:
        - id
        - name
        - description
        - strategy
        - conditions
        - actions
        - priority
        - enabled
        - createdAt
        - executionCount
        - successRate
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        name:
          type: string
        description:
          type: string
        strategy:
          type: string
          enum: [caching, indexing, query_optimization, resource_pooling, memory_management, cpu_optimization, io_optimization, network_optimization]
        conditions:
          type: object
        actions:
          type: array
        priority:
          type: integer
        enabled:
          type: boolean
        createdAt:
          type: string
          format: date-time
        lastExecuted:
          type: string
          format: date-time
        executionCount:
          type: integer
        successRate:
          type: number

    PerformanceRecommendation:
      type: object
      required:
        - id
        - title
        - description
        - category
        - priority
        - estimatedImprovement
        - implementationSteps
        - riskAssessment
        - status
        - createdAt
        - lastUpdated
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        title:
          type: string
        description:
          type: string
        category:
          type: string
          enum: [context_retrieval, ai_generation, database_query, file_system, memory_usage, cpu_usage, network_latency, cache_performance]
        priority:
          type: string
          enum: [low, medium, high, critical]
        estimatedImprovement:
          type: object
        implementationSteps:
          type: array
          items:
            type: string
        requiredResources:
          type: array
          items:
            type: string
        riskAssessment:
          type: object
        status:
          type: string
          enum: [new, reviewed, approved, implemented, rejected]
        createdAt:
          type: string
          format: date-time
        lastUpdated:
          type: string
          format: date-time

    PerformanceMonitoringConfig:
      type: object
      required:
        - id
        - intervals
        - thresholds
        - alerting
        - retention
        - autoOptimization
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        intervals:
          type: object
        thresholds:
          type: object
        alerting:
          type: object
        retention:
          type: object
        autoOptimization:
          type: object

    ResourceUtilization:
      type: object
      required:
        - id
        - timestamp
        - cpu
        - memory
        - disk
        - network
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        timestamp:
          type: string
          format: date-time
        cpu:
          type: object
        memory:
          type: object
        disk:
          type: object
        network:
          type: object
```

## **4. Detailed Business Logic & Validation Rules**

| Rule ID | Rule Description | Implementation Location(s) & Notes |
|---------|------------------|-----------------------------------|
| **PERF-01** | Context retrieval operations that exceed the 3-second KPI threshold must automatically trigger performance optimization rules and generate critical alerts. | **Backend (Authoritative):** Performance monitoring service must track all context retrieval times from Context Management Engine, compare against 3000ms threshold, and trigger optimization rules when violations occur. Integration with Logging Service for alert generation. |
| **PERF-02** | Cache optimization operations must coordinate with Context Management Engine and Vector Database Service to ensure cache invalidation strategies don't compromise data consistency. | **Backend (Authoritative):** Cache optimization service must call Context Management and Vector Database APIs to validate cache entries before eviction and ensure proper cache warming strategies during optimization. |
| **PERF-03** | Performance bottleneck detection must aggregate metrics from all system modules including Database Management, File System Management, and AI generation services to provide comprehensive analysis. | **Backend (Authoritative):** Bottleneck detection service must collect metrics from multiple modules via their performance APIs, analyze correlations, and identify cross-module performance dependencies that impact overall system performance. |
| **PERF-04** | Auto-optimization rules must respect the Configuration Management Module settings for safe mode operations and maximum optimization frequency to prevent system instability. | **Backend (Authoritative):** Auto-optimization service must query Configuration Management for current settings before executing any optimization, enforce rate limits, and operate in safe mode unless explicitly configured otherwise. |
| **PERF-05** | KPI compliance monitoring must validate that project resume times are under 30 seconds by coordinating with Project Management Module for project state restoration metrics. | **Backend (Authoritative):** KPI monitoring service must track project resume operations through Project Management API, measure end-to-end restoration times, and maintain compliance statistics for the user productivity KPI. |
| **PERF-06** | Resource utilization monitoring must integrate with the local system to track CPU, memory, and disk usage while respecting the local-first architecture's privacy constraints. | **Backend (Authoritative):** Resource monitoring service must use system APIs to collect utilization metrics without exposing sensitive user data, aggregate anonymized statistics, and provide optimization recommendations based on resource patterns. |
| **PERF-07** | Performance recommendation generation must analyze usage patterns from Analytics Service while maintaining user privacy by aggregating data without exposing individual session details. | **Backend (Authoritative):** Recommendation service must query Analytics Service for aggregated performance patterns, use AI analysis to generate recommendations, and ensure no individual user sessions or project details are exposed in recommendations. |
| **PERF-08** | Cache performance optimization must prioritize context cache efficiency to support the Context Management Efficiency KPI of managing 500+ files with <3 second retrieval times. | **Backend (Authoritative):** Cache optimization must monitor context cache hit rates, analyze access patterns for large projects, and implement intelligent prefetching and cache sizing strategies to maintain sub-3-second retrieval times. |
| **PERF-09** | Performance profile calculations must be cached for maximum 5 minutes to ensure real-time responsiveness while reducing computational overhead from frequent metric aggregation. | **Backend (Authoritative):** Performance service must implement intelligent caching of profile calculations with TTL of 300 seconds, invalidate cache on significant performance events, and provide fresh data for critical operations. |
| **PERF-10** | Optimization rule execution must create backup snapshots of current performance state before applying changes and provide rollback capability if optimization degrades performance. | **Backend (Authoritative):** Optimization execution service must capture baseline metrics before rule execution, monitor performance impact post-execution, and automatically rollback changes if performance degrades beyond acceptable thresholds. |

## **5. Developer Task Checklist**

### **Backend Tasks:**
- [ ] Create database migration script for performance optimization tables (`performance_profiles`, `optimization_rules`, `bottleneck_detections`, `cache_metrics`, `performance_recommendations`, `optimization_executions`, `resource_utilization_snapshots`)
- [ ] Implement the `PerformanceProfileService` class for comprehensive performance metric aggregation, KPI compliance monitoring, and real-time performance profile generation
- [ ] Implement the `BottleneckDetectionService` class for automated performance bottleneck analysis, root cause detection, and optimization strategy recommendation
- [ ] Implement the `CacheOptimizationService` class for intelligent cache performance monitoring, hit rate optimization, and cache configuration tuning
- [ ] Implement the `OptimizationRuleEngine` class for rule-based performance optimization with condition evaluation, action execution, and rollback capabilities
- [ ] Implement the `PerformanceRecommendationService` class for AI-powered performance optimization recommendations based on system usage patterns and bottleneck analysis
- [ ] Implement the `ResourceMonitoringService` class for real-time system resource utilization tracking with CPU, memory, disk, and network monitoring
- [ ] Implement the `KPIComplianceService` class for continuous monitoring of ReadyAI KPIs including context retrieval times, project resume times, and development velocity metrics
- [ ] Implement all performance monitoring endpoints (`GET /api/v1/performance/profile`, `GET /api/v1/performance/bottlenecks`, `POST /api/v1/performance/bottlenecks`) with real-time metric aggregation
- [ ] Implement cache performance endpoints (`GET /api/v1/performance/cache`, `POST /api/v1/performance/cache`) with cache optimization capabilities and multi-cache coordination
- [ ] Implement optimization rule management endpoints (`GET`, `POST`, `PUT`, `DELETE /api/v1/performance/optimization/rules/*`) with rule validation and execution tracking
- [ ] Implement performance recommendation endpoints (`GET`, `POST /api/v1/performance/recommendations`, `PATCH /api/v1/performance/recommendations/{id}/status`) with AI-powered analysis
- [ ] Implement resource utilization endpoint (`GET /api/v1/performance/resources`) with real-time system monitoring and historical trend analysis
- [ ] Implement KPI compliance endpoint (`GET /api/v1/performance/kpi-compliance`) with detailed compliance reporting and trend analysis
- [ ] Implement performance configuration endpoint (`GET`, `PUT /api/v1/performance/config`) with dynamic configuration updates and validation
- [ ] Create `PerformanceRepository` class for efficient storage and retrieval of performance metrics with time-series optimized indexing
- [ ] Create `OptimizationRepository` class for rule storage, execution history tracking, and performance improvement correlation analysis
- [ ] Implement integration with Context Management Engine for context retrieval performance monitoring and cache optimization coordination
- [ ] Implement integration with Vector Database Service for vector operation performance tracking and query optimization
- [ ] Implement integration with Analytics Service for performance data aggregation while maintaining privacy constraints
- [ ] Implement integration with Configuration Management Module for performance threshold management and optimization settings
- [ ] Implement integration with Logging & Monitoring Service for performance alert generation and metric correlation
- [ ] Create background services for continuous performance monitoring, automated bottleneck detection, and KPI compliance tracking
- [ ] Implement performance optimization middleware for automatic request/response time tracking across all API endpoints
- [ ] Create comprehensive unit tests for all service classes with mock implementations of dependent modules and performance scenario testing
- [ ] Create integration tests for performance optimization workflows including bottleneck detection, rule execution, and KPI validation scenarios
- [ ] Implement performance benchmarking tools for measuring optimization effectiveness and regression detection
- [ ] Add automated performance regression testing to ensure optimizations don't negatively impact system performance

### **Frontend Tasks:**
- [ ] Create `PerformanceProvider` React context for accessing performance monitoring and optimization functionality throughout the application
- [ ] Implement `usePerformance` hook for real-time performance metric access, KPI status monitoring, and optimization trigger capabilities
- [ ] Create `PerformanceDashboard` component for comprehensive performance overview with real-time metrics, KPI status, and system health visualization
- [ ] Implement `BottleneckAnalyzer` component for interactive bottleneck detection results with detailed analysis, severity indicators, and resolution tracking
- [ ] Create `CachePerformanceMonitor` component for cache performance visualization with hit rate charts, utilization graphs, and optimization recommendations
- [ ] Implement `OptimizationRuleManager` component for creating, editing, and managing performance optimization rules with condition builder and action configuration
- [ ] Create `PerformanceRecommendations` component for displaying AI-generated optimization recommendations with implementation guidance and impact estimates
- [ ] Implement `KPIComplianceTracker` component for real-time KPI monitoring with compliance status indicators, trend visualization, and alert management
- [ ] Create `ResourceUtilizationMonitor` component for system resource monitoring with CPU, memory, disk, and network utilization charts and alerts
- [ ] Implement `PerformanceConfigPanel` component for performance monitoring configuration with threshold management, alert settings, and auto-optimization controls
- [ ] Create performance service functions in the API client (`performanceService.ts`) for all performance optimization endpoints with proper error handling
- [ ] Implement real-time performance metric updates using WebSocket connections or Server-Sent Events for live dashboard updates
- [ ] Create performance metric visualization components using charts and graphs for trend analysis, bottleneck identification, and optimization impact tracking
- [ ] Implement performance alert notification system with toast notifications, dashboard indicators, and escalation workflows for critical performance issues
- [ ] Add performance optimization workflow components for guided optimization processes, rule creation wizards, and optimization impact assessment
- [ ] Create performance export functionality for downloading performance reports, optimization logs, and KPI compliance summaries
- [ ] Implement performance comparison tools for before/after optimization analysis, historical performance trends, and KPI improvement tracking
- [ ] Add performance debugging tools for developers including metric drill-down capabilities, correlation analysis, and performance profiling integration
- [ ] Create performance onboarding components for guiding users through performance monitoring setup, optimization rule configuration, and KPI threshold customization
- [ ] Implement performance search and filtering capabilities for finding specific metrics, bottlenecks, optimizations, and recommendations across large datasets



========================================================================================


# Cross-Project Learning System - Technical Specification

## **1. Module Overview**

**Purpose:** The Cross-Project Learning System serves as the intelligent pattern recognition and learning engine for ReadyAI, analyzing successful implementations across multiple projects to extract reusable patterns, track success metrics, and provide intelligent architectural and implementation suggestions. This module continuously learns from completed projects, phase outcomes, code quality metrics, and user decisions to improve future AI-generated code quality and development velocity while maintaining the local-first architecture principles.

**Dependencies & Interactions:** This module depends on the Context Management Engine to analyze code patterns, semantic relationships, and architectural structures across projects. It integrates with the Project Management Module to access project metadata, health metrics, phase progression data, and success indicators. The module relies on the Logging & Monitoring Service to gather performance metrics, error patterns, and usage analytics that inform learning algorithms. It interacts with the Configuration Management Module to store and retrieve learning preferences and optimization settings. The module provides learned insights to the AI Code Generation Engine and Multi-Phase Development Orchestrator to improve generation quality and phase recommendations, while supporting the Cross-Project Learning System charter feature and contributing to the 70-90% development velocity KPI through improved AI suggestions.

## **2. Module-Specific Type Additions (`types.crossProjectLearning.ts`)**

```typescript
/**
 * Cross-Project Learning System Module Types
 * Extends foundational types with learning and pattern recognition interfaces
 */

/** Pattern types that can be learned from projects */
export type LearnedPatternType = 
  | 'architectural'
  | 'implementation'
  | 'configuration'
  | 'testing'
  | 'dependency'
  | 'file_structure'
  | 'naming_convention'
  | 'error_handling';

/** Success metrics for pattern evaluation */
export type SuccessMetricType = 
  | 'build_success_rate'
  | 'test_coverage'
  | 'code_quality_score'
  | 'development_velocity'
  | 'error_rate'
  | 'maintenance_effort'
  | 'user_satisfaction';

/** Learning confidence levels */
export type LearningConfidenceLevel = 'low' | 'medium' | 'high' | 'very_high';

/** Suggestion application status */
export type SuggestionStatus = 'pending' | 'accepted' | 'rejected' | 'applied' | 'ignored';

/** Pattern frequency indicators */
export type PatternFrequency = 'rare' | 'uncommon' | 'common' | 'frequent' | 'ubiquitous';

/** Learned pattern from successful implementations */
export interface LearnedPattern {
  /** Unique pattern identifier */
  id: UUID;
  /** Pattern type category */
  type: LearnedPatternType;
  /** Pattern name for identification */
  name: string;
  /** Pattern description */
  description: string;
  /** Pattern content or structure */
  content: {
    /** Code template or structure */
    template?: string;
    /** Configuration pattern */
    configuration?: Record<string, any>;
    /** File structure pattern */
    fileStructure?: Array<{
      path: string;
      type: 'file' | 'directory';
      template?: string;
    }>;
    /** Dependency patterns */
    dependencies?: Array<{
      name: string;
      version?: string;
      context: string;
    }>;
  };
  /** Technology stack applicability */
  applicableTechStacks: TechStack[];
  /** Project phases where pattern applies */
  applicablePhases: PhaseType[];
  /** Pattern usage frequency */
  frequency: PatternFrequency;
  /** Learning confidence level */
  confidence: LearningConfidenceLevel;
  /** Success metrics for this pattern */
  successMetrics: PatternSuccessMetrics;
  /** Source projects that contributed to this pattern */
  sourceProjects: UUID[];
  /** Pattern tags for categorization */
  tags: string[];
  /** Pattern creation timestamp */
  createdAt: string; // ISO 8601 format
  /** Last update timestamp */
  lastUpdated: string; // ISO 8601 format
  /** Usage statistics */
  usageStats: {
    totalApplications: number;
    successfulApplications: number;
    lastUsed?: string; // ISO 8601 format
  };
}

/** Success metrics for pattern evaluation */
export interface PatternSuccessMetrics {
  /** Overall success score (0-100) */
  overallScore: number;
  /** Individual metric scores */
  metrics: Record<SuccessMetricType, {
    score: number;
    weight: number;
    confidence: number;
  }>;
  /** Metric calculation timestamp */
  calculatedAt: string; // ISO 8601 format
  /** Sample size for metrics */
  sampleSize: number;
}

/** Intelligent suggestion for current project */
export interface IntelligentSuggestion {
  /** Unique suggestion identifier */
  id: UUID;
  /** Target project for this suggestion */
  projectId: UUID;
  /** Associated learned pattern */
  patternId: UUID;
  /** Suggestion type */
  type: LearnedPatternType;
  /** Suggestion title */
  title: string;
  /** Detailed suggestion description */
  description: string;
  /** Suggested implementation */
  implementation: {
    /** Files to create or modify */
    files?: Array<{
      path: string;
      action: 'create' | 'modify' | 'delete';
      content?: string;
      changes?: string;
    }>;
    /** Configuration changes */
    configurations?: Array<{
      key: string;
      value: any;
      reason: string;
    }>;
    /** Dependencies to add */
    dependencies?: Array<{
      name: string;
      version?: string;
      reason: string;
    }>;
  };
  /** Applicable project phase */
  applicablePhase: PhaseType;
  /** Suggestion priority */
  priority: 'low' | 'medium' | 'high' | 'critical';
  /** Confidence in this suggestion */
  confidence: LearningConfidenceLevel;
  /** Expected benefits */
  expectedBenefits: Array<{
    metric: SuccessMetricType;
    expectedImprovement: number;
    description: string;
  }>;
  /** Potential risks or considerations */
  risks: string[];
  /** Implementation effort estimate */
  effortEstimate: {
    complexity: 'low' | 'medium' | 'high';
    estimatedTime: number; // minutes
    requiredSkills: string[];
  };
  /** Suggestion status */
  status: SuggestionStatus;
  /** Suggestion creation timestamp */
  createdAt: string; // ISO 8601 format
  /** User feedback on suggestion */
  feedback?: {
    rating: number; // 1-5
    comments?: string;
    actualOutcome?: string;
    submittedAt: string; // ISO 8601 format
  };
}

/** Project outcome data for learning */
export interface ProjectOutcome {
  /** Unique outcome identifier */
  id: UUID;
  /** Associated project */
  projectId: UUID;
  /** Outcome recording timestamp */
  recordedAt: string; // ISO 8601 format
  /** Project completion status */
  completionStatus: 'completed' | 'abandoned' | 'paused' | 'ongoing';
  /** Final project metrics */
  finalMetrics: {
    /** Total development time */
    totalDevelopmentTime: number; // minutes
    /** Final code quality score */
    codeQualityScore: number;
    /** Test coverage achieved */
    testCoverage: number;
    /** Number of phases completed */
    phasesCompleted: number;
    /** Error rate during development */
    developmentErrorRate: number;
    /** AI generation success rate */
    aiGenerationSuccessRate: number;
  };
  /** Technology stack used */
  techStackUsed: TechStack;
  /** Phases completed successfully */
  successfulPhases: PhaseType[];
  /** Challenges encountered */
  challenges: Array<{
    phase: PhaseType;
    challenge: string;
    resolution?: string;
    impact: 'low' | 'medium' | 'high';
  }>;
  /** Patterns successfully applied */
  appliedPatterns: UUID[];
  /** User satisfaction rating */
  userSatisfaction?: {
    rating: number; // 1-5
    feedback?: string;
  };
  /** Key learnings extracted */
  keyLearnings: string[];
}

/** Architectural decision record for learning */
export interface ArchitecturalDecision {
  /** Unique decision identifier */
  id: UUID;
  /** Associated project */
  projectId: UUID;
  /** Decision title */
  title: string;
  /** Decision context and rationale */
  context: string;
  /** Decision made */
  decision: string;
  /** Decision status */
  status: 'proposed' | 'accepted' | 'superseded' | 'rejected';
  /** Project phase when decided */
  phase: PhaseType;
  /** Technology stack context */
  techStack: TechStack;
  /** Decision outcomes */
  outcomes: {
    /** Whether decision was successful */
    successful: boolean;
    /** Measurable impacts */
    impacts: Array<{
      metric: SuccessMetricType;
      impact: number;
      description: string;
    }>;
    /** Lessons learned */
    lessonsLearned: string[];
  };
  /** Decision timestamp */
  decidedAt: string; // ISO 8601 format
  /** Outcome evaluation timestamp */
  evaluatedAt?: string; // ISO 8601 format
}

/** Learning analytics for system performance */
export interface LearningAnalytics {
  /** Analytics identifier */
  id: UUID;
  /** Analytics period */
  period: {
    start: string; // ISO 8601 format
    end: string; // ISO 8601 format
  };
  /** Pattern statistics */
  patternStats: {
    totalPatterns: number;
    newPatternsDiscovered: number;
    patternsApplied: number;
    patternSuccessRate: number;
  };
  /** Suggestion statistics */
  suggestionStats: {
    totalSuggestions: number;
    acceptedSuggestions: number;
    rejectedSuggestions: number;
    averageConfidence: number;
  };
  /** Learning effectiveness */
  effectiveness: {
    codeQualityImprovement: number;
    developmentVelocityImprovement: number;
    errorReduction: number;
    userSatisfactionScore: number;
  };
  /** Top performing patterns */
  topPatterns: Array<{
    patternId: UUID;
    patternName: string;
    successRate: number;
    usageCount: number;
  }>;
  /** Analytics calculation timestamp */
  calculatedAt: string; // ISO 8601 format
}

/** Learning preferences and configuration */
export interface LearningConfiguration {
  /** Configuration identifier */
  id: UUID;
  /** Global learning preferences */
  globalPreferences: {
    /** Enable automatic pattern extraction */
    enableAutoExtraction: boolean;
    /** Minimum confidence threshold for suggestions */
    suggestionConfidenceThreshold: LearningConfidenceLevel;
    /** Maximum suggestions per project */
    maxSuggestionsPerProject: number;
    /** Learning data retention period (days) */
    dataRetentionDays: number;
  };
  /** Pattern-specific preferences */
  patternPreferences: Record<LearnedPatternType, {
    enabled: boolean;
    weight: number;
    minFrequency: PatternFrequency;
  }>;
  /** Success metric preferences */
  metricPreferences: Record<SuccessMetricType, {
    enabled: boolean;
    weight: number;
    threshold: number;
  }>;
  /** Technology stack preferences */
  techStackPreferences: Array<{
    techStack: TechStack;
    priority: number;
    enabled: boolean;
  }>;
  /** Configuration last updated */
  lastUpdated: string; // ISO 8601 format
}
```

## **3. API Endpoint Specification (OpenAPI `paths` block)**

```yaml
paths:
  /api/v1/learning/patterns:
    get:
      tags:
        - Cross-Project Learning
      summary: Retrieve learned patterns
      description: Gets learned patterns with filtering and sorting options
      security:
        - localAuth: []
      parameters:
        - name: type
          in: query
          description: Filter by pattern type
          required: false
          schema:
            type: string
            enum: [architectural, implementation, configuration, testing, dependency, file_structure, naming_convention, error_handling]
        - name: techStack
          in: query
          description: Filter by applicable technology stack
          required: false
          schema:
            type: string
        - name: phase
          in: query
          description: Filter by applicable project phase
          required: false
          schema:
            $ref: '#/components/schemas/PhaseType'
        - name: confidence
          in: query
          description: Minimum confidence level
          required: false
          schema:
            type: string
            enum: [low, medium, high, very_high]
        - name: frequency
          in: query
          description: Minimum pattern frequency
          required: false
          schema:
            type: string
            enum: [rare, uncommon, common, frequent, ubiquitous]
        - name: limit
          in: query
          description: Maximum number of patterns to return
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
        - name: offset
          in: query
          description: Offset for pagination
          required: false
          schema:
            type: integer
            minimum: 0
            default: 0
      responses:
        '200':
          description: Learned patterns retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          patterns:
                            type: array
                            items:
                              $ref: '#/components/schemas/LearnedPattern'
                          totalCount:
                            type: integer
                          hasMore:
                            type: boolean
        '400':
          description: Invalid query parameters
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

    post:
      tags:
        - Cross-Project Learning
      summary: Manually add a learned pattern
      description: Allows manual addition of patterns for learning system
      security:
        - localAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                type:
                  type: string
                  enum: [architectural, implementation, configuration, testing, dependency, file_structure, naming_convention, error_handling]
                name:
                  type: string
                  minLength: 1
                  maxLength: 200
                description:
                  type: string
                  minLength: 1
                  maxLength: 1000
                content:
                  type: object
                applicableTechStacks:
                  type: array
                  items:
                    type: object
                applicablePhases:
                  type: array
                  items:
                    $ref: '#/components/schemas/PhaseType'
                tags:
                  type: array
                  items:
                    type: string
                sourceProjectId:
                  $ref: '#/components/schemas/UUID'
              required:
                - type
                - name
                - description
                - content
                - applicableTechStacks
                - applicablePhases
      responses:
        '201':
          description: Pattern added successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/LearnedPattern'
        '400':
          description: Invalid pattern data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

  /api/v1/learning/patterns/{patternId}:
    get:
      tags:
        - Cross-Project Learning
      summary: Get specific learned pattern
      description: Retrieves detailed information about a specific learned pattern
      security:
        - localAuth: []
      parameters:
        - name: patternId
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '200':
          description: Pattern retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/LearnedPattern'
        '404':
          description: Pattern not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

    delete:
      tags:
        - Cross-Project Learning
      summary: Delete learned pattern
      description: Removes a learned pattern from the system
      security:
        - localAuth: []
      parameters:
        - name: patternId
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '200':
          description: Pattern deleted successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '404':
          description: Pattern not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

  /api/v1/learning/suggestions/{projectId}:
    get:
      tags:
        - Cross-Project Learning
      summary: Get suggestions for project
      description: Retrieves intelligent suggestions based on learned patterns for a specific project
      security:
        - localAuth: []
      parameters:
        - name: projectId
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
        - name: phase
          in: query
          description: Filter suggestions by project phase
          required: false
          schema:
            $ref: '#/components/schemas/PhaseType'
        - name: priority
          in: query
          description: Filter by suggestion priority
          required: false
          schema:
            type: string
            enum: [low, medium, high, critical]
        - name: status
          in: query
          description: Filter by suggestion status
          required: false
          schema:
            type: string
            enum: [pending, accepted, rejected, applied, ignored]
      responses:
        '200':
          description: Suggestions retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          suggestions:
                            type: array
                            items:
                              $ref: '#/components/schemas/IntelligentSuggestion'
                          totalCount:
                            type: integer
        '404':
          description: Project not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

    post:
      tags:
        - Cross-Project Learning
      summary: Generate suggestions for project
      description: Triggers generation of new suggestions based on current project state and learned patterns
      security:
        - localAuth: []
      parameters:
        - name: projectId
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              properties:
                forceRegenerate:
                  type: boolean
                  default: false
                specificPatternTypes:
                  type: array
                  items:
                    type: string
                    enum: [architectural, implementation, configuration, testing, dependency, file_structure, naming_convention, error_handling]
                targetPhase:
                  $ref: '#/components/schemas/PhaseType'
      responses:
        '200':
          description: Suggestions generated successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          suggestionsGenerated: 
                            type: integer
                          suggestions:
                            type: array
                            items:
                              $ref: '#/components/schemas/IntelligentSuggestion'

  /api/v1/learning/suggestions/{suggestionId}/feedback:
    post:
      tags:
        - Cross-Project Learning
      summary: Provide feedback on suggestion
      description: Records user feedback on a specific suggestion to improve learning
      security:
        - localAuth: []
      parameters:
        - name: suggestionId
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                status:
                  type: string
                  enum: [accepted, rejected, applied, ignored]
                rating:
                  type: integer
                  minimum: 1
                  maximum: 5
                comments:
                  type: string
                  maxLength: 1000
                actualOutcome:
                  type: string
                  maxLength: 500
              required:
                - status
      responses:
        '200':
          description: Feedback recorded successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/IntelligentSuggestion'

  /api/v1/learning/outcomes:
    post:
      tags:
        - Cross-Project Learning
      summary: Record project outcome
      description: Records project completion outcome for learning purposes
      security:
        - localAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                projectId:
                  $ref: '#/components/schemas/UUID'
                completionStatus:
                  type: string
                  enum: [completed, abandoned, paused, ongoing]
                finalMetrics:
                  type: object
                  properties:
                    totalDevelopmentTime:
                      type: number
                    codeQualityScore:
                      type: number
                    testCoverage:
                      type: number
                    phasesCompleted:
                      type: integer
                    developmentErrorRate:
                      type: number
                    aiGenerationSuccessRate:
                      type: number
                successfulPhases:
                  type: array
                  items:
                    $ref: '#/components/schemas/PhaseType'
                challenges:
                  type: array
                  items:
                    type: object
                    properties:
                      phase:
                        $ref: '#/components/schemas/PhaseType'
                      challenge:
                        type: string
                      resolution:
                        type: string
                      impact:
                        type: string
                        enum: [low, medium, high]
                userSatisfaction:
                  type: object
                  properties:
                    rating:
                      type: integer
                      minimum: 1
                      maximum: 5
                    feedback:
                      type: string
                keyLearnings:
                  type: array
                  items:
                    type: string
              required:
                - projectId
                - completionStatus
                - finalMetrics
      responses:
        '201':
          description: Project outcome recorded successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/ProjectOutcome'

  /api/v1/learning/decisions:
    post:
      tags:
        - Cross-Project Learning
      summary: Record architectural decision
      description: Records an architectural decision for learning purposes
      security:
        - localAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                projectId:
                  $ref: '#/components/schemas/UUID'
                title:
                  type: string
                  minLength: 1
                  maxLength: 200
                context:
                  type: string
                  minLength: 1
                  maxLength: 2000
                decision:
                  type: string
                  minLength: 1
                  maxLength: 2000
                status:
                  type: string
                  enum: [proposed, accepted, superseded, rejected]
                phase:
                  $ref: '#/components/schemas/PhaseType'
              required:
                - projectId
                - title
                - context
                - decision
                - status
                - phase
      responses:
        '201':
          description: Architectural decision recorded successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/ArchitecturalDecision'

  /api/v1/learning/analytics:
    get:
      tags:
        - Cross-Project Learning
      summary: Get learning analytics
      description: Retrieves learning system performance analytics
      security:
        - localAuth: []
      parameters:
        - name: period
          in: query
          description: Analytics period
          required: false
          schema:
            type: string
            enum: [week, month, quarter, year]
            default: month
        - name: startDate
          in: query
          description: Start date for custom period
          required: false
          schema:
            type: string
            format: date
        - name: endDate
          in: query
          description: End date for custom period
          required: false
          schema:
            type: string
            format: date
      responses:
        '200':
          description: Learning analytics retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/LearningAnalytics'

  /api/v1/learning/configuration:
    get:
      tags:
        - Cross-Project Learning
      summary: Get learning configuration
      description: Retrieves current learning system configuration and preferences
      security:
        - localAuth: []
      responses:
        '200':
          description: Learning configuration retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/LearningConfiguration'

    put:
      tags:
        - Cross-Project Learning
      summary: Update learning configuration
      description: Updates learning system configuration and preferences
      security:
        - localAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                globalPreferences:
                  type: object
                  properties:
                    enableAutoExtraction:
                      type: boolean
                    suggestionConfidenceThreshold:
                      type: string
                      enum: [low, medium, high, very_high]
                    maxSuggestionsPerProject:
                      type: integer
                      minimum: 1
                      maximum: 50
                    dataRetentionDays:
                      type: integer
                      minimum: 30
                      maximum: 365
                patternPreferences:
                  type: object
                  additionalProperties:
                    type: object
                    properties:
                      enabled:
                        type: boolean
                      weight:
                        type: number
                        minimum: 0
                        maximum: 1
                      minFrequency:
                        type: string
                        enum: [rare, uncommon, common, frequent, ubiquitous]
                metricPreferences:
                  type: object
                  additionalProperties:
                    type: object
                    properties:
                      enabled:
                        type: boolean
                      weight:
                        type: number
                        minimum: 0
                        maximum: 1
                      threshold:
                        type: number
      responses:
        '200':
          description: Configuration updated successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/LearningConfiguration'

components:
  schemas:
    LearnedPattern:
      type: object
      required:
        - id
        - type
        - name
        - description
        - content
        - applicableTechStacks
        - applicablePhases
        - frequency
        - confidence
        - successMetrics
        - sourceProjects
        - tags
        - createdAt
        - lastUpdated
        - usageStats
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        type:
          type: string
          enum: [architectural, implementation, configuration, testing, dependency, file_structure, naming_convention, error_handling]
        name:
          type: string
        description:
          type: string
        content:
          type: object
        applicableTechStacks:
          type: array
          items:
            type: object
        applicablePhases:
          type: array
          items:
            $ref: '#/components/schemas/PhaseType'
        frequency:
          type: string
          enum: [rare, uncommon, common, frequent, ubiquitous]
        confidence:
          type: string
          enum: [low, medium, high, very_high]
        successMetrics:
          $ref: '#/components/schemas/PatternSuccessMetrics'
        sourceProjects:
          type: array
          items:
            $ref: '#/components/schemas/UUID'
        tags:
          type: array
          items:
            type: string
        createdAt:
          type: string
          format: date-time
        lastUpdated:
          type: string
          format: date-time
        usageStats:
          type: object
          properties:
            totalApplications:
              type: integer
            successfulApplications:
              type: integer
            lastUsed:
              type: string
              format: date-time

    PatternSuccessMetrics:
      type: object
      required:
        - overallScore
        - metrics
        - calculatedAt
        - sampleSize
      properties:
        overallScore:
          type: number
          minimum: 0
          maximum: 100
        metrics:
          type: object
          additionalProperties:
            type: object
            properties:
              score:
                type: number
              weight:
                type: number
              confidence:
                type: number
        calculatedAt:
          type: string
          format: date-time
        sampleSize:
          type: integer

    IntelligentSuggestion:
      type: object
      required:
        - id
        - projectId
        - patternId
        - type
        - title
        - description
        - implementation
        - applicablePhase
        - priority
        - confidence
        - expectedBenefits
        - risks
        - effortEstimate
        - status
        - createdAt
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        projectId:
          $ref: '#/components/schemas/UUID'
        patternId:
          $ref: '#/components/schemas/UUID'
        type:
          type: string
          enum: [architectural, implementation, configuration, testing, dependency, file_structure, naming_convention, error_handling]
        title:
          type: string
        description:
          type: string
        implementation:
          type: object
        applicablePhase:
          $ref: '#/components/schemas/PhaseType'
        priority:
          type: string
          enum: [low, medium, high, critical]
        confidence:
          type: string
          enum: [low, medium, high, very_high]
        expectedBenefits:
          type: array
          items:
            type: object
        risks:
          type: array
          items:
            type: string
        effortEstimate:
          type: object
        status:
          type: string
          enum: [pending, accepted, rejected, applied, ignored]
        createdAt:
          type: string
          format: date-time
        feedback:
          type: object
          properties:
            rating:
              type: integer
              minimum: 1
              maximum: 5
            comments:
              type: string
            actualOutcome:
              type: string
            submittedAt:
              type: string
              format: date-time

    ProjectOutcome:
      type: object
      required:
        - id
        - projectId
        - recordedAt
        - completionStatus
        - finalMetrics
        - techStackUsed
        - successfulPhases
        - challenges
        - appliedPatterns
        - keyLearnings
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        projectId:
          $ref: '#/components/schemas/UUID'
        recordedAt:
          type: string
          format: date-time
        completionStatus:
          type: string
          enum: [completed, abandoned, paused, ongoing]
        finalMetrics:
          type: object
        techStackUsed:
          type: object
        successfulPhases:
          type: array
          items:
            $ref: '#/components/schemas/PhaseType'
        challenges:
          type: array
          items:
            type: object
        appliedPatterns:
          type: array
          items:
            $ref: '#/components/schemas/UUID'
        keyLearnings:
          type: array
          items:
            type: string
        userSatisfaction:
          type: object
          properties:
            rating:
              type: integer
              minimum: 1
              maximum: 5
            feedback:
              type: string

    ArchitecturalDecision:
      type: object
      required:
        - id
        - projectId
        - title
        - context
        - decision
        - status
        - phase
        - techStack
        - outcomes
        - decidedAt
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        projectId:
          $ref: '#/components/schemas/UUID'
        title:
          type: string
        context:
          type: string
        decision:
          type: string
        status:
          type: string
          enum: [proposed, accepted, superseded, rejected]
        phase:
          $ref: '#/components/schemas/PhaseType'
        techStack:
          type: object
        outcomes:
          type: object
        decidedAt:
          type: string
          format: date-time
        evaluatedAt:
          type: string
          format: date-time

    LearningAnalytics:
      type: object
      required:
        - id
        - period
        - patternStats
        - suggestionStats
        - effectiveness
        - topPatterns
        - calculatedAt
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        period:
          type: object
          properties:
            start:
              type: string
              format: date-time
            end:
              type: string
              format: date-time
        patternStats:
          type: object
        suggestionStats:
          type: object
        effectiveness:
          type: object
        topPatterns:
          type: array
          items:
            type: object
        calculatedAt:
          type: string
          format: date-time

    LearningConfiguration:
      type: object
      required:
        - id
        - globalPreferences
        - patternPreferences
        - metricPreferences
        - techStackPreferences
        - lastUpdated
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        globalPreferences:
          type: object
        patternPreferences:
          type: object
        metricPreferences:
          type: object
        techStackPreferences:
          type: array
          items:
            type: object
        lastUpdated:
          type: string
          format: date-time
```

## **4. Detailed Business Logic & Validation Rules**

| Rule ID | Rule Description | Implementation Location(s) & Notes |
|---------|------------------|-----------------------------------|
| **CPL-01** | Pattern extraction must only occur from completed projects with successful outcomes to ensure learning from verified implementations. | **Backend (Authoritative):** Pattern extraction service must query Project Management Module for project completion status and success metrics before extracting patterns. Only projects with status 'completed' and positive outcome metrics qualify. |
| **CPL-02** | Intelligent suggestions must be contextually relevant to the target project's current phase, technology stack, and existing patterns to maintain suggestion quality. | **Backend (Authoritative):** Suggestion generation service must validate against Project Management Module for current project phase and tech stack, and Context Management Engine for existing code patterns before generating suggestions. |
| **CPL-03** | Pattern confidence levels must be calculated based on sample size, success rate, and consistency across multiple projects to ensure reliable learning. | **Backend (Authoritative):** Confidence calculation must require minimum sample size (3 projects for 'low', 5 for 'medium', 10 for 'high', 20 for 'very_high') and success rate thresholds (60%, 70%, 80%, 90% respectively). |
| **CPL-04** | User feedback on suggestions must be weighted by actual implementation outcomes to improve future learning accuracy and prevent feedback gaming. | **Backend (Authoritative):** Feedback processing must track actual project outcomes through Project Management Module and weight feedback scores based on measured success metrics rather than just user ratings. |
| **CPL-05** | Architectural decisions must be linked to measurable outcomes through integration with Project Management Module metrics to enable decision effectiveness learning. | **Backend (Authoritative):** Decision recording must automatically track subsequent project metrics through Project Management Module integration and update decision outcomes based on quality, velocity, and error rate impacts. |
| **CPL-06** | Pattern application tracking must coordinate with Context Management Engine to verify successful integration and measure impact on code quality metrics. | **Backend (Authoritative):** Pattern application must be validated through Context Management Engine integration to confirm successful code integration and measure architectural consistency improvements. |
| **CPL-07** | Learning data retention must comply with Configuration Management Module policies while preserving sufficient data for meaningful pattern analysis. | **Backend (Authoritative):** Data cleanup service must query Configuration Management Module for retention policies and implement graduated data archival that preserves pattern insights while removing detailed project data. |
| **CPL-08** | Cross-project pattern matching must exclude sensitive project-specific information to maintain local-first privacy while enabling effective learning. | **Backend (Authoritative):** Pattern extraction must sanitize project-specific identifiers, file paths, and business logic while preserving structural and architectural patterns for cross-project learning. |
| **CPL-09** | Learning effectiveness metrics must integrate with Logging & Monitoring Service to track system-wide improvements in development velocity and code quality KPIs. | **Backend (Authoritative):** Analytics service must query Logging & Monitoring Service for development time metrics, error rates, and quality scores to measure learning system effectiveness against ReadyAI KPIs. |
| **CPL-10** | Pattern recommendations must respect user preferences from Configuration Management Module and adapt suggestion frequency based on acceptance rates. | **Backend (Authoritative):** Suggestion engine must query Configuration Management Module for user learning preferences and implement adaptive suggestion frequency based on historical acceptance rates and feedback patterns. |

## **5. Developer Task Checklist**

### **Backend Tasks:**
- [ ] Create database migration script for cross-project learning tables (`learned_patterns`, `intelligent_suggestions`, `project_outcomes`, `architectural_decisions`, `pattern_success_metrics`, `learning_configuration`, `suggestion_feedback`)
- [ ] Implement the `CrossProjectLearningService` class with pattern extraction, suggestion generation, and outcome tracking capabilities
- [ ] Implement the `PatternExtractionService` class for automatically discovering patterns from completed projects using Context Management Engine data
- [ ] Implement the `SuggestionGenerationService` class for creating intelligent recommendations based on learned patterns and project context
- [ ] Implement the `OutcomeTrackingService` class for recording project outcomes and measuring pattern effectiveness
- [ ] Implement the `LearningAnalyticsService` class for calculating learning effectiveness metrics and system performance
- [ ] Implement all pattern management endpoints (`GET`, `POST /api/v1/learning/patterns`, `GET`, `DELETE /api/v1/learning/patterns/{id}`)
- [ ] Implement project suggestion endpoints (`GET`, `POST /api/v1/learning/suggestions/{projectId}`)
- [ ] Implement suggestion feedback endpoint (`POST /api/v1/learning/suggestions/{suggestionId}/feedback`)
- [ ] Implement outcome recording endpoints (`POST /api/v1/learning/outcomes`, `POST /api/v1/learning/decisions`)
- [ ] Implement learning analytics endpoint (`GET /api/v1/learning/analytics`)
- [ ] Implement learning configuration endpoints (`GET`, `PUT /api/v1/learning/configuration`)
- [ ] Create `CrossProjectLearningRepository` class for efficient pattern storage and retrieval with indexing on type, tech stack, phase, and confidence
- [ ] Create `SuggestionRepository` class for managing intelligent suggestions with status tracking and feedback collection
- [ ] Create `OutcomeRepository` class for storing project outcomes and architectural decisions with outcome correlation
- [ ] Implement integration with Project Management Module for accessing project metadata, health metrics, and completion status
- [ ] Implement integration with Context Management Engine for analyzing code patterns, semantic relationships, and architectural structures
- [ ] Implement integration with Logging & Monitoring Service for collecting performance metrics and development velocity data
- [ ] Implement integration with Configuration Management Module for learning preferences and adaptive configuration
- [ ] Implement pattern confidence calculation algorithms based on sample size, success rate, and cross-project consistency
- [ ] Implement adaptive suggestion algorithms that improve based on user feedback and implementation outcomes
- [ ] Create background services for automatic pattern extraction from completed projects and periodic learning analytics updates
- [ ] Implement comprehensive unit tests for all service classes with mock implementations of dependent modules
- [ ] Create integration tests for learning workflows including pattern discovery, suggestion generation, and outcome tracking
- [ ] Implement performance optimizations for pattern matching and suggestion generation with caching and efficient algorithms
- [ ] Add data privacy safeguards to ensure project-specific sensitive information is not exposed in cross-project learning

### **Frontend Tasks:**
- [ ] Create `CrossProjectLearningProvider` React context for accessing learning system functionality and suggestion state
- [ ] Implement `useLearning` hook for pattern retrieval, suggestion management, and feedback submission
- [ ] Create `PatternLibrary` component for browsing and managing learned patterns with filtering and search capabilities
- [ ] Implement `SuggestionsPanel` component for displaying intelligent suggestions with implementation previews and action buttons
- [ ] Create `SuggestionCard` component for individual suggestions with detailed information, benefits, and risk assessment
- [ ] Implement `FeedbackDialog` component for collecting user feedback on applied suggestions with rating and outcome tracking
- [ ] Create `LearningAnalytics` component for visualizing learning effectiveness metrics and system performance trends
- [ ] Implement `PatternDetails` component for detailed pattern information with usage examples and success metrics
- [ ] Create `LearningConfiguration` component for managing learning preferences and system settings
- [ ] Implement `OutcomeRecording` component for capturing project completion outcomes and lessons learned
- [ ] Create learning service functions in the API client (`learningService.ts`) for all cross-project learning endpoints
- [ ] Implement VS Code extension integration for displaying suggestions in the workspace with contextual recommendations
- [ ] Create pattern search and filtering interface with technology stack and phase-based filtering
- [ ] Implement suggestion notification system for alerting users about new relevant suggestions
- [ ] Add suggestion preview and simulation capabilities to show potential implementation impacts
- [ ] Create pattern contribution workflow allowing users to manually submit successful patterns for sharing
- [ ] Implement learning progress visualization showing system improvement over time and user benefit metrics
- [ ] Add integration with project dashboard to display learning-based insights and recommendations
- [ ] Create pattern comparison tools for evaluating different approaches and their success metrics
- [ ] Implement automated suggestion acceptance workflow for high-confidence patterns with user approval settings
- [ ] Add learning system onboarding and tutorial components to help users understand and utilize the system effectively



========================================================================================


# Analytics & Metrics Module - Technical Specification

## **1. Module Overview**

**Purpose:** The Analytics & Metrics Module serves as the advanced analytics and business intelligence layer for ReadyAI, providing comprehensive usage tracking, performance trend analysis, quality metrics aggregation, and strategic reporting capabilities. This module transforms raw data from various system components into actionable insights that support the ReadyAI KPIs (development velocity, code quality consistency, context management efficiency, and user productivity) while maintaining the local-first architecture principles. It focuses on historical analysis, trend identification, and predictive insights to help users optimize their development workflows.

**Dependencies & Interactions:** This module depends on the Logging & Monitoring Service to access raw metrics, performance data, and usage statistics collected from all system components. It depends on the Database Management Module for advanced data persistence, aggregation queries, and historical data storage. The module interacts with the Configuration Management Module to obtain analytics configuration settings and reporting preferences. It integrates with the Project Management Module to access project metadata for project-specific analytics, with the Multi-Phase Development Orchestrator to analyze phase completion patterns and development velocity trends, and with the Context Management Engine to evaluate context usage efficiency over time. The module provides analytical insights that enhance the user experience across the VS Code Extension and Frontend Application.

## **2. Module-Specific Type Additions (`types.analytics.ts`)**

```typescript
/**
 * Analytics & Metrics Module Types
 * Extends foundational types with advanced analytics interfaces
 */

/** Analytics report types */
export type AnalyticsReportType = 
  | 'productivity_summary'
  | 'quality_trends'
  | 'performance_analysis'
  | 'usage_patterns'
  | 'phase_efficiency'
  | 'context_optimization'
  | 'custom_report';

/** Analytics time granularity */
export type AnalyticsGranularity = 'hour' | 'day' | 'week' | 'month' | 'quarter' | 'year';

/** Trend direction indicators */
export type TrendDirection = 'improving' | 'declining' | 'stable' | 'volatile';

/** Analytics aggregation methods */
export type AggregationMethod = 'sum' | 'average' | 'median' | 'min' | 'max' | 'count' | 'percentile';

/** Analytics insight types */
export type InsightType = 'optimization' | 'warning' | 'achievement' | 'recommendation' | 'anomaly';

/** Productivity metrics aggregation */
export interface ProductivityMetrics {
  /** Metrics identifier */
  id: UUID;
  /** Project context (optional) */
  projectId?: UUID;
  /** Time period start */
  periodStart: string; // ISO 8601 format
  /** Time period end */
  periodEnd: string; // ISO 8601 format
  /** Development velocity metrics */
  velocity: {
    /** Average time from project start to working application */
    avgTimeToWorking: number; // minutes
    /** Percentage reduction compared to manual development */
    efficiencyGain: number; // percentage
    /** Number of projects completed */
    projectsCompleted: number;
    /** Average phases per day */
    avgPhasesPerDay: number;
  };
  /** Code generation metrics */
  generation: {
    /** Total files generated */
    totalFilesGenerated: number;
    /** Total lines of code generated */
    totalLinesGenerated: number;
    /** Average generation time per file */
    avgGenerationTime: number; // milliseconds
    /** Generation success rate */
    successRate: number; // percentage
  };
  /** Context efficiency metrics */
  contextEfficiency: {
    /** Average context retrieval time */
    avgRetrievalTime: number; // milliseconds
    /** Context cache hit rate */
    cacheHitRate: number; // percentage
    /** Average context relevance score */
    avgRelevanceScore: number; // 0-1
    /** Context optimization saves */
    optimizationSaves: number; // milliseconds saved
  };
  /** Calculation timestamp */
  calculatedAt: string; // ISO 8601 format
}

/** Quality trend analysis */
export interface QualityTrendAnalysis {
  /** Analysis identifier */
  id: UUID;
  /** Project context (optional) */
  projectId?: UUID;
  /** Analysis period start */
  periodStart: string; // ISO 8601 format
  /** Analysis period end */
  periodEnd: string; // ISO 8601 format
  /** Architectural consistency trends */
  architecturalConsistency: {
    /** Current score */
    currentScore: number; // 0-100
    /** Previous period score */
    previousScore: number; // 0-100
    /** Trend direction */
    trend: TrendDirection;
    /** Score history over time */
    history: Array<{
      timestamp: string;
      score: number;
    }>;
  };
  /** Test coverage trends */
  testCoverage: {
    /** Current coverage percentage */
    currentCoverage: number; // 0-100
    /** Previous period coverage */
    previousCoverage: number; // 0-100
    /** Trend direction */
    trend: TrendDirection;
    /** Coverage history */
    history: Array<{
      timestamp: string;
      coverage: number;
    }>;
  };
  /** Dependency health trends */
  dependencyHealth: {
    /** Current health score */
    currentHealth: number; // 0-100
    /** Previous period health */
    previousHealth: number; // 0-100
    /** Trend direction */
    trend: TrendDirection;
    /** Health incidents */
    incidents: number;
  };
  /** Analysis timestamp */
  analyzedAt: string; // ISO 8601 format
}

/** Usage pattern analysis */
export interface UsagePatternAnalysis {
  /** Analysis identifier */
  id: UUID;
  /** Analysis period start */
  periodStart: string; // ISO 8601 format
  /** Analysis period end */
  periodEnd: string; // ISO 8601 format
  /** Peak usage times */
  peakUsageTimes: Array<{
    hour: number; // 0-23
    dayOfWeek: number; // 0-6
    activityScore: number; // 0-100
  }>;
  /** Most active phases */
  phaseActivity: Array<{
    phase: PhaseType;
    usageCount: number;
    avgDuration: number; // minutes
    successRate: number; // percentage
  }>;
  /** Feature usage patterns */
  featureUsage: Array<{
    feature: string;
    usageCount: number;
    avgSessionDuration: number; // minutes
    userSatisfactionScore: number; // 0-100
  }>;
  /** AI provider usage */
  aiProviderUsage: {
    totalRequests: number;
    avgResponseTime: number; // milliseconds
    tokenUsage: {
      total: number;
      input: number;
      output: number;
      cost: number; // estimated cost
    };
  };
  /** Analysis timestamp */
  analyzedAt: string; // ISO 8601 format
}

/** Analytics insight */
export interface AnalyticsInsight {
  /** Insight identifier */
  id: UUID;
  /** Insight type */
  type: InsightType;
  /** Insight title */
  title: string;
  /** Insight description */
  description: string;
  /** Insight confidence score */
  confidence: number; // 0-100
  /** Related metrics */
  relatedMetrics: Array<{
    metric: string;
    value: number;
    unit: string;
    context?: string;
  }>;
  /** Recommended actions */
  recommendations?: string[];
  /** Insight priority */
  priority: 'low' | 'medium' | 'high' | 'critical';
  /** Project context (if applicable) */
  projectId?: UUID;
  /** Insight generation timestamp */
  generatedAt: string; // ISO 8601 format
  /** Insight expiration timestamp */
  expiresAt?: string; // ISO 8601 format
}

/** Performance benchmark */
export interface PerformanceBenchmark {
  /** Benchmark identifier */
  id: UUID;
  /** Benchmark name */
  name: string;
  /** Benchmark category */
  category: 'context_retrieval' | 'ai_generation' | 'phase_transition' | 'file_operations' | 'overall_productivity';
  /** Current performance value */
  currentValue: number;
  /** Performance unit */
  unit: string;
  /** Target/optimal value */
  targetValue: number;
  /** Performance percentile (compared to historical data) */
  percentile: number; // 0-100
  /** Historical performance data */
  history: Array<{
    timestamp: string;
    value: number;
    context?: Record<string, any>;
  }>;
  /** Benchmark last updated */
  lastUpdated: string; // ISO 8601 format
}

/** Custom analytics report */
export interface CustomAnalyticsReport {
  /** Report identifier */
  id: UUID;
  /** Report name */
  name: string;
  /** Report description */
  description?: string;
  /** Report type */
  type: AnalyticsReportType;
  /** Report configuration */
  config: {
    /** Time period */
    timePeriod: {
      start: string; // ISO 8601 format
      end: string; // ISO 8601 format
      granularity: AnalyticsGranularity;
    };
    /** Metrics to include */
    metrics: Array<{
      name: string;
      aggregation: AggregationMethod;
      filters?: Record<string, any>;
    }>;
    /** Grouping dimensions */
    groupBy?: string[];
    /** Filters */
    filters?: Record<string, any>;
  };
  /** Report data */
  data: {
    /** Summary statistics */
    summary: Record<string, any>;
    /** Time series data */
    timeSeries?: Array<{
      timestamp: string;
      values: Record<string, number>;
    }>;
    /** Dimensional breakdowns */
    breakdowns?: Record<string, Array<{
      dimension: string;
      value: number;
      percentage: number;
    }>>;
  };
  /** Generated insights */
  insights: AnalyticsInsight[];
  /** Report creation timestamp */
  createdAt: string; // ISO 8601 format
  /** Report last generated timestamp */
  lastGenerated: string; // ISO 8601 format
}

/** Analytics dashboard configuration */
export interface AnalyticsDashboard {
  /** Dashboard identifier */
  id: UUID;
  /** Dashboard name */
  name: string;
  /** Dashboard description */
  description?: string;
  /** Dashboard layout configuration */
  layout: {
    /** Dashboard widgets */
    widgets: Array<{
      id: UUID;
      type: 'metric_card' | 'trend_chart' | 'usage_heatmap' | 'insight_list' | 'benchmark_gauge';
      position: {
        x: number;
        y: number;
        width: number;
        height: number;
      };
      config: Record<string, any>;
    }>;
    /** Refresh interval in minutes */
    refreshInterval: number;
  };
  /** Dashboard access settings */
  access: {
    /** Whether dashboard is public */
    isPublic: boolean;
    /** Allowed project contexts */
    allowedProjects?: UUID[];
  };
  /** Dashboard creation timestamp */
  createdAt: string; // ISO 8601 format
  /** Dashboard last modified timestamp */
  lastModified: string; // ISO 8601 format
}

/** Analytics export configuration */
export interface AnalyticsExport {
  /** Export identifier */
  id: UUID;
  /** Export name */
  name: string;
  /** Export format */
  format: 'json' | 'csv' | 'excel' | 'pdf';
  /** Data to export */
  data: {
    /** Report IDs to include */
    reportIds?: UUID[];
    /** Raw metrics query */
    metricsQuery?: {
      startDate: string;
      endDate: string;
      metrics: string[];
      filters?: Record<string, any>;
    };
    /** Dashboard snapshot */
    dashboardId?: UUID;
  };
  /** Export status */
  status: 'pending' | 'processing' | 'completed' | 'failed';
  /** Export file path (when completed) */
  filePath?: string;
  /** Export creation timestamp */
  createdAt: string; // ISO 8601 format
  /** Export completion timestamp */
  completedAt?: string; // ISO 8601 format
}
```

## **3. API Endpoint Specification (OpenAPI `paths` block)**

```yaml
paths:
  /api/v1/analytics/productivity:
    get:
      tags:
        - Analytics
      summary: Get productivity metrics
      description: Retrieves comprehensive productivity metrics and development velocity analysis
      security:
        - localAuth: []
      parameters:
        - name: projectId
          in: query
          description: Filter metrics for specific project
          required: false
          schema:
            $ref: '#/components/schemas/UUID'
        - name: startDate
          in: query
          description: Start date for metrics period
          required: false
          schema:
            type: string
            format: date
        - name: endDate
          in: query
          description: End date for metrics period
          required: false
          schema:
            type: string
            format: date
        - name: granularity
          in: query
          description: Time granularity for metrics
          required: false
          schema:
            type: string
            enum: [hour, day, week, month, quarter, year]
            default: week
      responses:
        '200':
          description: Productivity metrics retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/ProductivityMetrics'
        '400':
          description: Invalid query parameters
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

  /api/v1/analytics/quality/trends:
    get:
      tags:
        - Analytics
      summary: Get quality trend analysis
      description: Analyzes quality metrics trends over time including architectural consistency, test coverage, and dependency health
      security:
        - localAuth: []
      parameters:
        - name: projectId
          in: query
          description: Filter analysis for specific project
          required: false
          schema:
            $ref: '#/components/schemas/UUID'
        - name: period
          in: query
          description: Analysis period
          required: false
          schema:
            type: string
            enum: [week, month, quarter, year]
            default: month
        - name: compareWith
          in: query
          description: Previous period to compare with
          required: false
          schema:
            type: string
            enum: [previous_period, same_period_last_year, baseline]
      responses:
        '200':
          description: Quality trend analysis retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/QualityTrendAnalysis'

  /api/v1/analytics/usage-patterns:
    get:
      tags:
        - Analytics
      summary: Get usage pattern analysis
      description: Analyzes user behavior patterns, peak usage times, and feature utilization
      security:
        - localAuth: []
      parameters:
        - name: period
          in: query
          description: Analysis period
          required: false
          schema:
            type: string
            enum: [week, month, quarter, year]
            default: month
        - name: includeFeatures
          in: query
          description: Include detailed feature usage analysis
          required: false
          schema:
            type: boolean
            default: true
      responses:
        '200':
          description: Usage pattern analysis retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/UsagePatternAnalysis'

  /api/v1/analytics/insights:
    get:
      tags:
        - Analytics
      summary: Get analytics insights
      description: Retrieves AI-generated insights and recommendations based on analytics data
      security:
        - localAuth: []
      parameters:
        - name: projectId
          in: query
          description: Filter insights for specific project
          required: false
          schema:
            $ref: '#/components/schemas/UUID'
        - name: type
          in: query
          description: Filter by insight type
          required: false
          schema:
            type: string
            enum: [optimization, warning, achievement, recommendation, anomaly]
        - name: priority
          in: query
          description: Filter by insight priority
          required: false
          schema:
            type: string
            enum: [low, medium, high, critical]
        - name: limit
          in: query
          description: Maximum number of insights to return
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
      responses:
        '200':
          description: Analytics insights retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          insights:
                            type: array
                            items:
                              $ref: '#/components/schemas/AnalyticsInsight'
                          totalCount:
                            type: integer

    post:
      tags:
        - Analytics
      summary: Generate analytics insights
      description: Triggers AI-powered analysis to generate new insights and recommendations
      security:
        - localAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                projectId:
                  $ref: '#/components/schemas/UUID'
                  description: Generate insights for specific project (optional)
                analysisType:
                  type: string
                  enum: [comprehensive, performance_focused, quality_focused, productivity_focused]
                  default: comprehensive
                timePeriod:
                  type: object
                  properties:
                    start:
                      type: string
                      format: date
                    end:
                      type: string
                      format: date
      responses:
        '202':
          description: Insight generation started
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          jobId:
                            $ref: '#/components/schemas/UUID'
                          estimatedCompletion:
                            type: string
                            format: date-time

  /api/v1/analytics/benchmarks:
    get:
      tags:
        - Analytics
      summary: Get performance benchmarks
      description: Retrieves performance benchmarks and comparisons against targets and historical data
      security:
        - localAuth: []
      parameters:
        - name: category
          in: query
          description: Filter by benchmark category
          required: false
          schema:
            type: string
            enum: [context_retrieval, ai_generation, phase_transition, file_operations, overall_productivity]
        - name: projectId
          in: query
          description: Filter benchmarks for specific project
          required: false
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '200':
          description: Performance benchmarks retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          benchmarks:
                            type: array
                            items:
                              $ref: '#/components/schemas/PerformanceBenchmark'

    post:
      tags:
        - Analytics
      summary: Create custom benchmark
      description: Creates a new performance benchmark for tracking specific metrics
      security:
        - localAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  minLength: 1
                  maxLength: 100
                category:
                  type: string
                  enum: [context_retrieval, ai_generation, phase_transition, file_operations, overall_productivity]
                targetValue:
                  type: number
                unit:
                  type: string
                  minLength: 1
                  maxLength: 20
                projectId:
                  $ref: '#/components/schemas/UUID'
                  description: Project-specific benchmark (optional)
              required:
                - name
                - category
                - targetValue
                - unit
      responses:
        '201':
          description: Benchmark created successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/PerformanceBenchmark'

  /api/v1/analytics/reports:
    get:
      tags:
        - Analytics
      summary: List analytics reports
      description: Retrieves list of available analytics reports
      security:
        - localAuth: []
      parameters:
        - name: type
          in: query
          description: Filter by report type
          required: false
          schema:
            type: string
            enum: [productivity_summary, quality_trends, performance_analysis, usage_patterns, phase_efficiency, context_optimization, custom_report]
        - name: projectId
          in: query
          description: Filter reports for specific project
          required: false
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '200':
          description: Analytics reports retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          reports:
                            type: array
                            items:
                              $ref: '#/components/schemas/CustomAnalyticsReport'

    post:
      tags:
        - Analytics
      summary: Create custom analytics report
      description: Creates a new custom analytics report with specified metrics and configuration
      security:
        - localAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  minLength: 1
                  maxLength: 100
                description:
                  type: string
                  maxLength: 500
                type:
                  type: string
                  enum: [productivity_summary, quality_trends, performance_analysis, usage_patterns, phase_efficiency, context_optimization, custom_report]
                config:
                  type: object
                  properties:
                    timePeriod:
                      type: object
                      properties:
                        start:
                          type: string
                          format: date
                        end:
                          type: string
                          format: date
                        granularity:
                          type: string
                          enum: [hour, day, week, month, quarter, year]
                      required:
                        - start
                        - end
                        - granularity
                    metrics:
                      type: array
                      items:
                        type: object
                        properties:
                          name:
                            type: string
                          aggregation:
                            type: string
                            enum: [sum, average, median, min, max, count, percentile]
                          filters:
                            type: object
                        required:
                          - name
                          - aggregation
                    groupBy:
                      type: array
                      items:
                        type: string
                    filters:
                      type: object
                  required:
                    - timePeriod
                    - metrics
              required:
                - name
                - type
                - config
      responses:
        '201':
          description: Analytics report created successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/CustomAnalyticsReport'

  /api/v1/analytics/reports/{reportId}:
    get:
      tags:
        - Analytics
      summary: Get analytics report
      description: Retrieves a specific analytics report with generated data and insights
      security:
        - localAuth: []
      parameters:
        - name: reportId
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
        - name: regenerate
          in: query
          description: Force regeneration of report data
          required: false
          schema:
            type: boolean
            default: false
      responses:
        '200':
          description: Analytics report retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/CustomAnalyticsReport'
        '404':
          description: Report not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

    put:
      tags:
        - Analytics
      summary: Update analytics report
      description: Updates an existing analytics report configuration
      security:
        - localAuth: []
      parameters:
        - name: reportId
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  minLength: 1
                  maxLength: 100
                description:
                  type: string
                  maxLength: 500
                config:
                  type: object
      responses:
        '200':
          description: Analytics report updated successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/CustomAnalyticsReport'

    delete:
      tags:
        - Analytics
      summary: Delete analytics report
      description: Deletes an analytics report
      security:
        - localAuth: []
      parameters:
        - name: reportId
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '200':
          description: Analytics report deleted successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'

  /api/v1/analytics/dashboards:
    get:
      tags:
        - Analytics
      summary: List analytics dashboards
      description: Retrieves list of available analytics dashboards
      security:
        - localAuth: []
      responses:
        '200':
          description: Analytics dashboards retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          dashboards:
                            type: array
                            items:
                              $ref: '#/components/schemas/AnalyticsDashboard'

    post:
      tags:
        - Analytics
      summary: Create analytics dashboard
      description: Creates a new analytics dashboard with custom widgets and layout
      security:
        - localAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  minLength: 1
                  maxLength: 100
                description:
                  type: string
                  maxLength: 500
                layout:
                  type: object
                  properties:
                    widgets:
                      type: array
                      items:
                        type: object
                        properties:
                          type:
                            type: string
                            enum: [metric_card, trend_chart, usage_heatmap, insight_list, benchmark_gauge]
                          position:
                            type: object
                            properties:
                              x:
                                type: number
                              y:
                                type: number
                              width:
                                type: number
                              height:
                                type: number
                            required: [x, y, width, height]
                          config:
                            type: object
                        required: [type, position, config]
                    refreshInterval:
                      type: number
                      minimum: 1
                      default: 5
                  required: [widgets]
              required:
                - name
                - layout
      responses:
        '201':
          description: Analytics dashboard created successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/AnalyticsDashboard'

  /api/v1/analytics/export:
    post:
      tags:
        - Analytics
      summary: Export analytics data
      description: Creates an export job for analytics data in various formats
      security:
        - localAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  minLength: 1
                  maxLength: 100
                format:
                  type: string
                  enum: [json, csv, excel, pdf]
                data:
                  type: object
                  properties:
                    reportIds:
                      type: array
                      items:
                        $ref: '#/components/schemas/UUID'
                    metricsQuery:
                      type: object
                      properties:
                        startDate:
                          type: string
                          format: date
                        endDate:
                          type: string
                          format: date
                        metrics:
                          type: array
                          items:
                            type: string
                        filters:
                          type: object
                    dashboardId:
                      $ref: '#/components/schemas/UUID'
              required:
                - name
                - format
                - data
      responses:
        '202':
          description: Export job created successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/AnalyticsExport'

  /api/v1/analytics/export/{exportId}:
    get:
      tags:
        - Analytics
      summary: Get export status
      description: Retrieves the status and details of an analytics export job
      security:
        - localAuth: []
      parameters:
        - name: exportId
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '200':
          description: Export status retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/AnalyticsExport'

components:
  schemas:
    ProductivityMetrics:
      type: object
      required:
        - id
        - periodStart
        - periodEnd
        - velocity
        - generation
        - contextEfficiency
        - calculatedAt
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        projectId:
          $ref: '#/components/schemas/UUID'
        periodStart:
          type: string
          format: date-time
        periodEnd:
          type: string
          format: date-time
        velocity:
          type: object
          properties:
            avgTimeToWorking:
              type: number
            efficiencyGain:
              type: number
            projectsCompleted:
              type: integer
            avgPhasesPerDay:
              type: number
        generation:
          type: object
          properties:
            totalFilesGenerated:
              type: integer
            totalLinesGenerated:
              type: integer
            avgGenerationTime:
              type: number
            successRate:
              type: number
        contextEfficiency:
          type: object
          properties:
            avgRetrievalTime:
              type: number
            cacheHitRate:
              type: number
            avgRelevanceScore:
              type: number
            optimizationSaves:
              type: number
        calculatedAt:
          type: string
          format: date-time

    QualityTrendAnalysis:
      type: object
      required:
        - id
        - periodStart
        - periodEnd
        - architecturalConsistency
        - testCoverage
        - dependencyHealth
        - analyzedAt
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        projectId:
          $ref: '#/components/schemas/UUID'
        periodStart:
          type: string
          format: date-time
        periodEnd:
          type: string
          format: date-time
        architecturalConsistency:
          type: object
          properties:
            currentScore:
              type: number
            previousScore:
              type: number
            trend:
              type: string
              enum: [improving, declining, stable, volatile]
            history:
              type: array
              items:
                type: object
                properties:
                  timestamp:
                    type: string
                    format: date-time
                  score:
                    type: number
        testCoverage:
          type: object
          properties:
            currentCoverage:
              type: number
            previousCoverage:
              type: number
            trend:
              type: string
              enum: [improving, declining, stable, volatile]
            history:
              type: array
              items:
                type: object
                properties:
                  timestamp:
                    type: string
                    format: date-time
                  coverage:
                    type: number
        dependencyHealth:
          type: object
          properties:
            currentHealth:
              type: number
            previousHealth:
              type: number
            trend:
              type: string
              enum: [improving, declining, stable, volatile]
            incidents:
              type: integer
        analyzedAt:
          type: string
          format: date-time

    UsagePatternAnalysis:
      type: object
      required:
        - id
        - periodStart
        - periodEnd
        - peakUsageTimes
        - phaseActivity
        - featureUsage
        - aiProviderUsage
        - analyzedAt
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        periodStart:
          type: string
          format: date-time
        periodEnd:
          type: string
          format: date-time
        peakUsageTimes:
          type: array
          items:
            type: object
            properties:
              hour:
                type: integer
              dayOfWeek:
                type: integer
              activityScore:
                type: number
        phaseActivity:
          type: array
          items:
            type: object
            properties:
              phase:
                $ref: '#/components/schemas/PhaseType'
              usageCount:
                type: integer
              avgDuration:
                type: number
              successRate:
                type: number
        featureUsage:
          type: array
          items:
            type: object
            properties:
              feature:
                type: string
              usageCount:
                type: integer
              avgSessionDuration:
                type: number
              userSatisfactionScore:
                type: number
        aiProviderUsage:
          type: object
          properties:
            totalRequests:
              type: integer
            avgResponseTime:
              type: number
            tokenUsage:
              type: object
              properties:
                total:
                  type: integer
                input:
                  type: integer
                output:
                  type: integer
                cost:
                  type: number
        analyzedAt:
          type: string
          format: date-time

    AnalyticsInsight:
      type: object
      required:
        - id
        - type
        - title
        - description
        - confidence
        - relatedMetrics
        - priority
        - generatedAt
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        type:
          type: string
          enum: [optimization, warning, achievement, recommendation, anomaly]
        title:
          type: string
        description:
          type: string
        confidence:
          type: number
          minimum: 0
          maximum: 100
        relatedMetrics:
          type: array
          items:
            type: object
            properties:
              metric:
                type: string
              value:
                type: number
              unit:
                type: string
              context:
                type: string
        recommendations:
          type: array
          items:
            type: string
        priority:
          type: string
          enum: [low, medium, high, critical]
        projectId:
          $ref: '#/components/schemas/UUID'
        generatedAt:
          type: string
          format: date-time
        expiresAt:
          type: string
          format: date-time

    PerformanceBenchmark:
      type: object
      required:
        - id
        - name
        - category
        - currentValue
        - unit
        - targetValue
        - percentile
        - history
        - lastUpdated
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        name:
          type: string
        category:
          type: string
          enum: [context_retrieval, ai_generation, phase_transition, file_operations, overall_productivity]
        currentValue:
          type: number
        unit:
          type: string
        targetValue:
          type: number
        percentile:
          type: number
        history:
          type: array
          items:
            type: object
            properties:
              timestamp:
                type: string
                format: date-time
              value:
                type: number
              context:
                type: object
        lastUpdated:
          type: string
          format: date-time

    CustomAnalyticsReport:
      type: object
      required:
        - id
        - name
        - type
        - config
        - data
        - insights
        - createdAt
        - lastGenerated
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        name:
          type: string
        description:
          type: string
        type:
          type: string
          enum: [productivity_summary, quality_trends, performance_analysis, usage_patterns, phase_efficiency, context_optimization, custom_report]
        config:
          type: object
          properties:
            timePeriod:
              type: object
              properties:
                start:
                  type: string
                  format: date-time
                end:
                  type: string
                  format: date-time
                granularity:
                  type: string
                  enum: [hour, day, week, month, quarter, year]
            metrics:
              type: array
              items:
                type: object
                properties:
                  name:
                    type: string
                  aggregation:
                    type: string
                    enum: [sum, average, median, min, max, count, percentile]
                  filters:
                    type: object
            groupBy:
              type: array
              items:
                type: string
            filters:
              type: object
        data:
          type: object
          properties:
            summary:
              type: object
            timeSeries:
              type: array
              items:
                type: object
                properties:
                  timestamp:
                    type: string
                    format: date-time
                  values:
                    type: object
                    additionalProperties:
                      type: number
            breakdowns:
              type: object
              additionalProperties:
                type: array
                items:
                  type: object
                  properties:
                    dimension:
                      type: string
                    value:
                      type: number
                    percentage:
                      type: number
        insights:
          type: array
          items:
            $ref: '#/components/schemas/AnalyticsInsight'
        createdAt:
          type: string
          format: date-time
        lastGenerated:
          type: string
          format: date-time

    AnalyticsDashboard:
      type: object
      required:
        - id
        - name
        - layout
        - access
        - createdAt
        - lastModified
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        name:
          type: string
        description:
          type: string
        layout:
          type: object
          properties:
            widgets:
              type: array
              items:
                type: object
                properties:
                  id:
                    $ref: '#/components/schemas/UUID'
                  type:
                    type: string
                    enum: [metric_card, trend_chart, usage_heatmap, insight_list, benchmark_gauge]
                  position:
                    type: object
                    properties:
                      x:
                        type: number
                      y:
                        type: number
                      width:
                        type: number
                      height:
                        type: number
                  config:
                    type: object
            refreshInterval:
              type: number
        access:
          type: object
          properties:
            isPublic:
              type: boolean
            allowedProjects:
              type: array
              items:
                $ref: '#/components/schemas/UUID'
        createdAt:
          type: string
          format: date-time
        lastModified:
          type: string
          format: date-time

    AnalyticsExport:
      type: object
      required:
        - id
        - name
        - format
        - data
        - status
        - createdAt
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        name:
          type: string
        format:
          type: string
          enum: [json, csv, excel, pdf]
        data:
          type: object
          properties:
            reportIds:
              type: array
              items:
                $ref: '#/components/schemas/UUID'
            metricsQuery:
              type: object
              properties:
                startDate:
                  type: string
                  format: date
                endDate:
                  type: string
                  format: date
                metrics:
                  type: array
                  items:
                    type: string
                filters:
                  type: object
            dashboardId:
              $ref: '#/components/schemas/UUID'
        status:
          type: string
          enum: [pending, processing, completed, failed]
        filePath:
          type: string
        createdAt:
          type: string
          format: date-time
        completedAt:
          type: string
          format: date-time
```

## **4. Detailed Business Logic & Validation Rules**

| Rule ID | Rule Description | Implementation Location(s) & Notes |
|---------|------------------|-----------------------------------|
| **ANA-01** | Productivity metrics calculations must aggregate data from Logging & Monitoring Service while ensuring privacy by anonymizing individual user sessions and maintaining only project-level aggregations. | **Backend (Authoritative):** Analytics service must query Logging & Monitoring Service for raw metrics, apply anonymization functions to remove session-specific identifiers, and calculate productivity trends based on project aggregates only. |
| **ANA-02** | Quality trend analysis must validate data consistency by cross-referencing Project Management Module project states and Context Management Engine quality metrics before generating trend reports. | **Backend (Authoritative):** Quality analysis service must validate project existence via Project Management Module, fetch current quality metrics from Context Management Engine, and ensure temporal consistency before trend calculation. |
| **ANA-03** | Analytics insights generation must respect the 3-second KPI for context retrieval by caching frequently requested analysis results and implementing progressive loading for complex reports. | **Backend (Authoritative):** Insight service must implement Redis-style caching for analysis results, use async processing for complex analytics jobs, and return cached data within 3-second limit while triggering background updates. |
| **ANA-04** | Performance benchmarks must automatically update when new performance metrics are recorded via the Logging & Monitoring Service, but only recalculate percentiles and historical comparisons during off-peak hours. | **Backend (Authoritative):** Benchmark service must listen to Logging & Monitoring Service metric events for real-time current value updates, but schedule intensive percentile calculations via background jobs during configured low-usage periods. |
| **ANA-05** | Custom analytics reports must validate metric availability and data access permissions through the Configuration Management Module before allowing report creation or execution. | **Backend (Authoritative):** Report service must query Configuration Management Module for available metrics, validate user access permissions, and ensure requested metrics are available in the current configuration before report creation. |
| **ANA-06** | Dashboard widget configurations must validate data sources and refresh intervals against system performance constraints defined in the Configuration Management Module to prevent system overload. | **Backend (Authoritative):** Dashboard service must validate widget configurations against maximum refresh frequency limits from Configuration Management, ensure data sources exist, and reject configurations that exceed system capacity. |
| **ANA-07** | Analytics export operations must coordinate with Database Management Module to ensure transaction consistency and prevent data locks during large export operations. | **Backend (Authoritative):** Export service must use Database Management Module's read replica connections for large exports, implement proper transaction isolation, and use streaming exports to minimize memory usage and database locks. |
| **ANA-08** | Usage pattern analysis must aggregate data from multiple modules (Project Management, Multi-Phase Development Orchestrator, Context Management) while maintaining temporal alignment and data consistency. | **Backend (Authoritative):** Pattern analysis service must synchronize data collection timestamps across modules, handle missing data gracefully, and validate data consistency before pattern analysis to ensure accurate insights. |
| **ANA-09** | Analytics data retention must follow the same policies as the Logging & Monitoring Service and coordinate cleanup operations to maintain referential integrity between analytics and source data. | **Backend (Authoritative):** Analytics retention service must query Logging & Monitoring Service retention policies, coordinate cleanup operations to maintain data relationships, and ensure analytics summaries are preserved when raw data is purged. |
| **ANA-10** | KPI tracking for ReadyAI charter metrics (development velocity, code quality consistency, context efficiency, user productivity) must be calculated using standardized formulas and update thresholds defined in Configuration Management Module. | **Backend (Authoritative):** KPI service must use Configuration Management Module for KPI calculation formulas and thresholds, ensure consistent measurement across time periods, and trigger alerts when KPIs fall below defined thresholds. |

## **5. Developer Task Checklist**

### **Backend Tasks:**
- [ ] Create database migration script for analytics tables (`productivity_metrics`, `quality_trends`, `usage_patterns`, `analytics_insights`, `performance_benchmarks`, `custom_reports`, `analytics_dashboards`, `analytics_exports`)
- [ ] Implement the `ProductivityAnalyticsService` class for calculating development velocity and efficiency metrics by aggregating data from Project Management and Logging & Monitoring Service
- [ ] Implement the `QualityTrendAnalysisService` class for analyzing architectural consistency, test coverage, and dependency health trends over time
- [ ] Implement the `UsagePatternAnalysisService` class for identifying user behavior patterns, peak usage times, and feature utilization analytics
- [ ] Implement the `AnalyticsInsightService` class with AI-powered analysis to generate actionable insights and recommendations from analytics data
- [ ] Implement the `PerformanceBenchmarkService` class for tracking performance metrics against targets and historical baselines
- [ ] Implement the `CustomReportService` class for creating, configuring, and generating custom analytics reports with flexible metrics and dimensions
- [ ] Implement the `AnalyticsDashboardService` class for managing dashboard configurations, widget layouts, and real-time data updates
- [ ] Implement the `AnalyticsExportService` class for generating exports in multiple formats (JSON, CSV, Excel, PDF) with background processing
- [ ] Implement all productivity metrics endpoints (`GET /api/v1/analytics/productivity`) with project filtering and time period aggregation
- [ ] Implement quality trend analysis endpoints (`GET /api/v1/analytics/quality/trends`) with comparative analysis and historical data
- [ ] Implement usage pattern analysis endpoints (`GET /api/v1/analytics/usage-patterns`) with peak time identification and feature utilization tracking
- [ ] Implement analytics insights endpoints (`GET`, `POST /api/v1/analytics/insights`) with AI-powered insight generation and filtering
- [ ] Implement performance benchmark endpoints (`GET`, `POST /api/v1/analytics/benchmarks`) with custom benchmark creation and tracking
- [ ] Implement custom report management endpoints (`GET`, `POST`, `PUT`, `DELETE /api/v1/analytics/reports/{id}`) with configuration validation
- [ ] Implement analytics dashboard endpoints (`GET`, `POST /api/v1/analytics/dashboards`) with widget management and layout persistence
- [ ] Implement analytics export endpoints (`POST /api/v1/analytics/export`, `GET /api/v1/analytics/export/{id}`) with background job processing
- [ ] Create `AnalyticsRepository` class for efficient analytics data storage and retrieval with proper indexing on timestamps, project IDs, and metric types
- [ ] Create `CachingService` integration for analytics results caching to meet the 3-second KPI requirement for data retrieval
- [ ] Implement data aggregation pipelines that coordinate with Logging & Monitoring Service to collect and process raw metrics data
- [ ] Implement integration with Project Management Module for project context and metadata in analytics calculations
- [ ] Implement integration with Multi-Phase Development Orchestrator for phase progression analytics and development workflow insights
- [ ] Implement integration with Context Management Engine for context efficiency metrics and usage pattern analysis
- [ ] Implement integration with Configuration Management Module for analytics configuration settings and KPI thresholds
- [ ] Implement background job processing for complex analytics calculations and report generation using job queues
- [ ] Create comprehensive unit tests for all analytics service classes with mock implementations of dependent modules
- [ ] Create integration tests for analytics workflows including data collection, aggregation, insight generation, and export processes
- [ ] Implement performance optimizations for analytics queries including database indexing, query optimization, and result caching
- [ ] Add analytics data validation and consistency checks to ensure accuracy across different data sources and time periods

### **Frontend Tasks:**
- [ ] Create `AnalyticsProvider` React context for accessing analytics data and managing analytics state across components
- [ ] Implement `useAnalytics` hook for simplified analytics data fetching with automatic caching and error handling
- [ ] Create `ProductivityDashboard` component displaying key productivity metrics, development velocity trends, and efficiency gains
- [ ] Implement `QualityTrendsChart` component for visualizing code quality metrics over time with interactive trend analysis
- [ ] Create `UsagePatternsHeatmap` component for displaying user activity patterns, peak usage times, and feature utilization
- [ ] Implement `AnalyticsInsightsList` component for displaying AI-generated insights with priority-based organization and action recommendations
- [ ] Create `PerformanceBenchmarks` component for displaying benchmark comparisons, target achievements, and performance percentiles
- [ ] Implement `CustomReportBuilder` component with drag-and-drop interface for creating custom analytics reports with metric selection
- [ ] Create `AnalyticsDashboardDesigner` component for building custom dashboards with widget placement, configuration, and layout management
- [ ] Implement `AnalyticsExportManager` component for initiating exports, tracking export status, and downloading completed exports
- [ ] Create analytics service functions in the API client (`analyticsService.ts`) for all analytics endpoints with proper error handling
- [ ] Implement `AnalyticsVisualization` library using charts.js or similar for creating interactive charts, graphs, and data visualizations
- [ ] Create `MetricCard` component for displaying individual metrics with trend indicators, comparisons, and drill-down capabilities
- [ ] Implement `TrendAnalysisChart` component for showing metric trends over time with period comparisons and forecasting
- [ ] Create `InsightNotification` component for displaying high-priority analytics insights as actionable notifications
- [ ] Implement `BenchmarkGauge` component for showing performance benchmark status with visual indicators and target comparisons
- [ ] Create `ReportScheduler` component for setting up automated report generation and delivery schedules
- [ ] Implement `AnalyticsFilters` component for filtering analytics data by date ranges, projects, phases, and other dimensions
- [ ] Add analytics integration to existing ReadyAI components (Project Detail, Phase Progress, Context Explorer) for contextual insights
- [ ] Create `AnalyticsSettings` component integrated with Configuration Management for customizing analytics preferences and KPI thresholds
- [ ] Implement real-time analytics updates using WebSockets or Server-Sent Events for dashboard widgets and live metrics
- [ ] Add analytics navigation integration to the main application menu and sidebar for easy access to analytics features



========================================================================================


# Documentation Generation Module - Technical Specification

## **1. Module Overview**

**Purpose:** The Documentation Generation Module serves as the automated documentation system for ReadyAI projects, providing intelligent generation of API documentation, project documentation, code documentation, and customizable documentation templates. This module leverages AI-powered analysis to create comprehensive, up-to-date documentation that maintains consistency with the codebase and project architecture while supporting multiple output formats and documentation styles to enhance project maintainability and developer productivity.

**Dependencies & Interactions:** This module depends on the AI Provider Management Module (Claude Integration Service) to generate intelligent documentation content from code analysis and project context, the Code Analysis Service to parse source code and extract documentation elements such as function signatures, type definitions, and inline comments, and the File System Management Module to read source files, access project structures, and write generated documentation files. It interacts with the Project Management Module to access project metadata, technology stack information, and phase artifacts for context-aware documentation generation. The module also integrates with the Context Management Engine to leverage project context and semantic relationships for more intelligent documentation structuring, and coordinates with the Multi-Phase Development Orchestrator to generate phase-specific documentation during Phase 6 (Documentation) of the development workflow.

## **2. Module-Specific Type Additions (`types.documentationGeneration.ts`)**

```typescript
/**
 * Documentation Generation Module Types
 * Extends foundational types with documentation generation interfaces
 */

/** Documentation generation types */
export type DocumentationType = 
  | 'api_reference'
  | 'project_overview'
  | 'code_documentation'
  | 'user_guide'
  | 'developer_guide'
  | 'changelog'
  | 'readme'
  | 'architecture_docs'
  | 'deployment_guide';

/** Documentation output formats */
export type DocumentationFormat = 
  | 'markdown'
  | 'html'
  | 'pdf'
  | 'json'
  | 'docx'
  | 'rst'
  | 'asciidoc';

/** Documentation generation strategies */
export type GenerationStrategy = 
  | 'ai_assisted'
  | 'template_based'
  | 'code_analysis'
  | 'hybrid';

/** Documentation quality levels */
export type DocumentationQualityLevel = 'basic' | 'standard' | 'comprehensive' | 'enterprise';

/** Documentation template types */
export type TemplateType = 'builtin' | 'custom' | 'community';

/** Documentation generation request */
export interface DocumentationGenerationRequest {
  /** Unique request identifier */
  id: UUID;
  /** Project identifier */
  projectId: UUID;
  /** Type of documentation to generate */
  documentationType: DocumentationType;
  /** Output format */
  format: DocumentationFormat;
  /** Generation strategy */
  strategy: GenerationStrategy;
  /** Quality level */
  qualityLevel: DocumentationQualityLevel;
  /** Template to use (optional) */
  templateId?: UUID;
  /** Target file paths to document */
  targetPaths?: string[];
  /** Output file path */
  outputPath: string;
  /** Generation options */
  options: {
    /** Include private/internal elements */
    includePrivate: boolean;
    /** Include examples */
    includeExamples: boolean;
    /** Include type definitions */
    includeTypes: boolean;
    /** Include dependency information */
    includeDependencies: boolean;
    /** Custom sections to include */
    customSections?: string[];
    /** Language for documentation */
    language: string;
  };
  /** Request timestamp */
  createdAt: string; // ISO 8601 format
  /** Request status */
  status: 'pending' | 'in_progress' | 'completed' | 'failed';
}

/** Documentation generation result */
export interface DocumentationGenerationResult {
  /** Request identifier */
  requestId: UUID;
  /** Generation success status */
  success: boolean;
  /** Generated documentation content */
  content?: string;
  /** Generated file path */
  filePath?: string;
  /** Generation metadata */
  metadata: {
    /** Total lines generated */
    linesGenerated: number;
    /** Total sections created */
    sectionsCreated: number;
    /** API endpoints documented */
    apiEndpoints?: number;
    /** Functions documented */
    functionsDocumented?: number;
    /** Classes documented */
    classesDocumented?: number;
    /** Generation time in milliseconds */
    generationTime: number;
    /** AI tokens used */
    tokensUsed?: {
      input: number;
      output: number;
      total: number;
    };
  };
  /** Warnings or issues */
  warnings?: string[];
  /** Error information (if failed) */
  error?: {
    code: string;
    message: string;
    details?: Record<string, any>;
  };
  /** Generation timestamp */
  generatedAt: string; // ISO 8601 format
}

/** Documentation template definition */
export interface DocumentationTemplate {
  /** Unique template identifier */
  id: UUID;
  /** Template name */
  name: string;
  /** Template description */
  description: string;
  /** Template type */
  type: TemplateType;
  /** Supported documentation types */
  supportedTypes: DocumentationType[];
  /** Supported output formats */
  supportedFormats: DocumentationFormat[];
  /** Template content structure */
  structure: DocumentationSection[];
  /** Template variables */
  variables: TemplateVariable[];
  /** Template styling options */
  styling?: {
    /** CSS styles for HTML output */
    css?: string;
    /** Theme configuration */
    theme?: string;
    /** Custom formatting rules */
    formatting?: Record<string, any>;
  };
  /** Template creation timestamp */
  createdAt: string; // ISO 8601 format
  /** Template last modified timestamp */
  lastModified: string; // ISO 8601 format
  /** Usage statistics */
  usageCount: number;
  /** Whether template is active */
  isActive: boolean;
}

/** Documentation section definition */
export interface DocumentationSection {
  /** Section identifier */
  id: string;
  /** Section title */
  title: string;
  /** Section content template */
  contentTemplate: string;
  /** Section order */
  order: number;
  /** Whether section is required */
  required: boolean;
  /** Conditional display rules */
  conditions?: Array<{
    field: string;
    operator: 'equals' | 'contains' | 'exists' | 'not_exists';
    value?: any;
  }>;
  /** Nested subsections */
  subsections?: DocumentationSection[];
}

/** Template variable definition */
export interface TemplateVariable {
  /** Variable name */
  name: string;
  /** Variable description */
  description: string;
  /** Variable type */
  type: 'string' | 'number' | 'boolean' | 'array' | 'object';
  /** Default value */
  defaultValue?: any;
  /** Whether variable is required */
  required: boolean;
  /** Validation rules */
  validation?: {
    pattern?: string;
    minLength?: number;
    maxLength?: number;
    min?: number;
    max?: number;
  };
}

/** Code element documentation */
export interface CodeElementDocumentation {
  /** Element identifier */
  id: UUID;
  /** Element type */
  type: 'function' | 'class' | 'interface' | 'type' | 'constant' | 'variable' | 'endpoint';
  /** Element name */
  name: string;
  /** File path */
  filePath: string;
  /** Line number in file */
  lineNumber: number;
  /** Element signature */
  signature: string;
  /** Generated description */
  description: string;
  /** Parameters documentation */
  parameters?: Array<{
    name: string;
    type: string;
    description: string;
    required: boolean;
    defaultValue?: any;
  }>;
  /** Return type documentation */
  returnType?: {
    type: string;
    description: string;
  };
  /** Usage examples */
  examples?: Array<{
    title: string;
    code: string;
    description: string;
  }>;
  /** Related elements */
  relatedElements?: UUID[];
  /** Tags and categories */
  tags: string[];
  /** Visibility level */
  visibility: 'public' | 'private' | 'protected' | 'internal';
}

/** API endpoint documentation */
export interface APIEndpointDocumentation {
  /** Endpoint identifier */
  id: UUID;
  /** HTTP method */
  method: string;
  /** Endpoint path */
  path: string;
  /** Endpoint summary */
  summary: string;
  /** Detailed description */
  description: string;
  /** Request parameters */
  parameters: Array<{
    name: string;
    in: 'query' | 'path' | 'header' | 'body';
    type: string;
    description: string;
    required: boolean;
    example?: any;
  }>;
  /** Request body schema */
  requestBody?: {
    contentType: string;
    schema: any;
    example?: any;
    description: string;
  };
  /** Response schemas */
  responses: Array<{
    statusCode: number;
    description: string;
    schema?: any;
    example?: any;
  }>;
  /** Usage examples */
  examples: Array<{
    title: string;
    request: any;
    response: any;
    description: string;
  }>;
  /** Related endpoints */
  relatedEndpoints?: UUID[];
  /** Tags and categories */
  tags: string[];
}

/** Documentation analytics */
export interface DocumentationAnalytics {
  /** Analytics identifier */
  id: UUID;
  /** Project identifier */
  projectId: UUID;
  /** Analytics period start */
  periodStart: string; // ISO 8601 format
  /** Analytics period end */
  periodEnd: string; // ISO 8601 format
  /** Generation statistics */
  generationStats: {
    /** Total generations */
    totalGenerations: number;
    /** Successful generations */
    successfulGenerations: number;
    /** Failed generations */
    failedGenerations: number;
    /** Average generation time */
    avgGenerationTime: number;
    /** Total tokens used */
    totalTokensUsed: number;
  };
  /** Content statistics */
  contentStats: {
    /** Total documentation files */
    totalFiles: number;
    /** Total lines of documentation */
    totalLines: number;
    /** Documentation types breakdown */
    typeBreakdown: Record<DocumentationType, number>;
    /** Format breakdown */
    formatBreakdown: Record<DocumentationFormat, number>;
  };
  /** Quality metrics */
  qualityMetrics: {
    /** Coverage percentage */
    coveragePercentage: number;
    /** Average quality score */
    avgQualityScore: number;
    /** Completeness score */
    completenessScore: number;
    /** Consistency score */
    consistencyScore: number;
  };
  /** Most used templates */
  popularTemplates: Array<{
    templateId: UUID;
    templateName: string;
    usageCount: number;
  }>;
}

/** Documentation coverage report */
export interface DocumentationCoverage {
  /** Project identifier */
  projectId: UUID;
  /** Coverage timestamp */
  timestamp: string; // ISO 8601 format
  /** Overall coverage percentage */
  overallCoverage: number;
  /** Coverage by file type */
  coverageByType: Record<string, {
    totalElements: number;
    documentedElements: number;
    coveragePercentage: number;
  }>;
  /** Undocumented elements */
  undocumentedElements: Array<{
    filePath: string;
    elementName: string;
    elementType: string;
    lineNumber: number;
    suggestion: string;
  }>;
  /** Documentation quality issues */
  qualityIssues: Array<{
    filePath: string;
    issueType: 'missing_description' | 'incomplete_params' | 'missing_examples' | 'outdated_content';
    severity: 'low' | 'medium' | 'high';
    description: string;
    suggestion: string;
  }>;
  /** Recommendations */
  recommendations: string[];
}
```

## **3. API Endpoint Specification (OpenAPI `paths` block)**

```yaml
paths:
  /api/v1/documentation/generate:
    post:
      tags:
        - Documentation
      summary: Generate project documentation
      description: Initiates documentation generation for a project using AI assistance and code analysis
      security:
        - localAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                projectId:
                  $ref: '#/components/schemas/UUID'
                documentationType:
                  type: string
                  enum: [api_reference, project_overview, code_documentation, user_guide, developer_guide, changelog, readme, architecture_docs, deployment_guide]
                format:
                  type: string
                  enum: [markdown, html, pdf, json, docx, rst, asciidoc]
                  default: markdown
                strategy:
                  type: string
                  enum: [ai_assisted, template_based, code_analysis, hybrid]
                  default: hybrid
                qualityLevel:
                  type: string
                  enum: [basic, standard, comprehensive, enterprise]
                  default: standard
                templateId:
                  $ref: '#/components/schemas/UUID'
                targetPaths:
                  type: array
                  items:
                    type: string
                outputPath:
                  type: string
                  minLength: 1
                options:
                  type: object
                  properties:
                    includePrivate:
                      type: boolean
                      default: false
                    includeExamples:
                      type: boolean
                      default: true
                    includeTypes:
                      type: boolean
                      default: true
                    includeDependencies:
                      type: boolean
                      default: true
                    customSections:
                      type: array
                      items:
                        type: string
                    language:
                      type: string
                      default: en
                  required:
                    - includePrivate
                    - includeExamples
                    - includeTypes
                    - includeDependencies
                    - language
              required:
                - projectId
                - documentationType
                - outputPath
                - options
      responses:
        '202':
          description: Documentation generation started successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/DocumentationGenerationRequest'
        '400':
          description: Invalid request parameters
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'
        '404':
          description: Project not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

  /api/v1/documentation/requests/{requestId}:
    get:
      tags:
        - Documentation
      summary: Get documentation generation status
      description: Retrieves the status and result of a documentation generation request
      security:
        - localAuth: []
      parameters:
        - name: requestId
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '200':
          description: Generation request status retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          request:
                            $ref: '#/components/schemas/DocumentationGenerationRequest'
                          result:
                            $ref: '#/components/schemas/DocumentationGenerationResult'
        '404':
          description: Generation request not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

  /api/v1/documentation/projects/{projectId}/requests:
    get:
      tags:
        - Documentation
      summary: List project documentation requests
      description: Retrieves all documentation generation requests for a specific project
      security:
        - localAuth: []
      parameters:
        - name: projectId
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
        - name: status
          in: query
          description: Filter by request status
          required: false
          schema:
            type: string
            enum: [pending, in_progress, completed, failed]
        - name: documentationType
          in: query
          description: Filter by documentation type
          required: false
          schema:
            type: string
            enum: [api_reference, project_overview, code_documentation, user_guide, developer_guide, changelog, readme, architecture_docs, deployment_guide]
        - name: limit
          in: query
          description: Maximum number of results
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
        - name: offset
          in: query
          description: Offset for pagination
          required: false
          schema:
            type: integer
            minimum: 0
            default: 0
      responses:
        '200':
          description: Documentation requests retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          requests:
                            type: array
                            items:
                              $ref: '#/components/schemas/DocumentationGenerationRequest'
                          totalCount:
                            type: integer
                          hasMore:
                            type: boolean

  /api/v1/documentation/templates:
    get:
      tags:
        - Documentation
      summary: List documentation templates
      description: Retrieves available documentation templates with filtering options
      security:
        - localAuth: []
      parameters:
        - name: type
          in: query
          description: Filter by template type
          required: false
          schema:
            type: string
            enum: [builtin, custom, community]
        - name: documentationType
          in: query
          description: Filter by supported documentation type
          required: false
          schema:
            type: string
            enum: [api_reference, project_overview, code_documentation, user_guide, developer_guide, changelog, readme, architecture_docs, deployment_guide]
        - name: format
          in: query
          description: Filter by supported format
          required: false
          schema:
            type: string
            enum: [markdown, html, pdf, json, docx, rst, asciidoc]
        - name: active
          in: query
          description: Filter by active status
          required: false
          schema:
            type: boolean
            default: true
      responses:
        '200':
          description: Documentation templates retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          templates:
                            type: array
                            items:
                              $ref: '#/components/schemas/DocumentationTemplate'

    post:
      tags:
        - Documentation
      summary: Create documentation template
      description: Creates a new custom documentation template
      security:
        - localAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  minLength: 1
                  maxLength: 100
                description:
                  type: string
                  maxLength: 500
                supportedTypes:
                  type: array
                  items:
                    type: string
                    enum: [api_reference, project_overview, code_documentation, user_guide, developer_guide, changelog, readme, architecture_docs, deployment_guide]
                  minItems: 1
                supportedFormats:
                  type: array
                  items:
                    type: string
                    enum: [markdown, html, pdf, json, docx, rst, asciidoc]
                  minItems: 1
                structure:
                  type: array
                  items:
                    $ref: '#/components/schemas/DocumentationSection'
                variables:
                  type: array
                  items:
                    $ref: '#/components/schemas/TemplateVariable'
                styling:
                  type: object
                  properties:
                    css:
                      type: string
                    theme:
                      type: string
                    formatting:
                      type: object
              required:
                - name
                - supportedTypes
                - supportedFormats
                - structure
      responses:
        '201':
          description: Documentation template created successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/DocumentationTemplate'

  /api/v1/documentation/templates/{templateId}:
    get:
      tags:
        - Documentation
      summary: Get documentation template
      description: Retrieves a specific documentation template by ID
      security:
        - localAuth: []
      parameters:
        - name: templateId
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '200':
          description: Documentation template retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/DocumentationTemplate'
        '404':
          description: Template not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

    put:
      tags:
        - Documentation
      summary: Update documentation template
      description: Updates an existing custom documentation template
      security:
        - localAuth: []
      parameters:
        - name: templateId
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  minLength: 1
                  maxLength: 100
                description:
                  type: string
                  maxLength: 500
                supportedTypes:
                  type: array
                  items:
                    type: string
                    enum: [api_reference, project_overview, code_documentation, user_guide, developer_guide, changelog, readme, architecture_docs, deployment_guide]
                supportedFormats:
                  type: array
                  items:
                    type: string
                    enum: [markdown, html, pdf, json, docx, rst, asciidoc]
                structure:
                  type: array
                  items:
                    $ref: '#/components/schemas/DocumentationSection'
                variables:
                  type: array
                  items:
                    $ref: '#/components/schemas/TemplateVariable'
                styling:
                  type: object
                  properties:
                    css:
                      type: string
                    theme:
                      type: string
                    formatting:
                      type: object
                isActive:
                  type: boolean
      responses:
        '200':
          description: Documentation template updated successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/DocumentationTemplate'
        '404':
          description: Template not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

    delete:
      tags:
        - Documentation
      summary: Delete documentation template
      description: Deletes a custom documentation template (built-in templates cannot be deleted)
      security:
        - localAuth: []
      parameters:
        - name: templateId
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '200':
          description: Documentation template deleted successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '400':
          description: Cannot delete built-in template
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'
        '404':
          description: Template not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

  /api/v1/documentation/projects/{projectId}/coverage:
    get:
      tags:
        - Documentation
      summary: Get documentation coverage
      description: Analyzes and returns documentation coverage for a project
      security:
        - localAuth: []
      parameters:
        - name: projectId
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
        - name: includeDetails
          in: query
          description: Include detailed undocumented elements and quality issues
          required: false
          schema:
            type: boolean
            default: true
      responses:
        '200':
          description: Documentation coverage retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/DocumentationCoverage'

  /api/v1/documentation/projects/{projectId}/analytics:
    get:
      tags:
        - Documentation
      summary: Get documentation analytics
      description: Retrieves documentation generation analytics for a project
      security:
        - localAuth: []
      parameters:
        - name: projectId
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
        - name: period
          in: query
          description: Analytics period
          required: false
          schema:
            type: string
            enum: [day, week, month, quarter, year, all_time]
            default: month
        - name: startDate
          in: query
          description: Start date for custom period
          required: false
          schema:
            type: string
            format: date
        - name: endDate
          in: query
          description: End date for custom period
          required: false
          schema:
            type: string
            format: date
      responses:
        '200':
          description: Documentation analytics retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/DocumentationAnalytics'

  /api/v1/documentation/projects/{projectId}/bulk-generate:
    post:
      tags:
        - Documentation
      summary: Generate multiple documentation types
      description: Initiates bulk generation of multiple documentation types for a project
      security:
        - localAuth: []
      parameters:
        - name: projectId
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                documentationTypes:
                  type: array
                  items:
                    type: string
                    enum: [api_reference, project_overview, code_documentation, user_guide, developer_guide, changelog, readme, architecture_docs, deployment_guide]
                  minItems: 1
                format:
                  type: string
                  enum: [markdown, html, pdf, json, docx, rst, asciidoc]
                  default: markdown
                strategy:
                  type: string
                  enum: [ai_assisted, template_based, code_analysis, hybrid]
                  default: hybrid
                qualityLevel:
                  type: string
                  enum: [basic, standard, comprehensive, enterprise]
                  default: standard
                outputDirectory:
                  type: string
                  minLength: 1
                options:
                  type: object
                  properties:
                    includePrivate:
                      type: boolean
                      default: false
                    includeExamples:
                      type: boolean
                      default: true
                    includeTypes:
                      type: boolean
                      default: true
                    includeDependencies:
                      type: boolean
                      default: true
                    language:
                      type: string
                      default: en
              required:
                - documentationTypes
                - outputDirectory
      responses:
        '202':
          description: Bulk documentation generation started successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          batchId:
                            $ref: '#/components/schemas/UUID'
                          requests:
                            type: array
                            items:
                              $ref: '#/components/schemas/DocumentationGenerationRequest'

components:
  schemas:
    DocumentationGenerationRequest:
      type: object
      required:
        - id
        - projectId
        - documentationType
        - format
        - strategy
        - qualityLevel
        - outputPath
        - options
        - createdAt
        - status
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        projectId:
          $ref: '#/components/schemas/UUID'
        documentationType:
          type: string
          enum: [api_reference, project_overview, code_documentation, user_guide, developer_guide, changelog, readme, architecture_docs, deployment_guide]
        format:
          type: string
          enum: [markdown, html, pdf, json, docx, rst, asciidoc]
        strategy:
          type: string
          enum: [ai_assisted, template_based, code_analysis, hybrid]
        qualityLevel:
          type: string
          enum: [basic, standard, comprehensive, enterprise]
        templateId:
          $ref: '#/components/schemas/UUID'
        targetPaths:
          type: array
          items:
            type: string
        outputPath:
          type: string
        options:
          type: object
          properties:
            includePrivate:
              type: boolean
            includeExamples:
              type: boolean
            includeTypes:
              type: boolean
            includeDependencies:
              type: boolean
            customSections:
              type: array
              items:
                type: string
            language:
              type: string
        createdAt:
          type: string
          format: date-time
        status:
          type: string
          enum: [pending, in_progress, completed, failed]

    DocumentationGenerationResult:
      type: object
      required:
        - requestId
        - success
        - metadata
        - generatedAt
      properties:
        requestId:
          $ref: '#/components/schemas/UUID'
        success:
          type: boolean
        content:
          type: string
        filePath:
          type: string
        metadata:
          type: object
          properties:
            linesGenerated:
              type: integer
            sectionsCreated:
              type: integer
            apiEndpoints:
              type: integer
            functionsDocumented:
              type: integer
            classesDocumented:
              type: integer
            generationTime:
              type: number
            tokensUsed:
              type: object
              properties:
                input:
                  type: integer
                output:
                  type: integer
                total:
                  type: integer
        warnings:
          type: array
          items:
            type: string
        error:
          type: object
          properties:
            code:
              type: string
            message:
              type: string
            details:
              type: object
        generatedAt:
          type: string
          format: date-time

    DocumentationTemplate:
      type: object
      required:
        - id
        - name
        - description
        - type
        - supportedTypes
        - supportedFormats
        - structure
        - variables
        - createdAt
        - lastModified
        - usageCount
        - isActive
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        name:
          type: string
        description:
          type: string
        type:
          type: string
          enum: [builtin, custom, community]
        supportedTypes:
          type: array
          items:
            type: string
            enum: [api_reference, project_overview, code_documentation, user_guide, developer_guide, changelog, readme, architecture_docs, deployment_guide]
        supportedFormats:
          type: array
          items:
            type: string
            enum: [markdown, html, pdf, json, docx, rst, asciidoc]
        structure:
          type: array
          items:
            $ref: '#/components/schemas/DocumentationSection'
        variables:
          type: array
          items:
            $ref: '#/components/schemas/TemplateVariable'
        styling:
          type: object
          properties:
            css:
              type: string
            theme:
              type: string
            formatting:
              type: object
        createdAt:
          type: string
          format: date-time
        lastModified:
          type: string
          format: date-time
        usageCount:
          type: integer
        isActive:
          type: boolean

    DocumentationSection:
      type: object
      required:
        - id
        - title
        - contentTemplate
        - order
        - required
      properties:
        id:
          type: string
        title:
          type: string
        contentTemplate:
          type: string
        order:
          type: integer
        required:
          type: boolean
        conditions:
          type: array
          items:
            type: object
            properties:
              field:
                type: string
              operator:
                type: string
                enum: [equals, contains, exists, not_exists]
              value:
                oneOf:
                  - type: string
                  - type: number
                  - type: boolean
        subsections:
          type: array
          items:
            $ref: '#/components/schemas/DocumentationSection'

    TemplateVariable:
      type: object
      required:
        - name
        - description
        - type
        - required
      properties:
        name:
          type: string
        description:
          type: string
        type:
          type: string
          enum: [string, number, boolean, array, object]
        defaultValue:
          oneOf:
            - type: string
            - type: number
            - type: boolean
            - type: array
            - type: object
        required:
          type: boolean
        validation:
          type: object
          properties:
            pattern:
              type: string
            minLength:
              type: integer
            maxLength:
              type: integer
            min:
              type: number
            max:
              type: number

    DocumentationCoverage:
      type: object
      required:
        - projectId
        - timestamp
        - overallCoverage
        - coverageByType
        - undocumentedElements
        - qualityIssues
        - recommendations
      properties:
        projectId:
          $ref: '#/components/schemas/UUID'
        timestamp:
          type: string
          format: date-time
        overallCoverage:
          type: number
          minimum: 0
          maximum: 100
        coverageByType:
          type: object
          additionalProperties:
            type: object
            properties:
              totalElements:
                type: integer
              documentedElements:
                type: integer
              coveragePercentage:
                type: number
        undocumentedElements:
          type: array
          items:
            type: object
            properties:
              filePath:
                type: string
              elementName:
                type: string
              elementType:
                type: string
              lineNumber:
                type: integer
              suggestion:
                type: string
        qualityIssues:
          type: array
          items:
            type: object
            properties:
              filePath:
                type: string
              issueType:
                type: string
                enum: [missing_description, incomplete_params, missing_examples, outdated_content]
              severity:
                type: string
                enum: [low, medium, high]
              description:
                type: string
              suggestion:
                type: string
        recommendations:
          type: array
          items:
            type: string

    DocumentationAnalytics:
      type: object
      required:
        - id
        - projectId
        - periodStart
        - periodEnd
        - generationStats
        - contentStats
        - qualityMetrics
        - popularTemplates
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        projectId:
          $ref: '#/components/schemas/UUID'
        periodStart:
          type: string
          format: date-time
        periodEnd:
          type: string
          format: date-time
        generationStats:
          type: object
          properties:
            totalGenerations:
              type: integer
            successfulGenerations:
              type: integer
            failedGenerations:
              type: integer
            avgGenerationTime:
              type: number
            totalTokensUsed:
              type: integer
        contentStats:
          type: object
          properties:
            totalFiles:
              type: integer
            totalLines:
              type: integer
            typeBreakdown:
              type: object
              additionalProperties:
                type: integer
            formatBreakdown:
              type: object
              additionalProperties:
                type: integer
        qualityMetrics:
          type: object
          properties:
            coveragePercentage:
              type: number
            avgQualityScore:
              type: number
            completenessScore:
              type: number
            consistencyScore:
              type: number
        popularTemplates:
          type: array
          items:
            type: object
            properties:
              templateId:
                $ref: '#/components/schemas/UUID'
              templateName:
                type: string
              usageCount:
                type: integer
```

## **4. Detailed Business Logic & Validation Rules**

| Rule ID | Rule Description | Implementation Location(s) & Notes |
|---------|------------------|-----------------------------------|
| **DOC-01** | Documentation generation requests must validate that the target project exists and is accessible before starting generation to prevent wasted AI tokens and processing time. | **Backend (Authoritative):** Service must query Project Management Module to verify project existence and File System Management Module to verify output path accessibility before creating generation request. |
| **DOC-02** | AI-assisted documentation generation must coordinate with the Claude Integration Service to use extended thinking mode for complex documentation types (architecture docs, developer guides) to ensure high-quality output. | **Backend (Authoritative):** Generation service must call Claude Integration Service with extended thinking enabled for comprehensive and enterprise quality levels, and include project context from Context Management Engine. |
| **DOC-03** | Code analysis for documentation must leverage the Code Analysis Service to extract function signatures, type definitions, and inline comments, ensuring accurate technical documentation. | **Backend (Authoritative):** Code analysis strategy must call Code Analysis Service to parse target files, extract AST elements, and provide structured code information to AI generation or template processing. |
| **DOC-04** | Template-based generation must validate template variables and ensure all required variables are provided before processing to prevent incomplete documentation. | **Backend (Authoritative):** Template service must validate all required template variables are provided with correct types and constraints before applying template to avoid generation failures. |
| **DOC-05** | Generated documentation files must be written through File System Management Module to ensure proper file permissions, directory creation, and backup integration. | **Backend (Authoritative):** Documentation generation must use File System Management Module for all file operations, creating parent directories if needed and respecting workspace isolation. |
| **DOC-06** | Documentation coverage analysis must coordinate with Code Analysis Service to identify all documentable elements and calculate accurate coverage percentages. | **Backend (Authoritative):** Coverage service must call Code Analysis Service to get complete inventory of functions, classes, and endpoints, then compare against existing documentation to calculate coverage metrics. |
| **DOC-07** | API documentation generation must extract endpoint information from the established OpenAPI specifications and project code to ensure accuracy and completeness. | **Backend (Authoritative):** API documentation generation must parse OpenAPI specs from project files and use Code Analysis Service to extract additional endpoint details not captured in specs. |
| **DOC-08** | Bulk documentation generation must respect system resource limits and queue requests appropriately to prevent overwhelming the AI Provider Management Module. | **Backend (Authoritative):** Bulk generation service must implement request queuing with configurable concurrency limits and coordinate with Configuration Management Module for resource constraints. |
| **DOC-09** | Documentation analytics must aggregate generation metrics from Logging & Monitoring Service while maintaining project-level privacy in accordance with local-first architecture principles. | **Backend (Authoritative):** Analytics service must query Logging Service for documentation-related metrics, aggregating data by project without exposing individual session or user information. |
| **DOC-10** | Custom template creation must validate template structure and variable definitions to ensure compatibility with the documentation generation engine and prevent runtime errors. | **Backend (Authoritative):** Template validation service must check template structure syntax, variable references, conditional logic, and supported format compatibility before saving custom templates. |

## **5. Developer Task Checklist**

### **Backend Tasks:**
- [ ] Create database migration script for documentation tables (`documentation_requests`, `documentation_templates`, `documentation_analytics`, `documentation_coverage`, `template_usage_stats`)
- [ ] Implement the `DocumentationGenerationService` class with AI-assisted, template-based, and hybrid generation strategies
- [ ] Implement the `DocumentationTemplateService` class for managing built-in and custom templates with variable substitution
- [ ] Implement the `DocumentationCoverageService` class for analyzing code coverage and generating quality reports
- [ ] Implement the `DocumentationAnalyticsService` class for tracking generation metrics and usage statistics
- [ ] Implement the `CodeDocumentationExtractor` service to interface with Code Analysis Service for extracting documentable elements
- [ ] Implement the `APIDocumentationGenerator` service for generating API reference documentation from OpenAPI specs and code analysis
- [ ] Implement all documentation generation endpoints (`POST /api/v1/documentation/generate`, `GET /api/v1/documentation/requests/{id}`)
- [ ] Implement template management endpoints (`GET`, `POST`, `PUT`, `DELETE /api/v1/documentation/templates`)
- [ ] Implement project-specific endpoints (`GET /api/v1/documentation/projects/{projectId}/requests`, coverage, analytics)
- [ ] Implement bulk generation endpoint (`POST /api/v1/documentation/projects/{projectId}/bulk-generate`) with request queuing
- [ ] Create `DocumentationRepository` class for storing generation requests, results, and templates with proper indexing
- [ ] Create `TemplateRepository` class for template storage with version control and usage tracking
- [ ] Create `CoverageRepository` class for storing coverage analysis results and historical trends
- [ ] Implement integration with Claude Integration Service for AI-powered documentation generation with context awareness
- [ ] Implement integration with Code Analysis Service for extracting code elements, signatures, and documentation comments
- [ ] Implement integration with File System Management Module for reading source files and writing documentation outputs
- [ ] Implement integration with Project Management Module for accessing project metadata and phase information
- [ ] Implement integration with Context Management Engine for leveraging project context in documentation generation
- [ ] Implement integration with Multi-Phase Development Orchestrator for Phase 6 documentation workflow integration
- [ ] Implement integration with Configuration Management Module for documentation generation settings and AI provider configuration
- [ ] Implement integration with Logging & Monitoring Service for tracking generation performance and analytics
- [ ] Create comprehensive unit tests for all service classes with mock dependencies for AI, file system, and code analysis
- [ ] Create integration tests for end-to-end documentation generation workflows including template application and file output
- [ ] Implement performance optimizations for large codebases including parallel processing and caching strategies
- [ ] Add error handling and retry logic for AI generation failures and file system operations

### **Frontend Tasks:**
- [ ] Create `DocumentationProvider` React context for managing documentation generation state and requests
- [ ] Implement `useDocumentation` hook for triggering generation and monitoring request status
- [ ] Create `DocumentationGenerator` component for initiating single and bulk documentation generation
- [ ] Implement `DocumentationRequestMonitor` component for tracking generation progress and status
- [ ] Create `DocumentationCoverageViewer` component for displaying coverage reports and undocumented elements
- [ ] Implement `DocumentationTemplateManager` component for creating and managing custom templates
- [ ] Create `DocumentationAnalyticsDashboard` component for visualizing generation metrics and trends
- [ ] Implement `DocumentationPreview` component for previewing generated documentation before finalization
- [ ] Create `TemplateEditor` component with syntax highlighting and variable validation for custom template creation
- [ ] Implement `CoverageRecommendations` component for displaying actionable documentation improvement suggestions
- [ ] Create documentation service functions in the API client (`documentationService.ts`) for all documentation endpoints
- [ ] Implement real-time status updates for documentation generation using WebSocket connections or polling
- [ ] Create documentation export functionality for downloading generated documentation in various formats
- [ ] Implement template sharing and import/export capabilities for community template distribution
- [ ] Add documentation quality scoring visualization with trends and improvement recommendations
- [ ] Create integration with VS Code Extension for triggering documentation generation from within the editor
- [ ] Implement batch operation management interface for monitoring multiple concurrent generation requests
- [ ] Add documentation diff viewer for comparing generated documentation versions and tracking changes
- [ ] Create documentation search and filtering interface for finding specific documentation artifacts
- [ ] Implement documentation project settings integration for configuring default generation preferences and templates



========================================================================================


# Backup & Recovery Module - Technical Specification

## **1. Module Overview**

**Purpose:** The Backup & Recovery Module serves as the comprehensive data protection and disaster recovery system for ReadyAI, providing automated backup capabilities, point-in-time recovery functionality, and data integrity verification across all system components. This module ensures business continuity by protecting project data, configuration settings, vector embeddings, and file systems while maintaining the local-first architecture principles and supporting the development velocity KPI through minimal downtime recovery operations.

**Dependencies & Interactions:** This module depends on the Database Management Module to access SQLite database backups and perform transaction-safe backup operations, the File System Management Module to handle project file backups and workspace snapshots, and the Configuration Management Module to obtain backup policies, retention settings, and scheduling configurations. It interacts with the Project Management Module to coordinate project-level backups including metadata and phase artifacts, with the Context Management Engine to backup vector embeddings and context data from Milvus, and with the Logging & Monitoring Service to track backup operations, recovery metrics, and system health. The module also integrates with the Multi-Phase Development Orchestrator to ensure backup operations respect phase boundaries and don't interfere with active development workflows.

## **2. Module-Specific Type Additions (`types.backupRecovery.ts`)**

```typescript
/**
 * Backup & Recovery Module Types
 * Extends foundational types with backup and recovery interfaces
 */

/** Backup types supported by the system */
export type BackupType = 
  | 'full_system'
  | 'project_only'
  | 'database_only'
  | 'files_only'
  | 'context_only'
  | 'configuration_only';

/** Backup trigger types */
export type BackupTriggerType = 'manual' | 'scheduled' | 'automatic' | 'pre_operation';

/** Backup compression levels */
export type BackupCompressionLevel = 'none' | 'fast' | 'standard' | 'maximum';

/** Recovery operation types */
export type RecoveryType = 'full_restore' | 'selective_restore' | 'point_in_time' | 'incremental_restore';

/** Backup verification status */
export type BackupVerificationStatus = 'pending' | 'verified' | 'corrupted' | 'failed';

/** Backup schedule frequency */
export type BackupScheduleFrequency = 'hourly' | 'daily' | 'weekly' | 'monthly' | 'custom';

/** Comprehensive backup entry */
export interface BackupEntry {
  /** Unique backup identifier */
  id: UUID;
  /** Backup name/label */
  name: string;
  /** Type of backup */
  type: BackupType;
  /** Backup trigger source */
  triggerType: BackupTriggerType;
  /** Project context (if project-specific) */
  projectId?: UUID;
  /** Backup creation timestamp */
  createdAt: string; // ISO 8601 format
  /** Backup completion timestamp */
  completedAt?: string; // ISO 8601 format
  /** Backup file path */
  backupPath: string;
  /** Backup file size in bytes */
  size: number;
  /** Compression level used */
  compressionLevel: BackupCompressionLevel;
  /** Backup integrity hash */
  integrityHash: string;
  /** Verification status */
  verificationStatus: BackupVerificationStatus;
  /** Last verification timestamp */
  lastVerifiedAt?: string; // ISO 8601 format
  /** Backup description */
  description?: string;
  /** Backup metadata */
  metadata: {
    /** Components included in backup */
    includedComponents: string[];
    /** Total files backed up */
    fileCount: number;
    /** Database tables included */
    databaseTables?: string[];
    /** Context collections included */
    contextCollections?: string[];
    /** Backup duration in milliseconds */
    backupDuration: number;
    /** Compression ratio achieved */
    compressionRatio: number;
  };
  /** Backup expiry date */
  expiresAt?: string; // ISO 8601 format
  /** Whether backup is encrypted */
  encrypted: boolean;
  /** Tags for categorization */
  tags: string[];
}

/** Backup schedule configuration */
export interface BackupSchedule {
  /** Unique schedule identifier */
  id: UUID;
  /** Schedule name */
  name: string;
  /** Schedule description */
  description?: string;
  /** Whether schedule is active */
  enabled: boolean;
  /** Backup type to perform */
  backupType: BackupType;
  /** Schedule frequency */
  frequency: BackupScheduleFrequency;
  /** Custom cron expression (for custom frequency) */
  cronExpression?: string;
  /** Next scheduled execution */
  nextExecution: string; // ISO 8601 format
  /** Last execution timestamp */
  lastExecution?: string; // ISO 8601 format
  /** Project filter (if applicable) */
  projectFilter?: {
    /** Specific project IDs */
    projectIds?: UUID[];
    /** Include active projects only */
    activeOnly?: boolean;
    /** Include projects by status */
    statusFilter?: ProjectStatus[];
  };
  /** Backup configuration */
  backupConfig: {
    /** Compression level */
    compressionLevel: BackupCompressionLevel;
    /** Retention period in days */
    retentionDays: number;
    /** Maximum backup size in bytes */
    maxSize?: number;
    /** Enable encryption */
    encryption: boolean;
    /** Backup location */
    backupLocation: string;
  };
  /** Schedule creation timestamp */
  createdAt: string; // ISO 8601 format
  /** Last modified timestamp */
  lastModified: string; // ISO 8601 format
  /** Execution statistics */
  stats: {
    /** Total executions */
    totalExecutions: number;
    /** Successful executions */
    successfulExecutions: number;
    /** Failed executions */
    failedExecutions: number;
    /** Average backup size */
    avgBackupSize: number;
    /** Average execution time */
    avgExecutionTime: number;
  };
}

/** Recovery operation request */
export interface RecoveryRequest {
  /** Unique recovery identifier */
  id: UUID;
  /** Recovery operation type */
  type: RecoveryType;
  /** Source backup identifier */
  backupId: UUID;
  /** Target project (if applicable) */
  targetProjectId?: UUID;
  /** Point-in-time target (for point-in-time recovery) */
  targetTimestamp?: string; // ISO 8601 format
  /** Specific components to restore */
  componentsToRestore: string[];
  /** Recovery options */
  options: {
    /** Overwrite existing data */
    overwriteExisting: boolean;
    /** Create backup before recovery */
    createPreRecoveryBackup: boolean;
    /** Verify integrity before recovery */
    verifyIntegrity: boolean;
    /** Restore to alternative location */
    alternativeLocation?: string;
  };
  /** Recovery request timestamp */
  createdAt: string; // ISO 8601 format
  /** Recovery status */
  status: 'pending' | 'in_progress' | 'completed' | 'failed' | 'cancelled';
  /** Progress percentage (0-100) */
  progress: number;
  /** Recovery result */
  result?: RecoveryResult;
}

/** Recovery operation result */
export interface RecoveryResult {
  /** Recovery success status */
  success: boolean;
  /** Restored components */
  restoredComponents: string[];
  /** Recovery execution time */
  executionTime: number;
  /** Pre-recovery backup ID (if created) */
  preRecoveryBackupId?: UUID;
  /** Restored files count */
  restoredFilesCount: number;
  /** Restored data size in bytes */
  restoredDataSize: number;
  /** Recovery warnings */
  warnings: string[];
  /** Recovery errors (if any) */
  errors?: string[];
  /** Recovery completion timestamp */
  completedAt: string; // ISO 8601 format
  /** Integrity verification result */
  integrityVerification?: {
    verified: boolean;
    hashMatches: boolean;
    corruptedFiles?: string[];
  };
}

/** Backup integrity check result */
export interface BackupIntegrityCheck {
  /** Check identifier */
  id: UUID;
  /** Backup being checked */
  backupId: UUID;
  /** Check timestamp */
  checkedAt: string; // ISO 8601 format
  /** Overall integrity status */
  status: BackupVerificationStatus;
  /** Check execution time */
  executionTime: number;
  /** Integrity check details */
  details: {
    /** Hash verification result */
    hashVerification: boolean;
    /** File count verification */
    fileCountMatch: boolean;
    /** Size verification */
    sizeMatch: boolean;
    /** Readability test result */
    readabilityTest: boolean;
    /** Compression verification */
    compressionVerification: boolean;
  };
  /** Issues found during check */
  issues: Array<{
    severity: 'low' | 'medium' | 'high' | 'critical';
    component: string;
    description: string;
    recommendation: string;
  }>;
  /** Check metadata */
  metadata: {
    /** Expected hash */
    expectedHash: string;
    /** Actual hash */
    actualHash: string;
    /** Expected size */
    expectedSize: number;
    /** Actual size */
    actualSize: number;
  };
}

/** Backup storage statistics */
export interface BackupStorageStats {
  /** Statistics timestamp */
  timestamp: string; // ISO 8601 format
  /** Total backups count */
  totalBackups: number;
  /** Total storage used in bytes */
  totalStorageUsed: number;
  /** Storage breakdown by type */
  storageByType: Record<BackupType, number>;
  /** Storage breakdown by project */
  storageByProject: Record<UUID, number>;
  /** Oldest backup date */
  oldestBackup: string; // ISO 8601 format
  /** Newest backup date */
  newestBackup: string; // ISO 8601 format
  /** Average backup size */
  avgBackupSize: number;
  /** Compression efficiency */
  compressionEfficiency: number;
  /** Storage growth trend */
  growthTrend: {
    /** Daily growth in bytes */
    dailyGrowth: number;
    /** Weekly growth in bytes */
    weeklyGrowth: number;
    /** Monthly growth in bytes */
    monthlyGrowth: number;
  };
  /** Cleanup recommendations */
  cleanupRecommendations: Array<{
    backupId: UUID;
    reason: string;
    potentialSavings: number;
  }>;
}

/** Disaster recovery plan */
export interface DisasterRecoveryPlan {
  /** Plan identifier */
  id: UUID;
  /** Plan name */
  name: string;
  /** Plan description */
  description: string;
  /** Plan priority level */
  priority: 'low' | 'medium' | 'high' | 'critical';
  /** Recovery time objective (RTO) in minutes */
  rto: number;
  /** Recovery point objective (RPO) in minutes */
  rpo: number;
  /** Plan steps */
  steps: Array<{
    order: number;
    description: string;
    estimatedTime: number;
    dependencies: string[];
    automatable: boolean;
  }>;
  /** Required backups */
  requiredBackups: BackupType[];
  /** Plan testing history */
  testingHistory: Array<{
    testDate: string;
    success: boolean;
    actualRto: number;
    actualRpo: number;
    issues: string[];
    improvements: string[];
  }>;
  /** Plan creation timestamp */
  createdAt: string; // ISO 8601 format
  /** Last updated timestamp */
  lastUpdated: string; // ISO 8601 format
  /** Next test date */
  nextTest: string; // ISO 8601 format
}
```

## **3. API Endpoint Specification (OpenAPI `paths` block)**

```yaml
paths:
  /api/v1/backup/create:
    post:
      tags:
        - Backup
      summary: Create backup
      description: Initiates a new backup operation with specified type and options
      security:
        - localAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  minLength: 1
                  maxLength: 100
                type:
                  type: string
                  enum: [full_system, project_only, database_only, files_only, context_only, configuration_only]
                projectId:
                  $ref: '#/components/schemas/UUID'
                  description: Required for project_only backups
                description:
                  type: string
                  maxLength: 500
                options:
                  type: object
                  properties:
                    compressionLevel:
                      type: string
                      enum: [none, fast, standard, maximum]
                      default: standard
                    encryption:
                      type: boolean
                      default: false
                    includedComponents:
                      type: array
                      items:
                        type: string
                    backupLocation:
                      type: string
                    tags:
                      type: array
                      items:
                        type: string
                triggerType:
                  type: string
                  enum: [manual, scheduled, automatic, pre_operation]
                  default: manual
              required:
                - name
                - type
      responses:
        '202':
          description: Backup operation initiated successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/BackupEntry'
        '400':
          description: Invalid backup request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'
        '409':
          description: Backup operation already in progress
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

  /api/v1/backup/list:
    get:
      tags:
        - Backup
      summary: List backups
      description: Retrieves list of backups with filtering and pagination options
      security:
        - localAuth: []
      parameters:
        - name: type
          in: query
          description: Filter by backup type
          required: false
          schema:
            type: string
            enum: [full_system, project_only, database_only, files_only, context_only, configuration_only]
        - name: projectId
          in: query
          description: Filter by project ID
          required: false
          schema:
            $ref: '#/components/schemas/UUID'
        - name: triggerType
          in: query
          description: Filter by trigger type
          required: false
          schema:
            type: string
            enum: [manual, scheduled, automatic, pre_operation]
        - name: verificationStatus
          in: query
          description: Filter by verification status
          required: false
          schema:
            type: string
            enum: [pending, verified, corrupted, failed]
        - name: startDate
          in: query
          description: Filter backups created after this date
          required: false
          schema:
            type: string
            format: date-time
        - name: endDate
          in: query
          description: Filter backups created before this date
          required: false
          schema:
            type: string
            format: date-time
        - name: tags
          in: query
          description: Filter by tags (comma-separated)
          required: false
          schema:
            type: string
        - name: limit
          in: query
          description: Maximum number of results
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
        - name: offset
          in: query
          description: Offset for pagination
          required: false
          schema:
            type: integer
            minimum: 0
            default: 0
      responses:
        '200':
          description: Backups retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          backups:
                            type: array
                            items:
                              $ref: '#/components/schemas/BackupEntry'
                          totalCount:
                            type: integer
                          hasMore:
                            type: boolean

  /api/v1/backup/{backupId}:
    get:
      tags:
        - Backup
      summary: Get backup details
      description: Retrieves detailed information about a specific backup
      security:
        - localAuth: []
      parameters:
        - name: backupId
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '200':
          description: Backup details retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/BackupEntry'
        '404':
          description: Backup not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

    delete:
      tags:
        - Backup
      summary: Delete backup
      description: Deletes a specific backup and its associated files
      security:
        - localAuth: []
      parameters:
        - name: backupId
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '200':
          description: Backup deleted successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '404':
          description: Backup not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'
        '409':
          description: Cannot delete backup (in use or protected)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

  /api/v1/backup/{backupId}/verify:
    post:
      tags:
        - Backup
      summary: Verify backup integrity
      description: Initiates integrity verification for a specific backup
      security:
        - localAuth: []
      parameters:
        - name: backupId
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '202':
          description: Backup verification initiated
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/BackupIntegrityCheck'

  /api/v1/backup/schedules:
    get:
      tags:
        - Backup
      summary: List backup schedules
      description: Retrieves all configured backup schedules
      security:
        - localAuth: []
      parameters:
        - name: enabled
          in: query
          description: Filter by enabled status
          required: false
          schema:
            type: boolean
      responses:
        '200':
          description: Backup schedules retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          schedules:
                            type: array
                            items:
                              $ref: '#/components/schemas/BackupSchedule'

    post:
      tags:
        - Backup
      summary: Create backup schedule
      description: Creates a new automated backup schedule
      security:
        - localAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  minLength: 1
                  maxLength: 100
                description:
                  type: string
                  maxLength: 500
                enabled:
                  type: boolean
                  default: true
                backupType:
                  type: string
                  enum: [full_system, project_only, database_only, files_only, context_only, configuration_only]
                frequency:
                  type: string
                  enum: [hourly, daily, weekly, monthly, custom]
                cronExpression:
                  type: string
                  description: Required when frequency is 'custom'
                projectFilter:
                  type: object
                  properties:
                    projectIds:
                      type: array
                      items:
                        $ref: '#/components/schemas/UUID'
                    activeOnly:
                      type: boolean
                    statusFilter:
                      type: array
                      items:
                        type: string
                        enum: [active, paused, completed, archived, failed]
                backupConfig:
                  type: object
                  properties:
                    compressionLevel:
                      type: string
                      enum: [none, fast, standard, maximum]
                      default: standard
                    retentionDays:
                      type: integer
                      minimum: 1
                      maximum: 365
                      default: 30
                    maxSize:
                      type: integer
                      minimum: 1
                    encryption:
                      type: boolean
                      default: false
                    backupLocation:
                      type: string
                  required:
                    - retentionDays
              required:
                - name
                - backupType
                - frequency
                - backupConfig
      responses:
        '201':
          description: Backup schedule created successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/BackupSchedule'

  /api/v1/backup/schedules/{scheduleId}:
    get:
      tags:
        - Backup
      summary: Get backup schedule
      description: Retrieves details of a specific backup schedule
      security:
        - localAuth: []
      parameters:
        - name: scheduleId
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '200':
          description: Schedule retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/BackupSchedule'

    put:
      tags:
        - Backup
      summary: Update backup schedule
      description: Updates an existing backup schedule configuration
      security:
        - localAuth: []
      parameters:
        - name: scheduleId
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  minLength: 1
                  maxLength: 100
                description:
                  type: string
                  maxLength: 500
                enabled:
                  type: boolean
                frequency:
                  type: string
                  enum: [hourly, daily, weekly, monthly, custom]
                cronExpression:
                  type: string
                projectFilter:
                  type: object
                backupConfig:
                  type: object
      responses:
        '200':
          description: Schedule updated successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/BackupSchedule'

    delete:
      tags:
        - Backup
      summary: Delete backup schedule
      description: Deletes a backup schedule (does not affect existing backups)
      security:
        - localAuth: []
      parameters:
        - name: scheduleId
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '200':
          description: Schedule deleted successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'

  /api/v1/recovery/restore:
    post:
      tags:
        - Recovery
      summary: Initiate recovery operation
      description: Starts a recovery operation from a specific backup
      security:
        - localAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                backupId:
                  $ref: '#/components/schemas/UUID'
                type:
                  type: string
                  enum: [full_restore, selective_restore, point_in_time, incremental_restore]
                targetProjectId:
                  $ref: '#/components/schemas/UUID'
                  description: Required for project-specific restores
                targetTimestamp:
                  type: string
                  format: date-time
                  description: Required for point_in_time recovery
                componentsToRestore:
                  type: array
                  items:
                    type: string
                  minItems: 1
                options:
                  type: object
                  properties:
                    overwriteExisting:
                      type: boolean
                      default: false
                    createPreRecoveryBackup:
                      type: boolean
                      default: true
                    verifyIntegrity:
                      type: boolean
                      default: true
                    alternativeLocation:
                      type: string
              required:
                - backupId
                - type
                - componentsToRestore
      responses:
        '202':
          description: Recovery operation initiated successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/RecoveryRequest'

  /api/v1/recovery/{recoveryId}:
    get:
      tags:
        - Recovery
      summary: Get recovery status
      description: Retrieves the current status and progress of a recovery operation
      security:
        - localAuth: []
      parameters:
        - name: recoveryId
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '200':
          description: Recovery status retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/RecoveryRequest'

    delete:
      tags:
        - Recovery
      summary: Cancel recovery operation
      description: Cancels an in-progress recovery operation
      security:
        - localAuth: []
      parameters:
        - name: recoveryId
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '200':
          description: Recovery operation cancelled successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'

  /api/v1/backup/storage/stats:
    get:
      tags:
        - Backup
      summary: Get backup storage statistics
      description: Retrieves comprehensive storage usage and backup statistics
      security:
        - localAuth: []
      responses:
        '200':
          description: Storage statistics retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/BackupStorageStats'

  /api/v1/backup/cleanup:
    post:
      tags:
        - Backup
      summary: Perform backup cleanup
      description: Removes expired backups and optimizes storage based on retention policies
      security:
        - localAuth: []
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              properties:
                dryRun:
                  type: boolean
                  default: false
                  description: Preview cleanup without actually deleting
                forceCleanup:
                  type: boolean
                  default: false
                  description: Force cleanup even for protected backups
                specificBackupIds:
                  type: array
                  items:
                    $ref: '#/components/schemas/UUID'
                  description: Cleanup specific backups only
      responses:
        '200':
          description: Backup cleanup completed successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          cleanedBackups:
                            type: array
                            items:
                              $ref: '#/components/schemas/UUID'
                          freedSpace:
                            type: integer
                            description: Space freed in bytes
                          remainingBackups:
                            type: integer

components:
  schemas:
    BackupEntry:
      type: object
      required:
        - id
        - name
        - type
        - triggerType
        - createdAt
        - backupPath
        - size
        - compressionLevel
        - integrityHash
        - verificationStatus
        - metadata
        - encrypted
        - tags
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        name:
          type: string
        type:
          type: string
          enum: [full_system, project_only, database_only, files_only, context_only, configuration_only]
        triggerType:
          type: string
          enum: [manual, scheduled, automatic, pre_operation]
        projectId:
          $ref: '#/components/schemas/UUID'
        createdAt:
          type: string
          format: date-time
        completedAt:
          type: string
          format: date-time
        backupPath:
          type: string
        size:
          type: integer
        compressionLevel:
          type: string
          enum: [none, fast, standard, maximum]
        integrityHash:
          type: string
        verificationStatus:
          type: string
          enum: [pending, verified, corrupted, failed]
        lastVerifiedAt:
          type: string
          format: date-time
        description:
          type: string
        metadata:
          type: object
          properties:
            includedComponents:
              type: array
              items:
                type: string
            fileCount:
              type: integer
            databaseTables:
              type: array
              items:
                type: string
            contextCollections:
              type: array
              items:
                type: string
            backupDuration:
              type: integer
            compressionRatio:
              type: number
        expiresAt:
          type: string
          format: date-time
        encrypted:
          type: boolean
        tags:
          type: array
          items:
            type: string

    BackupSchedule:
      type: object
      required:
        - id
        - name
        - enabled
        - backupType
        - frequency
        - nextExecution
        - backupConfig
        - createdAt
        - lastModified
        - stats
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        name:
          type: string
        description:
          type: string
        enabled:
          type: boolean
        backupType:
          type: string
          enum: [full_system, project_only, database_only, files_only, context_only, configuration_only]
        frequency:
          type: string
          enum: [hourly, daily, weekly, monthly, custom]
        cronExpression:
          type: string
        nextExecution:
          type: string
          format: date-time
        lastExecution:
          type: string
          format: date-time
        projectFilter:
          type: object
          properties:
            projectIds:
              type: array
              items:
                $ref: '#/components/schemas/UUID'
            activeOnly:
              type: boolean
            statusFilter:
              type: array
              items:
                type: string
        backupConfig:
          type: object
          properties:
            compressionLevel:
              type: string
              enum: [none, fast, standard, maximum]
            retentionDays:
              type: integer
            maxSize:
              type: integer
            encryption:
              type: boolean
            backupLocation:
              type: string
        createdAt:
          type: string
          format: date-time
        lastModified:
          type: string
          format: date-time
        stats:
          type: object
          properties:
            totalExecutions:
              type: integer
            successfulExecutions:
              type: integer
            failedExecutions:
              type: integer
            avgBackupSize:
              type: number
            avgExecutionTime:
              type: number

    RecoveryRequest:
      type: object
      required:
        - id
        - type
        - backupId
        - componentsToRestore
        - options
        - createdAt
        - status
        - progress
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        type:
          type: string
          enum: [full_restore, selective_restore, point_in_time, incremental_restore]
        backupId:
          $ref: '#/components/schemas/UUID'
        targetProjectId:
          $ref: '#/components/schemas/UUID'
        targetTimestamp:
          type: string
          format: date-time
        componentsToRestore:
          type: array
          items:
            type: string
        options:
          type: object
          properties:
            overwriteExisting:
              type: boolean
            createPreRecoveryBackup:
              type: boolean
            verifyIntegrity:
              type: boolean
            alternativeLocation:
              type: string
        createdAt:
          type: string
          format: date-time
        status:
          type: string
          enum: [pending, in_progress, completed, failed, cancelled]
        progress:
          type: number
          minimum: 0
          maximum: 100
        result:
          $ref: '#/components/schemas/RecoveryResult'

    RecoveryResult:
      type: object
      required:
        - success
        - restoredComponents
        - executionTime
        - restoredFilesCount
        - restoredDataSize
        - warnings
        - completedAt
      properties:
        success:
          type: boolean
        restoredComponents:
          type: array
          items:
            type: string
        executionTime:
          type: number
        preRecoveryBackupId:
          $ref: '#/components/schemas/UUID'
        restoredFilesCount:
          type: integer
        restoredDataSize:
          type: integer
        warnings:
          type: array
          items:
            type: string
        errors:
          type: array
          items:
            type: string
        completedAt:
          type: string
          format: date-time
        integrityVerification:
          type: object
          properties:
            verified:
              type: boolean
            hashMatches:
              type: boolean
            corruptedFiles:
              type: array
              items:
                type: string

    BackupIntegrityCheck:
      type: object
      required:
        - id
        - backupId
        - checkedAt
        - status
        - executionTime
        - details
        - issues
        - metadata
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        backupId:
          $ref: '#/components/schemas/UUID'
        checkedAt:
          type: string
          format: date-time
        status:
          type: string
          enum: [pending, verified, corrupted, failed]
        executionTime:
          type: number
        details:
          type: object
          properties:
            hashVerification:
              type: boolean
            fileCountMatch:
              type: boolean
            sizeMatch:
              type: boolean
            readabilityTest:
              type: boolean
            compressionVerification:
              type: boolean
        issues:
          type: array
          items:
            type: object
            properties:
              severity:
                type: string
                enum: [low, medium, high, critical]
              component:
                type: string
              description:
                type: string
              recommendation:
                type: string
        metadata:
          type: object
          properties:
            expectedHash:
              type: string
            actualHash:
              type: string
            expectedSize:
              type: integer
            actualSize:
              type: integer

    BackupStorageStats:
      type: object
      required:
        - timestamp
        - totalBackups
        - totalStorageUsed
        - storageByType
        - storageByProject
        - oldestBackup
        - newestBackup
        - avgBackupSize
        - compressionEfficiency
        - growthTrend
        - cleanupRecommendations
      properties:
        timestamp:
          type: string
          format: date-time
        totalBackups:
          type: integer
        totalStorageUsed:
          type: integer
        storageByType:
          type: object
          additionalProperties:
            type: integer
        storageByProject:
          type: object
          additionalProperties:
            type: integer
        oldestBackup:
          type: string
          format: date-time
        newestBackup:
          type: string
          format: date-time
        avgBackupSize:
          type: number
        compressionEfficiency:
          type: number
        growthTrend:
          type: object
          properties:
            dailyGrowth:
              type: number
            weeklyGrowth:
              type: number
            monthlyGrowth:
              type: number
        cleanupRecommendations:
          type: array
          items:
            type: object
            properties:
              backupId:
                $ref: '#/components/schemas/UUID'
              reason:
                type: string
              potentialSavings:
                type: integer
```

## **4. Detailed Business Logic & Validation Rules**

| Rule ID | Rule Description | Implementation Location(s) & Notes |
| :--- | :--- | :--- |
| **BAK-01** | Backup operations must coordinate with the Database Management Module to ensure transactional consistency and prevent corruption during active database operations. | **Backend (Authoritative):** Backup service must request database quiesce from Database Management Module before creating database backups and ensure proper transaction state management. |
| **BAK-02** | Project-specific backups must validate project existence through the Project Management Module and coordinate with Context Management Engine to backup vector embeddings and context data. | **Backend (Authoritative):** Backup service must call Project Management Module to verify project exists and active, then coordinate with Context Management Engine to export context data and vector embeddings. |
| **BAK-03** | File system backups must integrate with File System Management Module to respect workspace isolation and ensure proper handling of file permissions and symbolic links. | **Backend (Authoritative):** Backup service must use File System Management Module APIs for all file operations, respecting workspace isolation levels and preserving file metadata and permissions. |
| **BAK-04** | Backup retention policies must be enforced through Configuration Management Module settings and automatically trigger cleanup operations when retention periods expire. | **Backend (Authoritative):** Backup cleanup service must query Configuration Management Module for retention policies and automatically schedule cleanup operations based on configured retention periods. |
| **BAK-05** | Recovery operations must create pre-recovery backups unless explicitly disabled to prevent data loss during restoration and coordinate with all affected modules to restore their respective data. | **Backend (Authoritative):** Recovery service must create automatic backup before restoration, then coordinate with Database Management, File System Management, and Context Management modules for complete data restoration. |
| **BAK-06** | Backup integrity verification must validate data consistency across all components and automatically quarantine corrupted backups to prevent restoration of invalid data. | **Backend (Authoritative):** Integrity service must perform comprehensive hash validation, file count verification, and readability tests, automatically updating backup status and preventing use of corrupted backups. |
| **BAK-07** | Scheduled backup operations must integrate with Logging & Monitoring Service to track execution metrics and automatically retry failed backups with exponential backoff. | **Backend (Authoritative):** Backup scheduler must log all operations to Logging Service, implement retry logic for failed backups, and track success/failure metrics for schedule optimization. |
| **BAK-08** | Point-in-time recovery operations must coordinate with Multi-Phase Development Orchestrator to ensure restoration doesn't conflict with active development workflows and phase transitions. | **Backend (Authoritative):** Recovery service must check with Multi-Phase Development Orchestrator for active workflows and coordinate recovery timing to prevent conflicts with phase operations. |
| **BAK-09** | Backup compression and encryption operations must respect system performance limits and user productivity KPIs by implementing background processing with configurable resource limits. | **Backend (Authoritative):** Backup service must implement background compression/encryption with resource throttling to maintain &lt;30 second project resume KPI and avoid impacting active development. |
| **BAK-10** | Disaster recovery plans must be validated against current system state and automatically updated when backup configurations or system topology changes. | **Backend (Authoritative):** Disaster recovery service must periodically validate plans against actual backup availability and system configuration, updating plans automatically when changes are detected. |

## **5. Developer Task Checklist**

### **Backend Tasks:**
- [ ] Create database migration script for backup tables (`backup_entries`, `backup_schedules`, `recovery_requests`, `backup_integrity_checks`, `disaster_recovery_plans`)
- [ ] Implement the `BackupService` class with support for all backup types (full_system, project_only, database_only, files_only, context_only, configuration_only)
- [ ] Implement the `BackupSchedulerService` class for automated backup scheduling with cron expression support and execution tracking
- [ ] Implement the `RecoveryService` class for handling all recovery operations including point-in-time recovery and selective restoration
- [ ] Implement the `BackupIntegrityService` class for comprehensive backup verification including hash validation, file integrity, and readability testing
- [ ] Implement the `BackupStorageService` class for storage management, cleanup operations, and storage analytics
- [ ] Implement the `DisasterRecoveryService` class for managing disaster recovery plans and automated testing procedures
- [ ] Implement all backup creation endpoints (`POST /api/v1/backup/create`) with comprehensive validation and background processing
- [ ] Implement backup management endpoints (`GET /api/v1/backup/list`, `GET`, `DELETE /api/v1/backup/{id}`) with filtering and pagination
- [ ] Implement backup verification endpoint (`POST /api/v1/backup/{id}/verify`) with background integrity checking
- [ ] Implement backup schedule endpoints (`GET`, `POST`, `PUT`, `DELETE /api/v1/backup/schedules`) for automated backup management
- [ ] Implement recovery endpoints (`POST /api/v1/recovery/restore`, `GET`, `DELETE /api/v1/recovery/{id}`) with progress tracking
- [ ] Implement storage analytics endpoints (`GET /api/v1/backup/storage/stats`, `POST /api/v1/backup/cleanup`) for storage management
- [ ] Create `BackupRepository` class for backup metadata storage with indexing on type, project_id, created_at, and verification_status
- [ ] Create `ScheduleRepository` class for schedule management with next execution tracking and statistics
- [ ] Create `RecoveryRepository` class for recovery operation tracking with progress monitoring
- [ ] Implement integration with Database Management Module for transactional backup consistency and SQLite backup operations
- [ ] Implement integration with File System Management Module for file backup operations, workspace isolation, and permission preservation
- [ ] Implement integration with Context Management Engine for vector database backup and context data export/import
- [ ] Implement integration with Configuration Management Module for backup policies, retention settings, and storage configuration
- [ ] Implement integration with Project Management Module for project-specific backup validation and metadata inclusion
- [ ] Implement integration with Logging & Monitoring Service for backup operation logging, metrics tracking, and performance monitoring
- [ ] Implement backup compression algorithms with configurable levels (none, fast, standard, maximum)
- [ ] Implement backup encryption using industry-standard encryption algorithms with secure key management
- [ ] Create comprehensive unit tests for all service classes with mock implementations of dependent modules
- [ ] Create integration tests for backup/recovery workflows including cross-module coordination and error scenarios
- [ ] Implement background job processing for backup operations with queue management and resource throttling
- [ ] Add automated backup cleanup service with configurable retention policies and storage optimization

### **Frontend Tasks:**
- [ ] Create `BackupProvider` React context for managing backup operations state and configuration
- [ ] Implement `useBackup` hook for triggering backup operations and monitoring backup status
- [ ] Create `BackupDashboard` component for displaying backup overview, storage usage, and recent operations
- [ ] Implement `BackupCreation` component for initiating manual backups with type selection and configuration options
- [ ] Create `BackupScheduleManager` component for creating and managing automated backup schedules
- [ ] Implement `BackupList` component for displaying backups with filtering, searching, and pagination capabilities
- [ ] Create `RecoveryWizard` component for guiding users through recovery operations with step-by-step interface
- [ ] Implement `BackupIntegrityMonitor` component for displaying backup health status and integrity check results
- [ ] Create `StorageAnalytics` component for visualizing storage usage, growth trends, and cleanup recommendations
- [ ] Implement `DisasterRecoveryPlanner` component for creating and managing disaster recovery plans
- [ ] Create backup service functions in the API client (`backupService.ts`) for all backup and recovery endpoints
- [ ] Implement real-time backup progress monitoring using WebSocket connections or polling for long-running operations
- [ ] Create backup export/import functionality for transferring backups between systems or external storage
- [ ] Implement backup comparison tools for analyzing differences between backup versions
- [ ] Add backup scheduling interface with visual cron expression builder and schedule preview
- [ ] Create recovery simulation interface for testing disaster recovery plans without affecting live data
- [ ] Implement backup encryption configuration interface with key management and security options
- [ ] Add backup notification system for alerting users of completed operations, failures, and maintenance requirements
- [ ] Create backup search and filtering interface with advanced query capabilities and saved searches
- [ ] Implement backup tagging and categorization system for improved organization and management

